{"version":3,"names":["log","require","stringify","Node","Scalar","toJS","MERGE_KEY","addPairToJSMap","ctx","map","key","value","doc","schema","merge","isMergeKey","isAlias","resolve","isSeq","it","items","mergeToJSMap","Array","isArray","jsKey","Map","set","Set","add","stringKey","stringifyKey","jsValue","Object","defineProperty","writable","enumerable","configurable","isScalar","type","PLAIN","source","isMap","Error","srcMap","toJSON","has","prototype","hasOwnProperty","call","String","isNode","strCtx","createStringifyContext","anchors","node","keys","anchor","inFlow","inStringifyKey","strKey","toString","mapKeyWarned","jsonStr","JSON","length","substring","warn","options","logLevel","exports"],"sources":["addPairToJSMap.js"],"sourcesContent":["'use strict';\n\nvar log = require('../log.js');\nvar stringify = require('../stringify/stringify.js');\nvar Node = require('./Node.js');\nvar Scalar = require('./Scalar.js');\nvar toJS = require('./toJS.js');\n\nconst MERGE_KEY = '<<';\nfunction addPairToJSMap(ctx, map, { key, value }) {\n    if (ctx?.doc.schema.merge && isMergeKey(key)) {\n        value = Node.isAlias(value) ? value.resolve(ctx.doc) : value;\n        if (Node.isSeq(value))\n            for (const it of value.items)\n                mergeToJSMap(ctx, map, it);\n        else if (Array.isArray(value))\n            for (const it of value)\n                mergeToJSMap(ctx, map, it);\n        else\n            mergeToJSMap(ctx, map, value);\n    }\n    else {\n        const jsKey = toJS.toJS(key, '', ctx);\n        if (map instanceof Map) {\n            map.set(jsKey, toJS.toJS(value, jsKey, ctx));\n        }\n        else if (map instanceof Set) {\n            map.add(jsKey);\n        }\n        else {\n            const stringKey = stringifyKey(key, jsKey, ctx);\n            const jsValue = toJS.toJS(value, stringKey, ctx);\n            if (stringKey in map)\n                Object.defineProperty(map, stringKey, {\n                    value: jsValue,\n                    writable: true,\n                    enumerable: true,\n                    configurable: true\n                });\n            else\n                map[stringKey] = jsValue;\n        }\n    }\n    return map;\n}\nconst isMergeKey = (key) => key === MERGE_KEY ||\n    (Node.isScalar(key) &&\n        key.value === MERGE_KEY &&\n        (!key.type || key.type === Scalar.Scalar.PLAIN));\n// If the value associated with a merge key is a single mapping node, each of\n// its key/value pairs is inserted into the current mapping, unless the key\n// already exists in it. If the value associated with the merge key is a\n// sequence, then this sequence is expected to contain mapping nodes and each\n// of these nodes is merged in turn according to its order in the sequence.\n// Keys in mapping nodes earlier in the sequence override keys specified in\n// later mapping nodes. -- http://yaml.org/type/merge.html\nfunction mergeToJSMap(ctx, map, value) {\n    const source = ctx && Node.isAlias(value) ? value.resolve(ctx.doc) : value;\n    if (!Node.isMap(source))\n        throw new Error('Merge sources must be maps or map aliases');\n    const srcMap = source.toJSON(null, ctx, Map);\n    for (const [key, value] of srcMap) {\n        if (map instanceof Map) {\n            if (!map.has(key))\n                map.set(key, value);\n        }\n        else if (map instanceof Set) {\n            map.add(key);\n        }\n        else if (!Object.prototype.hasOwnProperty.call(map, key)) {\n            Object.defineProperty(map, key, {\n                value,\n                writable: true,\n                enumerable: true,\n                configurable: true\n            });\n        }\n    }\n    return map;\n}\nfunction stringifyKey(key, jsKey, ctx) {\n    if (jsKey === null)\n        return '';\n    if (typeof jsKey !== 'object')\n        return String(jsKey);\n    if (Node.isNode(key) && ctx && ctx.doc) {\n        const strCtx = stringify.createStringifyContext(ctx.doc, {});\n        strCtx.anchors = new Set();\n        for (const node of ctx.anchors.keys())\n            strCtx.anchors.add(node.anchor);\n        strCtx.inFlow = true;\n        strCtx.inStringifyKey = true;\n        const strKey = key.toString(strCtx);\n        if (!ctx.mapKeyWarned) {\n            let jsonStr = JSON.stringify(strKey);\n            if (jsonStr.length > 40)\n                jsonStr = jsonStr.substring(0, 36) + '...\"';\n            log.warn(ctx.doc.options.logLevel, `Keys with collection values will be stringified due to JS Object restrictions: ${jsonStr}. Set mapAsMap: true to use object keys.`);\n            ctx.mapKeyWarned = true;\n        }\n        return strKey;\n    }\n    return JSON.stringify(jsKey);\n}\n\nexports.addPairToJSMap = addPairToJSMap;\n"],"mappings":"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"}