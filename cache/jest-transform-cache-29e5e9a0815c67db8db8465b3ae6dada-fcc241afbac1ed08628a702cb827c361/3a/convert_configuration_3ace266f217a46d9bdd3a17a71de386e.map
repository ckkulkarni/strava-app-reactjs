{"version":3,"names":["configuration_1","require","convertConfiguration","flatConfiguration","env","sources","paths","defaultDialect","language","names","name","tagExpression","tags","order","support","requireModules","requireModule","requirePaths","importPaths","import","runtime","dryRun","failFast","filterStacktraces","backtrace","parallel","retry","retryTagFilter","strict","worldParameters","formats","convertFormats","exports","splitFormats","format","map","item","OptionSplitter","split","stdout","_b","_a","reverse","find","target","files","filter","reduce","mapped","type","publish","makePublishConfig","options","formatOptions","enabled","isPublishing","url","CUCUMBER_PUBLISH_URL","token","CUCUMBER_PUBLISH_TOKEN","isTruthyString","CUCUMBER_PUBLISH_ENABLED","undefined"],"sources":["../../src/api/convert_configuration.ts"],"sourcesContent":["import {\n  IConfiguration,\n  isTruthyString,\n  OptionSplitter,\n} from '../configuration'\nimport { IPublishConfig } from '../formatter'\nimport { IRunConfiguration } from './types'\n\nexport async function convertConfiguration(\n  flatConfiguration: IConfiguration,\n  env: NodeJS.ProcessEnv\n): Promise<IRunConfiguration> {\n  return {\n    sources: {\n      paths: flatConfiguration.paths,\n      defaultDialect: flatConfiguration.language,\n      names: flatConfiguration.name,\n      tagExpression: flatConfiguration.tags,\n      order: flatConfiguration.order,\n    },\n    support: {\n      requireModules: flatConfiguration.requireModule,\n      requirePaths: flatConfiguration.require,\n      importPaths: flatConfiguration.import,\n    },\n    runtime: {\n      dryRun: flatConfiguration.dryRun,\n      failFast: flatConfiguration.failFast,\n      filterStacktraces: !flatConfiguration.backtrace,\n      parallel: flatConfiguration.parallel,\n      retry: flatConfiguration.retry,\n      retryTagFilter: flatConfiguration.retryTagFilter,\n      strict: flatConfiguration.strict,\n      worldParameters: flatConfiguration.worldParameters,\n    },\n    formats: convertFormats(flatConfiguration, env),\n  }\n}\n\nfunction convertFormats(\n  flatConfiguration: IConfiguration,\n  env: NodeJS.ProcessEnv\n) {\n  const splitFormats: string[][] = flatConfiguration.format.map((item) =>\n    OptionSplitter.split(item)\n  )\n  return {\n    stdout:\n      [...splitFormats].reverse().find(([, target]) => !target)?.[0] ??\n      'progress',\n    files: splitFormats\n      .filter(([, target]) => !!target)\n      .reduce((mapped, [type, target]) => {\n        return {\n          ...mapped,\n          [target]: type,\n        }\n      }, {}),\n    publish: makePublishConfig(flatConfiguration, env),\n    options: flatConfiguration.formatOptions,\n  }\n}\n\nfunction makePublishConfig(\n  flatConfiguration: IConfiguration,\n  env: NodeJS.ProcessEnv\n): IPublishConfig | false {\n  const enabled = isPublishing(flatConfiguration, env)\n  if (!enabled) {\n    return false\n  }\n  return {\n    url: env.CUCUMBER_PUBLISH_URL,\n    token: env.CUCUMBER_PUBLISH_TOKEN,\n  }\n}\n\nfunction isPublishing(\n  flatConfiguration: IConfiguration,\n  env: NodeJS.ProcessEnv\n): boolean {\n  return (\n    flatConfiguration.publish ||\n    isTruthyString(env.CUCUMBER_PUBLISH_ENABLED) ||\n    env.CUCUMBER_PUBLISH_TOKEN !== undefined\n  )\n}\n"],"mappings":";;;;;;AAAA,MAAAA,eAAA,GAAAC,OAAA;AAQO,eAAeC,oBAAoBA,CACxCC,iBAAiC,EACjCC,GAAsB;EAEtB,OAAO;IACLC,OAAO,EAAE;MACPC,KAAK,EAAEH,iBAAiB,CAACG,KAAK;MAC9BC,cAAc,EAAEJ,iBAAiB,CAACK,QAAQ;MAC1CC,KAAK,EAAEN,iBAAiB,CAACO,IAAI;MAC7BC,aAAa,EAAER,iBAAiB,CAACS,IAAI;MACrCC,KAAK,EAAEV,iBAAiB,CAACU;KAC1B;IACDC,OAAO,EAAE;MACPC,cAAc,EAAEZ,iBAAiB,CAACa,aAAa;MAC/CC,YAAY,EAAEd,iBAAiB,CAACF,OAAO;MACvCiB,WAAW,EAAEf,iBAAiB,CAACgB;KAChC;IACDC,OAAO,EAAE;MACPC,MAAM,EAAElB,iBAAiB,CAACkB,MAAM;MAChCC,QAAQ,EAAEnB,iBAAiB,CAACmB,QAAQ;MACpCC,iBAAiB,EAAE,CAACpB,iBAAiB,CAACqB,SAAS;MAC/CC,QAAQ,EAAEtB,iBAAiB,CAACsB,QAAQ;MACpCC,KAAK,EAAEvB,iBAAiB,CAACuB,KAAK;MAC9BC,cAAc,EAAExB,iBAAiB,CAACwB,cAAc;MAChDC,MAAM,EAAEzB,iBAAiB,CAACyB,MAAM;MAChCC,eAAe,EAAE1B,iBAAiB,CAAC0B;KACpC;IACDC,OAAO,EAAEC,cAAc,CAAC5B,iBAAiB,EAAEC,GAAG;GAC/C;AACH;AA7BA4B,OAAA,CAAA9B,oBAAA,GAAAA,oBAAA;AA+BA,SAAS6B,cAAcA,CACrB5B,iBAAiC,EACjCC,GAAsB;;EAEtB,MAAM6B,YAAY,GAAe9B,iBAAiB,CAAC+B,MAAM,CAACC,GAAG,CAAEC,IAAI,IACjEpC,eAAA,CAAAqC,cAAc,CAACC,KAAK,CAACF,IAAI,CAAC,CAC3B;EACD,OAAO;IACLG,MAAM,EACJ,CAAAC,EAAA,IAAAC,EAAA,IAAC,GAAGR,YAAY,CAAC,CAACS,OAAO,EAAE,CAACC,IAAI,CAAC,CAAC,GAAGC,MAAM,CAAC,KAAK,CAACA,MAAM,CAAC,cAAAH,EAAA,uBAAAA,EAAA,CAAG,CAAC,CAAC,cAAAD,EAAA,cAAAA,EAAA,GAC9D,UAAU;IACZK,KAAK,EAAEZ,YAAY,CAChBa,MAAM,CAAC,CAAC,GAAGF,MAAM,CAAC,KAAK,CAAC,CAACA,MAAM,CAAC,CAChCG,MAAM,CAAC,CAACC,MAAM,EAAE,CAACC,IAAI,EAAEL,MAAM,CAAC,KAAI;MACjC,OAAO;QACL,GAAGI,MAAM;QACT,CAACJ,MAAM,GAAGK;OACX;IACH,CAAC,EAAE,EAAE,CAAC;IACRC,OAAO,EAAEC,iBAAiB,CAAChD,iBAAiB,EAAEC,GAAG,CAAC;IAClDgD,OAAO,EAAEjD,iBAAiB,CAACkD;GAC5B;AACH;AAEA,SAASF,iBAAiBA,CACxBhD,iBAAiC,EACjCC,GAAsB;EAEtB,MAAMkD,OAAO,GAAGC,YAAY,CAACpD,iBAAiB,EAAEC,GAAG,CAAC;EACpD,IAAI,CAACkD,OAAO,EAAE;IACZ,OAAO,KAAK;;EAEd,OAAO;IACLE,GAAG,EAAEpD,GAAG,CAACqD,oBAAoB;IAC7BC,KAAK,EAAEtD,GAAG,CAACuD;GACZ;AACH;AAEA,SAASJ,YAAYA,CACnBpD,iBAAiC,EACjCC,GAAsB;EAEtB,OACED,iBAAiB,CAAC+C,OAAO,IACzB,IAAAlD,eAAA,CAAA4D,cAAc,EAACxD,GAAG,CAACyD,wBAAwB,CAAC,IAC5CzD,GAAG,CAACuD,sBAAsB,KAAKG,SAAS;AAE5C"}