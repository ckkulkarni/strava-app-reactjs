6318273f2a6febe905486c7e3ffeea0f
"use strict";

var __createBinding = void 0 && (void 0).__createBinding || (Object.create ? function (o, m, k, k2) {
  if (k2 === undefined) k2 = k;
  var desc = Object.getOwnPropertyDescriptor(m, k);
  if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
    desc = {
      enumerable: true,
      get: function () {
        return m[k];
      }
    };
  }
  Object.defineProperty(o, k2, desc);
} : function (o, m, k, k2) {
  if (k2 === undefined) k2 = k;
  o[k2] = m[k];
});
var __setModuleDefault = void 0 && (void 0).__setModuleDefault || (Object.create ? function (o, v) {
  Object.defineProperty(o, "default", {
    enumerable: true,
    value: v
  });
} : function (o, v) {
  o["default"] = v;
});
var __importStar = void 0 && (void 0).__importStar || function (mod) {
  if (mod && mod.__esModule) return mod;
  var result = {};
  if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
  __setModuleDefault(result, mod);
  return result;
};
var __importDefault = void 0 && (void 0).__importDefault || function (mod) {
  return mod && mod.__esModule ? mod : {
    "default": mod
  };
};
Object.defineProperty(exports, "__esModule", {
  value: true
});
const child_process_1 = require("child_process");
const path_1 = __importDefault(require("path"));
const helpers_1 = require("../helpers");
const messages = __importStar(require("@cucumber/messages"));
const value_checker_1 = require("../../value_checker");
const stopwatch_1 = require("../stopwatch");
const assemble_test_cases_1 = require("../assemble_test_cases");
const runWorkerPath = path_1.default.resolve(__dirname, 'run_worker.js');
class Coordinator {
  constructor({
    cwd,
    logger,
    eventBroadcaster,
    eventDataCollector,
    pickleIds,
    options,
    newId,
    supportCodeLibrary,
    requireModules,
    requirePaths,
    importPaths,
    numberOfWorkers
  }) {
    this.cwd = cwd;
    this.logger = logger;
    this.eventBroadcaster = eventBroadcaster;
    this.eventDataCollector = eventDataCollector;
    this.stopwatch = (0, stopwatch_1.create)();
    this.options = options;
    this.newId = newId;
    this.supportCodeLibrary = supportCodeLibrary;
    this.requireModules = requireModules;
    this.requirePaths = requirePaths;
    this.importPaths = importPaths;
    this.pickleIds = Array.from(pickleIds);
    this.numberOfWorkers = numberOfWorkers;
    this.success = true;
    this.workers = {};
    this.inProgressPickles = {};
    this.idleInterventions = 0;
  }
  parseWorkerMessage(worker, message) {
    if (message.ready) {
      worker.state = 0 /* WorkerState.idle */;
      this.awakenWorkers(worker);
    } else if ((0, value_checker_1.doesHaveValue)(message.jsonEnvelope)) {
      const envelope = messages.parseEnvelope(message.jsonEnvelope);
      this.eventBroadcaster.emit('envelope', envelope);
      if ((0, value_checker_1.doesHaveValue)(envelope.testCaseFinished)) {
        delete this.inProgressPickles[worker.id];
        this.parseTestCaseResult(envelope.testCaseFinished);
      }
    } else {
      throw new Error(`Unexpected message from worker: ${JSON.stringify(message)}`);
    }
  }
  awakenWorkers(triggeringWorker) {
    Object.values(this.workers).forEach(worker => {
      if (worker.state === 0 /* WorkerState.idle */) {
        this.giveWork(worker);
      }
      return worker.state !== 0 /* WorkerState.idle */;
    });

    if (Object.keys(this.inProgressPickles).length == 0 && this.pickleIds.length > 0) {
      this.giveWork(triggeringWorker, true);
      this.idleInterventions++;
    }
  }
  startWorker(id, total) {
    const workerProcess = (0, child_process_1.fork)(runWorkerPath, [], {
      cwd: this.cwd,
      env: {
        ...process.env,
        CUCUMBER_PARALLEL: 'true',
        CUCUMBER_TOTAL_WORKERS: total.toString(),
        CUCUMBER_WORKER_ID: id
      },
      stdio: ['inherit', 'inherit', 'inherit', 'ipc']
    });
    const worker = {
      state: 3 /* WorkerState.new */,
      process: workerProcess,
      id
    };
    this.workers[id] = worker;
    worker.process.on('message', message => {
      this.parseWorkerMessage(worker, message);
    });
    worker.process.on('close', exitCode => {
      worker.state = 1 /* WorkerState.closed */;
      this.onWorkerProcessClose(exitCode);
    });
    const initializeCommand = {
      initialize: {
        filterStacktraces: this.options.filterStacktraces,
        requireModules: this.requireModules,
        requirePaths: this.requirePaths,
        importPaths: this.importPaths,
        supportCodeIds: {
          stepDefinitionIds: this.supportCodeLibrary.stepDefinitions.map(s => s.id),
          beforeTestCaseHookDefinitionIds: this.supportCodeLibrary.beforeTestCaseHookDefinitions.map(h => h.id),
          afterTestCaseHookDefinitionIds: this.supportCodeLibrary.afterTestCaseHookDefinitions.map(h => h.id)
        },
        options: this.options
      }
    };
    worker.process.send(initializeCommand);
  }
  onWorkerProcessClose(exitCode) {
    const success = exitCode === 0;
    if (!success) {
      this.success = false;
    }
    if (Object.values(this.workers).every(x => x.state === 1 /* WorkerState.closed */)) {
      const envelope = {
        testRunFinished: {
          timestamp: this.stopwatch.timestamp(),
          success
        }
      };
      this.eventBroadcaster.emit('envelope', envelope);
      this.onFinish(this.success);
    }
  }
  parseTestCaseResult(testCaseFinished) {
    const {
      worstTestStepResult
    } = this.eventDataCollector.getTestCaseAttempt(testCaseFinished.testCaseStartedId);
    if (!testCaseFinished.willBeRetried && (0, helpers_1.shouldCauseFailure)(worstTestStepResult.status, this.options)) {
      this.success = false;
    }
  }
  async start() {
    const envelope = {
      testRunStarted: {
        timestamp: this.stopwatch.timestamp()
      }
    };
    this.eventBroadcaster.emit('envelope', envelope);
    this.stopwatch.start();
    this.assembledTestCases = await (0, assemble_test_cases_1.assembleTestCases)({
      eventBroadcaster: this.eventBroadcaster,
      newId: this.newId,
      pickles: this.pickleIds.map(pickleId => this.eventDataCollector.getPickle(pickleId)),
      supportCodeLibrary: this.supportCodeLibrary
    });
    return await new Promise(resolve => {
      for (let i = 0; i < this.numberOfWorkers; i++) {
        this.startWorker(i.toString(), this.numberOfWorkers);
      }
      this.onFinish = status => {
        if (this.idleInterventions > 0) {
          this.logger.warn(`WARNING: All workers went idle ${this.idleInterventions} time(s). Consider revising handler passed to setParallelCanAssign.`);
        }
        resolve(status);
      };
    });
  }
  nextPicklePlacement() {
    for (let index = 0; index < this.pickleIds.length; index++) {
      const placement = this.placementAt(index);
      if (this.supportCodeLibrary.parallelCanAssign(placement.pickle, Object.values(this.inProgressPickles))) {
        return placement;
      }
    }
    return null;
  }
  placementAt(index) {
    return {
      index,
      pickle: this.eventDataCollector.getPickle(this.pickleIds[index])
    };
  }
  giveWork(worker, force = false) {
    if (this.pickleIds.length < 1) {
      const finalizeCommand = {
        finalize: true
      };
      worker.state = 2 /* WorkerState.running */;
      worker.process.send(finalizeCommand);
      return;
    }
    const picklePlacement = force ? this.placementAt(0) : this.nextPicklePlacement();
    if (picklePlacement === null) {
      return;
    }
    const {
      index: nextPickleIndex,
      pickle
    } = picklePlacement;
    this.pickleIds.splice(nextPickleIndex, 1);
    this.inProgressPickles[worker.id] = pickle;
    const testCase = this.assembledTestCases[pickle.id];
    const gherkinDocument = this.eventDataCollector.getGherkinDocument(pickle.uri);
    const retries = (0, helpers_1.retriesForPickle)(pickle, this.options);
    const skip = this.options.dryRun || this.options.failFast && !this.success;
    const runCommand = {
      run: {
        retries,
        skip,
        elapsed: this.stopwatch.duration(),
        pickle,
        testCase,
        gherkinDocument
      }
    };
    worker.state = 2 /* WorkerState.running */;
    worker.process.send(runCommand);
  }
}
exports.default = Coordinator;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjaGlsZF9wcm9jZXNzXzEiLCJyZXF1aXJlIiwicGF0aF8xIiwiX19pbXBvcnREZWZhdWx0IiwiaGVscGVyc18xIiwibWVzc2FnZXMiLCJfX2ltcG9ydFN0YXIiLCJ2YWx1ZV9jaGVja2VyXzEiLCJzdG9wd2F0Y2hfMSIsImFzc2VtYmxlX3Rlc3RfY2FzZXNfMSIsInJ1bldvcmtlclBhdGgiLCJkZWZhdWx0IiwicmVzb2x2ZSIsIl9fZGlybmFtZSIsIkNvb3JkaW5hdG9yIiwiY29uc3RydWN0b3IiLCJjd2QiLCJsb2dnZXIiLCJldmVudEJyb2FkY2FzdGVyIiwiZXZlbnREYXRhQ29sbGVjdG9yIiwicGlja2xlSWRzIiwib3B0aW9ucyIsIm5ld0lkIiwic3VwcG9ydENvZGVMaWJyYXJ5IiwicmVxdWlyZU1vZHVsZXMiLCJyZXF1aXJlUGF0aHMiLCJpbXBvcnRQYXRocyIsIm51bWJlck9mV29ya2VycyIsInN0b3B3YXRjaCIsImNyZWF0ZSIsIkFycmF5IiwiZnJvbSIsInN1Y2Nlc3MiLCJ3b3JrZXJzIiwiaW5Qcm9ncmVzc1BpY2tsZXMiLCJpZGxlSW50ZXJ2ZW50aW9ucyIsInBhcnNlV29ya2VyTWVzc2FnZSIsIndvcmtlciIsIm1lc3NhZ2UiLCJyZWFkeSIsInN0YXRlIiwiYXdha2VuV29ya2VycyIsImRvZXNIYXZlVmFsdWUiLCJqc29uRW52ZWxvcGUiLCJlbnZlbG9wZSIsInBhcnNlRW52ZWxvcGUiLCJlbWl0IiwidGVzdENhc2VGaW5pc2hlZCIsImlkIiwicGFyc2VUZXN0Q2FzZVJlc3VsdCIsIkVycm9yIiwiSlNPTiIsInN0cmluZ2lmeSIsInRyaWdnZXJpbmdXb3JrZXIiLCJPYmplY3QiLCJ2YWx1ZXMiLCJmb3JFYWNoIiwiZ2l2ZVdvcmsiLCJrZXlzIiwibGVuZ3RoIiwic3RhcnRXb3JrZXIiLCJ0b3RhbCIsIndvcmtlclByb2Nlc3MiLCJmb3JrIiwiZW52IiwicHJvY2VzcyIsIkNVQ1VNQkVSX1BBUkFMTEVMIiwiQ1VDVU1CRVJfVE9UQUxfV09SS0VSUyIsInRvU3RyaW5nIiwiQ1VDVU1CRVJfV09SS0VSX0lEIiwic3RkaW8iLCJvbiIsImV4aXRDb2RlIiwib25Xb3JrZXJQcm9jZXNzQ2xvc2UiLCJpbml0aWFsaXplQ29tbWFuZCIsImluaXRpYWxpemUiLCJmaWx0ZXJTdGFja3RyYWNlcyIsInN1cHBvcnRDb2RlSWRzIiwic3RlcERlZmluaXRpb25JZHMiLCJzdGVwRGVmaW5pdGlvbnMiLCJtYXAiLCJzIiwiYmVmb3JlVGVzdENhc2VIb29rRGVmaW5pdGlvbklkcyIsImJlZm9yZVRlc3RDYXNlSG9va0RlZmluaXRpb25zIiwiaCIsImFmdGVyVGVzdENhc2VIb29rRGVmaW5pdGlvbklkcyIsImFmdGVyVGVzdENhc2VIb29rRGVmaW5pdGlvbnMiLCJzZW5kIiwiZXZlcnkiLCJ4IiwidGVzdFJ1bkZpbmlzaGVkIiwidGltZXN0YW1wIiwib25GaW5pc2giLCJ3b3JzdFRlc3RTdGVwUmVzdWx0IiwiZ2V0VGVzdENhc2VBdHRlbXB0IiwidGVzdENhc2VTdGFydGVkSWQiLCJ3aWxsQmVSZXRyaWVkIiwic2hvdWxkQ2F1c2VGYWlsdXJlIiwic3RhdHVzIiwic3RhcnQiLCJ0ZXN0UnVuU3RhcnRlZCIsImFzc2VtYmxlZFRlc3RDYXNlcyIsImFzc2VtYmxlVGVzdENhc2VzIiwicGlja2xlcyIsInBpY2tsZUlkIiwiZ2V0UGlja2xlIiwiUHJvbWlzZSIsImkiLCJ3YXJuIiwibmV4dFBpY2tsZVBsYWNlbWVudCIsImluZGV4IiwicGxhY2VtZW50IiwicGxhY2VtZW50QXQiLCJwYXJhbGxlbENhbkFzc2lnbiIsInBpY2tsZSIsImZvcmNlIiwiZmluYWxpemVDb21tYW5kIiwiZmluYWxpemUiLCJwaWNrbGVQbGFjZW1lbnQiLCJuZXh0UGlja2xlSW5kZXgiLCJzcGxpY2UiLCJ0ZXN0Q2FzZSIsImdoZXJraW5Eb2N1bWVudCIsImdldEdoZXJraW5Eb2N1bWVudCIsInVyaSIsInJldHJpZXMiLCJyZXRyaWVzRm9yUGlja2xlIiwic2tpcCIsImRyeVJ1biIsImZhaWxGYXN0IiwicnVuQ29tbWFuZCIsInJ1biIsImVsYXBzZWQiLCJkdXJhdGlvbiIsImV4cG9ydHMiXSwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvcnVudGltZS9wYXJhbGxlbC9jb29yZGluYXRvci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDaGlsZFByb2Nlc3MsIGZvcmsgfSBmcm9tICdjaGlsZF9wcm9jZXNzJ1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCdcbmltcG9ydCB7IHJldHJpZXNGb3JQaWNrbGUsIHNob3VsZENhdXNlRmFpbHVyZSB9IGZyb20gJy4uL2hlbHBlcnMnXG5pbXBvcnQgKiBhcyBtZXNzYWdlcyBmcm9tICdAY3VjdW1iZXIvbWVzc2FnZXMnXG5pbXBvcnQgeyBFdmVudEVtaXR0ZXIgfSBmcm9tICdldmVudHMnXG5pbXBvcnQgeyBFdmVudERhdGFDb2xsZWN0b3IgfSBmcm9tICcuLi8uLi9mb3JtYXR0ZXIvaGVscGVycydcbmltcG9ydCB7IElSdW50aW1lLCBJUnVudGltZU9wdGlvbnMgfSBmcm9tICcuLidcbmltcG9ydCB7IElTdXBwb3J0Q29kZUxpYnJhcnkgfSBmcm9tICcuLi8uLi9zdXBwb3J0X2NvZGVfbGlicmFyeV9idWlsZGVyL3R5cGVzJ1xuaW1wb3J0IHsgSUNvb3JkaW5hdG9yUmVwb3J0LCBJV29ya2VyQ29tbWFuZCB9IGZyb20gJy4vY29tbWFuZF90eXBlcydcbmltcG9ydCB7IGRvZXNIYXZlVmFsdWUgfSBmcm9tICcuLi8uLi92YWx1ZV9jaGVja2VyJ1xuaW1wb3J0IHsgSVN0b3B3YXRjaCwgY3JlYXRlIH0gZnJvbSAnLi4vc3RvcHdhdGNoJ1xuaW1wb3J0IHsgYXNzZW1ibGVUZXN0Q2FzZXMsIElBc3NlbWJsZWRUZXN0Q2FzZXMgfSBmcm9tICcuLi9hc3NlbWJsZV90ZXN0X2Nhc2VzJ1xuaW1wb3J0IHsgSWRHZW5lcmF0b3IgfSBmcm9tICdAY3VjdW1iZXIvbWVzc2FnZXMnXG5pbXBvcnQgeyBJTG9nZ2VyIH0gZnJvbSAnLi4vLi4vbG9nZ2VyJ1xuXG5jb25zdCBydW5Xb3JrZXJQYXRoID0gcGF0aC5yZXNvbHZlKF9fZGlybmFtZSwgJ3J1bl93b3JrZXIuanMnKVxuXG5leHBvcnQgaW50ZXJmYWNlIElOZXdDb29yZGluYXRvck9wdGlvbnMge1xuICBjd2Q6IHN0cmluZ1xuICBsb2dnZXI6IElMb2dnZXJcbiAgZXZlbnRCcm9hZGNhc3RlcjogRXZlbnRFbWl0dGVyXG4gIGV2ZW50RGF0YUNvbGxlY3RvcjogRXZlbnREYXRhQ29sbGVjdG9yXG4gIG9wdGlvbnM6IElSdW50aW1lT3B0aW9uc1xuICBuZXdJZDogSWRHZW5lcmF0b3IuTmV3SWRcbiAgcGlja2xlSWRzOiBzdHJpbmdbXVxuICBzdXBwb3J0Q29kZUxpYnJhcnk6IElTdXBwb3J0Q29kZUxpYnJhcnlcbiAgcmVxdWlyZU1vZHVsZXM6IHN0cmluZ1tdXG4gIHJlcXVpcmVQYXRoczogc3RyaW5nW11cbiAgaW1wb3J0UGF0aHM6IHN0cmluZ1tdXG4gIG51bWJlck9mV29ya2VyczogbnVtYmVyXG59XG5cbmNvbnN0IGVudW0gV29ya2VyU3RhdGUge1xuICAnaWRsZScsXG4gICdjbG9zZWQnLFxuICAncnVubmluZycsXG4gICduZXcnLFxufVxuXG5pbnRlcmZhY2UgSVdvcmtlciB7XG4gIHN0YXRlOiBXb3JrZXJTdGF0ZVxuICBwcm9jZXNzOiBDaGlsZFByb2Nlc3NcbiAgaWQ6IHN0cmluZ1xufVxuXG5pbnRlcmZhY2UgSVBpY2tsZVBsYWNlbWVudCB7XG4gIGluZGV4OiBudW1iZXJcbiAgcGlja2xlOiBtZXNzYWdlcy5QaWNrbGVcbn1cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ29vcmRpbmF0b3IgaW1wbGVtZW50cyBJUnVudGltZSB7XG4gIHByaXZhdGUgcmVhZG9ubHkgY3dkOiBzdHJpbmdcbiAgcHJpdmF0ZSByZWFkb25seSBldmVudEJyb2FkY2FzdGVyOiBFdmVudEVtaXR0ZXJcbiAgcHJpdmF0ZSByZWFkb25seSBldmVudERhdGFDb2xsZWN0b3I6IEV2ZW50RGF0YUNvbGxlY3RvclxuICBwcml2YXRlIHJlYWRvbmx5IHN0b3B3YXRjaDogSVN0b3B3YXRjaFxuICBwcml2YXRlIG9uRmluaXNoOiAoc3VjY2VzczogYm9vbGVhbikgPT4gdm9pZFxuICBwcml2YXRlIHJlYWRvbmx5IG9wdGlvbnM6IElSdW50aW1lT3B0aW9uc1xuICBwcml2YXRlIHJlYWRvbmx5IG5ld0lkOiBJZEdlbmVyYXRvci5OZXdJZFxuICBwcml2YXRlIHJlYWRvbmx5IHBpY2tsZUlkczogc3RyaW5nW11cbiAgcHJpdmF0ZSBhc3NlbWJsZWRUZXN0Q2FzZXM6IElBc3NlbWJsZWRUZXN0Q2FzZXNcbiAgcHJpdmF0ZSBpblByb2dyZXNzUGlja2xlczogUmVjb3JkPHN0cmluZywgbWVzc2FnZXMuUGlja2xlPlxuICBwcml2YXRlIHdvcmtlcnM6IFJlY29yZDxzdHJpbmcsIElXb3JrZXI+XG4gIHByaXZhdGUgcmVhZG9ubHkgc3VwcG9ydENvZGVMaWJyYXJ5OiBJU3VwcG9ydENvZGVMaWJyYXJ5XG4gIHByaXZhdGUgcmVhZG9ubHkgcmVxdWlyZU1vZHVsZXM6IHN0cmluZ1tdXG4gIHByaXZhdGUgcmVhZG9ubHkgcmVxdWlyZVBhdGhzOiBzdHJpbmdbXVxuICBwcml2YXRlIHJlYWRvbmx5IGltcG9ydFBhdGhzOiBzdHJpbmdbXVxuICBwcml2YXRlIHJlYWRvbmx5IG51bWJlck9mV29ya2VyczogbnVtYmVyXG4gIHByaXZhdGUgcmVhZG9ubHkgbG9nZ2VyOiBJTG9nZ2VyXG4gIHByaXZhdGUgc3VjY2VzczogYm9vbGVhblxuICBwcml2YXRlIGlkbGVJbnRlcnZlbnRpb25zOiBudW1iZXJcblxuICBjb25zdHJ1Y3Rvcih7XG4gICAgY3dkLFxuICAgIGxvZ2dlcixcbiAgICBldmVudEJyb2FkY2FzdGVyLFxuICAgIGV2ZW50RGF0YUNvbGxlY3RvcixcbiAgICBwaWNrbGVJZHMsXG4gICAgb3B0aW9ucyxcbiAgICBuZXdJZCxcbiAgICBzdXBwb3J0Q29kZUxpYnJhcnksXG4gICAgcmVxdWlyZU1vZHVsZXMsXG4gICAgcmVxdWlyZVBhdGhzLFxuICAgIGltcG9ydFBhdGhzLFxuICAgIG51bWJlck9mV29ya2VycyxcbiAgfTogSU5ld0Nvb3JkaW5hdG9yT3B0aW9ucykge1xuICAgIHRoaXMuY3dkID0gY3dkXG4gICAgdGhpcy5sb2dnZXIgPSBsb2dnZXJcbiAgICB0aGlzLmV2ZW50QnJvYWRjYXN0ZXIgPSBldmVudEJyb2FkY2FzdGVyXG4gICAgdGhpcy5ldmVudERhdGFDb2xsZWN0b3IgPSBldmVudERhdGFDb2xsZWN0b3JcbiAgICB0aGlzLnN0b3B3YXRjaCA9IGNyZWF0ZSgpXG4gICAgdGhpcy5vcHRpb25zID0gb3B0aW9uc1xuICAgIHRoaXMubmV3SWQgPSBuZXdJZFxuICAgIHRoaXMuc3VwcG9ydENvZGVMaWJyYXJ5ID0gc3VwcG9ydENvZGVMaWJyYXJ5XG4gICAgdGhpcy5yZXF1aXJlTW9kdWxlcyA9IHJlcXVpcmVNb2R1bGVzXG4gICAgdGhpcy5yZXF1aXJlUGF0aHMgPSByZXF1aXJlUGF0aHNcbiAgICB0aGlzLmltcG9ydFBhdGhzID0gaW1wb3J0UGF0aHNcbiAgICB0aGlzLnBpY2tsZUlkcyA9IEFycmF5LmZyb20ocGlja2xlSWRzKVxuICAgIHRoaXMubnVtYmVyT2ZXb3JrZXJzID0gbnVtYmVyT2ZXb3JrZXJzXG4gICAgdGhpcy5zdWNjZXNzID0gdHJ1ZVxuICAgIHRoaXMud29ya2VycyA9IHt9XG4gICAgdGhpcy5pblByb2dyZXNzUGlja2xlcyA9IHt9XG4gICAgdGhpcy5pZGxlSW50ZXJ2ZW50aW9ucyA9IDBcbiAgfVxuXG4gIHBhcnNlV29ya2VyTWVzc2FnZSh3b3JrZXI6IElXb3JrZXIsIG1lc3NhZ2U6IElDb29yZGluYXRvclJlcG9ydCk6IHZvaWQge1xuICAgIGlmIChtZXNzYWdlLnJlYWR5KSB7XG4gICAgICB3b3JrZXIuc3RhdGUgPSBXb3JrZXJTdGF0ZS5pZGxlXG4gICAgICB0aGlzLmF3YWtlbldvcmtlcnMod29ya2VyKVxuICAgIH0gZWxzZSBpZiAoZG9lc0hhdmVWYWx1ZShtZXNzYWdlLmpzb25FbnZlbG9wZSkpIHtcbiAgICAgIGNvbnN0IGVudmVsb3BlID0gbWVzc2FnZXMucGFyc2VFbnZlbG9wZShtZXNzYWdlLmpzb25FbnZlbG9wZSlcbiAgICAgIHRoaXMuZXZlbnRCcm9hZGNhc3Rlci5lbWl0KCdlbnZlbG9wZScsIGVudmVsb3BlKVxuICAgICAgaWYgKGRvZXNIYXZlVmFsdWUoZW52ZWxvcGUudGVzdENhc2VGaW5pc2hlZCkpIHtcbiAgICAgICAgZGVsZXRlIHRoaXMuaW5Qcm9ncmVzc1BpY2tsZXNbd29ya2VyLmlkXVxuICAgICAgICB0aGlzLnBhcnNlVGVzdENhc2VSZXN1bHQoZW52ZWxvcGUudGVzdENhc2VGaW5pc2hlZClcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBgVW5leHBlY3RlZCBtZXNzYWdlIGZyb20gd29ya2VyOiAke0pTT04uc3RyaW5naWZ5KG1lc3NhZ2UpfWBcbiAgICAgIClcbiAgICB9XG4gIH1cblxuICBhd2FrZW5Xb3JrZXJzKHRyaWdnZXJpbmdXb3JrZXI6IElXb3JrZXIpOiB2b2lkIHtcbiAgICBPYmplY3QudmFsdWVzKHRoaXMud29ya2VycykuZm9yRWFjaCgod29ya2VyKSA9PiB7XG4gICAgICBpZiAod29ya2VyLnN0YXRlID09PSBXb3JrZXJTdGF0ZS5pZGxlKSB7XG4gICAgICAgIHRoaXMuZ2l2ZVdvcmsod29ya2VyKVxuICAgICAgfVxuICAgICAgcmV0dXJuIHdvcmtlci5zdGF0ZSAhPT0gV29ya2VyU3RhdGUuaWRsZVxuICAgIH0pXG5cbiAgICBpZiAoXG4gICAgICBPYmplY3Qua2V5cyh0aGlzLmluUHJvZ3Jlc3NQaWNrbGVzKS5sZW5ndGggPT0gMCAmJlxuICAgICAgdGhpcy5waWNrbGVJZHMubGVuZ3RoID4gMFxuICAgICkge1xuICAgICAgdGhpcy5naXZlV29yayh0cmlnZ2VyaW5nV29ya2VyLCB0cnVlKVxuICAgICAgdGhpcy5pZGxlSW50ZXJ2ZW50aW9ucysrXG4gICAgfVxuICB9XG5cbiAgc3RhcnRXb3JrZXIoaWQ6IHN0cmluZywgdG90YWw6IG51bWJlcik6IHZvaWQge1xuICAgIGNvbnN0IHdvcmtlclByb2Nlc3MgPSBmb3JrKHJ1bldvcmtlclBhdGgsIFtdLCB7XG4gICAgICBjd2Q6IHRoaXMuY3dkLFxuICAgICAgZW52OiB7XG4gICAgICAgIC4uLnByb2Nlc3MuZW52LFxuICAgICAgICBDVUNVTUJFUl9QQVJBTExFTDogJ3RydWUnLFxuICAgICAgICBDVUNVTUJFUl9UT1RBTF9XT1JLRVJTOiB0b3RhbC50b1N0cmluZygpLFxuICAgICAgICBDVUNVTUJFUl9XT1JLRVJfSUQ6IGlkLFxuICAgICAgfSxcbiAgICAgIHN0ZGlvOiBbJ2luaGVyaXQnLCAnaW5oZXJpdCcsICdpbmhlcml0JywgJ2lwYyddLFxuICAgIH0pXG4gICAgY29uc3Qgd29ya2VyID0geyBzdGF0ZTogV29ya2VyU3RhdGUubmV3LCBwcm9jZXNzOiB3b3JrZXJQcm9jZXNzLCBpZCB9XG4gICAgdGhpcy53b3JrZXJzW2lkXSA9IHdvcmtlclxuICAgIHdvcmtlci5wcm9jZXNzLm9uKCdtZXNzYWdlJywgKG1lc3NhZ2U6IElDb29yZGluYXRvclJlcG9ydCkgPT4ge1xuICAgICAgdGhpcy5wYXJzZVdvcmtlck1lc3NhZ2Uod29ya2VyLCBtZXNzYWdlKVxuICAgIH0pXG4gICAgd29ya2VyLnByb2Nlc3Mub24oJ2Nsb3NlJywgKGV4aXRDb2RlKSA9PiB7XG4gICAgICB3b3JrZXIuc3RhdGUgPSBXb3JrZXJTdGF0ZS5jbG9zZWRcbiAgICAgIHRoaXMub25Xb3JrZXJQcm9jZXNzQ2xvc2UoZXhpdENvZGUpXG4gICAgfSlcbiAgICBjb25zdCBpbml0aWFsaXplQ29tbWFuZDogSVdvcmtlckNvbW1hbmQgPSB7XG4gICAgICBpbml0aWFsaXplOiB7XG4gICAgICAgIGZpbHRlclN0YWNrdHJhY2VzOiB0aGlzLm9wdGlvbnMuZmlsdGVyU3RhY2t0cmFjZXMsXG4gICAgICAgIHJlcXVpcmVNb2R1bGVzOiB0aGlzLnJlcXVpcmVNb2R1bGVzLFxuICAgICAgICByZXF1aXJlUGF0aHM6IHRoaXMucmVxdWlyZVBhdGhzLFxuICAgICAgICBpbXBvcnRQYXRoczogdGhpcy5pbXBvcnRQYXRocyxcbiAgICAgICAgc3VwcG9ydENvZGVJZHM6IHtcbiAgICAgICAgICBzdGVwRGVmaW5pdGlvbklkczogdGhpcy5zdXBwb3J0Q29kZUxpYnJhcnkuc3RlcERlZmluaXRpb25zLm1hcChcbiAgICAgICAgICAgIChzKSA9PiBzLmlkXG4gICAgICAgICAgKSxcbiAgICAgICAgICBiZWZvcmVUZXN0Q2FzZUhvb2tEZWZpbml0aW9uSWRzOlxuICAgICAgICAgICAgdGhpcy5zdXBwb3J0Q29kZUxpYnJhcnkuYmVmb3JlVGVzdENhc2VIb29rRGVmaW5pdGlvbnMubWFwKFxuICAgICAgICAgICAgICAoaCkgPT4gaC5pZFxuICAgICAgICAgICAgKSxcbiAgICAgICAgICBhZnRlclRlc3RDYXNlSG9va0RlZmluaXRpb25JZHM6XG4gICAgICAgICAgICB0aGlzLnN1cHBvcnRDb2RlTGlicmFyeS5hZnRlclRlc3RDYXNlSG9va0RlZmluaXRpb25zLm1hcChcbiAgICAgICAgICAgICAgKGgpID0+IGguaWRcbiAgICAgICAgICAgICksXG4gICAgICAgIH0sXG4gICAgICAgIG9wdGlvbnM6IHRoaXMub3B0aW9ucyxcbiAgICAgIH0sXG4gICAgfVxuICAgIHdvcmtlci5wcm9jZXNzLnNlbmQoaW5pdGlhbGl6ZUNvbW1hbmQpXG4gIH1cblxuICBvbldvcmtlclByb2Nlc3NDbG9zZShleGl0Q29kZTogbnVtYmVyKTogdm9pZCB7XG4gICAgY29uc3Qgc3VjY2VzcyA9IGV4aXRDb2RlID09PSAwXG4gICAgaWYgKCFzdWNjZXNzKSB7XG4gICAgICB0aGlzLnN1Y2Nlc3MgPSBmYWxzZVxuICAgIH1cblxuICAgIGlmIChcbiAgICAgIE9iamVjdC52YWx1ZXModGhpcy53b3JrZXJzKS5ldmVyeSgoeCkgPT4geC5zdGF0ZSA9PT0gV29ya2VyU3RhdGUuY2xvc2VkKVxuICAgICkge1xuICAgICAgY29uc3QgZW52ZWxvcGU6IG1lc3NhZ2VzLkVudmVsb3BlID0ge1xuICAgICAgICB0ZXN0UnVuRmluaXNoZWQ6IHtcbiAgICAgICAgICB0aW1lc3RhbXA6IHRoaXMuc3RvcHdhdGNoLnRpbWVzdGFtcCgpLFxuICAgICAgICAgIHN1Y2Nlc3MsXG4gICAgICAgIH0sXG4gICAgICB9XG4gICAgICB0aGlzLmV2ZW50QnJvYWRjYXN0ZXIuZW1pdCgnZW52ZWxvcGUnLCBlbnZlbG9wZSlcbiAgICAgIHRoaXMub25GaW5pc2godGhpcy5zdWNjZXNzKVxuICAgIH1cbiAgfVxuXG4gIHBhcnNlVGVzdENhc2VSZXN1bHQodGVzdENhc2VGaW5pc2hlZDogbWVzc2FnZXMuVGVzdENhc2VGaW5pc2hlZCk6IHZvaWQge1xuICAgIGNvbnN0IHsgd29yc3RUZXN0U3RlcFJlc3VsdCB9ID0gdGhpcy5ldmVudERhdGFDb2xsZWN0b3IuZ2V0VGVzdENhc2VBdHRlbXB0KFxuICAgICAgdGVzdENhc2VGaW5pc2hlZC50ZXN0Q2FzZVN0YXJ0ZWRJZFxuICAgIClcbiAgICBpZiAoXG4gICAgICAhdGVzdENhc2VGaW5pc2hlZC53aWxsQmVSZXRyaWVkICYmXG4gICAgICBzaG91bGRDYXVzZUZhaWx1cmUod29yc3RUZXN0U3RlcFJlc3VsdC5zdGF0dXMsIHRoaXMub3B0aW9ucylcbiAgICApIHtcbiAgICAgIHRoaXMuc3VjY2VzcyA9IGZhbHNlXG4gICAgfVxuICB9XG5cbiAgYXN5bmMgc3RhcnQoKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgY29uc3QgZW52ZWxvcGU6IG1lc3NhZ2VzLkVudmVsb3BlID0ge1xuICAgICAgdGVzdFJ1blN0YXJ0ZWQ6IHtcbiAgICAgICAgdGltZXN0YW1wOiB0aGlzLnN0b3B3YXRjaC50aW1lc3RhbXAoKSxcbiAgICAgIH0sXG4gICAgfVxuICAgIHRoaXMuZXZlbnRCcm9hZGNhc3Rlci5lbWl0KCdlbnZlbG9wZScsIGVudmVsb3BlKVxuICAgIHRoaXMuc3RvcHdhdGNoLnN0YXJ0KClcbiAgICB0aGlzLmFzc2VtYmxlZFRlc3RDYXNlcyA9IGF3YWl0IGFzc2VtYmxlVGVzdENhc2VzKHtcbiAgICAgIGV2ZW50QnJvYWRjYXN0ZXI6IHRoaXMuZXZlbnRCcm9hZGNhc3RlcixcbiAgICAgIG5ld0lkOiB0aGlzLm5ld0lkLFxuICAgICAgcGlja2xlczogdGhpcy5waWNrbGVJZHMubWFwKChwaWNrbGVJZCkgPT5cbiAgICAgICAgdGhpcy5ldmVudERhdGFDb2xsZWN0b3IuZ2V0UGlja2xlKHBpY2tsZUlkKVxuICAgICAgKSxcbiAgICAgIHN1cHBvcnRDb2RlTGlicmFyeTogdGhpcy5zdXBwb3J0Q29kZUxpYnJhcnksXG4gICAgfSlcbiAgICByZXR1cm4gYXdhaXQgbmV3IFByb21pc2U8Ym9vbGVhbj4oKHJlc29sdmUpID0+IHtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5udW1iZXJPZldvcmtlcnM7IGkrKykge1xuICAgICAgICB0aGlzLnN0YXJ0V29ya2VyKGkudG9TdHJpbmcoKSwgdGhpcy5udW1iZXJPZldvcmtlcnMpXG4gICAgICB9XG4gICAgICB0aGlzLm9uRmluaXNoID0gKHN0YXR1cykgPT4ge1xuICAgICAgICBpZiAodGhpcy5pZGxlSW50ZXJ2ZW50aW9ucyA+IDApIHtcbiAgICAgICAgICB0aGlzLmxvZ2dlci53YXJuKFxuICAgICAgICAgICAgYFdBUk5JTkc6IEFsbCB3b3JrZXJzIHdlbnQgaWRsZSAke3RoaXMuaWRsZUludGVydmVudGlvbnN9IHRpbWUocykuIENvbnNpZGVyIHJldmlzaW5nIGhhbmRsZXIgcGFzc2VkIHRvIHNldFBhcmFsbGVsQ2FuQXNzaWduLmBcbiAgICAgICAgICApXG4gICAgICAgIH1cblxuICAgICAgICByZXNvbHZlKHN0YXR1cylcbiAgICAgIH1cbiAgICB9KVxuICB9XG5cbiAgbmV4dFBpY2tsZVBsYWNlbWVudCgpOiBJUGlja2xlUGxhY2VtZW50IHtcbiAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgdGhpcy5waWNrbGVJZHMubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICBjb25zdCBwbGFjZW1lbnQgPSB0aGlzLnBsYWNlbWVudEF0KGluZGV4KVxuICAgICAgaWYgKFxuICAgICAgICB0aGlzLnN1cHBvcnRDb2RlTGlicmFyeS5wYXJhbGxlbENhbkFzc2lnbihcbiAgICAgICAgICBwbGFjZW1lbnQucGlja2xlLFxuICAgICAgICAgIE9iamVjdC52YWx1ZXModGhpcy5pblByb2dyZXNzUGlja2xlcylcbiAgICAgICAgKVxuICAgICAgKSB7XG4gICAgICAgIHJldHVybiBwbGFjZW1lbnRcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gbnVsbFxuICB9XG5cbiAgcGxhY2VtZW50QXQoaW5kZXg6IG51bWJlcik6IElQaWNrbGVQbGFjZW1lbnQge1xuICAgIHJldHVybiB7XG4gICAgICBpbmRleCxcbiAgICAgIHBpY2tsZTogdGhpcy5ldmVudERhdGFDb2xsZWN0b3IuZ2V0UGlja2xlKHRoaXMucGlja2xlSWRzW2luZGV4XSksXG4gICAgfVxuICB9XG5cbiAgZ2l2ZVdvcmsod29ya2VyOiBJV29ya2VyLCBmb3JjZTogYm9vbGVhbiA9IGZhbHNlKTogdm9pZCB7XG4gICAgaWYgKHRoaXMucGlja2xlSWRzLmxlbmd0aCA8IDEpIHtcbiAgICAgIGNvbnN0IGZpbmFsaXplQ29tbWFuZDogSVdvcmtlckNvbW1hbmQgPSB7IGZpbmFsaXplOiB0cnVlIH1cbiAgICAgIHdvcmtlci5zdGF0ZSA9IFdvcmtlclN0YXRlLnJ1bm5pbmdcbiAgICAgIHdvcmtlci5wcm9jZXNzLnNlbmQoZmluYWxpemVDb21tYW5kKVxuICAgICAgcmV0dXJuXG4gICAgfVxuXG4gICAgY29uc3QgcGlja2xlUGxhY2VtZW50ID0gZm9yY2VcbiAgICAgID8gdGhpcy5wbGFjZW1lbnRBdCgwKVxuICAgICAgOiB0aGlzLm5leHRQaWNrbGVQbGFjZW1lbnQoKVxuXG4gICAgaWYgKHBpY2tsZVBsYWNlbWVudCA9PT0gbnVsbCkge1xuICAgICAgcmV0dXJuXG4gICAgfVxuXG4gICAgY29uc3QgeyBpbmRleDogbmV4dFBpY2tsZUluZGV4LCBwaWNrbGUgfSA9IHBpY2tsZVBsYWNlbWVudFxuXG4gICAgdGhpcy5waWNrbGVJZHMuc3BsaWNlKG5leHRQaWNrbGVJbmRleCwgMSlcbiAgICB0aGlzLmluUHJvZ3Jlc3NQaWNrbGVzW3dvcmtlci5pZF0gPSBwaWNrbGVcbiAgICBjb25zdCB0ZXN0Q2FzZSA9IHRoaXMuYXNzZW1ibGVkVGVzdENhc2VzW3BpY2tsZS5pZF1cbiAgICBjb25zdCBnaGVya2luRG9jdW1lbnQgPSB0aGlzLmV2ZW50RGF0YUNvbGxlY3Rvci5nZXRHaGVya2luRG9jdW1lbnQoXG4gICAgICBwaWNrbGUudXJpXG4gICAgKVxuICAgIGNvbnN0IHJldHJpZXMgPSByZXRyaWVzRm9yUGlja2xlKHBpY2tsZSwgdGhpcy5vcHRpb25zKVxuICAgIGNvbnN0IHNraXAgPSB0aGlzLm9wdGlvbnMuZHJ5UnVuIHx8ICh0aGlzLm9wdGlvbnMuZmFpbEZhc3QgJiYgIXRoaXMuc3VjY2VzcylcbiAgICBjb25zdCBydW5Db21tYW5kOiBJV29ya2VyQ29tbWFuZCA9IHtcbiAgICAgIHJ1bjoge1xuICAgICAgICByZXRyaWVzLFxuICAgICAgICBza2lwLFxuICAgICAgICBlbGFwc2VkOiB0aGlzLnN0b3B3YXRjaC5kdXJhdGlvbigpLFxuICAgICAgICBwaWNrbGUsXG4gICAgICAgIHRlc3RDYXNlLFxuICAgICAgICBnaGVya2luRG9jdW1lbnQsXG4gICAgICB9LFxuICAgIH1cbiAgICB3b3JrZXIuc3RhdGUgPSBXb3JrZXJTdGF0ZS5ydW5uaW5nXG4gICAgd29ya2VyLnByb2Nlc3Muc2VuZChydW5Db21tYW5kKVxuICB9XG59XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsTUFBQUEsZUFBQSxHQUFBQyxPQUFBO0FBQ0EsTUFBQUMsTUFBQSxHQUFBQyxlQUFBLENBQUFGLE9BQUE7QUFDQSxNQUFBRyxTQUFBLEdBQUFILE9BQUE7QUFDQSxNQUFB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