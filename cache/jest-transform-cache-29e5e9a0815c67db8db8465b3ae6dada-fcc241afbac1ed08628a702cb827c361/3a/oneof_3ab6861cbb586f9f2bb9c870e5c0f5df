68d558aa7301bcd45fb500a1bef19907
"use strict";

module.exports = OneOf;

// extends ReflectionObject
var ReflectionObject = require("./object");
((OneOf.prototype = Object.create(ReflectionObject.prototype)).constructor = OneOf).className = "OneOf";
var Field = require("./field"),
  util = require("./util");

/**
 * Constructs a new oneof instance.
 * @classdesc Reflected oneof.
 * @extends ReflectionObject
 * @constructor
 * @param {string} name Oneof name
 * @param {string[]|Object.<string,*>} [fieldNames] Field names
 * @param {Object.<string,*>} [options] Declared options
 * @param {string} [comment] Comment associated with this field
 */
function OneOf(name, fieldNames, options, comment) {
  if (!Array.isArray(fieldNames)) {
    options = fieldNames;
    fieldNames = undefined;
  }
  ReflectionObject.call(this, name, options);

  /* istanbul ignore if */
  if (!(fieldNames === undefined || Array.isArray(fieldNames))) throw TypeError("fieldNames must be an Array");

  /**
   * Field names that belong to this oneof.
   * @type {string[]}
   */
  this.oneof = fieldNames || []; // toJSON, marker

  /**
   * Fields that belong to this oneof as an array for iteration.
   * @type {Field[]}
   * @readonly
   */
  this.fieldsArray = []; // declared readonly for conformance, possibly not yet added to parent

  /**
   * Comment for this field.
   * @type {string|null}
   */
  this.comment = comment;
}

/**
 * Oneof descriptor.
 * @interface IOneOf
 * @property {Array.<string>} oneof Oneof field names
 * @property {Object.<string,*>} [options] Oneof options
 */

/**
 * Constructs a oneof from a oneof descriptor.
 * @param {string} name Oneof name
 * @param {IOneOf} json Oneof descriptor
 * @returns {OneOf} Created oneof
 * @throws {TypeError} If arguments are invalid
 */
OneOf.fromJSON = function fromJSON(name, json) {
  return new OneOf(name, json.oneof, json.options, json.comment);
};

/**
 * Converts this oneof to a oneof descriptor.
 * @param {IToJSONOptions} [toJSONOptions] JSON conversion options
 * @returns {IOneOf} Oneof descriptor
 */
OneOf.prototype.toJSON = function toJSON(toJSONOptions) {
  var keepComments = toJSONOptions ? Boolean(toJSONOptions.keepComments) : false;
  return util.toObject(["options", this.options, "oneof", this.oneof, "comment", keepComments ? this.comment : undefined]);
};

/**
 * Adds the fields of the specified oneof to the parent if not already done so.
 * @param {OneOf} oneof The oneof
 * @returns {undefined}
 * @inner
 * @ignore
 */
function addFieldsToParent(oneof) {
  if (oneof.parent) for (var i = 0; i < oneof.fieldsArray.length; ++i) if (!oneof.fieldsArray[i].parent) oneof.parent.add(oneof.fieldsArray[i]);
}

/**
 * Adds a field to this oneof and removes it from its current parent, if any.
 * @param {Field} field Field to add
 * @returns {OneOf} `this`
 */
OneOf.prototype.add = function add(field) {
  /* istanbul ignore if */
  if (!(field instanceof Field)) throw TypeError("field must be a Field");
  if (field.parent && field.parent !== this.parent) field.parent.remove(field);
  this.oneof.push(field.name);
  this.fieldsArray.push(field);
  field.partOf = this; // field.parent remains null
  addFieldsToParent(this);
  return this;
};

/**
 * Removes a field from this oneof and puts it back to the oneof's parent.
 * @param {Field} field Field to remove
 * @returns {OneOf} `this`
 */
OneOf.prototype.remove = function remove(field) {
  /* istanbul ignore if */
  if (!(field instanceof Field)) throw TypeError("field must be a Field");
  var index = this.fieldsArray.indexOf(field);

  /* istanbul ignore if */
  if (index < 0) throw Error(field + " is not a member of " + this);
  this.fieldsArray.splice(index, 1);
  index = this.oneof.indexOf(field.name);

  /* istanbul ignore else */
  if (index > -1)
    // theoretical
    this.oneof.splice(index, 1);
  field.partOf = null;
  return this;
};

/**
 * @override
 */
OneOf.prototype.onAdd = function onAdd(parent) {
  ReflectionObject.prototype.onAdd.call(this, parent);
  var self = this;
  // Collect present fields
  for (var i = 0; i < this.oneof.length; ++i) {
    var field = parent.get(this.oneof[i]);
    if (field && !field.partOf) {
      field.partOf = self;
      self.fieldsArray.push(field);
    }
  }
  // Add not yet present fields
  addFieldsToParent(this);
};

/**
 * @override
 */
OneOf.prototype.onRemove = function onRemove(parent) {
  for (var i = 0, field; i < this.fieldsArray.length; ++i) if ((field = this.fieldsArray[i]).parent) field.parent.remove(field);
  ReflectionObject.prototype.onRemove.call(this, parent);
};

/**
 * Decorator function as returned by {@link OneOf.d} (TypeScript).
 * @typedef OneOfDecorator
 * @type {function}
 * @param {Object} prototype Target prototype
 * @param {string} oneofName OneOf name
 * @returns {undefined}
 */

/**
 * OneOf decorator (TypeScript).
 * @function
 * @param {...string} fieldNames Field names
 * @returns {OneOfDecorator} Decorator function
 * @template T extends string
 */
OneOf.d = function decorateOneOf() {
  var fieldNames = new Array(arguments.length),
    index = 0;
  while (index < arguments.length) fieldNames[index] = arguments[index++];
  return function oneOfDecorator(prototype, oneofName) {
    util.decorateType(prototype.constructor).add(new OneOf(oneofName, fieldNames));
    Object.defineProperty(prototype, oneofName, {
      get: util.oneOfGetter(fieldNames),
      set: util.oneOfSetter(fieldNames)
    });
  };
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJtb2R1bGUiLCJleHBvcnRzIiwiT25lT2YiLCJSZWZsZWN0aW9uT2JqZWN0IiwicmVxdWlyZSIsInByb3RvdHlwZSIsIk9iamVjdCIsImNyZWF0ZSIsImNvbnN0cnVjdG9yIiwiY2xhc3NOYW1lIiwiRmllbGQiLCJ1dGlsIiwibmFtZSIsImZpZWxkTmFtZXMiLCJvcHRpb25zIiwiY29tbWVudCIsIkFycmF5IiwiaXNBcnJheSIsInVuZGVmaW5lZCIsImNhbGwiLCJUeXBlRXJyb3IiLCJvbmVvZiIsImZpZWxkc0FycmF5IiwiZnJvbUpTT04iLCJqc29uIiwidG9KU09OIiwidG9KU09OT3B0aW9ucyIsImtlZXBDb21tZW50cyIsIkJvb2xlYW4iLCJ0b09iamVjdCIsImFkZEZpZWxkc1RvUGFyZW50IiwicGFyZW50IiwiaSIsImxlbmd0aCIsImFkZCIsImZpZWxkIiwicmVtb3ZlIiwicHVzaCIsInBhcnRPZiIsImluZGV4IiwiaW5kZXhPZiIsIkVycm9yIiwic3BsaWNlIiwib25BZGQiLCJzZWxmIiwiZ2V0Iiwib25SZW1vdmUiLCJkIiwiZGVjb3JhdGVPbmVPZiIsImFyZ3VtZW50cyIsIm9uZU9mRGVjb3JhdG9yIiwib25lb2ZOYW1lIiwiZGVjb3JhdGVUeXBlIiwiZGVmaW5lUHJvcGVydHkiLCJvbmVPZkdldHRlciIsInNldCIsIm9uZU9mU2V0dGVyIl0sInNvdXJjZXMiOlsib25lb2YuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5tb2R1bGUuZXhwb3J0cyA9IE9uZU9mO1xuXG4vLyBleHRlbmRzIFJlZmxlY3Rpb25PYmplY3RcbnZhciBSZWZsZWN0aW9uT2JqZWN0ID0gcmVxdWlyZShcIi4vb2JqZWN0XCIpO1xuKChPbmVPZi5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKFJlZmxlY3Rpb25PYmplY3QucHJvdG90eXBlKSkuY29uc3RydWN0b3IgPSBPbmVPZikuY2xhc3NOYW1lID0gXCJPbmVPZlwiO1xuXG52YXIgRmllbGQgPSByZXF1aXJlKFwiLi9maWVsZFwiKSxcbiAgICB1dGlsICA9IHJlcXVpcmUoXCIuL3V0aWxcIik7XG5cbi8qKlxuICogQ29uc3RydWN0cyBhIG5ldyBvbmVvZiBpbnN0YW5jZS5cbiAqIEBjbGFzc2Rlc2MgUmVmbGVjdGVkIG9uZW9mLlxuICogQGV4dGVuZHMgUmVmbGVjdGlvbk9iamVjdFxuICogQGNvbnN0cnVjdG9yXG4gKiBAcGFyYW0ge3N0cmluZ30gbmFtZSBPbmVvZiBuYW1lXG4gKiBAcGFyYW0ge3N0cmluZ1tdfE9iamVjdC48c3RyaW5nLCo+fSBbZmllbGROYW1lc10gRmllbGQgbmFtZXNcbiAqIEBwYXJhbSB7T2JqZWN0LjxzdHJpbmcsKj59IFtvcHRpb25zXSBEZWNsYXJlZCBvcHRpb25zXG4gKiBAcGFyYW0ge3N0cmluZ30gW2NvbW1lbnRdIENvbW1lbnQgYXNzb2NpYXRlZCB3aXRoIHRoaXMgZmllbGRcbiAqL1xuZnVuY3Rpb24gT25lT2YobmFtZSwgZmllbGROYW1lcywgb3B0aW9ucywgY29tbWVudCkge1xuICAgIGlmICghQXJyYXkuaXNBcnJheShmaWVsZE5hbWVzKSkge1xuICAgICAgICBvcHRpb25zID0gZmllbGROYW1lcztcbiAgICAgICAgZmllbGROYW1lcyA9IHVuZGVmaW5lZDtcbiAgICB9XG4gICAgUmVmbGVjdGlvbk9iamVjdC5jYWxsKHRoaXMsIG5hbWUsIG9wdGlvbnMpO1xuXG4gICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovXG4gICAgaWYgKCEoZmllbGROYW1lcyA9PT0gdW5kZWZpbmVkIHx8IEFycmF5LmlzQXJyYXkoZmllbGROYW1lcykpKVxuICAgICAgICB0aHJvdyBUeXBlRXJyb3IoXCJmaWVsZE5hbWVzIG11c3QgYmUgYW4gQXJyYXlcIik7XG5cbiAgICAvKipcbiAgICAgKiBGaWVsZCBuYW1lcyB0aGF0IGJlbG9uZyB0byB0aGlzIG9uZW9mLlxuICAgICAqIEB0eXBlIHtzdHJpbmdbXX1cbiAgICAgKi9cbiAgICB0aGlzLm9uZW9mID0gZmllbGROYW1lcyB8fCBbXTsgLy8gdG9KU09OLCBtYXJrZXJcblxuICAgIC8qKlxuICAgICAqIEZpZWxkcyB0aGF0IGJlbG9uZyB0byB0aGlzIG9uZW9mIGFzIGFuIGFycmF5IGZvciBpdGVyYXRpb24uXG4gICAgICogQHR5cGUge0ZpZWxkW119XG4gICAgICogQHJlYWRvbmx5XG4gICAgICovXG4gICAgdGhpcy5maWVsZHNBcnJheSA9IFtdOyAvLyBkZWNsYXJlZCByZWFkb25seSBmb3IgY29uZm9ybWFuY2UsIHBvc3NpYmx5IG5vdCB5ZXQgYWRkZWQgdG8gcGFyZW50XG5cbiAgICAvKipcbiAgICAgKiBDb21tZW50IGZvciB0aGlzIGZpZWxkLlxuICAgICAqIEB0eXBlIHtzdHJpbmd8bnVsbH1cbiAgICAgKi9cbiAgICB0aGlzLmNvbW1lbnQgPSBjb21tZW50O1xufVxuXG4vKipcbiAqIE9uZW9mIGRlc2NyaXB0b3IuXG4gKiBAaW50ZXJmYWNlIElPbmVPZlxuICogQHByb3BlcnR5IHtBcnJheS48c3RyaW5nPn0gb25lb2YgT25lb2YgZmllbGQgbmFtZXNcbiAqIEBwcm9wZXJ0eSB7T2JqZWN0LjxzdHJpbmcsKj59IFtvcHRpb25zXSBPbmVvZiBvcHRpb25zXG4gKi9cblxuLyoqXG4gKiBDb25zdHJ1Y3RzIGEgb25lb2YgZnJvbSBhIG9uZW9mIGRlc2NyaXB0b3IuXG4gKiBAcGFyYW0ge3N0cmluZ30gbmFtZSBPbmVvZiBuYW1lXG4gKiBAcGFyYW0ge0lPbmVPZn0ganNvbiBPbmVvZiBkZXNjcmlwdG9yXG4gKiBAcmV0dXJucyB7T25lT2Z9IENyZWF0ZWQgb25lb2ZcbiAqIEB0aHJvd3Mge1R5cGVFcnJvcn0gSWYgYXJndW1lbnRzIGFyZSBpbnZhbGlkXG4gKi9cbk9uZU9mLmZyb21KU09OID0gZnVuY3Rpb24gZnJvbUpTT04obmFtZSwganNvbikge1xuICAgIHJldHVybiBuZXcgT25lT2YobmFtZSwganNvbi5vbmVvZiwganNvbi5vcHRpb25zLCBqc29uLmNvbW1lbnQpO1xufTtcblxuLyoqXG4gKiBDb252ZXJ0cyB0aGlzIG9uZW9mIHRvIGEgb25lb2YgZGVzY3JpcHRvci5cbiAqIEBwYXJhbSB7SVRvSlNPTk9wdGlvbnN9IFt0b0pTT05PcHRpb25zXSBKU09OIGNvbnZlcnNpb24gb3B0aW9uc1xuICogQHJldHVybnMge0lPbmVPZn0gT25lb2YgZGVzY3JpcHRvclxuICovXG5PbmVPZi5wcm90b3R5cGUudG9KU09OID0gZnVuY3Rpb24gdG9KU09OKHRvSlNPTk9wdGlvbnMpIHtcbiAgICB2YXIga2VlcENvbW1lbnRzID0gdG9KU09OT3B0aW9ucyA/IEJvb2xlYW4odG9KU09OT3B0aW9ucy5rZWVwQ29tbWVudHMpIDogZmFsc2U7XG4gICAgcmV0dXJuIHV0aWwudG9PYmplY3QoW1xuICAgICAgICBcIm9wdGlvbnNcIiAsIHRoaXMub3B0aW9ucyxcbiAgICAgICAgXCJvbmVvZlwiICAgLCB0aGlzLm9uZW9mLFxuICAgICAgICBcImNvbW1lbnRcIiAsIGtlZXBDb21tZW50cyA/IHRoaXMuY29tbWVudCA6IHVuZGVmaW5lZFxuICAgIF0pO1xufTtcblxuLyoqXG4gKiBBZGRzIHRoZSBmaWVsZHMgb2YgdGhlIHNwZWNpZmllZCBvbmVvZiB0byB0aGUgcGFyZW50IGlmIG5vdCBhbHJlYWR5IGRvbmUgc28uXG4gKiBAcGFyYW0ge09uZU9mfSBvbmVvZiBUaGUgb25lb2ZcbiAqIEByZXR1cm5zIHt1bmRlZmluZWR9XG4gKiBAaW5uZXJcbiAqIEBpZ25vcmVcbiAqL1xuZnVuY3Rpb24gYWRkRmllbGRzVG9QYXJlbnQob25lb2YpIHtcbiAgICBpZiAob25lb2YucGFyZW50KVxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9uZW9mLmZpZWxkc0FycmF5Lmxlbmd0aDsgKytpKVxuICAgICAgICAgICAgaWYgKCFvbmVvZi5maWVsZHNBcnJheVtpXS5wYXJlbnQpXG4gICAgICAgICAgICAgICAgb25lb2YucGFyZW50LmFkZChvbmVvZi5maWVsZHNBcnJheVtpXSk7XG59XG5cbi8qKlxuICogQWRkcyBhIGZpZWxkIHRvIHRoaXMgb25lb2YgYW5kIHJlbW92ZXMgaXQgZnJvbSBpdHMgY3VycmVudCBwYXJlbnQsIGlmIGFueS5cbiAqIEBwYXJhbSB7RmllbGR9IGZpZWxkIEZpZWxkIHRvIGFkZFxuICogQHJldHVybnMge09uZU9mfSBgdGhpc2BcbiAqL1xuT25lT2YucHJvdG90eXBlLmFkZCA9IGZ1bmN0aW9uIGFkZChmaWVsZCkge1xuXG4gICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovXG4gICAgaWYgKCEoZmllbGQgaW5zdGFuY2VvZiBGaWVsZCkpXG4gICAgICAgIHRocm93IFR5cGVFcnJvcihcImZpZWxkIG11c3QgYmUgYSBGaWVsZFwiKTtcblxuICAgIGlmIChmaWVsZC5wYXJlbnQgJiYgZmllbGQucGFyZW50ICE9PSB0aGlzLnBhcmVudClcbiAgICAgICAgZmllbGQucGFyZW50LnJlbW92ZShmaWVsZCk7XG4gICAgdGhpcy5vbmVvZi5wdXNoKGZpZWxkLm5hbWUpO1xuICAgIHRoaXMuZmllbGRzQXJyYXkucHVzaChmaWVsZCk7XG4gICAgZmllbGQucGFydE9mID0gdGhpczsgLy8gZmllbGQucGFyZW50IHJlbWFpbnMgbnVsbFxuICAgIGFkZEZpZWxkc1RvUGFyZW50KHRoaXMpO1xuICAgIHJldHVybiB0aGlzO1xufTtcblxuLyoqXG4gKiBSZW1vdmVzIGEgZmllbGQgZnJvbSB0aGlzIG9uZW9mIGFuZCBwdXRzIGl0IGJhY2sgdG8gdGhlIG9uZW9mJ3MgcGFyZW50LlxuICogQHBhcmFtIHtGaWVsZH0gZmllbGQgRmllbGQgdG8gcmVtb3ZlXG4gKiBAcmV0dXJucyB7T25lT2Z9IGB0aGlzYFxuICovXG5PbmVPZi5wcm90b3R5cGUucmVtb3ZlID0gZnVuY3Rpb24gcmVtb3ZlKGZpZWxkKSB7XG5cbiAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi9cbiAgICBpZiAoIShmaWVsZCBpbnN0YW5jZW9mIEZpZWxkKSlcbiAgICAgICAgdGhyb3cgVHlwZUVycm9yKFwiZmllbGQgbXVzdCBiZSBhIEZpZWxkXCIpO1xuXG4gICAgdmFyIGluZGV4ID0gdGhpcy5maWVsZHNBcnJheS5pbmRleE9mKGZpZWxkKTtcblxuICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqL1xuICAgIGlmIChpbmRleCA8IDApXG4gICAgICAgIHRocm93IEVycm9yKGZpZWxkICsgXCIgaXMgbm90IGEgbWVtYmVyIG9mIFwiICsgdGhpcyk7XG5cbiAgICB0aGlzLmZpZWxkc0FycmF5LnNwbGljZShpbmRleCwgMSk7XG4gICAgaW5kZXggPSB0aGlzLm9uZW9mLmluZGV4T2YoZmllbGQubmFtZSk7XG5cbiAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgZWxzZSAqL1xuICAgIGlmIChpbmRleCA+IC0xKSAvLyB0aGVvcmV0aWNhbFxuICAgICAgICB0aGlzLm9uZW9mLnNwbGljZShpbmRleCwgMSk7XG5cbiAgICBmaWVsZC5wYXJ0T2YgPSBudWxsO1xuICAgIHJldHVybiB0aGlzO1xufTtcblxuLyoqXG4gKiBAb3ZlcnJpZGVcbiAqL1xuT25lT2YucHJvdG90eXBlLm9uQWRkID0gZnVuY3Rpb24gb25BZGQocGFyZW50KSB7XG4gICAgUmVmbGVjdGlvbk9iamVjdC5wcm90b3R5cGUub25BZGQuY2FsbCh0aGlzLCBwYXJlbnQpO1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAvLyBDb2xsZWN0IHByZXNlbnQgZmllbGRzXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLm9uZW9mLmxlbmd0aDsgKytpKSB7XG4gICAgICAgIHZhciBmaWVsZCA9IHBhcmVudC5nZXQodGhpcy5vbmVvZltpXSk7XG4gICAgICAgIGlmIChmaWVsZCAmJiAhZmllbGQucGFydE9mKSB7XG4gICAgICAgICAgICBmaWVsZC5wYXJ0T2YgPSBzZWxmO1xuICAgICAgICAgICAgc2VsZi5maWVsZHNBcnJheS5wdXNoKGZpZWxkKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvLyBBZGQgbm90IHlldCBwcmVzZW50IGZpZWxkc1xuICAgIGFkZEZpZWxkc1RvUGFyZW50KHRoaXMpO1xufTtcblxuLyoqXG4gKiBAb3ZlcnJpZGVcbiAqL1xuT25lT2YucHJvdG90eXBlLm9uUmVtb3ZlID0gZnVuY3Rpb24gb25SZW1vdmUocGFyZW50KSB7XG4gICAgZm9yICh2YXIgaSA9IDAsIGZpZWxkOyBpIDwgdGhpcy5maWVsZHNBcnJheS5sZW5ndGg7ICsraSlcbiAgICAgICAgaWYgKChmaWVsZCA9IHRoaXMuZmllbGRzQXJyYXlbaV0pLnBhcmVudClcbiAgICAgICAgICAgIGZpZWxkLnBhcmVudC5yZW1vdmUoZmllbGQpO1xuICAgIFJlZmxlY3Rpb25PYmplY3QucHJvdG90eXBlLm9uUmVtb3ZlLmNhbGwodGhpcywgcGFyZW50KTtcbn07XG5cbi8qKlxuICogRGVjb3JhdG9yIGZ1bmN0aW9uIGFzIHJldHVybmVkIGJ5IHtAbGluayBPbmVPZi5kfSAoVHlwZVNjcmlwdCkuXG4gKiBAdHlwZWRlZiBPbmVPZkRlY29yYXRvclxuICogQHR5cGUge2Z1bmN0aW9ufVxuICogQHBhcmFtIHtPYmplY3R9IHByb3RvdHlwZSBUYXJnZXQgcHJvdG90eXBlXG4gKiBAcGFyYW0ge3N0cmluZ30gb25lb2ZOYW1lIE9uZU9mIG5hbWVcbiAqIEByZXR1cm5zIHt1bmRlZmluZWR9XG4gKi9cblxuLyoqXG4gKiBPbmVPZiBkZWNvcmF0b3IgKFR5cGVTY3JpcHQpLlxuICogQGZ1bmN0aW9uXG4gKiBAcGFyYW0gey4uLnN0cmluZ30gZmllbGROYW1lcyBGaWVsZCBuYW1lc1xuICogQHJldHVybnMge09uZU9mRGVjb3JhdG9yfSBEZWNvcmF0b3IgZnVuY3Rpb25cbiAqIEB0ZW1wbGF0ZSBUIGV4dGVuZHMgc3RyaW5nXG4gKi9cbk9uZU9mLmQgPSBmdW5jdGlvbiBkZWNvcmF0ZU9uZU9mKCkge1xuICAgIHZhciBmaWVsZE5hbWVzID0gbmV3IEFycmF5KGFyZ3VtZW50cy5sZW5ndGgpLFxuICAgICAgICBpbmRleCA9IDA7XG4gICAgd2hpbGUgKGluZGV4IDwgYXJndW1lbnRzLmxlbmd0aClcbiAgICAgICAgZmllbGROYW1lc1tpbmRleF0gPSBhcmd1bWVudHNbaW5kZXgrK107XG4gICAgcmV0dXJuIGZ1bmN0aW9uIG9uZU9mRGVjb3JhdG9yKHByb3RvdHlwZSwgb25lb2ZOYW1lKSB7XG4gICAgICAgIHV0aWwuZGVjb3JhdGVUeXBlKHByb3RvdHlwZS5jb25zdHJ1Y3RvcilcbiAgICAgICAgICAgIC5hZGQobmV3IE9uZU9mKG9uZW9mTmFtZSwgZmllbGROYW1lcykpO1xuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkocHJvdG90eXBlLCBvbmVvZk5hbWUsIHtcbiAgICAgICAgICAgIGdldDogdXRpbC5vbmVPZkdldHRlcihmaWVsZE5hbWVzKSxcbiAgICAgICAgICAgIHNldDogdXRpbC5vbmVPZlNldHRlcihmaWVsZE5hbWVzKVxuICAgICAgICB9KTtcbiAgICB9O1xufTtcbiJdLCJtYXBwaW5ncyI6IkFBQUEsWUFBWTs7QUFDWkEsTUFBTSxDQUFDQyxPQUFPLEdBQUdDLEtBQUs7O0FBRXRCO0FBQ0EsSUFBSUMsZ0JBQWdCLEdBQUdDLE9BQU8sQ0FBQyxVQUFVLENBQUM7QUFDMUMsQ0FBQyxDQUFDRixLQUFLLENBQUNHLFNBQVMsR0FBR0MsTUFBTSxDQUFDQyxNQUFNLENBQUNKLGdCQUFnQixDQUFDRSxTQUFTLENBQUMsRUFBRUcsV0FBVyxHQUFHTixLQUFLLEVBQUVPLFNBQVMsR0FBRyxPQUFPO0FBRXZHLElBQUlDLEtBQUssR0FBR04sT0FBTyxDQUFDLFNBQVMsQ0FBQztFQUMxQk8sSUFBSSxHQUFJUCxPQUFPLENBQUMsUUFBUSxDQUFDOztBQUU3QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVNGLEtBQUtBLENBQUNVLElBQUksRUFBRUMsVUFBVSxFQUFFQyxPQUFPLEVBQUVDLE9BQU8sRUFBRTtFQUMvQyxJQUFJLENBQUNDLEtBQUssQ0FBQ0MsT0FBTyxDQUFDSixVQUFVLENBQUMsRUFBRTtJQUM1QkMsT0FBTyxHQUFHRCxVQUFVO0lBQ3BCQSxVQUFVLEdBQUdLLFNBQVM7RUFDMUI7RUFD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