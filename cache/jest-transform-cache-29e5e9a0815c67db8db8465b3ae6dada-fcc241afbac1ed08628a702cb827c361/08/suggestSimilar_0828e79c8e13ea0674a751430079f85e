484b89f6f7a8565d162749e236c4193b
"use strict";

const maxDistance = 3;
function editDistance(a, b) {
  // https://en.wikipedia.org/wiki/Damerauâ€“Levenshtein_distance
  // Calculating optimal string alignment distance, no substring is edited more than once.
  // (Simple implementation.)

  // Quick early exit, return worst case.
  if (Math.abs(a.length - b.length) > maxDistance) return Math.max(a.length, b.length);

  // distance between prefix substrings of a and b
  const d = [];

  // pure deletions turn a into empty string
  for (let i = 0; i <= a.length; i++) {
    d[i] = [i];
  }
  // pure insertions turn empty string into b
  for (let j = 0; j <= b.length; j++) {
    d[0][j] = j;
  }

  // fill matrix
  for (let j = 1; j <= b.length; j++) {
    for (let i = 1; i <= a.length; i++) {
      let cost = 1;
      if (a[i - 1] === b[j - 1]) {
        cost = 0;
      } else {
        cost = 1;
      }
      d[i][j] = Math.min(d[i - 1][j] + 1,
      // deletion
      d[i][j - 1] + 1,
      // insertion
      d[i - 1][j - 1] + cost // substitution
      );
      // transposition
      if (i > 1 && j > 1 && a[i - 1] === b[j - 2] && a[i - 2] === b[j - 1]) {
        d[i][j] = Math.min(d[i][j], d[i - 2][j - 2] + 1);
      }
    }
  }
  return d[a.length][b.length];
}

/**
 * Find close matches, restricted to same number of edits.
 *
 * @param {string} word
 * @param {string[]} candidates
 * @returns {string}
 */

function suggestSimilar(word, candidates) {
  if (!candidates || candidates.length === 0) return '';
  // remove possible duplicates
  candidates = Array.from(new Set(candidates));
  const searchingOptions = word.startsWith('--');
  if (searchingOptions) {
    word = word.slice(2);
    candidates = candidates.map(candidate => candidate.slice(2));
  }
  let similar = [];
  let bestDistance = maxDistance;
  const minSimilarity = 0.4;
  candidates.forEach(candidate => {
    if (candidate.length <= 1) return; // no one character guesses

    const distance = editDistance(word, candidate);
    const length = Math.max(word.length, candidate.length);
    const similarity = (length - distance) / length;
    if (similarity > minSimilarity) {
      if (distance < bestDistance) {
        // better edit distance, throw away previous worse matches
        bestDistance = distance;
        similar = [candidate];
      } else if (distance === bestDistance) {
        similar.push(candidate);
      }
    }
  });
  similar.sort((a, b) => a.localeCompare(b));
  if (searchingOptions) {
    similar = similar.map(candidate => `--${candidate}`);
  }
  if (similar.length > 1) {
    return `\n(Did you mean one of ${similar.join(', ')}?)`;
  }
  if (similar.length === 1) {
    return `\n(Did you mean ${similar[0]}?)`;
  }
  return '';
}
exports.suggestSimilar = suggestSimilar;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJtYXhEaXN0YW5jZSIsImVkaXREaXN0YW5jZSIsImEiLCJiIiwiTWF0aCIsImFicyIsImxlbmd0aCIsIm1heCIsImQiLCJpIiwiaiIsImNvc3QiLCJtaW4iLCJzdWdnZXN0U2ltaWxhciIsIndvcmQiLCJjYW5kaWRhdGVzIiwiQXJyYXkiLCJmcm9tIiwiU2V0Iiwic2VhcmNoaW5nT3B0aW9ucyIsInN0YXJ0c1dpdGgiLCJzbGljZSIsIm1hcCIsImNhbmRpZGF0ZSIsInNpbWlsYXIiLCJiZXN0RGlzdGFuY2UiLCJtaW5TaW1pbGFyaXR5IiwiZm9yRWFjaCIsImRpc3RhbmNlIiwic2ltaWxhcml0eSIsInB1c2giLCJzb3J0IiwibG9jYWxlQ29tcGFyZSIsImpvaW4iLCJleHBvcnRzIl0sInNvdXJjZXMiOlsic3VnZ2VzdFNpbWlsYXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgbWF4RGlzdGFuY2UgPSAzO1xuXG5mdW5jdGlvbiBlZGl0RGlzdGFuY2UoYSwgYikge1xuICAvLyBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9EYW1lcmF14oCTTGV2ZW5zaHRlaW5fZGlzdGFuY2VcbiAgLy8gQ2FsY3VsYXRpbmcgb3B0aW1hbCBzdHJpbmcgYWxpZ25tZW50IGRpc3RhbmNlLCBubyBzdWJzdHJpbmcgaXMgZWRpdGVkIG1vcmUgdGhhbiBvbmNlLlxuICAvLyAoU2ltcGxlIGltcGxlbWVudGF0aW9uLilcblxuICAvLyBRdWljayBlYXJseSBleGl0LCByZXR1cm4gd29yc3QgY2FzZS5cbiAgaWYgKE1hdGguYWJzKGEubGVuZ3RoIC0gYi5sZW5ndGgpID4gbWF4RGlzdGFuY2UpIHJldHVybiBNYXRoLm1heChhLmxlbmd0aCwgYi5sZW5ndGgpO1xuXG4gIC8vIGRpc3RhbmNlIGJldHdlZW4gcHJlZml4IHN1YnN0cmluZ3Mgb2YgYSBhbmQgYlxuICBjb25zdCBkID0gW107XG5cbiAgLy8gcHVyZSBkZWxldGlvbnMgdHVybiBhIGludG8gZW1wdHkgc3RyaW5nXG4gIGZvciAobGV0IGkgPSAwOyBpIDw9IGEubGVuZ3RoOyBpKyspIHtcbiAgICBkW2ldID0gW2ldO1xuICB9XG4gIC8vIHB1cmUgaW5zZXJ0aW9ucyB0dXJuIGVtcHR5IHN0cmluZyBpbnRvIGJcbiAgZm9yIChsZXQgaiA9IDA7IGogPD0gYi5sZW5ndGg7IGorKykge1xuICAgIGRbMF1bal0gPSBqO1xuICB9XG5cbiAgLy8gZmlsbCBtYXRyaXhcbiAgZm9yIChsZXQgaiA9IDE7IGogPD0gYi5sZW5ndGg7IGorKykge1xuICAgIGZvciAobGV0IGkgPSAxOyBpIDw9IGEubGVuZ3RoOyBpKyspIHtcbiAgICAgIGxldCBjb3N0ID0gMTtcbiAgICAgIGlmIChhW2kgLSAxXSA9PT0gYltqIC0gMV0pIHtcbiAgICAgICAgY29zdCA9IDA7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb3N0ID0gMTtcbiAgICAgIH1cbiAgICAgIGRbaV1bal0gPSBNYXRoLm1pbihcbiAgICAgICAgZFtpIC0gMV1bal0gKyAxLCAvLyBkZWxldGlvblxuICAgICAgICBkW2ldW2ogLSAxXSArIDEsIC8vIGluc2VydGlvblxuICAgICAgICBkW2kgLSAxXVtqIC0gMV0gKyBjb3N0IC8vIHN1YnN0aXR1dGlvblxuICAgICAgKTtcbiAgICAgIC8vIHRyYW5zcG9zaXRpb25cbiAgICAgIGlmIChpID4gMSAmJiBqID4gMSAmJiBhW2kgLSAxXSA9PT0gYltqIC0gMl0gJiYgYVtpIC0gMl0gPT09IGJbaiAtIDFdKSB7XG4gICAgICAgIGRbaV1bal0gPSBNYXRoLm1pbihkW2ldW2pdLCBkW2kgLSAyXVtqIC0gMl0gKyAxKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICByZXR1cm4gZFthLmxlbmd0aF1bYi5sZW5ndGhdO1xufVxuXG4vKipcbiAqIEZpbmQgY2xvc2UgbWF0Y2hlcywgcmVzdHJpY3RlZCB0byBzYW1lIG51bWJlciBvZiBlZGl0cy5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gd29yZFxuICogQHBhcmFtIHtzdHJpbmdbXX0gY2FuZGlkYXRlc1xuICogQHJldHVybnMge3N0cmluZ31cbiAqL1xuXG5mdW5jdGlvbiBzdWdnZXN0U2ltaWxhcih3b3JkLCBjYW5kaWRhdGVzKSB7XG4gIGlmICghY2FuZGlkYXRlcyB8fCBjYW5kaWRhdGVzLmxlbmd0aCA9PT0gMCkgcmV0dXJuICcnO1xuICAvLyByZW1vdmUgcG9zc2libGUgZHVwbGljYXRlc1xuICBjYW5kaWRhdGVzID0gQXJyYXkuZnJvbShuZXcgU2V0KGNhbmRpZGF0ZXMpKTtcblxuICBjb25zdCBzZWFyY2hpbmdPcHRpb25zID0gd29yZC5zdGFydHNXaXRoKCctLScpO1xuICBpZiAoc2VhcmNoaW5nT3B0aW9ucykge1xuICAgIHdvcmQgPSB3b3JkLnNsaWNlKDIpO1xuICAgIGNhbmRpZGF0ZXMgPSBjYW5kaWRhdGVzLm1hcChjYW5kaWRhdGUgPT4gY2FuZGlkYXRlLnNsaWNlKDIpKTtcbiAgfVxuXG4gIGxldCBzaW1pbGFyID0gW107XG4gIGxldCBiZXN0RGlzdGFuY2UgPSBtYXhEaXN0YW5jZTtcbiAgY29uc3QgbWluU2ltaWxhcml0eSA9IDAuNDtcbiAgY2FuZGlkYXRlcy5mb3JFYWNoKChjYW5kaWRhdGUpID0+IHtcbiAgICBpZiAoY2FuZGlkYXRlLmxlbmd0aCA8PSAxKSByZXR1cm47IC8vIG5vIG9uZSBjaGFyYWN0ZXIgZ3Vlc3Nlc1xuXG4gICAgY29uc3QgZGlzdGFuY2UgPSBlZGl0RGlzdGFuY2Uod29yZCwgY2FuZGlkYXRlKTtcbiAgICBjb25zdCBsZW5ndGggPSBNYXRoLm1heCh3b3JkLmxlbmd0aCwgY2FuZGlkYXRlLmxlbmd0aCk7XG4gICAgY29uc3Qgc2ltaWxhcml0eSA9IChsZW5ndGggLSBkaXN0YW5jZSkgLyBsZW5ndGg7XG4gICAgaWYgKHNpbWlsYXJpdHkgPiBtaW5TaW1pbGFyaXR5KSB7XG4gICAgICBpZiAoZGlzdGFuY2UgPCBiZXN0RGlzdGFuY2UpIHtcbiAgICAgICAgLy8gYmV0dGVyIGVkaXQgZGlzdGFuY2UsIHRocm93IGF3YXkgcHJldmlvdXMgd29yc2UgbWF0Y2hlc1xuICAgICAgICBiZXN0RGlzdGFuY2UgPSBkaXN0YW5jZTtcbiAgICAgICAgc2ltaWxhciA9IFtjYW5kaWRhdGVdO1xuICAgICAgfSBlbHNlIGlmIChkaXN0YW5jZSA9PT0gYmVzdERpc3RhbmNlKSB7XG4gICAgICAgIHNpbWlsYXIucHVzaChjYW5kaWRhdGUpO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG5cbiAgc2ltaWxhci5zb3J0KChhLCBiKSA9PiBhLmxvY2FsZUNvbXBhcmUoYikpO1xuICBpZiAoc2VhcmNoaW5nT3B0aW9ucykge1xuICAgIHNpbWlsYXIgPSBzaW1pbGFyLm1hcChjYW5kaWRhdGUgPT4gYC0tJHtjYW5kaWRhdGV9YCk7XG4gIH1cblxuICBpZiAoc2ltaWxhci5sZW5ndGggPiAxKSB7XG4gICAgcmV0dXJuIGBcXG4oRGlkIHlvdSBtZWFuIG9uZSBvZiAke3NpbWlsYXIuam9pbignLCAnKX0/KWA7XG4gIH1cbiAgaWYgKHNpbWlsYXIubGVuZ3RoID09PSAxKSB7XG4gICAgcmV0dXJuIGBcXG4oRGlkIHlvdSBtZWFuICR7c2ltaWxhclswXX0/KWA7XG4gIH1cbiAgcmV0dXJuICcnO1xufVxuXG5leHBvcnRzLnN1Z2dlc3RTaW1pbGFyID0gc3VnZ2VzdFNpbWlsYXI7XG4iXSwibWFwcGluZ3MiOiI7O0FBQUEsTUFBTUEsV0FBVyxHQUFHLENBQUM7QUFFckIsU0FBU0MsWUFBWUEsQ0FBQ0MsQ0FBQyxFQUFFQyxDQUFDLEVBQUU7RUFDMUI7RUFDQTtFQUNBOztFQUVBO0VBQ0EsSUFBSUMsSUFBSSxDQUFDQyxHQUFHLENBQUNILENBQUMsQ0FBQ0ksTUFBTSxHQUFHSCxDQUFDLENBQUNHLE1BQU0sQ0FBQyxHQUFHTixXQUFXLEVBQUUsT0FBT0ksSUFBSSxDQUFDRyxHQUFHLENBQUNMLENBQUMsQ0FBQ0ksTUFBTSxFQUFFSCxDQUFDLENBQUNHLE1BQU0sQ0FBQzs7RUFFcEY7RUFDQSxNQUFNRSxDQUFDLEdBQUcsRUFBRTs7RUFFWjtFQUNBLEtBQUssSUFBSUMsQ0FB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