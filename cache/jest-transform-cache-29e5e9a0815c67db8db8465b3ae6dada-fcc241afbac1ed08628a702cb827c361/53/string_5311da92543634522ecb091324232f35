1e7e14368927f450bb4264bc1d5f097c
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.create = create;
exports.default = void 0;
var _locale = require("./locale");
var _isAbsent = _interopRequireDefault(require("./util/isAbsent"));
var _schema = _interopRequireDefault(require("./schema"));
function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    default: obj
  };
}

// eslint-disable-next-line
let rEmail = /^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i; // eslint-disable-next-line

let rUrl = /^((https?|ftp):)?\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i; // eslint-disable-next-line

let rUUID = /^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;
let isTrimmed = value => (0, _isAbsent.default)(value) || value === value.trim();
let objStringTag = {}.toString();
function create() {
  return new StringSchema();
}
class StringSchema extends _schema.default {
  constructor() {
    super({
      type: 'string'
    });
    this.withMutation(() => {
      this.transform(function (value) {
        if (this.isType(value)) return value;
        if (Array.isArray(value)) return value;
        const strValue = value != null && value.toString ? value.toString() : value;
        if (strValue === objStringTag) return value;
        return strValue;
      });
    });
  }
  _typeCheck(value) {
    if (value instanceof String) value = value.valueOf();
    return typeof value === 'string';
  }
  _isPresent(value) {
    return super._isPresent(value) && !!value.length;
  }
  length(length, message = _locale.string.length) {
    return this.test({
      message,
      name: 'length',
      exclusive: true,
      params: {
        length
      },
      test(value) {
        return (0, _isAbsent.default)(value) || value.length === this.resolve(length);
      }
    });
  }
  min(min, message = _locale.string.min) {
    return this.test({
      message,
      name: 'min',
      exclusive: true,
      params: {
        min
      },
      test(value) {
        return (0, _isAbsent.default)(value) || value.length >= this.resolve(min);
      }
    });
  }
  max(max, message = _locale.string.max) {
    return this.test({
      name: 'max',
      exclusive: true,
      message,
      params: {
        max
      },
      test(value) {
        return (0, _isAbsent.default)(value) || value.length <= this.resolve(max);
      }
    });
  }
  matches(regex, options) {
    let excludeEmptyString = false;
    let message;
    let name;
    if (options) {
      if (typeof options === 'object') {
        ({
          excludeEmptyString = false,
          message,
          name
        } = options);
      } else {
        message = options;
      }
    }
    return this.test({
      name: name || 'matches',
      message: message || _locale.string.matches,
      params: {
        regex
      },
      test: value => (0, _isAbsent.default)(value) || value === '' && excludeEmptyString || value.search(regex) !== -1
    });
  }
  email(message = _locale.string.email) {
    return this.matches(rEmail, {
      name: 'email',
      message,
      excludeEmptyString: true
    });
  }
  url(message = _locale.string.url) {
    return this.matches(rUrl, {
      name: 'url',
      message,
      excludeEmptyString: true
    });
  }
  uuid(message = _locale.string.uuid) {
    return this.matches(rUUID, {
      name: 'uuid',
      message,
      excludeEmptyString: false
    });
  } //-- transforms --

  ensure() {
    return this.default('').transform(val => val === null ? '' : val);
  }
  trim(message = _locale.string.trim) {
    return this.transform(val => val != null ? val.trim() : val).test({
      message,
      name: 'trim',
      test: isTrimmed
    });
  }
  lowercase(message = _locale.string.lowercase) {
    return this.transform(value => !(0, _isAbsent.default)(value) ? value.toLowerCase() : value).test({
      message,
      name: 'string_case',
      exclusive: true,
      test: value => (0, _isAbsent.default)(value) || value === value.toLowerCase()
    });
  }
  uppercase(message = _locale.string.uppercase) {
    return this.transform(value => !(0, _isAbsent.default)(value) ? value.toUpperCase() : value).test({
      message,
      name: 'string_case',
      exclusive: true,
      test: value => (0, _isAbsent.default)(value) || value === value.toUpperCase()
    });
  }
}
exports.default = StringSchema;
create.prototype = StringSchema.prototype; //
// String Interfaces
//
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsImNyZWF0ZSIsImRlZmF1bHQiLCJfbG9jYWxlIiwicmVxdWlyZSIsIl9pc0Fic2VudCIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJfc2NoZW1hIiwib2JqIiwiX19lc01vZHVsZSIsInJFbWFpbCIsInJVcmwiLCJyVVVJRCIsImlzVHJpbW1lZCIsInRyaW0iLCJvYmpTdHJpbmdUYWciLCJ0b1N0cmluZyIsIlN0cmluZ1NjaGVtYSIsImNvbnN0cnVjdG9yIiwidHlwZSIsIndpdGhNdXRhdGlvbiIsInRyYW5zZm9ybSIsImlzVHlwZSIsIkFycmF5IiwiaXNBcnJheSIsInN0clZhbHVlIiwiX3R5cGVDaGVjayIsIlN0cmluZyIsInZhbHVlT2YiLCJfaXNQcmVzZW50IiwibGVuZ3RoIiwibWVzc2FnZSIsInN0cmluZyIsInRlc3QiLCJuYW1lIiwiZXhjbHVzaXZlIiwicGFyYW1zIiwicmVzb2x2ZSIsIm1pbiIsIm1heCIsIm1hdGNoZXMiLCJyZWdleCIsIm9wdGlvbnMiLCJleGNsdWRlRW1wdHlTdHJpbmciLCJzZWFyY2giLCJlbWFpbCIsInVybCIsInV1aWQiLCJlbnN1cmUiLCJ2YWwiLCJsb3dlcmNhc2UiLCJ0b0xvd2VyQ2FzZSIsInVwcGVyY2FzZSIsInRvVXBwZXJDYXNlIiwicHJvdG90eXBlIl0sInNvdXJjZXMiOlsic3RyaW5nLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHtcbiAgdmFsdWU6IHRydWVcbn0pO1xuZXhwb3J0cy5jcmVhdGUgPSBjcmVhdGU7XG5leHBvcnRzLmRlZmF1bHQgPSB2b2lkIDA7XG5cbnZhciBfbG9jYWxlID0gcmVxdWlyZShcIi4vbG9jYWxlXCIpO1xuXG52YXIgX2lzQWJzZW50ID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKFwiLi91dGlsL2lzQWJzZW50XCIpKTtcblxudmFyIF9zY2hlbWEgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoXCIuL3NjaGVtYVwiKSk7XG5cbmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9XG5cbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZVxubGV0IHJFbWFpbCA9IC9eKCgoW2Etel18XFxkfFshI1xcJCUmJ1xcKlxcK1xcLVxcLz1cXD9cXF5fYHtcXHx9fl18W1xcdTAwQTAtXFx1RDdGRlxcdUY5MDAtXFx1RkRDRlxcdUZERjAtXFx1RkZFRl0pKyhcXC4oW2Etel18XFxkfFshI1xcJCUmJ1xcKlxcK1xcLVxcLz1cXD9cXF5fYHtcXHx9fl18W1xcdTAwQTAtXFx1RDdGRlxcdUY5MDAtXFx1RkRDRlxcdUZERjAtXFx1RkZFRl0pKykqKXwoKFxceDIyKSgoKChcXHgyMHxcXHgwOSkqKFxceDBkXFx4MGEpKT8oXFx4MjB8XFx4MDkpKyk/KChbXFx4MDEtXFx4MDhcXHgwYlxceDBjXFx4MGUtXFx4MWZcXHg3Zl18XFx4MjF8W1xceDIzLVxceDViXXxbXFx4NWQtXFx4N2VdfFtcXHUwMEEwLVxcdUQ3RkZcXHVGOTAwLVxcdUZEQ0ZcXHVGREYwLVxcdUZGRUZdKXwoXFxcXChbXFx4MDEtXFx4MDlcXHgwYlxceDBjXFx4MGQtXFx4N2ZdfFtcXHUwMEEwLVxcdUQ3RkZcXHVGOTAwLVxcdUZEQ0ZcXHVGREYwLVxcdUZGRUZdKSkpKSooKChcXHgyMHxcXHgwOSkqKFxceDBkXFx4MGEpKT8oXFx4MjB8XFx4MDkpKyk/KFxceDIyKSkpQCgoKFthLXpdfFxcZHxbXFx1MDBBMC1cXHVEN0ZGXFx1RjkwMC1cXHVGRENGXFx1RkRGMC1cXHVGRkVGXSl8KChbYS16XXxcXGR8W1xcdTAwQTAtXFx1RDdGRlxcdUY5MDAtXFx1RkRDRlxcdUZERjAtXFx1RkZFRl0pKFthLXpdfFxcZHwtfFxcLnxffH58W1xcdTAwQTAtXFx1RDdGRlxcdUY5MDAtXFx1RkRDRlxcdUZERjAtXFx1RkZFRl0pKihbYS16XXxcXGR8W1xcdTAwQTAtXFx1RDdGRlxcdUY5MDAtXFx1RkRDRlxcdUZERjAtXFx1RkZFRl0pKSlcXC4pKygoW2Etel18W1xcdTAwQTAtXFx1RDdGRlxcdUY5MDAtXFx1RkRDRlxcdUZERjAtXFx1RkZFRl0pfCgoW2Etel18W1xcdTAwQTAtXFx1RDdGRlxcdUY5MDAtXFx1RkRDRlxcdUZERjAtXFx1RkZFRl0pKFthLXpdfFxcZHwtfFxcLnxffH58W1xcdTAwQTAtXFx1RDdGRlxcdUY5MDAtXFx1RkRDRlxcdUZERjAtXFx1RkZFRl0pKihbYS16XXxbXFx1MDBBMC1cXHVEN0ZGXFx1RjkwMC1cXHVGRENGXFx1RkRGMC1cXHVGRkVGXSkpKSQvaTsgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lXG5cbmxldCByVXJsID0gL14oKGh0dHBzP3xmdHApOik/XFwvXFwvKCgoKFthLXpdfFxcZHwtfFxcLnxffH58W1xcdTAwQTAtXFx1RDdGRlxcdUY5MDAtXFx1RkRDRlxcdUZERjAtXFx1RkZFRl0pfCglW1xcZGEtZl17Mn0pfFshXFwkJidcXChcXClcXCpcXCssOz1dfDopKkApPygoKFxcZHxbMS05XVxcZHwxXFxkXFxkfDJbMC00XVxcZHwyNVswLTVdKVxcLihcXGR8WzEtOV1cXGR8MVxcZFxcZHwyWzAtNF1cXGR8MjVbMC01XSlcXC4oXFxkfFsxLTldXFxkfDFcXGRcXGR8MlswLTRdXFxkfDI1WzAtNV0pXFwuKFxcZHxbMS05XVxcZHwxXFxkXFxkfDJbMC00XVxcZHwyNVswLTVdKSl8KCgoW2Etel18XFxkfFtcXHUwMEEwLVxcdUQ3RkZcXHVGOTAwLVxcdUZEQ0ZcXHVGREYwLVxcdUZGRUZdKXwoKFthLXpdfFxcZHxbXFx1MDBBMC1cXHVEN0ZGXFx1RjkwMC1cXHVGRENGXFx1RkRGMC1cXHVGRkVGXSkoW2Etel18XFxkfC18XFwufF98fnxbXFx1MDBBMC1cXHVEN0ZGXFx1RjkwMC1cXHVGRENGXFx1RkRGMC1cXHVGRkVGXSkqKFthLXpdfFxcZHxbXFx1MDBBMC1cXHVEN0ZGXFx1RjkwMC1cXHVGRENGXFx1RkRGMC1cXHVGRkVGXSkpKVxcLikrKChbYS16XXxbXFx1MDBBMC1cXHVEN0ZGXFx1RjkwMC1cXHVGRENGXFx1RkRGMC1cXHVGRkVGXSl8KChbYS16XXxbXFx1MDBBMC1cXHVEN0ZGXFx1RjkwMC1cXHVGRENGXFx1RkRGMC1cXHVGRkVGXSkoW2Etel18XFxkfC18XFwufF98fnxbXFx1MDBBMC1cXHVEN0ZGXFx1RjkwMC1cXHVGRENGXFx1RkRGMC1cXHVGRkVGXSkqKFthLXpdfFtcXHUwMEEwLVxcdUQ3RkZcXHVGOTAwLVxcdUZEQ0ZcXHVGREYwLVxcdUZGRUZdKSkpXFwuPykoOlxcZCopPykoXFwvKCgoW2Etel18XFxkfC18XFwufF98fnxbXFx1MDBBMC1cXHVEN0ZGXFx1RjkwMC1cXHVGRENGXFx1RkRGMC1cXHVGRkVGXSl8KCVbXFxkYS1mXXsyfSl8WyFcXCQmJ1xcKFxcKVxcKlxcKyw7PV18OnxAKSsoXFwvKChbYS16XXxcXGR8LXxcXC58X3x+fFtcXHUwMEEwLVxcdUQ3RkZcXHVGOTAwLVxcdUZEQ0ZcXHVGREYwLVxcdUZGRUZdKXwoJVtcXGRhLWZdezJ9KXxbIVxcJCYnXFwoXFwpXFwqXFwrLDs9XXw6fEApKikqKT8pPyhcXD8oKChbYS16XXxcXGR8LXxcXC58X3x+fFtcXHUwMEEwLVxcdUQ3RkZcXHVGOTAwLVxcdUZEQ0ZcXHVGREYwLVxcdUZGRUZdKXwoJVtcXGRhLWZdezJ9KXxbIVxcJCYnXFwoXFwpXFwqXFwrLDs9XXw6fEApfFtcXHVFMDAwLVxcdUY4RkZdfFxcL3xcXD8pKik/KFxcIygoKFthLXpdfFxcZHwtfFxcLnxffH58W1xcdTAwQTAtXFx1RDdGRlxcdUY5MDAtXFx1RkRDRlxcdUZERjAtXFx1RkZFRl0pfCglW1xcZGEtZl17Mn0pfFshXFwkJidcXChcXClcXCpcXCssOz1dfDp8QCl8XFwvfFxcPykqKT8kL2k7IC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZVxuXG5sZXQgclVVSUQgPSAvXig/OlswLTlhLWZdezh9LVswLTlhLWZdezR9LVsxLTVdWzAtOWEtZl17M30tWzg5YWJdWzAtOWEtZl17M30tWzAtOWEtZl17MTJ9fDAwMDAwMDAwLTAwMDAtMDAwMC0wMDAwLTAwMDAwMDAwMDAwMCkkL2k7XG5cbmxldCBpc1RyaW1tZWQgPSB2YWx1ZSA9PiAoMCwgX2lzQWJzZW50LmRlZmF1bHQpKHZhbHVlKSB8fCB2YWx1ZSA9PT0gdmFsdWUudHJpbSgpO1xuXG5sZXQgb2JqU3RyaW5nVGFnID0ge30udG9TdHJpbmcoKTtcblxuZnVuY3Rpb24gY3JlYXRlKCkge1xuICByZXR1cm4gbmV3IFN0cmluZ1NjaGVtYSgpO1xufVxuXG5jbGFzcyBTdHJpbmdTY2hlbWEgZXh0ZW5kcyBfc2NoZW1hLmRlZmF1bHQge1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICBzdXBlcih7XG4gICAgICB0eXBlOiAnc3RyaW5nJ1xuICAgIH0pO1xuICAgIHRoaXMud2l0aE11dGF0aW9uKCgpID0+IHtcbiAgICAgIHRoaXMudHJhbnNmb3JtKGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICBpZiAodGhpcy5pc1R5cGUodmFsdWUpKSByZXR1cm4gdmFsdWU7XG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkgcmV0dXJuIHZhbHVlO1xuICAgICAgICBjb25zdCBzdHJWYWx1ZSA9IHZhbHVlICE9IG51bGwgJiYgdmFsdWUudG9TdHJpbmcgPyB2YWx1ZS50b1N0cmluZygpIDogdmFsdWU7XG4gICAgICAgIGlmIChzdHJWYWx1ZSA9PT0gb2JqU3RyaW5nVGFnKSByZXR1cm4gdmFsdWU7XG4gICAgICAgIHJldHVybiBzdHJWYWx1ZTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgX3R5cGVDaGVjayh2YWx1ZSkge1xuICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIFN0cmluZykgdmFsdWUgPSB2YWx1ZS52YWx1ZU9mKCk7XG4gICAgcmV0dXJuIHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZyc7XG4gIH1cblxuICBfaXNQcmVzZW50KHZhbHVlKSB7XG4gICAgcmV0dXJuIHN1cGVyLl9pc1ByZXNlbnQodmFsdWUpICYmICEhdmFsdWUubGVuZ3RoO1xuICB9XG5cbiAgbGVuZ3RoKGxlbmd0aCwgbWVzc2FnZSA9IF9sb2NhbGUuc3RyaW5nLmxlbmd0aCkge1xuICAgIHJldHVybiB0aGlzLnRlc3Qoe1xuICAgICAgbWVzc2FnZSxcbiAgICAgIG5hbWU6ICdsZW5ndGgnLFxuICAgICAgZXhjbHVzaXZlOiB0cnVlLFxuICAgICAgcGFyYW1zOiB7XG4gICAgICAgIGxlbmd0aFxuICAgICAgfSxcblxuICAgICAgdGVzdCh2YWx1ZSkge1xuICAgICAgICByZXR1cm4gKDAsIF9pc0Fic2VudC5kZWZhdWx0KSh2YWx1ZSkgfHwgdmFsdWUubGVuZ3RoID09PSB0aGlzLnJlc29sdmUobGVuZ3RoKTtcbiAgICAgIH1cblxuICAgIH0pO1xuICB9XG5cbiAgbWluKG1pbiwgbWVzc2FnZSA9IF9sb2NhbGUuc3RyaW5nLm1pbikge1xuICAgIHJldHVybiB0aGlzLnRlc3Qoe1xuICAgICAgbWVzc2FnZSxcbiAgICAgIG5hbWU6ICdtaW4nLFxuICAgICAgZXhjbHVzaXZlOiB0cnVlLFxuICAgICAgcGFyYW1zOiB7XG4gICAgICAgIG1pblxuICAgICAgfSxcblxuICAgICAgdGVzdCh2YWx1ZSkge1xuICAgICAgICByZXR1cm4gKDAsIF9pc0Fic2VudC5kZWZhdWx0KSh2YWx1ZSkgfHwgdmFsdWUubGVuZ3RoID49IHRoaXMucmVzb2x2ZShtaW4pO1xuICAgICAgfVxuXG4gICAgfSk7XG4gIH1cblxuICBtYXgobWF4LCBtZXNzYWdlID0gX2xvY2FsZS5zdHJpbmcubWF4KSB7XG4gICAgcmV0dXJuIHRoaXMudGVzdCh7XG4gICAgICBuYW1lOiAnbWF4JyxcbiAgICAgIGV4Y2x1c2l2ZTogdHJ1ZSxcbiAgICAgIG1lc3NhZ2UsXG4gICAgICBwYXJhbXM6IHtcbiAgICAgICAgbWF4XG4gICAgICB9LFxuXG4gICAgICB0ZXN0KHZhbHVlKSB7XG4gICAgICAgIHJldHVybiAoMCwgX2lzQWJzZW50LmRlZmF1bHQpKHZhbHVlKSB8fCB2YWx1ZS5sZW5ndGggPD0gdGhpcy5yZXNvbHZlKG1heCk7XG4gICAgICB9XG5cbiAgICB9KTtcbiAgfVxuXG4gIG1hdGNoZXMocmVnZXgsIG9wdGlvbnMpIHtcbiAgICBsZXQgZXhjbHVkZUVtcHR5U3RyaW5nID0gZmFsc2U7XG4gICAgbGV0IG1lc3NhZ2U7XG4gICAgbGV0IG5hbWU7XG5cbiAgICBpZiAob3B0aW9ucykge1xuICAgICAgaWYgKHR5cGVvZiBvcHRpb25zID09PSAnb2JqZWN0Jykge1xuICAgICAgICAoe1xuICAgICAgICAgIGV4Y2x1ZGVFbXB0eVN0cmluZyA9IGZhbHNlLFxuICAgICAgICAgIG1lc3NhZ2UsXG4gICAgICAgICAgbmFtZVxuICAgICAgICB9ID0gb3B0aW9ucyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBtZXNzYWdlID0gb3B0aW9ucztcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy50ZXN0KHtcbiAgICAgIG5hbWU6IG5hbWUgfHwgJ21hdGNoZXMnLFxuICAgICAgbWVzc2FnZTogbWVzc2FnZSB8fCBfbG9jYWxlLnN0cmluZy5tYXRjaGVzLFxuICAgICAgcGFyYW1zOiB7XG4gICAgICAgIHJlZ2V4XG4gICAgICB9LFxuICAgICAgdGVzdDogdmFsdWUgPT4gKDAsIF9pc0Fic2VudC5kZWZhdWx0KSh2YWx1ZSkgfHwgdmFsdWUgPT09ICcnICYmIGV4Y2x1ZGVFbXB0eVN0cmluZyB8fCB2YWx1ZS5zZWFyY2gocmVnZXgpICE9PSAtMVxuICAgIH0pO1xuICB9XG5cbiAgZW1haWwobWVzc2FnZSA9IF9sb2NhbGUuc3RyaW5nLmVtYWlsKSB7XG4gICAgcmV0dXJuIHRoaXMubWF0Y2hlcyhyRW1haWwsIHtcbiAgICAgIG5hbWU6ICdlbWFpbCcsXG4gICAgICBtZXNzYWdlLFxuICAgICAgZXhjbHVkZUVtcHR5U3RyaW5nOiB0cnVlXG4gICAgfSk7XG4gIH1cblxuICB1cmwobWVzc2FnZSA9IF9sb2NhbGUuc3RyaW5nLnVybCkge1xuICAgIHJldHVybiB0aGlzLm1hdGNoZXMoclVybCwge1xuICAgICAgbmFtZTogJ3VybCcsXG4gICAgICBtZXNzYWdlLFxuICAgICAgZXhjbHVkZUVtcHR5U3RyaW5nOiB0cnVlXG4gICAgfSk7XG4gIH1cblxuICB1dWlkKG1lc3NhZ2UgPSBfbG9jYWxlLnN0cmluZy51dWlkKSB7XG4gICAgcmV0dXJuIHRoaXMubWF0Y2hlcyhyVVVJRCwge1xuICAgICAgbmFtZTogJ3V1aWQnLFxuICAgICAgbWVzc2FnZSxcbiAgICAgIGV4Y2x1ZGVFbXB0eVN0cmluZzogZmFsc2VcbiAgICB9KTtcbiAgfSAvLy0tIHRyYW5zZm9ybXMgLS1cblxuXG4gIGVuc3VyZSgpIHtcbiAgICByZXR1cm4gdGhpcy5kZWZhdWx0KCcnKS50cmFuc2Zvcm0odmFsID0+IHZhbCA9PT0gbnVsbCA/ICcnIDogdmFsKTtcbiAgfVxuXG4gIHRyaW0obWVzc2FnZSA9IF9sb2NhbGUuc3RyaW5nLnRyaW0pIHtcbiAgICByZXR1cm4gdGhpcy50cmFuc2Zvcm0odmFsID0+IHZhbCAhPSBudWxsID8gdmFsLnRyaW0oKSA6IHZhbCkudGVzdCh7XG4gICAgICBtZXNzYWdlLFxuICAgICAgbmFtZTogJ3RyaW0nLFxuICAgICAgdGVzdDogaXNUcmltbWVkXG4gICAgfSk7XG4gIH1cblxuICBsb3dlcmNhc2UobWVzc2FnZSA9IF9sb2NhbGUuc3RyaW5nLmxvd2VyY2FzZSkge1xuICAgIHJldHVybiB0aGlzLnRyYW5zZm9ybSh2YWx1ZSA9PiAhKDAsIF9pc0Fic2VudC5kZWZhdWx0KSh2YWx1ZSkgPyB2YWx1ZS50b0xvd2VyQ2FzZSgpIDogdmFsdWUpLnRlc3Qoe1xuICAgICAgbWVzc2FnZSxcbiAgICAgIG5hbWU6ICdzdHJpbmdfY2FzZScsXG4gICAgICBleGNsdXNpdmU6IHRydWUsXG4gICAgICB0ZXN0OiB2YWx1ZSA9PiAoMCwgX2lzQWJzZW50LmRlZmF1bHQpKHZhbHVlKSB8fCB2YWx1ZSA9PT0gdmFsdWUudG9Mb3dlckNhc2UoKVxuICAgIH0pO1xuICB9XG5cbiAgdXBwZXJjYXNlKG1lc3NhZ2UgPSBfbG9jYWxlLnN0cmluZy51cHBlcmNhc2UpIHtcbiAgICByZXR1cm4gdGhpcy50cmFuc2Zvcm0odmFsdWUgPT4gISgwLCBfaXNBYnNlbnQuZGVmYXVsdCkodmFsdWUpID8gdmFsdWUudG9VcHBlckNhc2UoKSA6IHZhbHVlKS50ZXN0KHtcbiAgICAgIG1lc3NhZ2UsXG4gICAgICBuYW1lOiAnc3RyaW5nX2Nhc2UnLFxuICAgICAgZXhjbHVzaXZlOiB0cnVlLFxuICAgICAgdGVzdDogdmFsdWUgPT4gKDAsIF9pc0Fic2VudC5kZWZhdWx0KSh2YWx1ZSkgfHwgdmFsdWUgPT09IHZhbHVlLnRvVXBwZXJDYXNlKClcbiAgICB9KTtcbiAgfVxuXG59XG5cbmV4cG9ydHMuZGVmYXVsdCA9IFN0cmluZ1NjaGVtYTtcbmNyZWF0ZS5wcm90b3R5cGUgPSBTdHJpbmdTY2hlbWEucHJvdG90eXBlOyAvL1xuLy8gU3RyaW5nIEludGVyZmFjZXNcbi8vIl0sIm1hcHBpbmdzIjoiQUFBQSxZQUFZOztBQUVaQSxNQUFNLENBQUNDLGNBQWMsQ0FBQ0MsT0FBTyxFQUFFLFlBQVksRUFBRTtFQUMzQ0MsS0FBSyxFQUFFO0FBQ1QsQ0FBQyxDQUFDO0FBQ0ZELE9BQU8sQ0FBQ0UsTUFBTSxHQUFHQSxNQUFNO0FBQ3ZCRixPQUFPLENBQUNHLE9BQU8sR0FBRyxLQUFLLENBQUM7QUFFeEIsSUFBSUMsT0FBTyxHQUFHQyxPQUFPLENBQUMsVUFBVSxDQUFDO0FBRWpDLElBQUlDLFNBQVMsR0FBR0Msc0JBQXNCLENBQUNGLE9BQU8sQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO0FBRWxFLElBQUlHLE9BQU8sR0FBR0Qsc0JBQXNCLENBQUNGLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQztBQUV6RCxTQUFTRSxzQkFBc0JBLENBQUNFLEdBQUcsRUFBRTtFQUFFLE9BQU9BLEdBQUcsSUFBSUEsR0FBRyxDQUFD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