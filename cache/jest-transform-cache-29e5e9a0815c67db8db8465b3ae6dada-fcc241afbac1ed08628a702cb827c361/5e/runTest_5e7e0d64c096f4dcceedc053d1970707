8db171e8618aeacc41d71fe589c76eeb
'use strict';

Object.defineProperty(exports, '__esModule', {
  value: true
});
exports.default = runTest;
function _chalk() {
  const data = _interopRequireDefault(require('chalk'));
  _chalk = function () {
    return data;
  };
  return data;
}
function fs() {
  const data = _interopRequireWildcard(require('graceful-fs'));
  fs = function () {
    return data;
  };
  return data;
}
function _sourceMapSupport() {
  const data = _interopRequireDefault(require('source-map-support'));
  _sourceMapSupport = function () {
    return data;
  };
  return data;
}
function _console() {
  const data = require('@jest/console');
  _console = function () {
    return data;
  };
  return data;
}
function _transform() {
  const data = require('@jest/transform');
  _transform = function () {
    return data;
  };
  return data;
}
function docblock() {
  const data = _interopRequireWildcard(require('jest-docblock'));
  docblock = function () {
    return data;
  };
  return data;
}
function _jestLeakDetector() {
  const data = _interopRequireDefault(require('jest-leak-detector'));
  _jestLeakDetector = function () {
    return data;
  };
  return data;
}
function _jestMessageUtil() {
  const data = require('jest-message-util');
  _jestMessageUtil = function () {
    return data;
  };
  return data;
}
function _jestResolve() {
  const data = require('jest-resolve');
  _jestResolve = function () {
    return data;
  };
  return data;
}
function _jestUtil() {
  const data = require('jest-util');
  _jestUtil = function () {
    return data;
  };
  return data;
}
function _getRequireWildcardCache(nodeInterop) {
  if (typeof WeakMap !== 'function') return null;
  var cacheBabelInterop = new WeakMap();
  var cacheNodeInterop = new WeakMap();
  return (_getRequireWildcardCache = function (nodeInterop) {
    return nodeInterop ? cacheNodeInterop : cacheBabelInterop;
  })(nodeInterop);
}
function _interopRequireWildcard(obj, nodeInterop) {
  if (!nodeInterop && obj && obj.__esModule) {
    return obj;
  }
  if (obj === null || typeof obj !== 'object' && typeof obj !== 'function') {
    return {
      default: obj
    };
  }
  var cache = _getRequireWildcardCache(nodeInterop);
  if (cache && cache.has(obj)) {
    return cache.get(obj);
  }
  var newObj = {};
  var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;
  for (var key in obj) {
    if (key !== 'default' && Object.prototype.hasOwnProperty.call(obj, key)) {
      var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;
      if (desc && (desc.get || desc.set)) {
        Object.defineProperty(newObj, key, desc);
      } else {
        newObj[key] = obj[key];
      }
    }
  }
  newObj.default = obj;
  if (cache) {
    cache.set(obj, newObj);
  }
  return newObj;
}
function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    default: obj
  };
}

/**
 * Copyright (c) Facebook, Inc. and its affiliates. All Rights Reserved.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 *
 */
function freezeConsole(testConsole, config) {
  // @ts-expect-error: `_log` is `private` - we should figure out some proper API here
  testConsole._log = function fakeConsolePush(_type, message) {
    const error = new (_jestUtil().ErrorWithStack)(`${_chalk().default.red(`${_chalk().default.bold('Cannot log after tests are done.')} Did you forget to wait for something async in your test?`)}\nAttempted to log "${message}".`, fakeConsolePush);
    const formattedError = (0, _jestMessageUtil().formatExecError)(error, config, {
      noStackTrace: false
    }, undefined, true);
    process.stderr.write('\n' + formattedError + '\n');
    process.exitCode = 1;
  };
} // Keeping the core of "runTest" as a separate function (as "runTestInternal")
// is key to be able to detect memory leaks. Since all variables are local to
// the function, when "runTestInternal" finishes its execution, they can all be
// freed, UNLESS something else is leaking them (and that's why we can detect
// the leak!).
//
// If we had all the code in a single function, we should manually nullify all
// references to verify if there is a leak, which is not maintainable and error
// prone. That's why "runTestInternal" CANNOT be inlined inside "runTest".

async function runTestInternal(path, globalConfig, config, resolver, context, sendMessageToJest) {
  const testSource = fs().readFileSync(path, 'utf8');
  const docblockPragmas = docblock().parse(docblock().extract(testSource));
  const customEnvironment = docblockPragmas['jest-environment'];
  let testEnvironment = config.testEnvironment;
  if (customEnvironment) {
    if (Array.isArray(customEnvironment)) {
      throw new Error(`You can only define a single test environment through docblocks, got "${customEnvironment.join(', ')}"`);
    }
    testEnvironment = (0, _jestResolve().resolveTestEnvironment)({
      ...config,
      requireResolveFunction: require.resolve,
      testEnvironment: customEnvironment
    });
  }
  const cacheFS = new Map([[path, testSource]]);
  const transformer = await (0, _transform().createScriptTransformer)(config, cacheFS);
  const TestEnvironment = await transformer.requireAndTranspileModule(testEnvironment);
  const testFramework = await transformer.requireAndTranspileModule(process.env.JEST_JASMINE === '1' ? require.resolve('jest-jasmine2') : config.testRunner);
  const Runtime = (0, _jestUtil().interopRequireDefault)(config.moduleLoader ? require(config.moduleLoader) : require('jest-runtime')).default;
  const consoleOut = globalConfig.useStderr ? process.stderr : process.stdout;
  const consoleFormatter = (type, message) => (0, _console().getConsoleOutput)(
  // 4 = the console call is buried 4 stack frames deep
  _console().BufferedConsole.write([], type, message, 4), config, globalConfig);
  let testConsole;
  if (globalConfig.silent) {
    testConsole = new (_console().NullConsole)(consoleOut, consoleOut, consoleFormatter);
  } else if (globalConfig.verbose) {
    testConsole = new (_console().CustomConsole)(consoleOut, consoleOut, consoleFormatter);
  } else {
    testConsole = new (_console().BufferedConsole)();
  }
  const environment = new TestEnvironment(config, {
    console: testConsole,
    docblockPragmas,
    testPath: path
  });
  if (typeof environment.getVmContext !== 'function') {
    console.error(`Test environment found at "${testEnvironment}" does not export a "getVmContext" method, which is mandatory from Jest 27. This method is a replacement for "runScript".`);
    process.exit(1);
  }
  const leakDetector = config.detectLeaks ? new (_jestLeakDetector().default)(environment) : null;
  (0, _jestUtil().setGlobal)(environment.global, 'console', testConsole);
  const runtime = new Runtime(config, environment, resolver, transformer, cacheFS, {
    changedFiles: context === null || context === void 0 ? void 0 : context.changedFiles,
    collectCoverage: globalConfig.collectCoverage,
    collectCoverageFrom: globalConfig.collectCoverageFrom,
    collectCoverageOnlyFrom: globalConfig.collectCoverageOnlyFrom,
    coverageProvider: globalConfig.coverageProvider,
    sourcesRelatedToTestsInChangedFiles: context === null || context === void 0 ? void 0 : context.sourcesRelatedToTestsInChangedFiles
  }, path);
  const start = Date.now();
  for (const path of config.setupFiles) {
    const esm = runtime.unstable_shouldLoadAsEsm(path);
    if (esm) {
      await runtime.unstable_importModule(path);
    } else {
      runtime.requireModule(path);
    }
  }
  const sourcemapOptions = {
    environment: 'node',
    handleUncaughtExceptions: false,
    retrieveSourceMap: source => {
      var _runtime$getSourceMap;
      const sourceMapSource = (_runtime$getSourceMap = runtime.getSourceMaps()) === null || _runtime$getSourceMap === void 0 ? void 0 : _runtime$getSourceMap.get(source);
      if (sourceMapSource) {
        try {
          return {
            map: JSON.parse(fs().readFileSync(sourceMapSource, 'utf8')),
            url: source
          };
        } catch {}
      }
      return null;
    }
  }; // For tests

  runtime.requireInternalModule(require.resolve('source-map-support'), 'source-map-support').install(sourcemapOptions); // For runtime errors

  _sourceMapSupport().default.install(sourcemapOptions);
  if (environment.global && environment.global.process && environment.global.process.exit) {
    const realExit = environment.global.process.exit;
    environment.global.process.exit = function exit(...args) {
      const error = new (_jestUtil().ErrorWithStack)(`process.exit called with "${args.join(', ')}"`, exit);
      const formattedError = (0, _jestMessageUtil().formatExecError)(error, config, {
        noStackTrace: false
      }, undefined, true);
      process.stderr.write(formattedError);
      return realExit(...args);
    };
  } // if we don't have `getVmContext` on the env skip coverage

  const collectV8Coverage = globalConfig.coverageProvider === 'v8' && typeof environment.getVmContext === 'function';
  try {
    await environment.setup();
    let result;
    try {
      if (collectV8Coverage) {
        await runtime.collectV8Coverage();
      }
      result = await testFramework(globalConfig, config, environment, runtime, path, sendMessageToJest);
    } catch (err) {
      // Access stack before uninstalling sourcemaps
      err.stack;
      throw err;
    } finally {
      if (collectV8Coverage) {
        await runtime.stopCollectingV8Coverage();
      }
    }
    freezeConsole(testConsole, config);
    const testCount = result.numPassingTests + result.numFailingTests + result.numPendingTests + result.numTodoTests;
    const end = Date.now();
    const testRuntime = end - start;
    result.perfStats = {
      end,
      runtime: testRuntime,
      slow: testRuntime / 1000 > config.slowTestThreshold,
      start
    };
    result.testFilePath = path;
    result.console = testConsole.getBuffer();
    result.skipped = testCount === result.numPendingTests;
    result.displayName = config.displayName;
    const coverage = runtime.getAllCoverageInfoCopy();
    if (coverage) {
      const coverageKeys = Object.keys(coverage);
      if (coverageKeys.length) {
        result.coverage = coverage;
      }
    }
    if (collectV8Coverage) {
      const v8Coverage = runtime.getAllV8CoverageInfoCopy();
      if (v8Coverage && v8Coverage.length > 0) {
        result.v8Coverage = v8Coverage;
      }
    }
    if (globalConfig.logHeapUsage) {
      if (global.gc) {
        global.gc();
      }
      result.memoryUsage = process.memoryUsage().heapUsed;
    } // Delay the resolution to allow log messages to be output.

    return new Promise(resolve => {
      setImmediate(() => resolve({
        leakDetector,
        result
      }));
    });
  } finally {
    runtime.teardown();
    await environment.teardown();
    _sourceMapSupport().default.resetRetrieveHandlers();
  }
}
async function runTest(path, globalConfig, config, resolver, context, sendMessageToJest) {
  const {
    leakDetector,
    result
  } = await runTestInternal(path, globalConfig, config, resolver, context, sendMessageToJest);
  if (leakDetector) {
    // We wanna allow a tiny but time to pass to allow last-minute cleanup
    await new Promise(resolve => setTimeout(resolve, 100)); // Resolve leak detector, outside the "runTestInternal" closure.

    result.leaks = await leakDetector.isLeaking();
  } else {
    result.leaks = false;
  }
  return result;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsImRlZmF1bHQiLCJydW5UZXN0IiwiX2NoYWxrIiwiZGF0YSIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJyZXF1aXJlIiwiZnMiLCJfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZCIsIl9zb3VyY2VNYXBTdXBwb3J0IiwiX2NvbnNvbGUiLCJfdHJhbnNmb3JtIiwiZG9jYmxvY2siLCJfamVzdExlYWtEZXRlY3RvciIsIl9qZXN0TWVzc2FnZVV0aWwiLCJfamVzdFJlc29sdmUiLCJfamVzdFV0aWwiLCJfZ2V0UmVxdWlyZVdpbGRjYXJkQ2FjaGUiLCJub2RlSW50ZXJvcCIsIldlYWtNYXAiLCJjYWNoZUJhYmVsSW50ZXJvcCIsImNhY2hlTm9kZUludGVyb3AiLCJvYmoiLCJfX2VzTW9kdWxlIiwiY2FjaGUiLCJoYXMiLCJnZXQiLCJuZXdPYmoiLCJoYXNQcm9wZXJ0eURlc2NyaXB0b3IiLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IiLCJrZXkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJkZXNjIiwic2V0IiwiZnJlZXplQ29uc29sZSIsInRlc3RDb25zb2xlIiwiY29uZmlnIiwiX2xvZyIsImZha2VDb25zb2xlUHVzaCIsIl90eXBlIiwibWVzc2FnZSIsImVycm9yIiwiRXJyb3JXaXRoU3RhY2siLCJyZWQiLCJib2xkIiwiZm9ybWF0dGVkRXJyb3IiLCJmb3JtYXRFeGVjRXJyb3IiLCJub1N0YWNrVHJhY2UiLCJ1bmRlZmluZWQiLCJwcm9jZXNzIiwic3RkZXJyIiwid3JpdGUiLCJleGl0Q29kZSIsInJ1blRlc3RJbnRlcm5hbCIsInBhdGgiLCJnbG9iYWxDb25maWciLCJyZXNvbHZlciIsImNvbnRleHQiLCJzZW5kTWVzc2FnZVRvSmVzdCIsInRlc3RTb3VyY2UiLCJyZWFkRmlsZVN5bmMiLCJkb2NibG9ja1ByYWdtYXMiLCJwYXJzZSIsImV4dHJhY3QiLCJjdXN0b21FbnZpcm9ubWVudCIsInRlc3RFbnZpcm9ubWVudCIsIkFycmF5IiwiaXNBcnJheSIsIkVycm9yIiwiam9pbiIsInJlc29sdmVUZXN0RW52aXJvbm1lbnQiLCJyZXF1aXJlUmVzb2x2ZUZ1bmN0aW9uIiwicmVzb2x2ZSIsImNhY2hlRlMiLCJNYXAiLCJ0cmFuc2Zvcm1lciIsImNyZWF0ZVNjcmlwdFRyYW5zZm9ybWVyIiwiVGVzdEVudmlyb25tZW50IiwicmVxdWlyZUFuZFRyYW5zcGlsZU1vZHVsZSIsInRlc3RGcmFtZXdvcmsiLCJlbnYiLCJKRVNUX0pBU01JTkUiLCJ0ZXN0UnVubmVyIiwiUnVudGltZSIsImludGVyb3BSZXF1aXJlRGVmYXVsdCIsIm1vZHVsZUxvYWRlciIsImNvbnNvbGVPdXQiLCJ1c2VTdGRlcnIiLCJzdGRvdXQiLCJjb25zb2xlRm9ybWF0dGVyIiwidHlwZSIsImdldENvbnNvbGVPdXRwdXQiLCJCdWZmZXJlZENvbnNvbGUiLCJzaWxlbnQiLCJOdWxsQ29uc29sZSIsInZlcmJvc2UiLCJDdXN0b21Db25zb2xlIiwiZW52aXJvbm1lbnQiLCJjb25zb2xlIiwidGVzdFBhdGgiLCJnZXRWbUNvbnRleHQiLCJleGl0IiwibGVha0RldGVjdG9yIiwiZGV0ZWN0TGVha3MiLCJzZXRHbG9iYWwiLCJnbG9iYWwiLCJydW50aW1lIiwiY2hhbmdlZEZpbGVzIiwiY29sbGVjdENvdmVyYWdlIiwiY29sbGVjdENvdmVyYWdlRnJvbSIsImNvbGxlY3RDb3ZlcmFnZU9ubHlGcm9tIiwiY292ZXJhZ2VQcm92aWRlciIsInNvdXJjZXNSZWxhdGVkVG9UZXN0c0luQ2hhbmdlZEZpbGVzIiwic3RhcnQiLCJEYXRlIiwibm93Iiwic2V0dXBGaWxlcyIsImVzbSIsInVuc3RhYmxlX3Nob3VsZExvYWRBc0VzbSIsInVuc3RhYmxlX2ltcG9ydE1vZHVsZSIsInJlcXVpcmVNb2R1bGUiLCJzb3VyY2VtYXBPcHRpb25zIiwiaGFuZGxlVW5jYXVnaHRFeGNlcHRpb25zIiwicmV0cmlldmVTb3VyY2VNYXAiLCJzb3VyY2UiLCJfcnVudGltZSRnZXRTb3VyY2VNYXAiLCJzb3VyY2VNYXBTb3VyY2UiLCJnZXRTb3VyY2VNYXBzIiwibWFwIiwiSlNPTiIsInVybCIsInJlcXVpcmVJbnRlcm5hbE1vZHVsZSIsImluc3RhbGwiLCJyZWFsRXhpdCIsImFyZ3MiLCJjb2xsZWN0VjhDb3ZlcmFnZSIsInNldHVwIiwicmVzdWx0IiwiZXJyIiwic3RhY2siLCJzdG9wQ29sbGVjdGluZ1Y4Q292ZXJhZ2UiLCJ0ZXN0Q291bnQiLCJudW1QYXNzaW5nVGVzdHMiLCJudW1GYWlsaW5nVGVzdHMiLCJudW1QZW5kaW5nVGVzdHMiLCJudW1Ub2RvVGVzdHMiLCJlbmQiLCJ0ZXN0UnVudGltZSIsInBlcmZTdGF0cyIsInNsb3ciLCJzbG93VGVzdFRocmVzaG9sZCIsInRlc3RGaWxlUGF0aCIsImdldEJ1ZmZlciIsInNraXBwZWQiLCJkaXNwbGF5TmFtZSIsImNvdmVyYWdlIiwiZ2V0QWxsQ292ZXJhZ2VJbmZvQ29weSIsImNvdmVyYWdlS2V5cyIsImtleXMiLCJsZW5ndGgiLCJ2OENvdmVyYWdlIiwiZ2V0QWxsVjhDb3ZlcmFnZUluZm9Db3B5IiwibG9nSGVhcFVzYWdlIiwiZ2MiLCJtZW1vcnlVc2FnZSIsImhlYXBVc2VkIiwiUHJvbWlzZSIsInNldEltbWVkaWF0ZSIsInRlYXJkb3duIiwicmVzZXRSZXRyaWV2ZUhhbmRsZXJzIiwic2V0VGltZW91dCIsImxlYWtzIiwiaXNMZWFraW5nIl0sInNvdXJjZXMiOlsicnVuVGVzdC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHtcbiAgdmFsdWU6IHRydWVcbn0pO1xuZXhwb3J0cy5kZWZhdWx0ID0gcnVuVGVzdDtcblxuZnVuY3Rpb24gX2NoYWxrKCkge1xuICBjb25zdCBkYXRhID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKCdjaGFsaycpKTtcblxuICBfY2hhbGsgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIGRhdGE7XG4gIH07XG5cbiAgcmV0dXJuIGRhdGE7XG59XG5cbmZ1bmN0aW9uIGZzKCkge1xuICBjb25zdCBkYXRhID0gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQocmVxdWlyZSgnZ3JhY2VmdWwtZnMnKSk7XG5cbiAgZnMgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIGRhdGE7XG4gIH07XG5cbiAgcmV0dXJuIGRhdGE7XG59XG5cbmZ1bmN0aW9uIF9zb3VyY2VNYXBTdXBwb3J0KCkge1xuICBjb25zdCBkYXRhID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKCdzb3VyY2UtbWFwLXN1cHBvcnQnKSk7XG5cbiAgX3NvdXJjZU1hcFN1cHBvcnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIGRhdGE7XG4gIH07XG5cbiAgcmV0dXJuIGRhdGE7XG59XG5cbmZ1bmN0aW9uIF9jb25zb2xlKCkge1xuICBjb25zdCBkYXRhID0gcmVxdWlyZSgnQGplc3QvY29uc29sZScpO1xuXG4gIF9jb25zb2xlID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBkYXRhO1xuICB9O1xuXG4gIHJldHVybiBkYXRhO1xufVxuXG5mdW5jdGlvbiBfdHJhbnNmb3JtKCkge1xuICBjb25zdCBkYXRhID0gcmVxdWlyZSgnQGplc3QvdHJhbnNmb3JtJyk7XG5cbiAgX3RyYW5zZm9ybSA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gZGF0YTtcbiAgfTtcblxuICByZXR1cm4gZGF0YTtcbn1cblxuZnVuY3Rpb24gZG9jYmxvY2soKSB7XG4gIGNvbnN0IGRhdGEgPSBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChyZXF1aXJlKCdqZXN0LWRvY2Jsb2NrJykpO1xuXG4gIGRvY2Jsb2NrID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBkYXRhO1xuICB9O1xuXG4gIHJldHVybiBkYXRhO1xufVxuXG5mdW5jdGlvbiBfamVzdExlYWtEZXRlY3RvcigpIHtcbiAgY29uc3QgZGF0YSA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgnamVzdC1sZWFrLWRldGVjdG9yJykpO1xuXG4gIF9qZXN0TGVha0RldGVjdG9yID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBkYXRhO1xuICB9O1xuXG4gIHJldHVybiBkYXRhO1xufVxuXG5mdW5jdGlvbiBfamVzdE1lc3NhZ2VVdGlsKCkge1xuICBjb25zdCBkYXRhID0gcmVxdWlyZSgnamVzdC1tZXNzYWdlLXV0aWwnKTtcblxuICBfamVzdE1lc3NhZ2VVdGlsID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBkYXRhO1xuICB9O1xuXG4gIHJldHVybiBkYXRhO1xufVxuXG5mdW5jdGlvbiBfamVzdFJlc29sdmUoKSB7XG4gIGNvbnN0IGRhdGEgPSByZXF1aXJlKCdqZXN0LXJlc29sdmUnKTtcblxuICBfamVzdFJlc29sdmUgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIGRhdGE7XG4gIH07XG5cbiAgcmV0dXJuIGRhdGE7XG59XG5cbmZ1bmN0aW9uIF9qZXN0VXRpbCgpIHtcbiAgY29uc3QgZGF0YSA9IHJlcXVpcmUoJ2plc3QtdXRpbCcpO1xuXG4gIF9qZXN0VXRpbCA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gZGF0YTtcbiAgfTtcblxuICByZXR1cm4gZGF0YTtcbn1cblxuZnVuY3Rpb24gX2dldFJlcXVpcmVXaWxkY2FyZENhY2hlKG5vZGVJbnRlcm9wKSB7XG4gIGlmICh0eXBlb2YgV2Vha01hcCAhPT0gJ2Z1bmN0aW9uJykgcmV0dXJuIG51bGw7XG4gIHZhciBjYWNoZUJhYmVsSW50ZXJvcCA9IG5ldyBXZWFrTWFwKCk7XG4gIHZhciBjYWNoZU5vZGVJbnRlcm9wID0gbmV3IFdlYWtNYXAoKTtcbiAgcmV0dXJuIChfZ2V0UmVxdWlyZVdpbGRjYXJkQ2FjaGUgPSBmdW5jdGlvbiAobm9kZUludGVyb3ApIHtcbiAgICByZXR1cm4gbm9kZUludGVyb3AgPyBjYWNoZU5vZGVJbnRlcm9wIDogY2FjaGVCYWJlbEludGVyb3A7XG4gIH0pKG5vZGVJbnRlcm9wKTtcbn1cblxuZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQob2JqLCBub2RlSW50ZXJvcCkge1xuICBpZiAoIW5vZGVJbnRlcm9wICYmIG9iaiAmJiBvYmouX19lc01vZHVsZSkge1xuICAgIHJldHVybiBvYmo7XG4gIH1cbiAgaWYgKG9iaiA9PT0gbnVsbCB8fCAodHlwZW9mIG9iaiAhPT0gJ29iamVjdCcgJiYgdHlwZW9mIG9iaiAhPT0gJ2Z1bmN0aW9uJykpIHtcbiAgICByZXR1cm4ge2RlZmF1bHQ6IG9ian07XG4gIH1cbiAgdmFyIGNhY2hlID0gX2dldFJlcXVpcmVXaWxkY2FyZENhY2hlKG5vZGVJbnRlcm9wKTtcbiAgaWYgKGNhY2hlICYmIGNhY2hlLmhhcyhvYmopKSB7XG4gICAgcmV0dXJuIGNhY2hlLmdldChvYmopO1xuICB9XG4gIHZhciBuZXdPYmogPSB7fTtcbiAgdmFyIGhhc1Byb3BlcnR5RGVzY3JpcHRvciA9XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5ICYmIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I7XG4gIGZvciAodmFyIGtleSBpbiBvYmopIHtcbiAgICBpZiAoa2V5ICE9PSAnZGVmYXVsdCcgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwga2V5KSkge1xuICAgICAgdmFyIGRlc2MgPSBoYXNQcm9wZXJ0eURlc2NyaXB0b3JcbiAgICAgICAgPyBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iaiwga2V5KVxuICAgICAgICA6IG51bGw7XG4gICAgICBpZiAoZGVzYyAmJiAoZGVzYy5nZXQgfHwgZGVzYy5zZXQpKSB7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShuZXdPYmosIGtleSwgZGVzYyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBuZXdPYmpba2V5XSA9IG9ialtrZXldO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICBuZXdPYmouZGVmYXVsdCA9IG9iajtcbiAgaWYgKGNhY2hlKSB7XG4gICAgY2FjaGUuc2V0KG9iaiwgbmV3T2JqKTtcbiAgfVxuICByZXR1cm4gbmV3T2JqO1xufVxuXG5mdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikge1xuICByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDoge2RlZmF1bHQ6IG9ian07XG59XG5cbi8qKlxuICogQ29weXJpZ2h0IChjKSBGYWNlYm9vaywgSW5jLiBhbmQgaXRzIGFmZmlsaWF0ZXMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuXG4gKlxuICovXG5mdW5jdGlvbiBmcmVlemVDb25zb2xlKHRlc3RDb25zb2xlLCBjb25maWcpIHtcbiAgLy8gQHRzLWV4cGVjdC1lcnJvcjogYF9sb2dgIGlzIGBwcml2YXRlYCAtIHdlIHNob3VsZCBmaWd1cmUgb3V0IHNvbWUgcHJvcGVyIEFQSSBoZXJlXG4gIHRlc3RDb25zb2xlLl9sb2cgPSBmdW5jdGlvbiBmYWtlQ29uc29sZVB1c2goX3R5cGUsIG1lc3NhZ2UpIHtcbiAgICBjb25zdCBlcnJvciA9IG5ldyAoX2plc3RVdGlsKCkuRXJyb3JXaXRoU3RhY2spKFxuICAgICAgYCR7X2NoYWxrKCkuZGVmYXVsdC5yZWQoXG4gICAgICAgIGAke19jaGFsaygpLmRlZmF1bHQuYm9sZChcbiAgICAgICAgICAnQ2Fubm90IGxvZyBhZnRlciB0ZXN0cyBhcmUgZG9uZS4nXG4gICAgICAgICl9IERpZCB5b3UgZm9yZ2V0IHRvIHdhaXQgZm9yIHNvbWV0aGluZyBhc3luYyBpbiB5b3VyIHRlc3Q/YFxuICAgICAgKX1cXG5BdHRlbXB0ZWQgdG8gbG9nIFwiJHttZXNzYWdlfVwiLmAsXG4gICAgICBmYWtlQ29uc29sZVB1c2hcbiAgICApO1xuICAgIGNvbnN0IGZvcm1hdHRlZEVycm9yID0gKDAsIF9qZXN0TWVzc2FnZVV0aWwoKS5mb3JtYXRFeGVjRXJyb3IpKFxuICAgICAgZXJyb3IsXG4gICAgICBjb25maWcsXG4gICAgICB7XG4gICAgICAgIG5vU3RhY2tUcmFjZTogZmFsc2VcbiAgICAgIH0sXG4gICAgICB1bmRlZmluZWQsXG4gICAgICB0cnVlXG4gICAgKTtcbiAgICBwcm9jZXNzLnN0ZGVyci53cml0ZSgnXFxuJyArIGZvcm1hdHRlZEVycm9yICsgJ1xcbicpO1xuICAgIHByb2Nlc3MuZXhpdENvZGUgPSAxO1xuICB9O1xufSAvLyBLZWVwaW5nIHRoZSBjb3JlIG9mIFwicnVuVGVzdFwiIGFzIGEgc2VwYXJhdGUgZnVuY3Rpb24gKGFzIFwicnVuVGVzdEludGVybmFsXCIpXG4vLyBpcyBrZXkgdG8gYmUgYWJsZSB0byBkZXRlY3QgbWVtb3J5IGxlYWtzLiBTaW5jZSBhbGwgdmFyaWFibGVzIGFyZSBsb2NhbCB0b1xuLy8gdGhlIGZ1bmN0aW9uLCB3aGVuIFwicnVuVGVzdEludGVybmFsXCIgZmluaXNoZXMgaXRzIGV4ZWN1dGlvbiwgdGhleSBjYW4gYWxsIGJlXG4vLyBmcmVlZCwgVU5MRVNTIHNvbWV0aGluZyBlbHNlIGlzIGxlYWtpbmcgdGhlbSAoYW5kIHRoYXQncyB3aHkgd2UgY2FuIGRldGVjdFxuLy8gdGhlIGxlYWshKS5cbi8vXG4vLyBJZiB3ZSBoYWQgYWxsIHRoZSBjb2RlIGluIGEgc2luZ2xlIGZ1bmN0aW9uLCB3ZSBzaG91bGQgbWFudWFsbHkgbnVsbGlmeSBhbGxcbi8vIHJlZmVyZW5jZXMgdG8gdmVyaWZ5IGlmIHRoZXJlIGlzIGEgbGVhaywgd2hpY2ggaXMgbm90IG1haW50YWluYWJsZSBhbmQgZXJyb3Jcbi8vIHByb25lLiBUaGF0J3Mgd2h5IFwicnVuVGVzdEludGVybmFsXCIgQ0FOTk9UIGJlIGlubGluZWQgaW5zaWRlIFwicnVuVGVzdFwiLlxuXG5hc3luYyBmdW5jdGlvbiBydW5UZXN0SW50ZXJuYWwoXG4gIHBhdGgsXG4gIGdsb2JhbENvbmZpZyxcbiAgY29uZmlnLFxuICByZXNvbHZlcixcbiAgY29udGV4dCxcbiAgc2VuZE1lc3NhZ2VUb0plc3Rcbikge1xuICBjb25zdCB0ZXN0U291cmNlID0gZnMoKS5yZWFkRmlsZVN5bmMocGF0aCwgJ3V0ZjgnKTtcbiAgY29uc3QgZG9jYmxvY2tQcmFnbWFzID0gZG9jYmxvY2soKS5wYXJzZShkb2NibG9jaygpLmV4dHJhY3QodGVzdFNvdXJjZSkpO1xuICBjb25zdCBjdXN0b21FbnZpcm9ubWVudCA9IGRvY2Jsb2NrUHJhZ21hc1snamVzdC1lbnZpcm9ubWVudCddO1xuICBsZXQgdGVzdEVudmlyb25tZW50ID0gY29uZmlnLnRlc3RFbnZpcm9ubWVudDtcblxuICBpZiAoY3VzdG9tRW52aXJvbm1lbnQpIHtcbiAgICBpZiAoQXJyYXkuaXNBcnJheShjdXN0b21FbnZpcm9ubWVudCkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgYFlvdSBjYW4gb25seSBkZWZpbmUgYSBzaW5nbGUgdGVzdCBlbnZpcm9ubWVudCB0aHJvdWdoIGRvY2Jsb2NrcywgZ290IFwiJHtjdXN0b21FbnZpcm9ubWVudC5qb2luKFxuICAgICAgICAgICcsICdcbiAgICAgICAgKX1cImBcbiAgICAgICk7XG4gICAgfVxuXG4gICAgdGVzdEVudmlyb25tZW50ID0gKDAsIF9qZXN0UmVzb2x2ZSgpLnJlc29sdmVUZXN0RW52aXJvbm1lbnQpKHtcbiAgICAgIC4uLmNvbmZpZyxcbiAgICAgIHJlcXVpcmVSZXNvbHZlRnVuY3Rpb246IHJlcXVpcmUucmVzb2x2ZSxcbiAgICAgIHRlc3RFbnZpcm9ubWVudDogY3VzdG9tRW52aXJvbm1lbnRcbiAgICB9KTtcbiAgfVxuXG4gIGNvbnN0IGNhY2hlRlMgPSBuZXcgTWFwKFtbcGF0aCwgdGVzdFNvdXJjZV1dKTtcbiAgY29uc3QgdHJhbnNmb3JtZXIgPSBhd2FpdCAoMCwgX3RyYW5zZm9ybSgpLmNyZWF0ZVNjcmlwdFRyYW5zZm9ybWVyKShcbiAgICBjb25maWcsXG4gICAgY2FjaGVGU1xuICApO1xuICBjb25zdCBUZXN0RW52aXJvbm1lbnQgPSBhd2FpdCB0cmFuc2Zvcm1lci5yZXF1aXJlQW5kVHJhbnNwaWxlTW9kdWxlKFxuICAgIHRlc3RFbnZpcm9ubWVudFxuICApO1xuICBjb25zdCB0ZXN0RnJhbWV3b3JrID0gYXdhaXQgdHJhbnNmb3JtZXIucmVxdWlyZUFuZFRyYW5zcGlsZU1vZHVsZShcbiAgICBwcm9jZXNzLmVudi5KRVNUX0pBU01JTkUgPT09ICcxJ1xuICAgICAgPyByZXF1aXJlLnJlc29sdmUoJ2plc3QtamFzbWluZTInKVxuICAgICAgOiBjb25maWcudGVzdFJ1bm5lclxuICApO1xuICBjb25zdCBSdW50aW1lID0gKDAsIF9qZXN0VXRpbCgpLmludGVyb3BSZXF1aXJlRGVmYXVsdCkoXG4gICAgY29uZmlnLm1vZHVsZUxvYWRlciA/IHJlcXVpcmUoY29uZmlnLm1vZHVsZUxvYWRlcikgOiByZXF1aXJlKCdqZXN0LXJ1bnRpbWUnKVxuICApLmRlZmF1bHQ7XG4gIGNvbnN0IGNvbnNvbGVPdXQgPSBnbG9iYWxDb25maWcudXNlU3RkZXJyID8gcHJvY2Vzcy5zdGRlcnIgOiBwcm9jZXNzLnN0ZG91dDtcblxuICBjb25zdCBjb25zb2xlRm9ybWF0dGVyID0gKHR5cGUsIG1lc3NhZ2UpID0+XG4gICAgKDAsIF9jb25zb2xlKCkuZ2V0Q29uc29sZU91dHB1dCkoXG4gICAgICAvLyA0ID0gdGhlIGNvbnNvbGUgY2FsbCBpcyBidXJpZWQgNCBzdGFjayBmcmFtZXMgZGVlcFxuICAgICAgX2NvbnNvbGUoKS5CdWZmZXJlZENvbnNvbGUud3JpdGUoW10sIHR5cGUsIG1lc3NhZ2UsIDQpLFxuICAgICAgY29uZmlnLFxuICAgICAgZ2xvYmFsQ29uZmlnXG4gICAgKTtcblxuICBsZXQgdGVzdENvbnNvbGU7XG5cbiAgaWYgKGdsb2JhbENvbmZpZy5zaWxlbnQpIHtcbiAgICB0ZXN0Q29uc29sZSA9IG5ldyAoX2NvbnNvbGUoKS5OdWxsQ29uc29sZSkoXG4gICAgICBjb25zb2xlT3V0LFxuICAgICAgY29uc29sZU91dCxcbiAgICAgIGNvbnNvbGVGb3JtYXR0ZXJcbiAgICApO1xuICB9IGVsc2UgaWYgKGdsb2JhbENvbmZpZy52ZXJib3NlKSB7XG4gICAgdGVzdENvbnNvbGUgPSBuZXcgKF9jb25zb2xlKCkuQ3VzdG9tQ29uc29sZSkoXG4gICAgICBjb25zb2xlT3V0LFxuICAgICAgY29uc29sZU91dCxcbiAgICAgIGNvbnNvbGVGb3JtYXR0ZXJcbiAgICApO1xuICB9IGVsc2Uge1xuICAgIHRlc3RDb25zb2xlID0gbmV3IChfY29uc29sZSgpLkJ1ZmZlcmVkQ29uc29sZSkoKTtcbiAgfVxuXG4gIGNvbnN0IGVudmlyb25tZW50ID0gbmV3IFRlc3RFbnZpcm9ubWVudChjb25maWcsIHtcbiAgICBjb25zb2xlOiB0ZXN0Q29uc29sZSxcbiAgICBkb2NibG9ja1ByYWdtYXMsXG4gICAgdGVzdFBhdGg6IHBhdGhcbiAgfSk7XG5cbiAgaWYgKHR5cGVvZiBlbnZpcm9ubWVudC5nZXRWbUNvbnRleHQgIT09ICdmdW5jdGlvbicpIHtcbiAgICBjb25zb2xlLmVycm9yKFxuICAgICAgYFRlc3QgZW52aXJvbm1lbnQgZm91bmQgYXQgXCIke3Rlc3RFbnZpcm9ubWVudH1cIiBkb2VzIG5vdCBleHBvcnQgYSBcImdldFZtQ29udGV4dFwiIG1ldGhvZCwgd2hpY2ggaXMgbWFuZGF0b3J5IGZyb20gSmVzdCAyNy4gVGhpcyBtZXRob2QgaXMgYSByZXBsYWNlbWVudCBmb3IgXCJydW5TY3JpcHRcIi5gXG4gICAgKTtcbiAgICBwcm9jZXNzLmV4aXQoMSk7XG4gIH1cblxuICBjb25zdCBsZWFrRGV0ZWN0b3IgPSBjb25maWcuZGV0ZWN0TGVha3NcbiAgICA/IG5ldyAoX2plc3RMZWFrRGV0ZWN0b3IoKS5kZWZhdWx0KShlbnZpcm9ubWVudClcbiAgICA6IG51bGw7XG4gICgwLCBfamVzdFV0aWwoKS5zZXRHbG9iYWwpKGVudmlyb25tZW50Lmdsb2JhbCwgJ2NvbnNvbGUnLCB0ZXN0Q29uc29sZSk7XG4gIGNvbnN0IHJ1bnRpbWUgPSBuZXcgUnVudGltZShcbiAgICBjb25maWcsXG4gICAgZW52aXJvbm1lbnQsXG4gICAgcmVzb2x2ZXIsXG4gICAgdHJhbnNmb3JtZXIsXG4gICAgY2FjaGVGUyxcbiAgICB7XG4gICAgICBjaGFuZ2VkRmlsZXM6XG4gICAgICAgIGNvbnRleHQgPT09IG51bGwgfHwgY29udGV4dCA9PT0gdm9pZCAwID8gdm9pZCAwIDogY29udGV4dC5jaGFuZ2VkRmlsZXMsXG4gICAgICBjb2xsZWN0Q292ZXJhZ2U6IGdsb2JhbENvbmZpZy5jb2xsZWN0Q292ZXJhZ2UsXG4gICAgICBjb2xsZWN0Q292ZXJhZ2VGcm9tOiBnbG9iYWxDb25maWcuY29sbGVjdENvdmVyYWdlRnJvbSxcbiAgICAgIGNvbGxlY3RDb3ZlcmFnZU9ubHlGcm9tOiBnbG9iYWxDb25maWcuY29sbGVjdENvdmVyYWdlT25seUZyb20sXG4gICAgICBjb3ZlcmFnZVByb3ZpZGVyOiBnbG9iYWxDb25maWcuY292ZXJhZ2VQcm92aWRlcixcbiAgICAgIHNvdXJjZXNSZWxhdGVkVG9UZXN0c0luQ2hhbmdlZEZpbGVzOlxuICAgICAgICBjb250ZXh0ID09PSBudWxsIHx8IGNvbnRleHQgPT09IHZvaWQgMFxuICAgICAgICAgID8gdm9pZCAwXG4gICAgICAgICAgOiBjb250ZXh0LnNvdXJjZXNSZWxhdGVkVG9UZXN0c0luQ2hhbmdlZEZpbGVzXG4gICAgfSxcbiAgICBwYXRoXG4gICk7XG4gIGNvbnN0IHN0YXJ0ID0gRGF0ZS5ub3coKTtcblxuICBmb3IgKGNvbnN0IHBhdGggb2YgY29uZmlnLnNldHVwRmlsZXMpIHtcbiAgICBjb25zdCBlc20gPSBydW50aW1lLnVuc3RhYmxlX3Nob3VsZExvYWRBc0VzbShwYXRoKTtcblxuICAgIGlmIChlc20pIHtcbiAgICAgIGF3YWl0IHJ1bnRpbWUudW5zdGFibGVfaW1wb3J0TW9kdWxlKHBhdGgpO1xuICAgIH0gZWxzZSB7XG4gICAgICBydW50aW1lLnJlcXVpcmVNb2R1bGUocGF0aCk7XG4gICAgfVxuICB9XG5cbiAgY29uc3Qgc291cmNlbWFwT3B0aW9ucyA9IHtcbiAgICBlbnZpcm9ubWVudDogJ25vZGUnLFxuICAgIGhhbmRsZVVuY2F1Z2h0RXhjZXB0aW9uczogZmFsc2UsXG4gICAgcmV0cmlldmVTb3VyY2VNYXA6IHNvdXJjZSA9PiB7XG4gICAgICB2YXIgX3J1bnRpbWUkZ2V0U291cmNlTWFwO1xuXG4gICAgICBjb25zdCBzb3VyY2VNYXBTb3VyY2UgPVxuICAgICAgICAoX3J1bnRpbWUkZ2V0U291cmNlTWFwID0gcnVudGltZS5nZXRTb3VyY2VNYXBzKCkpID09PSBudWxsIHx8XG4gICAgICAgIF9ydW50aW1lJGdldFNvdXJjZU1hcCA9PT0gdm9pZCAwXG4gICAgICAgICAgPyB2b2lkIDBcbiAgICAgICAgICA6IF9ydW50aW1lJGdldFNvdXJjZU1hcC5nZXQoc291cmNlKTtcblxuICAgICAgaWYgKHNvdXJjZU1hcFNvdXJjZSkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBtYXA6IEpTT04ucGFyc2UoZnMoKS5yZWFkRmlsZVN5bmMoc291cmNlTWFwU291cmNlLCAndXRmOCcpKSxcbiAgICAgICAgICAgIHVybDogc291cmNlXG4gICAgICAgICAgfTtcbiAgICAgICAgfSBjYXRjaCB7fVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH07IC8vIEZvciB0ZXN0c1xuXG4gIHJ1bnRpbWVcbiAgICAucmVxdWlyZUludGVybmFsTW9kdWxlKFxuICAgICAgcmVxdWlyZS5yZXNvbHZlKCdzb3VyY2UtbWFwLXN1cHBvcnQnKSxcbiAgICAgICdzb3VyY2UtbWFwLXN1cHBvcnQnXG4gICAgKVxuICAgIC5pbnN0YWxsKHNvdXJjZW1hcE9wdGlvbnMpOyAvLyBGb3IgcnVudGltZSBlcnJvcnNcblxuICBfc291cmNlTWFwU3VwcG9ydCgpLmRlZmF1bHQuaW5zdGFsbChzb3VyY2VtYXBPcHRpb25zKTtcblxuICBpZiAoXG4gICAgZW52aXJvbm1lbnQuZ2xvYmFsICYmXG4gICAgZW52aXJvbm1lbnQuZ2xvYmFsLnByb2Nlc3MgJiZcbiAgICBlbnZpcm9ubWVudC5nbG9iYWwucHJvY2Vzcy5leGl0XG4gICkge1xuICAgIGNvbnN0IHJlYWxFeGl0ID0gZW52aXJvbm1lbnQuZ2xvYmFsLnByb2Nlc3MuZXhpdDtcblxuICAgIGVudmlyb25tZW50Lmdsb2JhbC5wcm9jZXNzLmV4aXQgPSBmdW5jdGlvbiBleGl0KC4uLmFyZ3MpIHtcbiAgICAgIGNvbnN0IGVycm9yID0gbmV3IChfamVzdFV0aWwoKS5FcnJvcldpdGhTdGFjaykoXG4gICAgICAgIGBwcm9jZXNzLmV4aXQgY2FsbGVkIHdpdGggXCIke2FyZ3Muam9pbignLCAnKX1cImAsXG4gICAgICAgIGV4aXRcbiAgICAgICk7XG4gICAgICBjb25zdCBmb3JtYXR0ZWRFcnJvciA9ICgwLCBfamVzdE1lc3NhZ2VVdGlsKCkuZm9ybWF0RXhlY0Vycm9yKShcbiAgICAgICAgZXJyb3IsXG4gICAgICAgIGNvbmZpZyxcbiAgICAgICAge1xuICAgICAgICAgIG5vU3RhY2tUcmFjZTogZmFsc2VcbiAgICAgICAgfSxcbiAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICB0cnVlXG4gICAgICApO1xuICAgICAgcHJvY2Vzcy5zdGRlcnIud3JpdGUoZm9ybWF0dGVkRXJyb3IpO1xuICAgICAgcmV0dXJuIHJlYWxFeGl0KC4uLmFyZ3MpO1xuICAgIH07XG4gIH0gLy8gaWYgd2UgZG9uJ3QgaGF2ZSBgZ2V0Vm1Db250ZXh0YCBvbiB0aGUgZW52IHNraXAgY292ZXJhZ2VcblxuICBjb25zdCBjb2xsZWN0VjhDb3ZlcmFnZSA9XG4gICAgZ2xvYmFsQ29uZmlnLmNvdmVyYWdlUHJvdmlkZXIgPT09ICd2OCcgJiZcbiAgICB0eXBlb2YgZW52aXJvbm1lbnQuZ2V0Vm1Db250ZXh0ID09PSAnZnVuY3Rpb24nO1xuXG4gIHRyeSB7XG4gICAgYXdhaXQgZW52aXJvbm1lbnQuc2V0dXAoKTtcbiAgICBsZXQgcmVzdWx0O1xuXG4gICAgdHJ5IHtcbiAgICAgIGlmIChjb2xsZWN0VjhDb3ZlcmFnZSkge1xuICAgICAgICBhd2FpdCBydW50aW1lLmNvbGxlY3RWOENvdmVyYWdlKCk7XG4gICAgICB9XG5cbiAgICAgIHJlc3VsdCA9IGF3YWl0IHRlc3RGcmFtZXdvcmsoXG4gICAgICAgIGdsb2JhbENvbmZpZyxcbiAgICAgICAgY29uZmlnLFxuICAgICAgICBlbnZpcm9ubWVudCxcbiAgICAgICAgcnVudGltZSxcbiAgICAgICAgcGF0aCxcbiAgICAgICAgc2VuZE1lc3NhZ2VUb0plc3RcbiAgICAgICk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAvLyBBY2Nlc3Mgc3RhY2sgYmVmb3JlIHVuaW5zdGFsbGluZyBzb3VyY2VtYXBzXG4gICAgICBlcnIuc3RhY2s7XG4gICAgICB0aHJvdyBlcnI7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIGlmIChjb2xsZWN0VjhDb3ZlcmFnZSkge1xuICAgICAgICBhd2FpdCBydW50aW1lLnN0b3BDb2xsZWN0aW5nVjhDb3ZlcmFnZSgpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGZyZWV6ZUNvbnNvbGUodGVzdENvbnNvbGUsIGNvbmZpZyk7XG4gICAgY29uc3QgdGVzdENvdW50ID1cbiAgICAgIHJlc3VsdC5udW1QYXNzaW5nVGVzdHMgK1xuICAgICAgcmVzdWx0Lm51bUZhaWxpbmdUZXN0cyArXG4gICAgICByZXN1bHQubnVtUGVuZGluZ1Rlc3RzICtcbiAgICAgIHJlc3VsdC5udW1Ub2RvVGVzdHM7XG4gICAgY29uc3QgZW5kID0gRGF0ZS5ub3coKTtcbiAgICBjb25zdCB0ZXN0UnVudGltZSA9IGVuZCAtIHN0YXJ0O1xuICAgIHJlc3VsdC5wZXJmU3RhdHMgPSB7XG4gICAgICBlbmQsXG4gICAgICBydW50aW1lOiB0ZXN0UnVudGltZSxcbiAgICAgIHNsb3c6IHRlc3RSdW50aW1lIC8gMTAwMCA+IGNvbmZpZy5zbG93VGVzdFRocmVzaG9sZCxcbiAgICAgIHN0YXJ0XG4gICAgfTtcbiAgICByZXN1bHQudGVzdEZpbGVQYXRoID0gcGF0aDtcbiAgICByZXN1bHQuY29uc29sZSA9IHRlc3RDb25zb2xlLmdldEJ1ZmZlcigpO1xuICAgIHJlc3VsdC5za2lwcGVkID0gdGVzdENvdW50ID09PSByZXN1bHQubnVtUGVuZGluZ1Rlc3RzO1xuICAgIHJlc3VsdC5kaXNwbGF5TmFtZSA9IGNvbmZpZy5kaXNwbGF5TmFtZTtcbiAgICBjb25zdCBjb3ZlcmFnZSA9IHJ1bnRpbWUuZ2V0QWxsQ292ZXJhZ2VJbmZvQ29weSgpO1xuXG4gICAgaWYgKGNvdmVyYWdlKSB7XG4gICAgICBjb25zdCBjb3ZlcmFnZUtleXMgPSBPYmplY3Qua2V5cyhjb3ZlcmFnZSk7XG5cbiAgICAgIGlmIChjb3ZlcmFnZUtleXMubGVuZ3RoKSB7XG4gICAgICAgIHJlc3VsdC5jb3ZlcmFnZSA9IGNvdmVyYWdlO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChjb2xsZWN0VjhDb3ZlcmFnZSkge1xuICAgICAgY29uc3QgdjhDb3ZlcmFnZSA9IHJ1bnRpbWUuZ2V0QWxsVjhDb3ZlcmFnZUluZm9Db3B5KCk7XG5cbiAgICAgIGlmICh2OENvdmVyYWdlICYmIHY4Q292ZXJhZ2UubGVuZ3RoID4gMCkge1xuICAgICAgICByZXN1bHQudjhDb3ZlcmFnZSA9IHY4Q292ZXJhZ2U7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKGdsb2JhbENvbmZpZy5sb2dIZWFwVXNhZ2UpIHtcbiAgICAgIGlmIChnbG9iYWwuZ2MpIHtcbiAgICAgICAgZ2xvYmFsLmdjKCk7XG4gICAgICB9XG5cbiAgICAgIHJlc3VsdC5tZW1vcnlVc2FnZSA9IHByb2Nlc3MubWVtb3J5VXNhZ2UoKS5oZWFwVXNlZDtcbiAgICB9IC8vIERlbGF5IHRoZSByZXNvbHV0aW9uIHRvIGFsbG93IGxvZyBtZXNzYWdlcyB0byBiZSBvdXRwdXQuXG5cbiAgICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XG4gICAgICBzZXRJbW1lZGlhdGUoKCkgPT5cbiAgICAgICAgcmVzb2x2ZSh7XG4gICAgICAgICAgbGVha0RldGVjdG9yLFxuICAgICAgICAgIHJlc3VsdFxuICAgICAgICB9KVxuICAgICAgKTtcbiAgICB9KTtcbiAgfSBmaW5hbGx5IHtcbiAgICBydW50aW1lLnRlYXJkb3duKCk7XG4gICAgYXdhaXQgZW52aXJvbm1lbnQudGVhcmRvd24oKTtcblxuICAgIF9zb3VyY2VNYXBTdXBwb3J0KCkuZGVmYXVsdC5yZXNldFJldHJpZXZlSGFuZGxlcnMoKTtcbiAgfVxufVxuXG5hc3luYyBmdW5jdGlvbiBydW5UZXN0KFxuICBwYXRoLFxuICBnbG9iYWxDb25maWcsXG4gIGNvbmZpZyxcbiAgcmVzb2x2ZXIsXG4gIGNvbnRleHQsXG4gIHNlbmRNZXNzYWdlVG9KZXN0XG4pIHtcbiAgY29uc3Qge2xlYWtEZXRlY3RvciwgcmVzdWx0fSA9IGF3YWl0IHJ1blRlc3RJbnRlcm5hbChcbiAgICBwYXRoLFxuICAgIGdsb2JhbENvbmZpZyxcbiAgICBjb25maWcsXG4gICAgcmVzb2x2ZXIsXG4gICAgY29udGV4dCxcbiAgICBzZW5kTWVzc2FnZVRvSmVzdFxuICApO1xuXG4gIGlmIChsZWFrRGV0ZWN0b3IpIHtcbiAgICAvLyBXZSB3YW5uYSBhbGxvdyBhIHRpbnkgYnV0IHRpbWUgdG8gcGFzcyB0byBhbGxvdyBsYXN0LW1pbnV0ZSBjbGVhbnVwXG4gICAgYXdhaXQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIDEwMCkpOyAvLyBSZXNvbHZlIGxlYWsgZGV0ZWN0b3IsIG91dHNpZGUgdGhlIFwicnVuVGVzdEludGVybmFsXCIgY2xvc3VyZS5cblxuICAgIHJlc3VsdC5sZWFrcyA9IGF3YWl0IGxlYWtEZXRlY3Rvci5pc0xlYWtpbmcoKTtcbiAgfSBlbHNlIHtcbiAgICByZXN1bHQubGVha3MgPSBmYWxzZTtcbiAg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