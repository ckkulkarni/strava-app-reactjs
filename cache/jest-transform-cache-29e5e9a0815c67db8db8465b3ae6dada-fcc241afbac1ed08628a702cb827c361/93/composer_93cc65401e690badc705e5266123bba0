1689c6e70073b5dd2a902c3c14aa1a21
'use strict';

var directives = require('../doc/directives.js');
var Document = require('../doc/Document.js');
var errors = require('../errors.js');
var Node = require('../nodes/Node.js');
var composeDoc = require('./compose-doc.js');
var resolveEnd = require('./resolve-end.js');
function getErrorPos(src) {
  if (typeof src === 'number') return [src, src + 1];
  if (Array.isArray(src)) return src.length === 2 ? src : [src[0], src[1]];
  const {
    offset,
    source
  } = src;
  return [offset, offset + (typeof source === 'string' ? source.length : 1)];
}
function parsePrelude(prelude) {
  let comment = '';
  let atComment = false;
  let afterEmptyLine = false;
  for (let i = 0; i < prelude.length; ++i) {
    const source = prelude[i];
    switch (source[0]) {
      case '#':
        comment += (comment === '' ? '' : afterEmptyLine ? '\n\n' : '\n') + (source.substring(1) || ' ');
        atComment = true;
        afterEmptyLine = false;
        break;
      case '%':
        if (prelude[i + 1]?.[0] !== '#') i += 1;
        atComment = false;
        break;
      default:
        // This may be wrong after doc-end, but in that case it doesn't matter
        if (!atComment) afterEmptyLine = true;
        atComment = false;
    }
  }
  return {
    comment,
    afterEmptyLine
  };
}
/**
 * Compose a stream of CST nodes into a stream of YAML Documents.
 *
 * ```ts
 * import { Composer, Parser } from 'yaml'
 *
 * const src: string = ...
 * const tokens = new Parser().parse(src)
 * const docs = new Composer().compose(tokens)
 * ```
 */
class Composer {
  constructor(options = {}) {
    this.doc = null;
    this.atDirectives = false;
    this.prelude = [];
    this.errors = [];
    this.warnings = [];
    this.onError = (source, code, message, warning) => {
      const pos = getErrorPos(source);
      if (warning) this.warnings.push(new errors.YAMLWarning(pos, code, message));else this.errors.push(new errors.YAMLParseError(pos, code, message));
    };
    // eslint-disable-next-line @typescript-eslint/prefer-nullish-coalescing
    this.directives = new directives.Directives({
      version: options.version || '1.2'
    });
    this.options = options;
  }
  decorate(doc, afterDoc) {
    const {
      comment,
      afterEmptyLine
    } = parsePrelude(this.prelude);
    //console.log({ dc: doc.comment, prelude, comment })
    if (comment) {
      const dc = doc.contents;
      if (afterDoc) {
        doc.comment = doc.comment ? `${doc.comment}\n${comment}` : comment;
      } else if (afterEmptyLine || doc.directives.docStart || !dc) {
        doc.commentBefore = comment;
      } else if (Node.isCollection(dc) && !dc.flow && dc.items.length > 0) {
        let it = dc.items[0];
        if (Node.isPair(it)) it = it.key;
        const cb = it.commentBefore;
        it.commentBefore = cb ? `${comment}\n${cb}` : comment;
      } else {
        const cb = dc.commentBefore;
        dc.commentBefore = cb ? `${comment}\n${cb}` : comment;
      }
    }
    if (afterDoc) {
      Array.prototype.push.apply(doc.errors, this.errors);
      Array.prototype.push.apply(doc.warnings, this.warnings);
    } else {
      doc.errors = this.errors;
      doc.warnings = this.warnings;
    }
    this.prelude = [];
    this.errors = [];
    this.warnings = [];
  }
  /**
   * Current stream status information.
   *
   * Mostly useful at the end of input for an empty stream.
   */
  streamInfo() {
    return {
      comment: parsePrelude(this.prelude).comment,
      directives: this.directives,
      errors: this.errors,
      warnings: this.warnings
    };
  }
  /**
   * Compose tokens into documents.
   *
   * @param forceDoc - If the stream contains no document, still emit a final document including any comments and directives that would be applied to a subsequent document.
   * @param endOffset - Should be set if `forceDoc` is also set, to set the document range end and to indicate errors correctly.
   */
  *compose(tokens, forceDoc = false, endOffset = -1) {
    for (const token of tokens) yield* this.next(token);
    yield* this.end(forceDoc, endOffset);
  }
  /** Advance the composer by one CST token. */
  *next(token) {
    if (process.env.LOG_STREAM) console.dir(token, {
      depth: null
    });
    switch (token.type) {
      case 'directive':
        this.directives.add(token.source, (offset, message, warning) => {
          const pos = getErrorPos(token);
          pos[0] += offset;
          this.onError(pos, 'BAD_DIRECTIVE', message, warning);
        });
        this.prelude.push(token.source);
        this.atDirectives = true;
        break;
      case 'document':
        {
          const doc = composeDoc.composeDoc(this.options, this.directives, token, this.onError);
          if (this.atDirectives && !doc.directives.docStart) this.onError(token, 'MISSING_CHAR', 'Missing directives-end/doc-start indicator line');
          this.decorate(doc, false);
          if (this.doc) yield this.doc;
          this.doc = doc;
          this.atDirectives = false;
          break;
        }
      case 'byte-order-mark':
      case 'space':
        break;
      case 'comment':
      case 'newline':
        this.prelude.push(token.source);
        break;
      case 'error':
        {
          const msg = token.source ? `${token.message}: ${JSON.stringify(token.source)}` : token.message;
          const error = new errors.YAMLParseError(getErrorPos(token), 'UNEXPECTED_TOKEN', msg);
          if (this.atDirectives || !this.doc) this.errors.push(error);else this.doc.errors.push(error);
          break;
        }
      case 'doc-end':
        {
          if (!this.doc) {
            const msg = 'Unexpected doc-end without preceding document';
            this.errors.push(new errors.YAMLParseError(getErrorPos(token), 'UNEXPECTED_TOKEN', msg));
            break;
          }
          this.doc.directives.docEnd = true;
          const end = resolveEnd.resolveEnd(token.end, token.offset + token.source.length, this.doc.options.strict, this.onError);
          this.decorate(this.doc, true);
          if (end.comment) {
            const dc = this.doc.comment;
            this.doc.comment = dc ? `${dc}\n${end.comment}` : end.comment;
          }
          this.doc.range[2] = end.offset;
          break;
        }
      default:
        this.errors.push(new errors.YAMLParseError(getErrorPos(token), 'UNEXPECTED_TOKEN', `Unsupported token ${token.type}`));
    }
  }
  /**
   * Call at end of input to yield any remaining document.
   *
   * @param forceDoc - If the stream contains no document, still emit a final document including any comments and directives that would be applied to a subsequent document.
   * @param endOffset - Should be set if `forceDoc` is also set, to set the document range end and to indicate errors correctly.
   */
  *end(forceDoc = false, endOffset = -1) {
    if (this.doc) {
      this.decorate(this.doc, true);
      yield this.doc;
      this.doc = null;
    } else if (forceDoc) {
      const opts = Object.assign({
        _directives: this.directives
      }, this.options);
      const doc = new Document.Document(undefined, opts);
      if (this.atDirectives) this.onError(endOffset, 'MISSING_CHAR', 'Missing directives-end indicator line');
      doc.range = [0, endOffset, endOffset];
      this.decorate(doc, false);
      yield doc;
    }
  }
}
exports.Composer = Composer;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJkaXJlY3RpdmVzIiwicmVxdWlyZSIsIkRvY3VtZW50IiwiZXJyb3JzIiwiTm9kZSIsImNvbXBvc2VEb2MiLCJyZXNvbHZlRW5kIiwiZ2V0RXJyb3JQb3MiLCJzcmMiLCJBcnJheSIsImlzQXJyYXkiLCJsZW5ndGgiLCJvZmZzZXQiLCJzb3VyY2UiLCJwYXJzZVByZWx1ZGUiLCJwcmVsdWRlIiwiY29tbWVudCIsImF0Q29tbWVudCIsImFmdGVyRW1wdHlMaW5lIiwiaSIsInN1YnN0cmluZyIsIkNvbXBvc2VyIiwiY29uc3RydWN0b3IiLCJvcHRpb25zIiwiZG9jIiwiYXREaXJlY3RpdmVzIiwid2FybmluZ3MiLCJvbkVycm9yIiwiY29kZSIsIm1lc3NhZ2UiLCJ3YXJuaW5nIiwicG9zIiwicHVzaCIsIllBTUxXYXJuaW5nIiwiWUFNTFBhcnNlRXJyb3IiLCJEaXJlY3RpdmVzIiwidmVyc2lvbiIsImRlY29yYXRlIiwiYWZ0ZXJEb2MiLCJkYyIsImNvbnRlbnRzIiwiZG9jU3RhcnQiLCJjb21tZW50QmVmb3JlIiwiaXNDb2xsZWN0aW9uIiwiZmxvdyIsIml0ZW1zIiwiaXQiLCJpc1BhaXIiLCJrZXkiLCJjYiIsInByb3RvdHlwZSIsImFwcGx5Iiwic3RyZWFtSW5mbyIsImNvbXBvc2UiLCJ0b2tlbnMiLCJmb3JjZURvYyIsImVuZE9mZnNldCIsInRva2VuIiwibmV4dCIsImVuZCIsInByb2Nlc3MiLCJlbnYiLCJMT0dfU1RSRUFNIiwiY29uc29sZSIsImRpciIsImRlcHRoIiwidHlwZSIsImFkZCIsIm1zZyIsIkpTT04iLCJzdHJpbmdpZnkiLCJlcnJvciIsImRvY0VuZCIsInN0cmljdCIsInJhbmdlIiwib3B0cyIsIk9iamVjdCIsImFzc2lnbiIsIl9kaXJlY3RpdmVzIiwidW5kZWZpbmVkIiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbImNvbXBvc2VyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxudmFyIGRpcmVjdGl2ZXMgPSByZXF1aXJlKCcuLi9kb2MvZGlyZWN0aXZlcy5qcycpO1xudmFyIERvY3VtZW50ID0gcmVxdWlyZSgnLi4vZG9jL0RvY3VtZW50LmpzJyk7XG52YXIgZXJyb3JzID0gcmVxdWlyZSgnLi4vZXJyb3JzLmpzJyk7XG52YXIgTm9kZSA9IHJlcXVpcmUoJy4uL25vZGVzL05vZGUuanMnKTtcbnZhciBjb21wb3NlRG9jID0gcmVxdWlyZSgnLi9jb21wb3NlLWRvYy5qcycpO1xudmFyIHJlc29sdmVFbmQgPSByZXF1aXJlKCcuL3Jlc29sdmUtZW5kLmpzJyk7XG5cbmZ1bmN0aW9uIGdldEVycm9yUG9zKHNyYykge1xuICAgIGlmICh0eXBlb2Ygc3JjID09PSAnbnVtYmVyJylcbiAgICAgICAgcmV0dXJuIFtzcmMsIHNyYyArIDFdO1xuICAgIGlmIChBcnJheS5pc0FycmF5KHNyYykpXG4gICAgICAgIHJldHVybiBzcmMubGVuZ3RoID09PSAyID8gc3JjIDogW3NyY1swXSwgc3JjWzFdXTtcbiAgICBjb25zdCB7IG9mZnNldCwgc291cmNlIH0gPSBzcmM7XG4gICAgcmV0dXJuIFtvZmZzZXQsIG9mZnNldCArICh0eXBlb2Ygc291cmNlID09PSAnc3RyaW5nJyA/IHNvdXJjZS5sZW5ndGggOiAxKV07XG59XG5mdW5jdGlvbiBwYXJzZVByZWx1ZGUocHJlbHVkZSkge1xuICAgIGxldCBjb21tZW50ID0gJyc7XG4gICAgbGV0IGF0Q29tbWVudCA9IGZhbHNlO1xuICAgIGxldCBhZnRlckVtcHR5TGluZSA9IGZhbHNlO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcHJlbHVkZS5sZW5ndGg7ICsraSkge1xuICAgICAgICBjb25zdCBzb3VyY2UgPSBwcmVsdWRlW2ldO1xuICAgICAgICBzd2l0Y2ggKHNvdXJjZVswXSkge1xuICAgICAgICAgICAgY2FzZSAnIyc6XG4gICAgICAgICAgICAgICAgY29tbWVudCArPVxuICAgICAgICAgICAgICAgICAgICAoY29tbWVudCA9PT0gJycgPyAnJyA6IGFmdGVyRW1wdHlMaW5lID8gJ1xcblxcbicgOiAnXFxuJykgK1xuICAgICAgICAgICAgICAgICAgICAgICAgKHNvdXJjZS5zdWJzdHJpbmcoMSkgfHwgJyAnKTtcbiAgICAgICAgICAgICAgICBhdENvbW1lbnQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGFmdGVyRW1wdHlMaW5lID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICclJzpcbiAgICAgICAgICAgICAgICBpZiAocHJlbHVkZVtpICsgMV0/LlswXSAhPT0gJyMnKVxuICAgICAgICAgICAgICAgICAgICBpICs9IDE7XG4gICAgICAgICAgICAgICAgYXRDb21tZW50ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIC8vIFRoaXMgbWF5IGJlIHdyb25nIGFmdGVyIGRvYy1lbmQsIGJ1dCBpbiB0aGF0IGNhc2UgaXQgZG9lc24ndCBtYXR0ZXJcbiAgICAgICAgICAgICAgICBpZiAoIWF0Q29tbWVudClcbiAgICAgICAgICAgICAgICAgICAgYWZ0ZXJFbXB0eUxpbmUgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGF0Q29tbWVudCA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiB7IGNvbW1lbnQsIGFmdGVyRW1wdHlMaW5lIH07XG59XG4vKipcbiAqIENvbXBvc2UgYSBzdHJlYW0gb2YgQ1NUIG5vZGVzIGludG8gYSBzdHJlYW0gb2YgWUFNTCBEb2N1bWVudHMuXG4gKlxuICogYGBgdHNcbiAqIGltcG9ydCB7IENvbXBvc2VyLCBQYXJzZXIgfSBmcm9tICd5YW1sJ1xuICpcbiAqIGNvbnN0IHNyYzogc3RyaW5nID0gLi4uXG4gKiBjb25zdCB0b2tlbnMgPSBuZXcgUGFyc2VyKCkucGFyc2Uoc3JjKVxuICogY29uc3QgZG9jcyA9IG5ldyBDb21wb3NlcigpLmNvbXBvc2UodG9rZW5zKVxuICogYGBgXG4gKi9cbmNsYXNzIENvbXBvc2VyIHtcbiAgICBjb25zdHJ1Y3RvcihvcHRpb25zID0ge30pIHtcbiAgICAgICAgdGhpcy5kb2MgPSBudWxsO1xuICAgICAgICB0aGlzLmF0RGlyZWN0aXZlcyA9IGZhbHNlO1xuICAgICAgICB0aGlzLnByZWx1ZGUgPSBbXTtcbiAgICAgICAgdGhpcy5lcnJvcnMgPSBbXTtcbiAgICAgICAgdGhpcy53YXJuaW5ncyA9IFtdO1xuICAgICAgICB0aGlzLm9uRXJyb3IgPSAoc291cmNlLCBjb2RlLCBtZXNzYWdlLCB3YXJuaW5nKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBwb3MgPSBnZXRFcnJvclBvcyhzb3VyY2UpO1xuICAgICAgICAgICAgaWYgKHdhcm5pbmcpXG4gICAgICAgICAgICAgICAgdGhpcy53YXJuaW5ncy5wdXNoKG5ldyBlcnJvcnMuWUFNTFdhcm5pbmcocG9zLCBjb2RlLCBtZXNzYWdlKSk7XG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgdGhpcy5lcnJvcnMucHVzaChuZXcgZXJyb3JzLllBTUxQYXJzZUVycm9yKHBvcywgY29kZSwgbWVzc2FnZSkpO1xuICAgICAgICB9O1xuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L3ByZWZlci1udWxsaXNoLWNvYWxlc2NpbmdcbiAgICAgICAgdGhpcy5kaXJlY3RpdmVzID0gbmV3IGRpcmVjdGl2ZXMuRGlyZWN0aXZlcyh7IHZlcnNpb246IG9wdGlvbnMudmVyc2lvbiB8fCAnMS4yJyB9KTtcbiAgICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucztcbiAgICB9XG4gICAgZGVjb3JhdGUoZG9jLCBhZnRlckRvYykge1xuICAgICAgICBjb25zdCB7IGNvbW1lbnQsIGFmdGVyRW1wdHlMaW5lIH0gPSBwYXJzZVByZWx1ZGUodGhpcy5wcmVsdWRlKTtcbiAgICAgICAgLy9jb25zb2xlLmxvZyh7IGRjOiBkb2MuY29tbWVudCwgcHJlbHVkZSwgY29tbWVudCB9KVxuICAgICAgICBpZiAoY29tbWVudCkge1xuICAgICAgICAgICAgY29uc3QgZGMgPSBkb2MuY29udGVudHM7XG4gICAgICAgICAgICBpZiAoYWZ0ZXJEb2MpIHtcbiAgICAgICAgICAgICAgICBkb2MuY29tbWVudCA9IGRvYy5jb21tZW50ID8gYCR7ZG9jLmNvbW1lbnR9XFxuJHtjb21tZW50fWAgOiBjb21tZW50O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoYWZ0ZXJFbXB0eUxpbmUgfHwgZG9jLmRpcmVjdGl2ZXMuZG9jU3RhcnQgfHwgIWRjKSB7XG4gICAgICAgICAgICAgICAgZG9jLmNvbW1lbnRCZWZvcmUgPSBjb21tZW50O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoTm9kZS5pc0NvbGxlY3Rpb24oZGMpICYmICFkYy5mbG93ICYmIGRjLml0ZW1zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICBsZXQgaXQgPSBkYy5pdGVtc1swXTtcbiAgICAgICAgICAgICAgICBpZiAoTm9kZS5pc1BhaXIoaXQpKVxuICAgICAgICAgICAgICAgICAgICBpdCA9IGl0LmtleTtcbiAgICAgICAgICAgICAgICBjb25zdCBjYiA9IGl0LmNvbW1lbnRCZWZvcmU7XG4gICAgICAgICAgICAgICAgaXQuY29tbWVudEJlZm9yZSA9IGNiID8gYCR7Y29tbWVudH1cXG4ke2NifWAgOiBjb21tZW50O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc3QgY2IgPSBkYy5jb21tZW50QmVmb3JlO1xuICAgICAgICAgICAgICAgIGRjLmNvbW1lbnRCZWZvcmUgPSBjYiA/IGAke2NvbW1lbnR9XFxuJHtjYn1gIDogY29tbWVudDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoYWZ0ZXJEb2MpIHtcbiAgICAgICAgICAgIEFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KGRvYy5lcnJvcnMsIHRoaXMuZXJyb3JzKTtcbiAgICAgICAgICAgIEFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KGRvYy53YXJuaW5ncywgdGhpcy53YXJuaW5ncyk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBkb2MuZXJyb3JzID0gdGhpcy5lcnJvcnM7XG4gICAgICAgICAgICBkb2Mud2FybmluZ3MgPSB0aGlzLndhcm5pbmdzO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMucHJlbHVkZSA9IFtdO1xuICAgICAgICB0aGlzLmVycm9ycyA9IFtdO1xuICAgICAgICB0aGlzLndhcm5pbmdzID0gW107XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEN1cnJlbnQgc3RyZWFtIHN0YXR1cyBpbmZvcm1hdGlvbi5cbiAgICAgKlxuICAgICAqIE1vc3RseSB1c2VmdWwgYXQgdGhlIGVuZCBvZiBpbnB1dCBmb3IgYW4gZW1wdHkgc3RyZWFtLlxuICAgICAqL1xuICAgIHN0cmVhbUluZm8oKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBjb21tZW50OiBwYXJzZVByZWx1ZGUodGhpcy5wcmVsdWRlKS5jb21tZW50LFxuICAgICAgICAgICAgZGlyZWN0aXZlczogdGhpcy5kaXJlY3RpdmVzLFxuICAgICAgICAgICAgZXJyb3JzOiB0aGlzLmVycm9ycyxcbiAgICAgICAgICAgIHdhcm5pbmdzOiB0aGlzLndhcm5pbmdzXG4gICAgICAgIH07XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENvbXBvc2UgdG9rZW5zIGludG8gZG9jdW1lbnRzLlxuICAgICAqXG4gICAgICogQHBhcmFtIGZvcmNlRG9jIC0gSWYgdGhlIHN0cmVhbSBjb250YWlucyBubyBkb2N1bWVudCwgc3RpbGwgZW1pdCBhIGZpbmFsIGRvY3VtZW50IGluY2x1ZGluZyBhbnkgY29tbWVudHMgYW5kIGRpcmVjdGl2ZXMgdGhhdCB3b3VsZCBiZSBhcHBsaWVkIHRvIGEgc3Vic2VxdWVudCBkb2N1bWVudC5cbiAgICAgKiBAcGFyYW0gZW5kT2Zmc2V0IC0gU2hvdWxkIGJlIHNldCBpZiBgZm9yY2VEb2NgIGlzIGFsc28gc2V0LCB0byBzZXQgdGhlIGRvY3VtZW50IHJhbmdlIGVuZCBhbmQgdG8gaW5kaWNhdGUgZXJyb3JzIGNvcnJlY3RseS5cbiAgICAgKi9cbiAgICAqY29tcG9zZSh0b2tlbnMsIGZvcmNlRG9jID0gZmFsc2UsIGVuZE9mZnNldCA9IC0xKSB7XG4gICAgICAgIGZvciAoY29uc3QgdG9rZW4gb2YgdG9rZW5zKVxuICAgICAgICAgICAgeWllbGQqIHRoaXMubmV4dCh0b2tlbik7XG4gICAgICAgIHlpZWxkKiB0aGlzLmVuZChmb3JjZURvYywgZW5kT2Zmc2V0KTtcbiAgICB9XG4gICAgLyoqIEFkdmFuY2UgdGhlIGNvbXBvc2VyIGJ5IG9uZSBDU1QgdG9rZW4uICovXG4gICAgKm5leHQodG9rZW4pIHtcbiAgICAgICAgaWYgKHByb2Nlc3MuZW52LkxPR19TVFJFQU0pXG4gICAgICAgICAgICBjb25zb2xlLmRpcih0b2tlbiwgeyBkZXB0aDogbnVsbCB9KTtcbiAgICAgICAgc3dpdGNoICh0b2tlbi50eXBlKSB7XG4gICAgICAgICAgICBjYXNlICdkaXJlY3RpdmUnOlxuICAgICAgICAgICAgICAgIHRoaXMuZGlyZWN0aXZlcy5hZGQodG9rZW4uc291cmNlLCAob2Zmc2V0LCBtZXNzYWdlLCB3YXJuaW5nKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHBvcyA9IGdldEVycm9yUG9zKHRva2VuKTtcbiAgICAgICAgICAgICAgICAgICAgcG9zWzBdICs9IG9mZnNldDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vbkVycm9yKHBvcywgJ0JBRF9ESVJFQ1RJVkUnLCBtZXNzYWdlLCB3YXJuaW5nKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB0aGlzLnByZWx1ZGUucHVzaCh0b2tlbi5zb3VyY2UpO1xuICAgICAgICAgICAgICAgIHRoaXMuYXREaXJlY3RpdmVzID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ2RvY3VtZW50Jzoge1xuICAgICAgICAgICAgICAgIGNvbnN0IGRvYyA9IGNvbXBvc2VEb2MuY29tcG9zZURvYyh0aGlzLm9wdGlvbnMsIHRoaXMuZGlyZWN0aXZlcywgdG9rZW4sIHRoaXMub25FcnJvcik7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuYXREaXJlY3RpdmVzICYmICFkb2MuZGlyZWN0aXZlcy5kb2NTdGFydClcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vbkVycm9yKHRva2VuLCAnTUlTU0lOR19DSEFSJywgJ01pc3NpbmcgZGlyZWN0aXZlcy1lbmQvZG9jLXN0YXJ0IGluZGljYXRvciBsaW5lJyk7XG4gICAgICAgICAgICAgICAgdGhpcy5kZWNvcmF0ZShkb2MsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5kb2MpXG4gICAgICAgICAgICAgICAgICAgIHlpZWxkIHRoaXMuZG9jO1xuICAgICAgICAgICAgICAgIHRoaXMuZG9jID0gZG9jO1xuICAgICAgICAgICAgICAgIHRoaXMuYXREaXJlY3RpdmVzID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXNlICdieXRlLW9yZGVyLW1hcmsnOlxuICAgICAgICAgICAgY2FzZSAnc3BhY2UnOlxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnY29tbWVudCc6XG4gICAgICAgICAgICBjYXNlICduZXdsaW5lJzpcbiAgICAgICAgICAgICAgICB0aGlzLnByZWx1ZGUucHVzaCh0b2tlbi5zb3VyY2UpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnZXJyb3InOiB7XG4gICAgICAgICAgICAgICAgY29uc3QgbXNnID0gdG9rZW4uc291cmNlXG4gICAgICAgICAgICAgICAgICAgID8gYCR7dG9rZW4ubWVzc2FnZX06ICR7SlNPTi5zdHJpbmdpZnkodG9rZW4uc291cmNlKX1gXG4gICAgICAgICAgICAgICAgICAgIDogdG9rZW4ubWVzc2FnZTtcbiAgICAgICAgICAgICAgICBjb25zdCBlcnJvciA9IG5ldyBlcnJvcnMuWUFNTFBhcnNlRXJyb3IoZ2V0RXJyb3JQb3ModG9rZW4pLCAnVU5FWFBFQ1RFRF9UT0tFTicsIG1zZyk7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuYXREaXJlY3RpdmVzIHx8ICF0aGlzLmRvYylcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lcnJvcnMucHVzaChlcnJvcik7XG4gICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICB0aGlzLmRvYy5lcnJvcnMucHVzaChlcnJvcik7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXNlICdkb2MtZW5kJzoge1xuICAgICAgICAgICAgICAgIGlmICghdGhpcy5kb2MpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbXNnID0gJ1VuZXhwZWN0ZWQgZG9jLWVuZCB3aXRob3V0IHByZWNlZGluZyBkb2N1bWVudCc7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZXJyb3JzLnB1c2gobmV3IGVycm9ycy5ZQU1MUGFyc2VFcnJvcihnZXRFcnJvclBvcyh0b2tlbiksICdVTkVYUEVDVEVEX1RPS0VOJywgbXNnKSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLmRvYy5kaXJlY3RpdmVzLmRvY0VuZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgY29uc3QgZW5kID0gcmVzb2x2ZUVuZC5yZXNvbHZlRW5kKHRva2VuLmVuZCwgdG9rZW4ub2Zmc2V0ICsgdG9rZW4uc291cmNlLmxlbmd0aCwgdGhpcy5kb2Mub3B0aW9ucy5zdHJpY3QsIHRoaXMub25FcnJvcik7XG4gICAgICAgICAgICAgICAgdGhpcy5kZWNvcmF0ZSh0aGlzLmRvYywgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgaWYgKGVuZC5jb21tZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGRjID0gdGhpcy5kb2MuY29tbWVudDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kb2MuY29tbWVudCA9IGRjID8gYCR7ZGN9XFxuJHtlbmQuY29tbWVudH1gIDogZW5kLmNvbW1lbnQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuZG9jLnJhbmdlWzJdID0gZW5kLm9mZnNldDtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgdGhpcy5lcnJvcnMucHVzaChuZXcgZXJyb3JzLllBTUxQYXJzZUVycm9yKGdldEVycm9yUG9zKHRva2VuKSwgJ1VORVhQRUNURURfVE9LRU4nLCBgVW5zdXBwb3J0ZWQgdG9rZW4gJHt0b2tlbi50eXBlfWApKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBDYWxsIGF0IGVuZCBvZiBpbnB1dCB0byB5aWVsZCBhbnkgcmVtYWluaW5nIGRvY3VtZW50LlxuICAgICAqXG4gICAgICogQHBhcmFtIGZvcmNlRG9jIC0gSWYgdGhlIHN0cmVhbSBjb250YWlucyBubyBkb2N1bWVudCwgc3RpbGwgZW1pdCBhIGZpbmFsIGRvY3VtZW50IGluY2x1ZGluZyBhbnkgY29tbWVudHMgYW5kIGRpcmVjdGl2ZXMgdGhhdCB3b3VsZCBiZSBhcHBsaWVkIHRvIGEgc3Vic2VxdWVudCBkb2N1bWVudC5cbiAgICAgKiBAcGFyYW0gZW5kT2Zmc2V0IC0gU2hvdWxkIGJlIHNldCBpZiBgZm9yY2VEb2NgIGlzIGFsc28gc2V0LCB0byBzZXQgdGhlIGRvY3VtZW50IHJhbmdlIGVuZCBhbmQgdG8gaW5kaWNhdGUgZXJyb3JzIGNvcnJlY3RseS5cbiAgICAgKi9cbiAgICAqZW5kKGZvcmNlRG9jID0gZmFsc2UsIGVuZE9mZnNldCA9IC0xKSB7XG4gICAgICAgIGlmICh0aGlzLmRvYykge1xuICAgICAgICAgICAgdGhpcy5kZWNvcmF0ZSh0aGlzLmRvYywgdHJ1ZSk7XG4gICAgICAgICAgICB5aWVsZCB0aGlzLmRvYztcbiAgICAgICAgICAgIHRoaXMuZG9jID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChmb3JjZURvYykge1xuICAgICAgICAgICAgY29uc3Qgb3B0cyA9IE9iamVjdC5hc3NpZ24oeyBfZGlyZWN0aXZlczogdGhpcy5kaXJlY3RpdmVzIH0sIHRoaXMub3B0aW9ucyk7XG4gICAgICAgICAgICBjb25zdCBkb2MgPSBuZXcgRG9jdW1lbnQuRG9jdW1lbnQodW5kZWZpbmVkLCBvcHRzKTtcbiAgICAgICAgICAgIGlmICh0aGlzLmF0RGlyZWN0aXZlcylcbiAgICAgICAgICAgICAgICB0aGlzLm9uRXJyb3IoZW5kT2Zmc2V0LCAnTUlTU0lOR19DSEFSJywgJ01pc3NpbmcgZGlyZWN0aXZlcy1lbmQgaW5kaWNhdG9yIGxpbmUnKTtcbiAgICAgICAgICAgIGRvYy5yYW5nZSA9IFswLCBlbmRPZmZzZXQsIGVuZE9mZnNldF07XG4gICAgICAgICAgICB0aGlzLmRlY29yYXRlKGRvYywgZmFsc2UpO1xuICAgICAgICAgICAgeWllbGQgZG9jO1xuICAgICAgICB9XG4gICAgfVxufVxuXG5leHBvcnRzLkNvbXBvc2VyID0gQ29tcG9zZXI7XG4iXSwibWFwcGluZ3MiOiJBQUFBLFlBQVk7O0FBRVosSUFBSUEsVUFBVSxHQUFHQyxPQUFPLENBQUMsc0JBQXNCLENBQUM7QUFDaEQsSUFBSUMsUUFBUSxHQUFHRCxPQUFPLENBQUMsb0JBQW9CLENBQUM7QUFDNUMsSUFBSUUsTUFBTSxHQUFHRixPQUFPLENBQUMsY0FBYyxDQUFDO0FBQ3BDLElBQUlHLElBQUksR0FBR0gsT0FBTyxDQUFDLGtCQUFrQixDQUFDO0FBQ3RDLElBQUlJLFVBQVUsR0FBR0osT0FBTyxDQUFDLGtCQUFrQixDQUFDO0FBQzVDLElBQUlLLFVB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