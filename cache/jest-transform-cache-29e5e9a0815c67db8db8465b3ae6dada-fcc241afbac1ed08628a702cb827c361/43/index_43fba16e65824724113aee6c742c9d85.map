{"version":3,"names":["configuration_1","require","api_1","i18n_1","install_validator_1","debug_1","__importDefault","Cli","constructor","argv","cwd","stdout","stderr","process","env","run","validateInstall","options","configuration","argvConfiguration","ArgvParser","parse","i18nLanguages","write","getLanguages","shouldAdvertisePublish","shouldExitImmediately","success","i18nKeywords","getKeywords","environment","debug","default","enabled","useConfiguration","runConfiguration","loadConfiguration","file","config","profiles","profile","provided","runCucumber","formats","publish","publishQuiet","isTruthyString","CUCUMBER_PUBLISH_QUIET","forceExit","exports"],"sources":["../../src/cli/index.ts"],"sourcesContent":["import { ArgvParser, isTruthyString } from '../configuration'\nimport { IFormatterStream } from '../formatter'\nimport { loadConfiguration, runCucumber } from '../api'\nimport { getKeywords, getLanguages } from './i18n'\nimport { validateInstall } from './install_validator'\nimport debug from 'debug'\n\nexport interface ICliRunResult {\n  shouldAdvertisePublish: boolean\n  shouldExitImmediately: boolean\n  success: boolean\n}\n\nexport default class Cli {\n  private readonly argv: string[]\n  private readonly cwd: string\n  private readonly stdout: IFormatterStream\n  private readonly stderr: IFormatterStream\n  private readonly env: NodeJS.ProcessEnv\n\n  constructor({\n    argv,\n    cwd,\n    stdout,\n    stderr = process.stderr,\n    env,\n  }: {\n    argv: string[]\n    cwd: string\n    stdout: IFormatterStream\n    stderr?: IFormatterStream\n    env: NodeJS.ProcessEnv\n  }) {\n    this.argv = argv\n    this.cwd = cwd\n    this.stdout = stdout\n    this.stderr = stderr\n    this.env = env\n  }\n\n  async run(): Promise<ICliRunResult> {\n    await validateInstall()\n    const { options, configuration: argvConfiguration } = ArgvParser.parse(\n      this.argv\n    )\n    if (options.i18nLanguages) {\n      this.stdout.write(getLanguages())\n      return {\n        shouldAdvertisePublish: false,\n        shouldExitImmediately: true,\n        success: true,\n      }\n    }\n    if (options.i18nKeywords) {\n      this.stdout.write(getKeywords(options.i18nKeywords))\n      return {\n        shouldAdvertisePublish: false,\n        shouldExitImmediately: true,\n        success: true,\n      }\n    }\n    const environment = {\n      cwd: this.cwd,\n      stdout: this.stdout,\n      stderr: this.stderr,\n      env: this.env,\n      debug: debug.enabled('cucumber'),\n    }\n    const { useConfiguration: configuration, runConfiguration } =\n      await loadConfiguration(\n        {\n          file: options.config,\n          profiles: options.profile,\n          provided: argvConfiguration,\n        },\n        environment\n      )\n    const { success } = await runCucumber(runConfiguration, environment)\n    return {\n      shouldAdvertisePublish:\n        !runConfiguration.formats.publish &&\n        !configuration.publishQuiet &&\n        !isTruthyString(this.env.CUCUMBER_PUBLISH_QUIET),\n      shouldExitImmediately: configuration.forceExit,\n      success,\n    }\n  }\n}\n"],"mappings":";;;;;;;;;;AAAA,MAAAA,eAAA,GAAAC,OAAA;AAEA,MAAAC,KAAA,GAAAD,OAAA;AACA,MAAAE,MAAA,GAAAF,OAAA;AACA,MAAAG,mBAAA,GAAAH,OAAA;AACA,MAAAI,OAAA,GAAAC,eAAA,CAAAL,OAAA;AAQA,MAAqBM,GAAG;EAOtBC,YAAY;IACVC,IAAI;IACJC,GAAG;IACHC,MAAM;IACNC,MAAM,GAAGC,OAAO,CAACD,MAAM;IACvBE;EAAG,CAOJ;IACC,IAAI,CAACL,IAAI,GAAGA,IAAI;IAChB,IAAI,CAACC,GAAG,GAAGA,GAAG;IACd,IAAI,CAACC,MAAM,GAAGA,MAAM;IACpB,IAAI,CAACC,MAAM,GAAGA,MAAM;IACpB,IAAI,CAACE,GAAG,GAAGA,GAAG;EAChB;EAEA,MAAMC,GAAGA,CAAA;IACP,MAAM,IAAAX,mBAAA,CAAAY,eAAe,GAAE;IACvB,MAAM;MAAEC,OAAO;MAAEC,aAAa,EAAEC;IAAiB,CAAE,GAAGnB,eAAA,CAAAoB,UAAU,CAACC,KAAK,CACpE,IAAI,CAACZ,IAAI,CACV;IACD,IAAIQ,OAAO,CAACK,aAAa,EAAE;MACzB,IAAI,CAACX,MAAM,CAACY,KAAK,CAAC,IAAApB,MAAA,CAAAqB,YAAY,GAAE,CAAC;MACjC,OAAO;QACLC,sBAAsB,EAAE,KAAK;QAC7BC,qBAAqB,EAAE,IAAI;QAC3BC,OAAO,EAAE;OACV;;IAEH,IAAIV,OAAO,CAACW,YAAY,EAAE;MACxB,IAAI,CAACjB,MAAM,CAACY,KAAK,CAAC,IAAApB,MAAA,CAAA0B,WAAW,EAACZ,OAAO,CAACW,YAAY,CAAC,CAAC;MACpD,OAAO;QACLH,sBAAsB,EAAE,KAAK;QAC7BC,qBAAqB,EAAE,IAAI;QAC3BC,OAAO,EAAE;OACV;;IAEH,MAAMG,WAAW,GAAG;MAClBpB,GAAG,EAAE,IAAI,CAACA,GAAG;MACbC,MAAM,EAAE,IAAI,CAACA,MAAM;MACnBC,MAAM,EAAE,IAAI,CAACA,MAAM;MACnBE,GAAG,EAAE,IAAI,CAACA,GAAG;MACbiB,KAAK,EAAE1B,OAAA,CAAA2B,OAAK,CAACC,OAAO,CAAC,UAAU;KAChC;IACD,MAAM;MAAEC,gBAAgB,EAAEhB,aAAa;MAAEiB;IAAgB,CAAE,GACzD,MAAM,IAAAjC,KAAA,CAAAkC,iBAAiB,EACrB;MACEC,IAAI,EAAEpB,OAAO,CAACqB,MAAM;MACpBC,QAAQ,EAAEtB,OAAO,CAACuB,OAAO;MACzBC,QAAQ,EAAEtB;KACX,EACDW,WAAW,CACZ;IACH,MAAM;MAAEH;IAAO,CAAE,GAAG,MAAM,IAAAzB,KAAA,CAAAwC,WAAW,EAACP,gBAAgB,EAAEL,WAAW,CAAC;IACpE,OAAO;MACLL,sBAAsB,EACpB,CAACU,gBAAgB,CAACQ,OAAO,CAACC,OAAO,IACjC,CAAC1B,aAAa,CAAC2B,YAAY,IAC3B,CAAC,IAAA7C,eAAA,CAAA8C,cAAc,EAAC,IAAI,CAAChC,GAAG,CAACiC,sBAAsB,CAAC;MAClDrB,qBAAqB,EAAER,aAAa,CAAC8B,SAAS;MAC9CrB;KACD;EACH;;AAzEFsB,OAAA,CAAAjB,OAAA,GAAAzB,GAAA"}