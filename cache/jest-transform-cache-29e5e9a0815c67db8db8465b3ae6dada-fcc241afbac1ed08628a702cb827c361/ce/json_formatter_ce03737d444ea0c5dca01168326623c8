c6eb04478e234119fa1f99f2ca14c5f9
"use strict";

var __createBinding = void 0 && (void 0).__createBinding || (Object.create ? function (o, m, k, k2) {
  if (k2 === undefined) k2 = k;
  var desc = Object.getOwnPropertyDescriptor(m, k);
  if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
    desc = {
      enumerable: true,
      get: function () {
        return m[k];
      }
    };
  }
  Object.defineProperty(o, k2, desc);
} : function (o, m, k, k2) {
  if (k2 === undefined) k2 = k;
  o[k2] = m[k];
});
var __setModuleDefault = void 0 && (void 0).__setModuleDefault || (Object.create ? function (o, v) {
  Object.defineProperty(o, "default", {
    enumerable: true,
    value: v
  });
} : function (o, v) {
  o["default"] = v;
});
var __importStar = void 0 && (void 0).__importStar || function (mod) {
  if (mod && mod.__esModule) return mod;
  var result = {};
  if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
  __setModuleDefault(result, mod);
  return result;
};
var __importDefault = void 0 && (void 0).__importDefault || function (mod) {
  return mod && mod.__esModule ? mod : {
    "default": mod
  };
};
Object.defineProperty(exports, "__esModule", {
  value: true
});
const _1 = __importDefault(require("./"));
const helpers_1 = require("./helpers");
const messages = __importStar(require("@cucumber/messages"));
const gherkin_document_parser_1 = require("./helpers/gherkin_document_parser");
const value_checker_1 = require("../value_checker");
const step_arguments_1 = require("../step_arguments");
const duration_helpers_1 = require("./helpers/duration_helpers");
const {
  getGherkinStepMap,
  getGherkinScenarioMap
} = helpers_1.GherkinDocumentParser;
const {
  getScenarioDescription,
  getPickleStepMap,
  getStepKeyword
} = helpers_1.PickleParser;
class JsonFormatter extends _1.default {
  constructor(options) {
    super(options);
    options.eventBroadcaster.on('envelope', envelope => {
      if ((0, value_checker_1.doesHaveValue)(envelope.testRunFinished)) {
        this.onTestRunFinished();
      }
    });
  }
  convertNameToId(obj) {
    return obj.name.replace(/ /g, '-').toLowerCase();
  }
  formatDataTable(dataTable) {
    return {
      rows: dataTable.rows.map(row => ({
        cells: row.cells.map(x => x.value)
      }))
    };
  }
  formatDocString(docString, gherkinStep) {
    return {
      content: docString.content,
      line: gherkinStep.docString.location.line
    };
  }
  formatStepArgument(stepArgument, gherkinStep) {
    if ((0, value_checker_1.doesNotHaveValue)(stepArgument)) {
      return [];
    }
    return [(0, step_arguments_1.parseStepArgument)(stepArgument, {
      dataTable: dataTable => this.formatDataTable(dataTable),
      docString: docString => this.formatDocString(docString, gherkinStep)
    })];
  }
  onTestRunFinished() {
    const groupedTestCaseAttempts = {};
    this.eventDataCollector.getTestCaseAttempts().forEach(testCaseAttempt => {
      if (!testCaseAttempt.willBeRetried) {
        const uri = testCaseAttempt.pickle.uri;
        if ((0, value_checker_1.doesNotHaveValue)(groupedTestCaseAttempts[uri])) {
          groupedTestCaseAttempts[uri] = [];
        }
        groupedTestCaseAttempts[uri].push(testCaseAttempt);
      }
    });
    const features = Object.keys(groupedTestCaseAttempts).map(uri => {
      const group = groupedTestCaseAttempts[uri];
      const {
        gherkinDocument
      } = group[0];
      const gherkinStepMap = getGherkinStepMap(gherkinDocument);
      const gherkinScenarioMap = getGherkinScenarioMap(gherkinDocument);
      const gherkinExampleRuleMap = (0, gherkin_document_parser_1.getGherkinExampleRuleMap)(gherkinDocument);
      const gherkinScenarioLocationMap = (0, gherkin_document_parser_1.getGherkinScenarioLocationMap)(gherkinDocument);
      const elements = group.map(testCaseAttempt => {
        const {
          pickle
        } = testCaseAttempt;
        const pickleStepMap = getPickleStepMap(pickle);
        let isBeforeHook = true;
        const steps = testCaseAttempt.testCase.testSteps.map(testStep => {
          isBeforeHook = isBeforeHook && !(0, value_checker_1.doesHaveValue)(testStep.pickleStepId);
          return this.getStepData({
            isBeforeHook,
            gherkinStepMap,
            pickleStepMap,
            testStep,
            testStepAttachments: testCaseAttempt.stepAttachments[testStep.id],
            testStepResult: testCaseAttempt.stepResults[testStep.id]
          });
        });
        return this.getScenarioData({
          feature: gherkinDocument.feature,
          gherkinScenarioLocationMap,
          gherkinExampleRuleMap,
          gherkinScenarioMap,
          pickle,
          steps
        });
      });
      return this.getFeatureData({
        feature: gherkinDocument.feature,
        elements,
        uri
      });
    });
    this.log(JSON.stringify(features, null, 2));
  }
  getFeatureData({
    feature,
    elements,
    uri
  }) {
    return {
      description: feature.description,
      elements,
      id: this.convertNameToId(feature),
      line: feature.location.line,
      keyword: feature.keyword,
      name: feature.name,
      tags: this.getFeatureTags(feature),
      uri
    };
  }
  getScenarioData({
    feature,
    gherkinScenarioLocationMap,
    gherkinExampleRuleMap,
    gherkinScenarioMap,
    pickle,
    steps
  }) {
    const description = getScenarioDescription({
      pickle,
      gherkinScenarioMap
    });
    return {
      description,
      id: this.formatScenarioId({
        feature,
        pickle,
        gherkinExampleRuleMap
      }),
      keyword: gherkinScenarioMap[pickle.astNodeIds[0]].keyword,
      line: gherkinScenarioLocationMap[pickle.astNodeIds[pickle.astNodeIds.length - 1]].line,
      name: pickle.name,
      steps,
      tags: this.getScenarioTags({
        feature,
        pickle,
        gherkinScenarioMap
      }),
      type: 'scenario'
    };
  }
  formatScenarioId({
    feature,
    pickle,
    gherkinExampleRuleMap
  }) {
    let parts;
    const rule = gherkinExampleRuleMap[pickle.astNodeIds[0]];
    if ((0, value_checker_1.doesHaveValue)(rule)) {
      parts = [feature, rule, pickle];
    } else {
      parts = [feature, pickle];
    }
    return parts.map(part => this.convertNameToId(part)).join(';');
  }
  getStepData({
    isBeforeHook,
    gherkinStepMap,
    pickleStepMap,
    testStep,
    testStepAttachments,
    testStepResult
  }) {
    const data = {};
    if ((0, value_checker_1.doesHaveValue)(testStep.pickleStepId)) {
      const pickleStep = pickleStepMap[testStep.pickleStepId];
      data.arguments = this.formatStepArgument(pickleStep.argument, gherkinStepMap[pickleStep.astNodeIds[0]]);
      data.keyword = getStepKeyword({
        pickleStep,
        gherkinStepMap
      });
      data.line = gherkinStepMap[pickleStep.astNodeIds[0]].location.line;
      data.name = pickleStep.text;
    } else {
      data.keyword = isBeforeHook ? 'Before' : 'After';
      data.hidden = true;
    }
    if ((0, value_checker_1.doesHaveValue)(testStep.stepDefinitionIds) && testStep.stepDefinitionIds.length === 1) {
      const stepDefinition = this.supportCodeLibrary.stepDefinitions.find(s => s.id === testStep.stepDefinitionIds[0]);
      data.match = {
        location: (0, helpers_1.formatLocation)(stepDefinition)
      };
    }
    const {
      message,
      status
    } = testStepResult;
    data.result = {
      status: messages.TestStepResultStatus[status].toLowerCase()
    };
    if ((0, value_checker_1.doesHaveValue)(testStepResult.duration)) {
      data.result.duration = (0, duration_helpers_1.durationToNanoseconds)(testStepResult.duration);
    }
    if (status === messages.TestStepResultStatus.FAILED && (0, value_checker_1.doesHaveValue)(message)) {
      data.result.error_message = message;
    }
    if ((testStepAttachments === null || testStepAttachments === void 0 ? void 0 : testStepAttachments.length) > 0) {
      data.embeddings = testStepAttachments.map(attachment => ({
        data: attachment.body,
        mime_type: attachment.mediaType
      }));
    }
    return data;
  }
  getFeatureTags(feature) {
    return feature.tags.map(tagData => ({
      name: tagData.name,
      line: tagData.location.line
    }));
  }
  getScenarioTags({
    feature,
    pickle,
    gherkinScenarioMap
  }) {
    const scenario = gherkinScenarioMap[pickle.astNodeIds[0]];
    return pickle.tags.map(tagData => this.getScenarioTag(tagData, feature, scenario));
  }
  getScenarioTag(tagData, feature, scenario) {
    var _a;
    const byAstNodeId = tag => tag.id === tagData.astNodeId;
    const flatten = (acc, val) => acc.concat(val);
    const tag = feature.tags.find(byAstNodeId) || scenario.tags.find(byAstNodeId) || scenario.examples.map(e => e.tags).reduce(flatten, []).find(byAstNodeId);
    return {
      name: tagData.name,
      line: (_a = tag === null || tag === void 0 ? void 0 : tag.location) === null || _a === void 0 ? void 0 : _a.line
    };
  }
}
exports.default = JsonFormatter;
JsonFormatter.documentation = 'Prints the feature as JSON. The JSON format is in maintenance mode. Please consider using the message formatter with the standalone json-formatter (https://github.com/cucumber/cucumber/tree/master/json-formatter).';
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfMSIsIl9faW1wb3J0RGVmYXVsdCIsInJlcXVpcmUiLCJoZWxwZXJzXzEiLCJtZXNzYWdlcyIsIl9faW1wb3J0U3RhciIsImdoZXJraW5fZG9jdW1lbnRfcGFyc2VyXzEiLCJ2YWx1ZV9jaGVja2VyXzEiLCJzdGVwX2FyZ3VtZW50c18xIiwiZHVyYXRpb25faGVscGVyc18xIiwiZ2V0R2hlcmtpblN0ZXBNYXAiLCJnZXRHaGVya2luU2NlbmFyaW9NYXAiLCJHaGVya2luRG9jdW1lbnRQYXJzZXIiLCJnZXRTY2VuYXJpb0Rlc2NyaXB0aW9uIiwiZ2V0UGlja2xlU3RlcE1hcCIsImdldFN0ZXBLZXl3b3JkIiwiUGlja2xlUGFyc2VyIiwiSnNvbkZvcm1hdHRlciIsImRlZmF1bHQiLCJjb25zdHJ1Y3RvciIsIm9wdGlvbnMiLCJldmVudEJyb2FkY2FzdGVyIiwib24iLCJlbnZlbG9wZSIsImRvZXNIYXZlVmFsdWUiLCJ0ZXN0UnVuRmluaXNoZWQiLCJvblRlc3RSdW5GaW5pc2hlZCIsImNvbnZlcnROYW1lVG9JZCIsIm9iaiIsIm5hbWUiLCJyZXBsYWNlIiwidG9Mb3dlckNhc2UiLCJmb3JtYXREYXRhVGFibGUiLCJkYXRhVGFibGUiLCJyb3dzIiwibWFwIiwicm93IiwiY2VsbHMiLCJ4IiwidmFsdWUiLCJmb3JtYXREb2NTdHJpbmciLCJkb2NTdHJpbmciLCJnaGVya2luU3RlcCIsImNvbnRlbnQiLCJsaW5lIiwibG9jYXRpb24iLCJmb3JtYXRTdGVwQXJndW1lbnQiLCJzdGVwQXJndW1lbnQiLCJkb2VzTm90SGF2ZVZhbHVlIiwicGFyc2VTdGVwQXJndW1lbnQiLCJncm91cGVkVGVzdENhc2VBdHRlbXB0cyIsImV2ZW50RGF0YUNvbGxlY3RvciIsImdldFRlc3RDYXNlQXR0ZW1wdHMiLCJmb3JFYWNoIiwidGVzdENhc2VBdHRlbXB0Iiwid2lsbEJlUmV0cmllZCIsInVyaSIsInBpY2tsZSIsInB1c2giLCJmZWF0dXJlcyIsIk9iamVjdCIsImtleXMiLCJncm91cCIsImdoZXJraW5Eb2N1bWVudCIsImdoZXJraW5TdGVwTWFwIiwiZ2hlcmtpblNjZW5hcmlvTWFwIiwiZ2hlcmtpbkV4YW1wbGVSdWxlTWFwIiwiZ2V0R2hlcmtpbkV4YW1wbGVSdWxlTWFwIiwiZ2hlcmtpblNjZW5hcmlvTG9jYXRpb25NYXAiLCJnZXRHaGVya2luU2NlbmFyaW9Mb2NhdGlvbk1hcCIsImVsZW1lbnRzIiwicGlja2xlU3RlcE1hcCIsImlzQmVmb3JlSG9vayIsInN0ZXBzIiwidGVzdENhc2UiLCJ0ZXN0U3RlcHMiLCJ0ZXN0U3RlcCIsInBpY2tsZVN0ZXBJZCIsImdldFN0ZXBEYXRhIiwidGVzdFN0ZXBBdHRhY2htZW50cyIsInN0ZXBBdHRhY2htZW50cyIsImlkIiwidGVzdFN0ZXBSZXN1bHQiLCJzdGVwUmVzdWx0cyIsImdldFNjZW5hcmlvRGF0YSIsImZlYXR1cmUiLCJnZXRGZWF0dXJlRGF0YSIsImxvZyIsIkpTT04iLCJzdHJpbmdpZnkiLCJkZXNjcmlwdGlvbiIsImtleXdvcmQiLCJ0YWdzIiwiZ2V0RmVhdHVyZVRhZ3MiLCJmb3JtYXRTY2VuYXJpb0lkIiwiYXN0Tm9kZUlkcyIsImxlbmd0aCIsImdldFNjZW5hcmlvVGFncyIsInR5cGUiLCJwYXJ0cyIsInJ1bGUiLCJwYXJ0Iiwiam9pbiIsImRhdGEiLCJwaWNrbGVTdGVwIiwiYXJndW1lbnRzIiwiYXJndW1lbnQiLCJ0ZXh0IiwiaGlkZGVuIiwic3RlcERlZmluaXRpb25JZHMiLCJzdGVwRGVmaW5pdGlvbiIsInN1cHBvcnRDb2RlTGlicmFyeSIsInN0ZXBEZWZpbml0aW9ucyIsImZpbmQiLCJzIiwibWF0Y2giLCJmb3JtYXRMb2NhdGlvbiIsIm1lc3NhZ2UiLCJzdGF0dXMiLCJyZXN1bHQiLCJUZXN0U3RlcFJlc3VsdFN0YXR1cyIsImR1cmF0aW9uIiwiZHVyYXRpb25Ub05hbm9zZWNvbmRzIiwiRkFJTEVEIiwiZXJyb3JfbWVzc2FnZSIsImVtYmVkZGluZ3MiLCJhdHRhY2htZW50IiwiYm9keSIsIm1pbWVfdHlwZSIsIm1lZGlhVHlwZSIsInRhZ0RhdGEiLCJzY2VuYXJpbyIsImdldFNjZW5hcmlvVGFnIiwiYnlBc3ROb2RlSWQiLCJ0YWciLCJhc3ROb2RlSWQiLCJmbGF0dGVuIiwiYWNjIiwidmFsIiwiY29uY2F0IiwiZXhhbXBsZXMiLCJlIiwicmVkdWNlIiwiX2EiLCJleHBvcnRzIiwiZG9jdW1lbnRhdGlvbiJdLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9mb3JtYXR0ZXIvanNvbl9mb3JtYXR0ZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEZvcm1hdHRlciwgeyBJRm9ybWF0dGVyT3B0aW9ucyB9IGZyb20gJy4vJ1xuaW1wb3J0IHsgZm9ybWF0TG9jYXRpb24sIEdoZXJraW5Eb2N1bWVudFBhcnNlciwgUGlja2xlUGFyc2VyIH0gZnJvbSAnLi9oZWxwZXJzJ1xuaW1wb3J0ICogYXMgbWVzc2FnZXMgZnJvbSAnQGN1Y3VtYmVyL21lc3NhZ2VzJ1xuaW1wb3J0IHtcbiAgZ2V0R2hlcmtpbkV4YW1wbGVSdWxlTWFwLFxuICBnZXRHaGVya2luU2NlbmFyaW9Mb2NhdGlvbk1hcCxcbn0gZnJvbSAnLi9oZWxwZXJzL2doZXJraW5fZG9jdW1lbnRfcGFyc2VyJ1xuaW1wb3J0IHsgSVRlc3RDYXNlQXR0ZW1wdCB9IGZyb20gJy4vaGVscGVycy9ldmVudF9kYXRhX2NvbGxlY3RvcidcbmltcG9ydCB7IGRvZXNIYXZlVmFsdWUsIGRvZXNOb3RIYXZlVmFsdWUgfSBmcm9tICcuLi92YWx1ZV9jaGVja2VyJ1xuaW1wb3J0IHsgcGFyc2VTdGVwQXJndW1lbnQgfSBmcm9tICcuLi9zdGVwX2FyZ3VtZW50cydcbmltcG9ydCB7IGR1cmF0aW9uVG9OYW5vc2Vjb25kcyB9IGZyb20gJy4vaGVscGVycy9kdXJhdGlvbl9oZWxwZXJzJ1xuXG5jb25zdCB7IGdldEdoZXJraW5TdGVwTWFwLCBnZXRHaGVya2luU2NlbmFyaW9NYXAgfSA9IEdoZXJraW5Eb2N1bWVudFBhcnNlclxuXG5jb25zdCB7IGdldFNjZW5hcmlvRGVzY3JpcHRpb24sIGdldFBpY2tsZVN0ZXBNYXAsIGdldFN0ZXBLZXl3b3JkIH0gPVxuICBQaWNrbGVQYXJzZXJcblxuZXhwb3J0IGludGVyZmFjZSBJSnNvbkZlYXR1cmUge1xuICBkZXNjcmlwdGlvbjogc3RyaW5nXG4gIGVsZW1lbnRzOiBJSnNvblNjZW5hcmlvW11cbiAgaWQ6IHN0cmluZ1xuICBrZXl3b3JkOiBzdHJpbmdcbiAgbGluZTogbnVtYmVyXG4gIG5hbWU6IHN0cmluZ1xuICB0YWdzOiBJSnNvblRhZ1tdXG4gIHVyaTogc3RyaW5nXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgSUpzb25TY2VuYXJpbyB7XG4gIGRlc2NyaXB0aW9uOiBzdHJpbmdcbiAgaWQ6IHN0cmluZ1xuICBrZXl3b3JkOiBzdHJpbmdcbiAgbGluZTogbnVtYmVyXG4gIG5hbWU6IHN0cmluZ1xuICBzdGVwczogSUpzb25TdGVwW11cbiAgdGFnczogSUpzb25UYWdbXVxuICB0eXBlOiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBJSnNvblN0ZXAge1xuICBhcmd1bWVudHM/OiBhbnkgLy8gVE9ET1xuICBlbWJlZGRpbmdzPzogYW55IC8vIFRPRE9cbiAgaGlkZGVuPzogYm9vbGVhblxuICBrZXl3b3JkPzogc3RyaW5nIC8vIFRPRE8sIG5vdCBvcHRpb25hbFxuICBsaW5lPzogbnVtYmVyXG4gIG1hdGNoPzogYW55IC8vIFRPRE9cbiAgbmFtZT86IHN0cmluZ1xuICByZXN1bHQ/OiBhbnkgLy8gVE9ET1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIElKc29uVGFnIHtcbiAgbmFtZTogc3RyaW5nXG4gIGxpbmU6IG51bWJlclxufVxuXG5pbnRlcmZhY2UgSUJ1aWxkSnNvbkZlYXR1cmVPcHRpb25zIHtcbiAgZmVhdHVyZTogbWVzc2FnZXMuRmVhdHVyZVxuICBlbGVtZW50czogSUpzb25TY2VuYXJpb1tdXG4gIHVyaTogc3RyaW5nXG59XG5cbmludGVyZmFjZSBJQnVpbGRKc29uU2NlbmFyaW9PcHRpb25zIHtcbiAgZmVhdHVyZTogbWVzc2FnZXMuRmVhdHVyZVxuICBnaGVya2luU2NlbmFyaW9NYXA6IFJlY29yZDxzdHJpbmcsIG1lc3NhZ2VzLlNjZW5hcmlvPlxuICBnaGVya2luRXhhbXBsZVJ1bGVNYXA6IFJlY29yZDxzdHJpbmcsIG1lc3NhZ2VzLlJ1bGU+XG4gIGdoZXJraW5TY2VuYXJpb0xvY2F0aW9uTWFwOiBSZWNvcmQ8c3RyaW5nLCBtZXNzYWdlcy5Mb2NhdGlvbj5cbiAgcGlja2xlOiBtZXNzYWdlcy5QaWNrbGVcbiAgc3RlcHM6IElKc29uU3RlcFtdXG59XG5cbmludGVyZmFjZSBJQnVpbGRKc29uU3RlcE9wdGlvbnMge1xuICBpc0JlZm9yZUhvb2s6IGJvb2xlYW5cbiAgZ2hlcmtpblN0ZXBNYXA6IFJlY29yZDxzdHJpbmcsIG1lc3NhZ2VzLlN0ZXA+XG4gIHBpY2tsZVN0ZXBNYXA6IFJlY29yZDxzdHJpbmcsIG1lc3NhZ2VzLlBpY2tsZVN0ZXA+XG4gIHRlc3RTdGVwOiBtZXNzYWdlcy5UZXN0U3RlcFxuICB0ZXN0U3RlcEF0dGFjaG1lbnRzOiBtZXNzYWdlcy5BdHRhY2htZW50W11cbiAgdGVzdFN0ZXBSZXN1bHQ6IG1lc3NhZ2VzLlRlc3RTdGVwUmVzdWx0XG59XG5cbmludGVyZmFjZSBVcmlUb1Rlc3RDYXNlQXR0ZW1wdHNNYXAge1xuICBbdXJpOiBzdHJpbmddOiBJVGVzdENhc2VBdHRlbXB0W11cbn1cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgSnNvbkZvcm1hdHRlciBleHRlbmRzIEZvcm1hdHRlciB7XG4gIHB1YmxpYyBzdGF0aWMgcmVhZG9ubHkgZG9jdW1lbnRhdGlvbjogc3RyaW5nID1cbiAgICAnUHJpbnRzIHRoZSBmZWF0dXJlIGFzIEpTT04uIFRoZSBKU09OIGZvcm1hdCBpcyBpbiBtYWludGVuYW5jZSBtb2RlLiBQbGVhc2UgY29uc2lkZXIgdXNpbmcgdGhlIG1lc3NhZ2UgZm9ybWF0dGVyIHdpdGggdGhlIHN0YW5kYWxvbmUganNvbi1mb3JtYXR0ZXIgKGh0dHBzOi8vZ2l0aHViLmNvbS9jdWN1bWJlci9jdWN1bWJlci90cmVlL21hc3Rlci9qc29uLWZvcm1hdHRlcikuJ1xuXG4gIGNvbnN0cnVjdG9yKG9wdGlvbnM6IElGb3JtYXR0ZXJPcHRpb25zKSB7XG4gICAgc3VwZXIob3B0aW9ucylcbiAgICBvcHRpb25zLmV2ZW50QnJvYWRjYXN0ZXIub24oJ2VudmVsb3BlJywgKGVudmVsb3BlOiBtZXNzYWdlcy5FbnZlbG9wZSkgPT4ge1xuICAgICAgaWYgKGRvZXNIYXZlVmFsdWUoZW52ZWxvcGUudGVzdFJ1bkZpbmlzaGVkKSkge1xuICAgICAgICB0aGlzLm9uVGVzdFJ1bkZpbmlzaGVkKClcbiAgICAgIH1cbiAgICB9KVxuICB9XG5cbiAgY29udmVydE5hbWVUb0lkKG9iajogbWVzc2FnZXMuRmVhdHVyZSB8IG1lc3NhZ2VzLlBpY2tsZSk6IHN0cmluZyB7XG4gICAgcmV0dXJuIG9iai5uYW1lLnJlcGxhY2UoLyAvZywgJy0nKS50b0xvd2VyQ2FzZSgpXG4gIH1cblxuICBmb3JtYXREYXRhVGFibGUoZGF0YVRhYmxlOiBtZXNzYWdlcy5QaWNrbGVUYWJsZSk6IGFueSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHJvd3M6IGRhdGFUYWJsZS5yb3dzLm1hcCgocm93KSA9PiAoe1xuICAgICAgICBjZWxsczogcm93LmNlbGxzLm1hcCgoeCkgPT4geC52YWx1ZSksXG4gICAgICB9KSksXG4gICAgfVxuICB9XG5cbiAgZm9ybWF0RG9jU3RyaW5nKFxuICAgIGRvY1N0cmluZzogbWVzc2FnZXMuUGlja2xlRG9jU3RyaW5nLFxuICAgIGdoZXJraW5TdGVwOiBtZXNzYWdlcy5TdGVwXG4gICk6IGFueSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGNvbnRlbnQ6IGRvY1N0cmluZy5jb250ZW50LFxuICAgICAgbGluZTogZ2hlcmtpblN0ZXAuZG9jU3RyaW5nLmxvY2F0aW9uLmxpbmUsXG4gICAgfVxuICB9XG5cbiAgZm9ybWF0U3RlcEFyZ3VtZW50KFxuICAgIHN0ZXBBcmd1bWVudDogbWVzc2FnZXMuUGlja2xlU3RlcEFyZ3VtZW50LFxuICAgIGdoZXJraW5TdGVwOiBtZXNzYWdlcy5TdGVwXG4gICk6IGFueSB7XG4gICAgaWYgKGRvZXNOb3RIYXZlVmFsdWUoc3RlcEFyZ3VtZW50KSkge1xuICAgICAgcmV0dXJuIFtdXG4gICAgfVxuICAgIHJldHVybiBbXG4gICAgICBwYXJzZVN0ZXBBcmd1bWVudDxhbnk+KHN0ZXBBcmd1bWVudCwge1xuICAgICAgICBkYXRhVGFibGU6IChkYXRhVGFibGUpID0+IHRoaXMuZm9ybWF0RGF0YVRhYmxlKGRhdGFUYWJsZSksXG4gICAgICAgIGRvY1N0cmluZzogKGRvY1N0cmluZykgPT4gdGhpcy5mb3JtYXREb2NTdHJpbmcoZG9jU3RyaW5nLCBnaGVya2luU3RlcCksXG4gICAgICB9KSxcbiAgICBdXG4gIH1cblxuICBvblRlc3RSdW5GaW5pc2hlZCgpOiB2b2lkIHtcbiAgICBjb25zdCBncm91cGVkVGVzdENhc2VBdHRlbXB0czogVXJpVG9UZXN0Q2FzZUF0dGVtcHRzTWFwID0ge31cbiAgICB0aGlzLmV2ZW50RGF0YUNvbGxlY3RvclxuICAgICAgLmdldFRlc3RDYXNlQXR0ZW1wdHMoKVxuICAgICAgLmZvckVhY2goKHRlc3RDYXNlQXR0ZW1wdDogSVRlc3RDYXNlQXR0ZW1wdCkgPT4ge1xuICAgICAgICBpZiAoIXRlc3RDYXNlQXR0ZW1wdC53aWxsQmVSZXRyaWVkKSB7XG4gICAgICAgICAgY29uc3QgdXJpID0gdGVzdENhc2VBdHRlbXB0LnBpY2tsZS51cmlcbiAgICAgICAgICBpZiAoZG9lc05vdEhhdmVWYWx1ZShncm91cGVkVGVzdENhc2VBdHRlbXB0c1t1cmldKSkge1xuICAgICAgICAgICAgZ3JvdXBlZFRlc3RDYXNlQXR0ZW1wdHNbdXJpXSA9IFtdXG4gICAgICAgICAgfVxuICAgICAgICAgIGdyb3VwZWRUZXN0Q2FzZUF0dGVtcHRzW3VyaV0ucHVzaCh0ZXN0Q2FzZUF0dGVtcHQpXG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgY29uc3QgZmVhdHVyZXMgPSBPYmplY3Qua2V5cyhncm91cGVkVGVzdENhc2VBdHRlbXB0cykubWFwKCh1cmkpID0+IHtcbiAgICAgIGNvbnN0IGdyb3VwID0gZ3JvdXBlZFRlc3RDYXNlQXR0ZW1wdHNbdXJpXVxuICAgICAgY29uc3QgeyBnaGVya2luRG9jdW1lbnQgfSA9IGdyb3VwWzBdXG4gICAgICBjb25zdCBnaGVya2luU3RlcE1hcCA9IGdldEdoZXJraW5TdGVwTWFwKGdoZXJraW5Eb2N1bWVudClcbiAgICAgIGNvbnN0IGdoZXJraW5TY2VuYXJpb01hcCA9IGdldEdoZXJraW5TY2VuYXJpb01hcChnaGVya2luRG9jdW1lbnQpXG4gICAgICBjb25zdCBnaGVya2luRXhhbXBsZVJ1bGVNYXAgPSBnZXRHaGVya2luRXhhbXBsZVJ1bGVNYXAoZ2hlcmtpbkRvY3VtZW50KVxuICAgICAgY29uc3QgZ2hlcmtpblNjZW5hcmlvTG9jYXRpb25NYXAgPVxuICAgICAgICBnZXRHaGVya2luU2NlbmFyaW9Mb2NhdGlvbk1hcChnaGVya2luRG9jdW1lbnQpXG4gICAgICBjb25zdCBlbGVtZW50cyA9IGdyb3VwLm1hcCgodGVzdENhc2VBdHRlbXB0OiBJVGVzdENhc2VBdHRlbXB0KSA9PiB7XG4gICAgICAgIGNvbnN0IHsgcGlja2xlIH0gPSB0ZXN0Q2FzZUF0dGVtcHRcbiAgICAgICAgY29uc3QgcGlja2xlU3RlcE1hcCA9IGdldFBpY2tsZVN0ZXBNYXAocGlja2xlKVxuICAgICAgICBsZXQgaXNCZWZvcmVIb29rID0gdHJ1ZVxuICAgICAgICBjb25zdCBzdGVwcyA9IHRlc3RDYXNlQXR0ZW1wdC50ZXN0Q2FzZS50ZXN0U3RlcHMubWFwKCh0ZXN0U3RlcCkgPT4ge1xuICAgICAgICAgIGlzQmVmb3JlSG9vayA9IGlzQmVmb3JlSG9vayAmJiAhZG9lc0hhdmVWYWx1ZSh0ZXN0U3RlcC5waWNrbGVTdGVwSWQpXG4gICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0U3RlcERhdGEoe1xuICAgICAgICAgICAgaXNCZWZvcmVIb29rLFxuICAgICAgICAgICAgZ2hlcmtpblN0ZXBNYXAsXG4gICAgICAgICAgICBwaWNrbGVTdGVwTWFwLFxuICAgICAgICAgICAgdGVzdFN0ZXAsXG4gICAgICAgICAgICB0ZXN0U3RlcEF0dGFjaG1lbnRzOiB0ZXN0Q2FzZUF0dGVtcHQuc3RlcEF0dGFjaG1lbnRzW3Rlc3RTdGVwLmlkXSxcbiAgICAgICAgICAgIHRlc3RTdGVwUmVzdWx0OiB0ZXN0Q2FzZUF0dGVtcHQuc3RlcFJlc3VsdHNbdGVzdFN0ZXAuaWRdLFxuICAgICAgICAgIH0pXG4gICAgICAgIH0pXG4gICAgICAgIHJldHVybiB0aGlzLmdldFNjZW5hcmlvRGF0YSh7XG4gICAgICAgICAgZmVhdHVyZTogZ2hlcmtpbkRvY3VtZW50LmZlYXR1cmUsXG4gICAgICAgICAgZ2hlcmtpblNjZW5hcmlvTG9jYXRpb25NYXAsXG4gICAgICAgICAgZ2hlcmtpbkV4YW1wbGVSdWxlTWFwLFxuICAgICAgICAgIGdoZXJraW5TY2VuYXJpb01hcCxcbiAgICAgICAgICBwaWNrbGUsXG4gICAgICAgICAgc3RlcHMsXG4gICAgICAgIH0pXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHRoaXMuZ2V0RmVhdHVyZURhdGEoe1xuICAgICAgICBmZWF0dXJlOiBnaGVya2luRG9jdW1lbnQuZmVhdHVyZSxcbiAgICAgICAgZWxlbWVudHMsXG4gICAgICAgIHVyaSxcbiAgICAgIH0pXG4gICAgfSlcbiAgICB0aGlzLmxvZyhKU09OLnN0cmluZ2lmeShmZWF0dXJlcywgbnVsbCwgMikpXG4gIH1cblxuICBnZXRGZWF0dXJlRGF0YSh7XG4gICAgZmVhdHVyZSxcbiAgICBlbGVtZW50cyxcbiAgICB1cmksXG4gIH06IElCdWlsZEpzb25GZWF0dXJlT3B0aW9ucyk6IElKc29uRmVhdHVyZSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGRlc2NyaXB0aW9uOiBmZWF0dXJlLmRlc2NyaXB0aW9uLFxuICAgICAgZWxlbWVudHMsXG4gICAgICBpZDogdGhpcy5jb252ZXJ0TmFtZVRvSWQoZmVhdHVyZSksXG4gICAgICBsaW5lOiBmZWF0dXJlLmxvY2F0aW9uLmxpbmUsXG4gICAgICBrZXl3b3JkOiBmZWF0dXJlLmtleXdvcmQsXG4gICAgICBuYW1lOiBmZWF0dXJlLm5hbWUsXG4gICAgICB0YWdzOiB0aGlzLmdldEZlYXR1cmVUYWdzKGZlYXR1cmUpLFxuICAgICAgdXJpLFxuICAgIH1cbiAgfVxuXG4gIGdldFNjZW5hcmlvRGF0YSh7XG4gICAgZmVhdHVyZSxcbiAgICBnaGVya2luU2NlbmFyaW9Mb2NhdGlvbk1hcCxcbiAgICBnaGVya2luRXhhbXBsZVJ1bGVNYXAsXG4gICAgZ2hlcmtpblNjZW5hcmlvTWFwLFxuICAgIHBpY2tsZSxcbiAgICBzdGVwcyxcbiAgfTogSUJ1aWxkSnNvblNjZW5hcmlvT3B0aW9ucyk6IElKc29uU2NlbmFyaW8ge1xuICAgIGNvbnN0IGRlc2NyaXB0aW9uID0gZ2V0U2NlbmFyaW9EZXNjcmlwdGlvbih7XG4gICAgICBwaWNrbGUsXG4gICAgICBnaGVya2luU2NlbmFyaW9NYXAsXG4gICAgfSlcbiAgICByZXR1cm4ge1xuICAgICAgZGVzY3JpcHRpb24sXG4gICAgICBpZDogdGhpcy5mb3JtYXRTY2VuYXJpb0lkKHsgZmVhdHVyZSwgcGlja2xlLCBnaGVya2luRXhhbXBsZVJ1bGVNYXAgfSksXG4gICAgICBrZXl3b3JkOiBnaGVya2luU2NlbmFyaW9NYXBbcGlja2xlLmFzdE5vZGVJZHNbMF1dLmtleXdvcmQsXG4gICAgICBsaW5lOiBnaGVya2luU2NlbmFyaW9Mb2NhdGlvbk1hcFtcbiAgICAgICAgcGlja2xlLmFzdE5vZGVJZHNbcGlja2xlLmFzdE5vZGVJZHMubGVuZ3RoIC0gMV1cbiAgICAgIF0ubGluZSxcbiAgICAgIG5hbWU6IHBpY2tsZS5uYW1lLFxuICAgICAgc3RlcHMsXG4gICAgICB0YWdzOiB0aGlzLmdldFNjZW5hcmlvVGFncyh7IGZlYXR1cmUsIHBpY2tsZSwgZ2hlcmtpblNjZW5hcmlvTWFwIH0pLFxuICAgICAgdHlwZTogJ3NjZW5hcmlvJyxcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGZvcm1hdFNjZW5hcmlvSWQoe1xuICAgIGZlYXR1cmUsXG4gICAgcGlja2xlLFxuICAgIGdoZXJraW5FeGFtcGxlUnVsZU1hcCxcbiAgfToge1xuICAgIGZlYXR1cmU6IG1lc3NhZ2VzLkZlYXR1cmVcbiAgICBwaWNrbGU6IG1lc3NhZ2VzLlBpY2tsZVxuICAgIGdoZXJraW5FeGFtcGxlUnVsZU1hcDogUmVjb3JkPHN0cmluZywgbWVzc2FnZXMuUnVsZT5cbiAgfSk6IHN0cmluZyB7XG4gICAgbGV0IHBhcnRzOiBhbnlbXVxuICAgIGNvbnN0IHJ1bGUgPSBnaGVya2luRXhhbXBsZVJ1bGVNYXBbcGlja2xlLmFzdE5vZGVJZHNbMF1dXG4gICAgaWYgKGRvZXNIYXZlVmFsdWUocnVsZSkpIHtcbiAgICAgIHBhcnRzID0gW2ZlYXR1cmUsIHJ1bGUsIHBpY2tsZV1cbiAgICB9IGVsc2Uge1xuICAgICAgcGFydHMgPSBbZmVhdHVyZSwgcGlja2xlXVxuICAgIH1cbiAgICByZXR1cm4gcGFydHMubWFwKChwYXJ0KSA9PiB0aGlzLmNvbnZlcnROYW1lVG9JZChwYXJ0KSkuam9pbignOycpXG4gIH1cblxuICBnZXRTdGVwRGF0YSh7XG4gICAgaXNCZWZvcmVIb29rLFxuICAgIGdoZXJraW5TdGVwTWFwLFxuICAgIHBpY2tsZVN0ZXBNYXAsXG4gICAgdGVzdFN0ZXAsXG4gICAgdGVzdFN0ZXBBdHRhY2htZW50cyxcbiAgICB0ZXN0U3RlcFJlc3VsdCxcbiAgfTogSUJ1aWxkSnNvblN0ZXBPcHRpb25zKTogSUpzb25TdGVwIHtcbiAgICBjb25zdCBkYXRhOiBJSnNvblN0ZXAgPSB7fVxuICAgIGlmIChkb2VzSGF2ZVZhbHVlKHRlc3RTdGVwLnBpY2tsZVN0ZXBJZCkpIHtcbiAgICAgIGNvbnN0IHBpY2tsZVN0ZXAgPSBwaWNrbGVTdGVwTWFwW3Rlc3RTdGVwLnBpY2tsZVN0ZXBJZF1cbiAgICAgIGRhdGEuYXJndW1lbnRzID0gdGhpcy5mb3JtYXRTdGVwQXJndW1lbnQoXG4gICAgICAgIHBpY2tsZVN0ZXAuYXJndW1lbnQsXG4gICAgICAgIGdoZXJraW5TdGVwTWFwW3BpY2tsZVN0ZXAuYXN0Tm9kZUlkc1swXV1cbiAgICAgIClcbiAgICAgIGRhdGEua2V5d29yZCA9IGdldFN0ZXBLZXl3b3JkKHsgcGlja2xlU3RlcCwgZ2hlcmtpblN0ZXBNYXAgfSlcbiAgICAgIGRhdGEubGluZSA9IGdoZXJraW5TdGVwTWFwW3BpY2tsZVN0ZXAuYXN0Tm9kZUlkc1swXV0ubG9jYXRpb24ubGluZVxuICAgICAgZGF0YS5uYW1lID0gcGlja2xlU3RlcC50ZXh0XG4gICAgfSBlbHNlIHtcbiAgICAgIGRhdGEua2V5d29yZCA9IGlzQmVmb3JlSG9vayA/ICdCZWZvcmUnIDogJ0FmdGVyJ1xuICAgICAgZGF0YS5oaWRkZW4gPSB0cnVlXG4gICAgfVxuICAgIGlmIChcbiAgICAgIGRvZXNIYXZlVmFsdWUodGVzdFN0ZXAuc3RlcERlZmluaXRpb25JZHMpICYmXG4gICAgICB0ZXN0U3RlcC5zdGVwRGVmaW5pdGlvbklkcy5sZW5ndGggPT09IDFcbiAgICApIHtcbiAgICAgIGNvbnN0IHN0ZXBEZWZpbml0aW9uID0gdGhpcy5zdXBwb3J0Q29kZUxpYnJhcnkuc3RlcERlZmluaXRpb25zLmZpbmQoXG4gICAgICAgIChzKSA9PiBzLmlkID09PSB0ZXN0U3RlcC5zdGVwRGVmaW5pdGlvbklkc1swXVxuICAgICAgKVxuICAgICAgZGF0YS5tYXRjaCA9IHsgbG9jYXRpb246IGZvcm1hdExvY2F0aW9uKHN0ZXBEZWZpbml0aW9uKSB9XG4gICAgfVxuICAgIGNvbnN0IHsgbWVzc2FnZSwgc3RhdHVzIH0gPSB0ZXN0U3RlcFJlc3VsdFxuICAgIGRhdGEucmVzdWx0ID0ge1xuICAgICAgc3RhdHVzOiBtZXNzYWdlcy5UZXN0U3RlcFJlc3VsdFN0YXR1c1tzdGF0dXNdLnRvTG93ZXJDYXNlKCksXG4gICAgfVxuICAgIGlmIChkb2VzSGF2ZVZhbHVlKHRlc3RTdGVwUmVzdWx0LmR1cmF0aW9uKSkge1xuICAgICAgZGF0YS5yZXN1bHQuZHVyYXRpb24gPSBkdXJhdGlvblRvTmFub3NlY29uZHModGVzdFN0ZXBSZXN1bHQuZHVyYXRpb24pXG4gICAgfVxuICAgIGlmIChcbiAgICAgIHN0YXR1cyA9PT0gbWVzc2FnZXMuVGVzdFN0ZXBSZXN1bHRTdGF0dXMuRkFJTEVEICYmXG4gICAgICBkb2VzSGF2ZVZhbHVlKG1lc3NhZ2UpXG4gICAgKSB7XG4gICAgICBkYXRhLnJlc3VsdC5lcnJvcl9tZXNzYWdlID0gbWVzc2FnZVxuICAgIH1cbiAgICBpZiAodGVzdFN0ZXBBdHRhY2htZW50cz8ubGVuZ3RoID4gMCkge1xuICAgICAgZGF0YS5lbWJlZGRpbmdzID0gdGVzdFN0ZXBBdHRhY2htZW50cy5tYXAoKGF0dGFjaG1lbnQpID0+ICh7XG4gICAgICAgIGRhdGE6IGF0dGFjaG1lbnQuYm9keSxcbiAgICAgICAgbWltZV90eXBlOiBhdHRhY2htZW50Lm1lZGlhVHlwZSxcbiAgICAgIH0pKVxuICAgIH1cbiAgICByZXR1cm4gZGF0YVxuICB9XG5cbiAgZ2V0RmVhdHVyZVRhZ3MoZmVhdHVyZTogbWVzc2FnZXMuRmVhdHVyZSk6IElKc29uVGFnW10ge1xuICAgIHJldHVybiBmZWF0dXJlLnRhZ3MubWFwKCh0YWdEYXRhKSA9PiAoe1xuICAgICAgbmFtZTogdGFnRGF0YS5uYW1lLFxuICAgICAgbGluZTogdGFnRGF0YS5sb2NhdGlvbi5saW5lLFxuICAgIH0pKVxuICB9XG5cbiAgZ2V0U2NlbmFyaW9UYWdzKHtcbiAgICBmZWF0dXJlLFxuICAgIHBpY2tsZSxcbiAgICBnaGVya2luU2NlbmFyaW9NYXAsXG4gIH06IHtcbiAgICBmZWF0dXJlOiBtZXNzYWdlcy5GZWF0dXJlXG4gICAgcGlja2xlOiBtZXNzYWdlcy5QaWNrbGVcbiAgICBnaGVya2luU2NlbmFyaW9NYXA6IFJlY29yZDxzdHJpbmcsIG1lc3NhZ2VzLlNjZW5hcmlvPlxuICB9KTogSUpzb25UYWdbXSB7XG4gICAgY29uc3Qgc2NlbmFyaW8gPSBnaGVya2luU2NlbmFyaW9NYXBbcGlja2xlLmFzdE5vZGVJZHNbMF1dXG5cbiAgICByZXR1cm4gcGlja2xlLnRhZ3MubWFwKFxuICAgICAgKHRhZ0RhdGE6IG1lc3NhZ2VzLlBpY2tsZVRhZyk6IElKc29uVGFnID0+XG4gICAgICAgIHRoaXMuZ2V0U2NlbmFyaW9UYWcodGFnRGF0YSwgZmVhdHVyZSwgc2NlbmFyaW8pXG4gICAgKVxuICB9XG5cbiAgcHJpdmF0ZSBnZXRTY2VuYXJpb1RhZyhcbiAgICB0YWdEYXRhOiBtZXNzYWdlcy5QaWNrbGVUYWcsXG4gICAgZmVhdHVyZTogbWVzc2FnZXMuRmVhdHVyZSxcbiAgICBzY2VuYXJpbzogbWVzc2FnZXMuU2NlbmFyaW9cbiAgKTogSUpzb25UYWcge1xuICAgIGNvbnN0IGJ5QXN0Tm9kZUlkID0gKHRhZzogbWVzc2FnZXMuVGFnKTogYm9vbGVhbiA9PlxuICAgICAgdGFnLmlkID09PSB0YWdEYXRhLmFzdE5vZGVJZFxuICAgIGNvbnN0IGZsYXR0ZW4gPSAoXG4gICAgICBhY2M6IG1lc3NhZ2VzLlRhZ1tdLFxuICAgICAgdmFsOiBtZXNzYWdlcy5UYWdbXVxuICAgICk6IG1lc3NhZ2VzLlRhZ1tdID0+IGFjYy5jb25jYXQodmFsKVxuXG4gICAgY29uc3QgdGFnID1cbiAgICAgIGZlYXR1cmUudGFncy5maW5kKGJ5QXN0Tm9kZUlkKSB8fFxuICAgICAgc2NlbmFyaW8udGFncy5maW5kKGJ5QXN0Tm9kZUlkKSB8fFxuICAgICAgc2NlbmFyaW8uZXhhbXBsZXNcbiAgICAgICAgLm1hcCgoZSkgPT4gZS50YWdzKVxuICAgICAgICAucmVkdWNlKGZsYXR0ZW4sIFtdKVxuICAgICAgICAuZmluZChieUFzdE5vZGVJZClcblxuICAgIHJldHVybiB7XG4gICAgICBuYW1lOiB0YWdEYXRhLm5hbWUsXG4gICAgICBsaW5lOiB0YWc/LmxvY2F0aW9uPy5saW5lLFxuICAgIH1cbiAgfVxufVxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztB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