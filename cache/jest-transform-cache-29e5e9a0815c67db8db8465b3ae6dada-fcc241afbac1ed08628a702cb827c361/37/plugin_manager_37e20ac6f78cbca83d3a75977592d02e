d066814a976aa2105ce1d8b70f917889
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.PluginManager = void 0;
class PluginManager {
  constructor(pluginFns) {
    this.pluginFns = pluginFns;
    this.handlers = {
      message: []
    };
    this.cleanupFns = [];
  }
  async register(event, handler) {
    this.handlers[event].push(handler);
  }
  async init(logger, configuration, environment) {
    for (const pluginFn of this.pluginFns) {
      const cleanupFn = await pluginFn({
        on: this.register.bind(this),
        logger,
        configuration,
        environment
      });
      if (cleanupFn) {
        this.cleanupFns.push(cleanupFn);
      }
    }
  }
  emit(event, value) {
    this.handlers[event].forEach(handler => handler(value));
  }
  async cleanup() {
    for (const cleanupFn of this.cleanupFns) {
      await cleanupFn();
    }
  }
}
exports.PluginManager = PluginManager;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJQbHVnaW5NYW5hZ2VyIiwiY29uc3RydWN0b3IiLCJwbHVnaW5GbnMiLCJoYW5kbGVycyIsIm1lc3NhZ2UiLCJjbGVhbnVwRm5zIiwicmVnaXN0ZXIiLCJldmVudCIsImhhbmRsZXIiLCJwdXNoIiwiaW5pdCIsImxvZ2dlciIsImNvbmZpZ3VyYXRpb24iLCJlbnZpcm9ubWVudCIsInBsdWdpbkZuIiwiY2xlYW51cEZuIiwib24iLCJiaW5kIiwiZW1pdCIsInZhbHVlIiwiZm9yRWFjaCIsImNsZWFudXAiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsiLi4vLi4vc3JjL3BsdWdpbi9wbHVnaW5fbWFuYWdlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQbHVnaW4sIFBsdWdpbkNsZWFudXAsIFBsdWdpbkV2ZW50cyB9IGZyb20gJy4vdHlwZXMnXG5pbXBvcnQgeyBJUnVuRW52aXJvbm1lbnQsIElSdW5PcHRpb25zIH0gZnJvbSAnLi4vYXBpJ1xuaW1wb3J0IHsgSUxvZ2dlciB9IGZyb20gJy4uL2xvZ2dlcidcblxudHlwZSBIYW5kbGVyUmVnaXN0cnkgPSB7XG4gIFtLIGluIGtleW9mIFBsdWdpbkV2ZW50c106IEFycmF5PCh2YWx1ZTogUGx1Z2luRXZlbnRzW0tdKSA9PiB2b2lkPlxufVxuXG5leHBvcnQgY2xhc3MgUGx1Z2luTWFuYWdlciB7XG4gIHByaXZhdGUgaGFuZGxlcnM6IEhhbmRsZXJSZWdpc3RyeSA9IHsgbWVzc2FnZTogW10gfVxuICBwcml2YXRlIGNsZWFudXBGbnM6IFBsdWdpbkNsZWFudXBbXSA9IFtdXG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBwbHVnaW5GbnM6IFBsdWdpbltdKSB7fVxuXG4gIHByaXZhdGUgYXN5bmMgcmVnaXN0ZXI8SyBleHRlbmRzIGtleW9mIFBsdWdpbkV2ZW50cz4oXG4gICAgZXZlbnQ6IEssXG4gICAgaGFuZGxlcjogKHZhbHVlOiBQbHVnaW5FdmVudHNbS10pID0+IHZvaWRcbiAgKSB7XG4gICAgdGhpcy5oYW5kbGVyc1tldmVudF0ucHVzaChoYW5kbGVyKVxuICB9XG5cbiAgYXN5bmMgaW5pdChcbiAgICBsb2dnZXI6IElMb2dnZXIsXG4gICAgY29uZmlndXJhdGlvbjogSVJ1bk9wdGlvbnMsXG4gICAgZW52aXJvbm1lbnQ6IElSdW5FbnZpcm9ubWVudFxuICApIHtcbiAgICBmb3IgKGNvbnN0IHBsdWdpbkZuIG9mIHRoaXMucGx1Z2luRm5zKSB7XG4gICAgICBjb25zdCBjbGVhbnVwRm4gPSBhd2FpdCBwbHVnaW5Gbih7XG4gICAgICAgIG9uOiB0aGlzLnJlZ2lzdGVyLmJpbmQodGhpcyksXG4gICAgICAgIGxvZ2dlcixcbiAgICAgICAgY29uZmlndXJhdGlvbixcbiAgICAgICAgZW52aXJvbm1lbnQsXG4gICAgICB9KVxuICAgICAgaWYgKGNsZWFudXBGbikge1xuICAgICAgICB0aGlzLmNsZWFudXBGbnMucHVzaChjbGVhbnVwRm4pXG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgZW1pdDxLIGV4dGVuZHMga2V5b2YgUGx1Z2luRXZlbnRzPihldmVudDogSywgdmFsdWU6IFBsdWdpbkV2ZW50c1tLXSk6IHZvaWQge1xuICAgIHRoaXMuaGFuZGxlcnNbZXZlbnRdLmZvckVhY2goKGhhbmRsZXIpID0+IGhhbmRsZXIodmFsdWUpKVxuICB9XG5cbiAgYXN5bmMgY2xlYW51cCgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBmb3IgKGNvbnN0IGNsZWFudXBGbiBvZiB0aGlzLmNsZWFudXBGbnMpIHtcbiAgICAgIGF3YWl0IGNsZWFudXBGbigpXG4gICAgfVxuICB9XG59XG4iXSwibWFwcGluZ3MiOiI7Ozs7OztBQVFBLE1BQWFBLGFBQWE7RUFJeEJDLFlBQW9CQyxTQUFtQjtJQUFuQixLQUFBQSxTQUFTLEdBQVRBLFNBQVM7SUFIckIsS0FBQUMsUUFBUSxHQUFvQjtNQUFFQyxPQUFPLEVBQUU7SUFBRSxDQUFFO0lBQzNDLEtBQUFDLFVBQVUsR0FBb0IsRUFBRTtFQUVFO0VBRWxDLE1BQU1DLFFBQVFBLENBQ3BCQyxLQUFRLEVBQ1JDLE9BQXlDO0lBRXpDLElBQUksQ0FBQ0wsUUFBUSxDQUFDSSxLQUFLLENBQUMsQ0FBQ0UsSUFBSSxDQUFDRCxPQUFPLENBQUM7RUFDcEM7RUFFQSxNQUFNRSxJQUFJQSxDQUNSQyxNQUFlLEVBQ2ZDLGFBQTBCLEVBQzFCQyxXQUE0QjtJQUU1QixLQUFLLE1BQU1DLFFBQVEsSUFBSSxJQUFJLENBQUNaLFNBQVMsRUFBRTtNQUNyQyxNQUFNYSxTQUFTLEdBQUcsTUFBTUQsUUFBUSxDQUFDO1FBQy9CRSxFQUFFLEVBQUUsSUFBSSxDQUFDVixRQUFRLENBQUNXLElBQUksQ0FBQyxJQUFJLENBQUM7UUFDNUJOLE1BQU07UUFDTkMsYUFBYTtRQUNiQztPQUNELENBQUM7TUFDRixJQUFJRSxTQUFTLEVBQUU7UUFDYixJQUFJLENBQUNWLFVBQVUsQ0FBQ0ksSUFBSSxDQUFDTSxTQUFTLENBQUM7OztFQUdyQztFQUVBRyxJQUFJQSxDQUErQlgsS0FBUSxFQUFFWSxLQUFzQjtJQUNqRSxJQUFJLENBQUNoQixRQUFRLENBQUNJLEtBQUssQ0FBQyxDQUFDYSxPQUFPLENBQUVaLE9BQU8sSUFBS0EsT0FBTyxDQUFDVyxLQUFLLENBQUMsQ0FBQztFQUMzRDtFQUVBLE1BQU1FLE9BQU9BLENBQUE7SUFDWCxLQUFLLE1BQU1OLFNBQVMsSUFBSSxJQUFJLENBQUNWLFVBQVUsRUFBRTtNQUN2QyxNQUFNVSxTQUFTLEVBQUU7O0VBRXJCOztBQXZDRk8sT0FBQSxDQUFBdEIsYUFBQSxHQUFBQSxhQUFBIn0=