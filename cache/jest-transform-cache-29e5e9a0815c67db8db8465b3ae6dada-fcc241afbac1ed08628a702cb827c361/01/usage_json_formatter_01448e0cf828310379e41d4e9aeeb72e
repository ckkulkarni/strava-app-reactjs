1d871c9106477f404043869d00e46f92
"use strict";

var __importDefault = void 0 && (void 0).__importDefault || function (mod) {
  return mod && mod.__esModule ? mod : {
    "default": mod
  };
};
Object.defineProperty(exports, "__esModule", {
  value: true
});
const helpers_1 = require("./helpers");
const _1 = __importDefault(require("./"));
const value_checker_1 = require("../value_checker");
class UsageJsonFormatter extends _1.default {
  constructor(options) {
    super(options);
    options.eventBroadcaster.on('envelope', envelope => {
      if ((0, value_checker_1.doesHaveValue)(envelope.testRunFinished)) {
        this.logUsage();
      }
    });
  }
  logUsage() {
    const usage = (0, helpers_1.getUsage)({
      stepDefinitions: this.supportCodeLibrary.stepDefinitions,
      eventDataCollector: this.eventDataCollector
    });
    this.log(JSON.stringify(usage, this.replacer, 2));
  }
  replacer(key, value) {
    if (key === 'seconds') {
      return parseInt(value);
    }
    return value;
  }
}
exports.default = UsageJsonFormatter;
UsageJsonFormatter.documentation = 'Does what the Usage Formatter does, but outputs JSON, which can be output to a file and then consumed by other tools.';
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJoZWxwZXJzXzEiLCJyZXF1aXJlIiwiXzEiLCJfX2ltcG9ydERlZmF1bHQiLCJ2YWx1ZV9jaGVja2VyXzEiLCJVc2FnZUpzb25Gb3JtYXR0ZXIiLCJkZWZhdWx0IiwiY29uc3RydWN0b3IiLCJvcHRpb25zIiwiZXZlbnRCcm9hZGNhc3RlciIsIm9uIiwiZW52ZWxvcGUiLCJkb2VzSGF2ZVZhbHVlIiwidGVzdFJ1bkZpbmlzaGVkIiwibG9nVXNhZ2UiLCJ1c2FnZSIsImdldFVzYWdlIiwic3RlcERlZmluaXRpb25zIiwic3VwcG9ydENvZGVMaWJyYXJ5IiwiZXZlbnREYXRhQ29sbGVjdG9yIiwibG9nIiwiSlNPTiIsInN0cmluZ2lmeSIsInJlcGxhY2VyIiwia2V5IiwidmFsdWUiLCJwYXJzZUludCIsImV4cG9ydHMiLCJkb2N1bWVudGF0aW9uIl0sInNvdXJjZXMiOlsiLi4vLi4vc3JjL2Zvcm1hdHRlci91c2FnZV9qc29uX2Zvcm1hdHRlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBnZXRVc2FnZSB9IGZyb20gJy4vaGVscGVycydcbmltcG9ydCBGb3JtYXR0ZXIsIHsgSUZvcm1hdHRlck9wdGlvbnMgfSBmcm9tICcuLydcbmltcG9ydCB7IGRvZXNIYXZlVmFsdWUgfSBmcm9tICcuLi92YWx1ZV9jaGVja2VyJ1xuaW1wb3J0ICogYXMgbWVzc2FnZXMgZnJvbSAnQGN1Y3VtYmVyL21lc3NhZ2VzJ1xuaW1wb3J0IElFbnZlbG9wZSA9IG1lc3NhZ2VzLkVudmVsb3BlXG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFVzYWdlSnNvbkZvcm1hdHRlciBleHRlbmRzIEZvcm1hdHRlciB7XG4gIHB1YmxpYyBzdGF0aWMgcmVhZG9ubHkgZG9jdW1lbnRhdGlvbjogc3RyaW5nID1cbiAgICAnRG9lcyB3aGF0IHRoZSBVc2FnZSBGb3JtYXR0ZXIgZG9lcywgYnV0IG91dHB1dHMgSlNPTiwgd2hpY2ggY2FuIGJlIG91dHB1dCB0byBhIGZpbGUgYW5kIHRoZW4gY29uc3VtZWQgYnkgb3RoZXIgdG9vbHMuJ1xuXG4gIGNvbnN0cnVjdG9yKG9wdGlvbnM6IElGb3JtYXR0ZXJPcHRpb25zKSB7XG4gICAgc3VwZXIob3B0aW9ucylcbiAgICBvcHRpb25zLmV2ZW50QnJvYWRjYXN0ZXIub24oJ2VudmVsb3BlJywgKGVudmVsb3BlOiBJRW52ZWxvcGUpID0+IHtcbiAgICAgIGlmIChkb2VzSGF2ZVZhbHVlKGVudmVsb3BlLnRlc3RSdW5GaW5pc2hlZCkpIHtcbiAgICAgICAgdGhpcy5sb2dVc2FnZSgpXG4gICAgICB9XG4gICAgfSlcbiAgfVxuXG4gIGxvZ1VzYWdlKCk6IHZvaWQge1xuICAgIGNvbnN0IHVzYWdlID0gZ2V0VXNhZ2Uoe1xuICAgICAgc3RlcERlZmluaXRpb25zOiB0aGlzLnN1cHBvcnRDb2RlTGlicmFyeS5zdGVwRGVmaW5pdGlvbnMsXG4gICAgICBldmVudERhdGFDb2xsZWN0b3I6IHRoaXMuZXZlbnREYXRhQ29sbGVjdG9yLFxuICAgIH0pXG4gICAgdGhpcy5sb2coSlNPTi5zdHJpbmdpZnkodXNhZ2UsIHRoaXMucmVwbGFjZXIsIDIpKVxuICB9XG5cbiAgcmVwbGFjZXIoa2V5OiBzdHJpbmcsIHZhbHVlOiBhbnkpOiBhbnkge1xuICAgIGlmIChrZXkgPT09ICdzZWNvbmRzJykge1xuICAgICAgcmV0dXJuIHBhcnNlSW50KHZhbHVlKVxuICAgIH1cbiAgICByZXR1cm4gdmFsdWVcbiAgfVxufVxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0FBQUEsTUFBQUEsU0FBQSxHQUFBQyxPQUFBO0FBQ0EsTUFBQUMsRUFBQSxHQUFBQyxlQUFBLENBQUFGLE9BQUE7QUFDQSxNQUFBRyxlQUFBLEdBQUFILE9BQUE7QUFJQSxNQUFxQkksa0JBQW1CLFNBQVFILEVBQUEsQ0FBQUksT0FBUztFQUl2REMsWUFBWUMsT0FBMEI7SUFDcEMsS0FBSyxDQUFDQSxPQUFPLENBQUM7SUFDZEEsT0FBTyxDQUFDQyxnQkFBZ0IsQ0FBQ0MsRUFBRSxDQUFDLFVBQVUsRUFBR0MsUUFBbUIsSUFBSTtNQUM5RCxJQUFJLElBQUFQLGVBQUEsQ0FBQVEsYUFBYSxFQUFDRCxRQUFRLENBQUNFLGVBQWUsQ0FBQyxFQUFFO1FBQzNDLElBQUksQ0FBQ0MsUUFBUSxFQUFFOztJQUVuQixDQUFDLENBQUM7RUFDSjtFQUVBQSxRQUFRQSxDQUFBO0lBQ04sTUFBTUMsS0FBSyxHQUFHLElBQUFmLFNBQUEsQ0FBQWdCLFFBQVEsRUFBQztNQUNyQkMsZUFBZSxFQUFFLElBQUksQ0FBQ0Msa0JBQWtCLENBQUNELGVBQWU7TUFDeERFLGtCQUFrQixFQUFFLElBQUksQ0FBQ0E7S0FDMUIsQ0FBQztJQUNGLElBQUksQ0FBQ0MsR0FBRyxDQUFDQyxJQUFJLENBQUNDLFNBQVMsQ0FBQ1AsS0FBSyxFQUFFLElBQUksQ0FBQ1EsUUFBUSxFQUFFLENBQUMsQ0FBQyxDQUFDO0VBQ25EO0VBRUFBLFFBQVFBLENBQUNDLEdBQVcsRUFBRUMsS0FBVTtJQUM5QixJQUFJRCxHQUFHLEtBQUssU0FBUyxFQUFFO01BQ3JCLE9BQU9FLFFBQVEsQ0FBQ0QsS0FBSyxDQUFDOztJQUV4QixPQUFPQSxLQUFLO0VBQ2Q7O0FBMUJGRSxPQUFBLENBQUFyQixPQUFBLEdBQUFELGtCQUFBO0FBQ3lCQSxrQkFBQSxDQUFBdUIsYUFBYSxHQUNsQyx1SEFBdUgifQ==