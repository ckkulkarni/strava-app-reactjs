{"version":3,"names":["Alias","require","composeCollection","composeScalar","resolveEnd","utilEmptyScalarPosition","CN","composeNode","composeEmptyNode","ctx","token","props","onError","spaceBefore","comment","anchor","tag","node","isSrcToken","type","composeAlias","source","substring","message","offset","undefined","commentBefore","options","keepSourceTokens","srcToken","before","pos","end","emptyScalarPosition","indent","range","alias","endsWith","length","valueEnd","re","strict","exports"],"sources":["compose-node.js"],"sourcesContent":["'use strict';\n\nvar Alias = require('../nodes/Alias.js');\nvar composeCollection = require('./compose-collection.js');\nvar composeScalar = require('./compose-scalar.js');\nvar resolveEnd = require('./resolve-end.js');\nvar utilEmptyScalarPosition = require('./util-empty-scalar-position.js');\n\nconst CN = { composeNode, composeEmptyNode };\nfunction composeNode(ctx, token, props, onError) {\n    const { spaceBefore, comment, anchor, tag } = props;\n    let node;\n    let isSrcToken = true;\n    switch (token.type) {\n        case 'alias':\n            node = composeAlias(ctx, token, onError);\n            if (anchor || tag)\n                onError(token, 'ALIAS_PROPS', 'An alias node must not specify any properties');\n            break;\n        case 'scalar':\n        case 'single-quoted-scalar':\n        case 'double-quoted-scalar':\n        case 'block-scalar':\n            node = composeScalar.composeScalar(ctx, token, tag, onError);\n            if (anchor)\n                node.anchor = anchor.source.substring(1);\n            break;\n        case 'block-map':\n        case 'block-seq':\n        case 'flow-collection':\n            node = composeCollection.composeCollection(CN, ctx, token, tag, onError);\n            if (anchor)\n                node.anchor = anchor.source.substring(1);\n            break;\n        default: {\n            const message = token.type === 'error'\n                ? token.message\n                : `Unsupported token (type: ${token.type})`;\n            onError(token, 'UNEXPECTED_TOKEN', message);\n            node = composeEmptyNode(ctx, token.offset, undefined, null, props, onError);\n            isSrcToken = false;\n        }\n    }\n    if (anchor && node.anchor === '')\n        onError(anchor, 'BAD_ALIAS', 'Anchor cannot be an empty string');\n    if (spaceBefore)\n        node.spaceBefore = true;\n    if (comment) {\n        if (token.type === 'scalar' && token.source === '')\n            node.comment = comment;\n        else\n            node.commentBefore = comment;\n    }\n    // @ts-expect-error Type checking misses meaning of isSrcToken\n    if (ctx.options.keepSourceTokens && isSrcToken)\n        node.srcToken = token;\n    return node;\n}\nfunction composeEmptyNode(ctx, offset, before, pos, { spaceBefore, comment, anchor, tag, end }, onError) {\n    const token = {\n        type: 'scalar',\n        offset: utilEmptyScalarPosition.emptyScalarPosition(offset, before, pos),\n        indent: -1,\n        source: ''\n    };\n    const node = composeScalar.composeScalar(ctx, token, tag, onError);\n    if (anchor) {\n        node.anchor = anchor.source.substring(1);\n        if (node.anchor === '')\n            onError(anchor, 'BAD_ALIAS', 'Anchor cannot be an empty string');\n    }\n    if (spaceBefore)\n        node.spaceBefore = true;\n    if (comment) {\n        node.comment = comment;\n        node.range[2] = end;\n    }\n    return node;\n}\nfunction composeAlias({ options }, { offset, source, end }, onError) {\n    const alias = new Alias.Alias(source.substring(1));\n    if (alias.source === '')\n        onError(offset, 'BAD_ALIAS', 'Alias cannot be an empty string');\n    if (alias.source.endsWith(':'))\n        onError(offset + source.length - 1, 'BAD_ALIAS', 'Alias ending in : is ambiguous', true);\n    const valueEnd = offset + source.length;\n    const re = resolveEnd.resolveEnd(end, valueEnd, options.strict, onError);\n    alias.range = [offset, valueEnd, re.offset];\n    if (re.comment)\n        alias.comment = re.comment;\n    return alias;\n}\n\nexports.composeEmptyNode = composeEmptyNode;\nexports.composeNode = composeNode;\n"],"mappings":"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"}