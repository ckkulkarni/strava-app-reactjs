ac5a4a34326a471cd2d5e88940535635
"use strict";

var Stream = require('stream').Stream;
module.exports = legacy;
function legacy(fs) {
  return {
    ReadStream: ReadStream,
    WriteStream: WriteStream
  };
  function ReadStream(path, options) {
    if (!(this instanceof ReadStream)) return new ReadStream(path, options);
    Stream.call(this);
    var self = this;
    this.path = path;
    this.fd = null;
    this.readable = true;
    this.paused = false;
    this.flags = 'r';
    this.mode = 438; /*=0666*/
    this.bufferSize = 64 * 1024;
    options = options || {};

    // Mixin options into this
    var keys = Object.keys(options);
    for (var index = 0, length = keys.length; index < length; index++) {
      var key = keys[index];
      this[key] = options[key];
    }
    if (this.encoding) this.setEncoding(this.encoding);
    if (this.start !== undefined) {
      if ('number' !== typeof this.start) {
        throw TypeError('start must be a Number');
      }
      if (this.end === undefined) {
        this.end = Infinity;
      } else if ('number' !== typeof this.end) {
        throw TypeError('end must be a Number');
      }
      if (this.start > this.end) {
        throw new Error('start must be <= end');
      }
      this.pos = this.start;
    }
    if (this.fd !== null) {
      process.nextTick(function () {
        self._read();
      });
      return;
    }
    fs.open(this.path, this.flags, this.mode, function (err, fd) {
      if (err) {
        self.emit('error', err);
        self.readable = false;
        return;
      }
      self.fd = fd;
      self.emit('open', fd);
      self._read();
    });
  }
  function WriteStream(path, options) {
    if (!(this instanceof WriteStream)) return new WriteStream(path, options);
    Stream.call(this);
    this.path = path;
    this.fd = null;
    this.writable = true;
    this.flags = 'w';
    this.encoding = 'binary';
    this.mode = 438; /*=0666*/
    this.bytesWritten = 0;
    options = options || {};

    // Mixin options into this
    var keys = Object.keys(options);
    for (var index = 0, length = keys.length; index < length; index++) {
      var key = keys[index];
      this[key] = options[key];
    }
    if (this.start !== undefined) {
      if ('number' !== typeof this.start) {
        throw TypeError('start must be a Number');
      }
      if (this.start < 0) {
        throw new Error('start must be >= zero');
      }
      this.pos = this.start;
    }
    this.busy = false;
    this._queue = [];
    if (this.fd === null) {
      this._open = fs.open;
      this._queue.push([this._open, this.path, this.flags, this.mode, undefined]);
      this.flush();
    }
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJTdHJlYW0iLCJyZXF1aXJlIiwibW9kdWxlIiwiZXhwb3J0cyIsImxlZ2FjeSIsImZzIiwiUmVhZFN0cmVhbSIsIldyaXRlU3RyZWFtIiwicGF0aCIsIm9wdGlvbnMiLCJjYWxsIiwic2VsZiIsImZkIiwicmVhZGFibGUiLCJwYXVzZWQiLCJmbGFncyIsIm1vZGUiLCJidWZmZXJTaXplIiwia2V5cyIsIk9iamVjdCIsImluZGV4IiwibGVuZ3RoIiwia2V5IiwiZW5jb2RpbmciLCJzZXRFbmNvZGluZyIsInN0YXJ0IiwidW5kZWZpbmVkIiwiVHlwZUVycm9yIiwiZW5kIiwiSW5maW5pdHkiLCJFcnJvciIsInBvcyIsInByb2Nlc3MiLCJuZXh0VGljayIsIl9yZWFkIiwib3BlbiIsImVyciIsImVtaXQiLCJ3cml0YWJsZSIsImJ5dGVzV3JpdHRlbiIsImJ1c3kiLCJfcXVldWUiLCJfb3BlbiIsInB1c2giLCJmbHVzaCJdLCJzb3VyY2VzIjpbImxlZ2FjeS1zdHJlYW1zLmpzIl0sInNvdXJjZXNDb250ZW50IjpbInZhciBTdHJlYW0gPSByZXF1aXJlKCdzdHJlYW0nKS5TdHJlYW1cblxubW9kdWxlLmV4cG9ydHMgPSBsZWdhY3lcblxuZnVuY3Rpb24gbGVnYWN5IChmcykge1xuICByZXR1cm4ge1xuICAgIFJlYWRTdHJlYW06IFJlYWRTdHJlYW0sXG4gICAgV3JpdGVTdHJlYW06IFdyaXRlU3RyZWFtXG4gIH1cblxuICBmdW5jdGlvbiBSZWFkU3RyZWFtIChwYXRoLCBvcHRpb25zKSB7XG4gICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIFJlYWRTdHJlYW0pKSByZXR1cm4gbmV3IFJlYWRTdHJlYW0ocGF0aCwgb3B0aW9ucyk7XG5cbiAgICBTdHJlYW0uY2FsbCh0aGlzKTtcblxuICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgIHRoaXMucGF0aCA9IHBhdGg7XG4gICAgdGhpcy5mZCA9IG51bGw7XG4gICAgdGhpcy5yZWFkYWJsZSA9IHRydWU7XG4gICAgdGhpcy5wYXVzZWQgPSBmYWxzZTtcblxuICAgIHRoaXMuZmxhZ3MgPSAncic7XG4gICAgdGhpcy5tb2RlID0gNDM4OyAvKj0wNjY2Ki9cbiAgICB0aGlzLmJ1ZmZlclNpemUgPSA2NCAqIDEwMjQ7XG5cbiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcblxuICAgIC8vIE1peGluIG9wdGlvbnMgaW50byB0aGlzXG4gICAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhvcHRpb25zKTtcbiAgICBmb3IgKHZhciBpbmRleCA9IDAsIGxlbmd0aCA9IGtleXMubGVuZ3RoOyBpbmRleCA8IGxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgdmFyIGtleSA9IGtleXNbaW5kZXhdO1xuICAgICAgdGhpc1trZXldID0gb3B0aW9uc1trZXldO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmVuY29kaW5nKSB0aGlzLnNldEVuY29kaW5nKHRoaXMuZW5jb2RpbmcpO1xuXG4gICAgaWYgKHRoaXMuc3RhcnQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgaWYgKCdudW1iZXInICE9PSB0eXBlb2YgdGhpcy5zdGFydCkge1xuICAgICAgICB0aHJvdyBUeXBlRXJyb3IoJ3N0YXJ0IG11c3QgYmUgYSBOdW1iZXInKTtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLmVuZCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHRoaXMuZW5kID0gSW5maW5pdHk7XG4gICAgICB9IGVsc2UgaWYgKCdudW1iZXInICE9PSB0eXBlb2YgdGhpcy5lbmQpIHtcbiAgICAgICAgdGhyb3cgVHlwZUVycm9yKCdlbmQgbXVzdCBiZSBhIE51bWJlcicpO1xuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5zdGFydCA+IHRoaXMuZW5kKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignc3RhcnQgbXVzdCBiZSA8PSBlbmQnKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5wb3MgPSB0aGlzLnN0YXJ0O1xuICAgIH1cblxuICAgIGlmICh0aGlzLmZkICE9PSBudWxsKSB7XG4gICAgICBwcm9jZXNzLm5leHRUaWNrKGZ1bmN0aW9uKCkge1xuICAgICAgICBzZWxmLl9yZWFkKCk7XG4gICAgICB9KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBmcy5vcGVuKHRoaXMucGF0aCwgdGhpcy5mbGFncywgdGhpcy5tb2RlLCBmdW5jdGlvbiAoZXJyLCBmZCkge1xuICAgICAgaWYgKGVycikge1xuICAgICAgICBzZWxmLmVtaXQoJ2Vycm9yJywgZXJyKTtcbiAgICAgICAgc2VsZi5yZWFkYWJsZSA9IGZhbHNlO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHNlbGYuZmQgPSBmZDtcbiAgICAgIHNlbGYuZW1pdCgnb3BlbicsIGZkKTtcbiAgICAgIHNlbGYuX3JlYWQoKTtcbiAgICB9KVxuICB9XG5cbiAgZnVuY3Rpb24gV3JpdGVTdHJlYW0gKHBhdGgsIG9wdGlvbnMpIHtcbiAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgV3JpdGVTdHJlYW0pKSByZXR1cm4gbmV3IFdyaXRlU3RyZWFtKHBhdGgsIG9wdGlvbnMpO1xuXG4gICAgU3RyZWFtLmNhbGwodGhpcyk7XG5cbiAgICB0aGlzLnBhdGggPSBwYXRoO1xuICAgIHRoaXMuZmQgPSBudWxsO1xuICAgIHRoaXMud3JpdGFibGUgPSB0cnVlO1xuXG4gICAgdGhpcy5mbGFncyA9ICd3JztcbiAgICB0aGlzLmVuY29kaW5nID0gJ2JpbmFyeSc7XG4gICAgdGhpcy5tb2RlID0gNDM4OyAvKj0wNjY2Ki9cbiAgICB0aGlzLmJ5dGVzV3JpdHRlbiA9IDA7XG5cbiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcblxuICAgIC8vIE1peGluIG9wdGlvbnMgaW50byB0aGlzXG4gICAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhvcHRpb25zKTtcbiAgICBmb3IgKHZhciBpbmRleCA9IDAsIGxlbmd0aCA9IGtleXMubGVuZ3RoOyBpbmRleCA8IGxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgdmFyIGtleSA9IGtleXNbaW5kZXhdO1xuICAgICAgdGhpc1trZXldID0gb3B0aW9uc1trZXldO1xuICAgIH1cblxuICAgIGlmICh0aGlzLnN0YXJ0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGlmICgnbnVtYmVyJyAhPT0gdHlwZW9mIHRoaXMuc3RhcnQpIHtcbiAgICAgICAgdGhyb3cgVHlwZUVycm9yKCdzdGFydCBtdXN0IGJlIGEgTnVtYmVyJyk7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5zdGFydCA8IDApIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdzdGFydCBtdXN0IGJlID49IHplcm8nKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5wb3MgPSB0aGlzLnN0YXJ0O1xuICAgIH1cblxuICAgIHRoaXMuYnVzeSA9IGZhbHNlO1xuICAgIHRoaXMuX3F1ZXVlID0gW107XG5cbiAgICBpZiAodGhpcy5mZCA9PT0gbnVsbCkge1xuICAgICAgdGhpcy5fb3BlbiA9IGZzLm9wZW47XG4gICAgICB0aGlzLl9xdWV1ZS5wdXNoKFt0aGlzLl9vcGVuLCB0aGlzLnBhdGgsIHRoaXMuZmxhZ3MsIHRoaXMubW9kZSwgdW5kZWZpbmVkXSk7XG4gICAgICB0aGlzLmZsdXNoKCk7XG4gICAgfVxuICB9XG59XG4iXSwibWFwcGluZ3MiOiI7O0FBQUEsSUFBSUEsTUFBTSxHQUFHQyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUNELE1BQU07QUFFckNFLE1BQU0sQ0FBQ0MsT0FBTyxHQUFHQyxNQUFNO0FBRXZCLFNBQVNBLE1BQU1BLENBQUVDLEVBQUUsRUFBRTtFQUNuQixPQUFPO0lBQ0xDLFVBQVUsRUFBRUEsVUFBVTtJQUN0QkMsV0FBVyxFQUFFQTtFQUNmLENBQUM7RUFFRCxTQUFTRCxVQUFVQSxDQUFFRSxJQUFJLEVBQUVDLE9BQU8sRUFBRTtJQUNsQyxJQUFJLEVBQUUsSUFBSSxZQUFZSCxVQUFVLENBQUMsRUFBRSxPQUFPLElBQUlBLFVBQVUsQ0FBQ0UsSUFBSSxFQUFFQyxPQUFPLENBQUM7SUFFdkVULE1BQU0sQ0FBQ1UsSUFBSSxDQUFDLElBQUksQ0FBQztJQUVqQixJQUFJQyxJQUFJLEdBQUcsSUFBSTtJQUVmLElBQUksQ0FBQ0gsSUFBSSxHQUFHQSxJQUFJO0lBQ2hCLElBQUksQ0FBQ0ksRUFBRSxHQUFHLElBQUk7SUFDZCxJQUFJLENBQUNDLFFBQVEsR0FBRyxJQUFJO0lBQ3BCLElBQUksQ0FBQ0MsTUFBTSxHQUFHLEtBQUs7SUFFbkIsSUFBSSxDQUFDQyxLQUFLLEdBQUcsR0FBRztJQUNoQixJQUFJLENBQUNDLElBQUksR0FBRyxHQUFHLENBQUMsQ0FBQztJQUNqQixJQUFJLENBQUNDLFVBQVUsR0FBRyxFQUFFLEdBQUcsSUFBSTtJQUUzQlIsT0FBTyxHQUFHQSxPQUFPLElBQUksQ0FBQyxDQUFDOztJQUV2QjtJQUNBLElBQUlTLElBQUksR0FBR0MsTUFBTSxDQUFDRCxJQUFJLENBQUNULE9BQU8sQ0FBQztJQUMvQixLQUFLLElBQUlXLEtBQUssR0FBRyxDQUFDLEVBQUVDLE1BQU0sR0FBR0gsSUFBSSxDQUFDRyxNQUFNLEVBQUVELEtBQUssR0FBR0MsTUFBTSxFQUFFRCxLQUFLLEVBQUUsRUFBRTtNQUNqRSxJQUFJRSxHQUFHLEdBQUdKLElBQUksQ0FBQ0UsS0FBSyxDQUFDO01BQ3JCLElBQUksQ0FBQ0UsR0FBRyxDQUFDLEdBQUdiLE9BQU8sQ0FBQ2EsR0FBRyxDQUFDO0lBQzFCO0lBRUEsSUFBSSxJQUFJLENBQUNDLFFBQVEsRUFBRSxJQUFJLENBQUNDLFdBQVcsQ0FBQyxJQUFJLENBQUNELFFBQVEsQ0FBQztJQUVsRCxJQUFJLElBQUksQ0FBQ0UsS0FBSyxLQUFLQyxTQUFTLEVBQUU7TUFDNUIsSUFBSSxRQUFRLEtBQUssT0FBTyxJQUFJLENBQUNELEtBQUssRUFBRTtRQUNsQyxNQUFNRSxTQUFTLENBQUMsd0JBQXdCLENBQUM7TUFDM0M7TUFDQSxJQUFJLElBQUksQ0FBQ0MsR0FBRyxLQUFLRixTQUFTLEVBQUU7UUFDMUIsSUFBSSxDQUFDRSxHQUFHLEdBQUdDLFFBQVE7TUFDckIsQ0FBQyxNQUFNLElBQUksUUFBUSxLQUFLLE9BQU8sSUFBSSxDQUFDRCxHQUFHLEVBQUU7UUFDdkMsTUFBTUQsU0FBUyxDQUFDLHNCQUFzQixDQUFDO01BQ3pDO01BRUEsSUFBSSxJQUFJLENBQUNGLEtBQUssR0FBRyxJQUFJLENBQUNHLEdBQUcsRUFBRTtRQUN6QixNQUFNLElBQUlFLEtBQUssQ0FBQyxzQkFBc0IsQ0FBQztNQUN6QztNQUVBLElBQUksQ0FBQ0MsR0FBRyxHQUFHLElBQUksQ0FBQ04sS0FBSztJQUN2QjtJQUVBLElBQUksSUFBSSxDQUFDYixFQUFFLEtBQUssSUFBSSxFQUFFO01BQ3BCb0IsT0FBTyxDQUFDQyxRQUFRLENBQUMsWUFBVztRQUMxQnRCLElBQUksQ0FBQ3VCLEtBQUssRUFBRTtNQUNkLENBQUMsQ0FBQztNQUNGO0lBQ0Y7SUFFQTdCLEVBQUUsQ0FBQzhCLElBQUksQ0FBQyxJQUFJLENBQUMzQixJQUFJLEVBQUUsSUFBSSxDQUFDTyxLQUFLLEVBQUUsSUFBSSxDQUFDQyxJQUFJLEVBQUUsVUFBVW9CLEdBQUcsRUFBRXhCLEVBQUUsRUFBRTtNQUMzRCxJQUFJd0IsR0FBRyxFQUFFO1FBQ1B6QixJQUFJLENBQUMwQixJQUFJLENBQUMsT0FBTyxFQUFFRCxHQUFHLENBQUM7UUFDdkJ6QixJQUFJLENBQUNFLFFBQVEsR0FBRyxLQUFLO1FBQ3JCO01BQ0Y7TUFFQUYsSUFBSSxDQUFDQyxFQUFFLEdBQUdBLEVBQUU7TUFDWkQsSUFBSSxDQUFDMEIsSUFBSSxDQUFDLE1BQU0sRUFBRXpCLEVBQUUsQ0FBQztNQUNyQkQsSUFBSSxDQUFDdUIsS0FBSyxFQUFFO0lBQ2QsQ0FBQyxDQUFDO0VBQ0o7RUFFQSxTQUFTM0IsV0FBV0EsQ0FBRUMsSUFBSSxFQUFFQyxPQUFPLEVBQUU7SUFDbkMsSUFBSSxFQUFFLElBQUksWUFBWUYsV0FBVyxDQUFDLEVBQUUsT0FBTyxJQUFJQSxXQUFXLENBQUNDLElBQUksRUFBRUMsT0FBTyxDQUFDO0lBRXpFVCxNQUFNLENBQUNVLElBQUksQ0FBQyxJQUFJLENBQUM7SUFFakIsSUFBSSxDQUFDRixJQUFJLEdBQUdBLElBQUk7SUFDaEIsSUFBSSxDQUFDSSxFQUFFLEdBQUcsSUFBSTtJQUNkLElBQUksQ0FBQzBCLFFBQVEsR0FBRyxJQUFJO0lBRXBCLElBQUksQ0FBQ3ZCLEtBQUssR0FBRyxHQUFHO0lBQ2hCLElBQUksQ0FBQ1EsUUFBUSxHQUFHLFFBQVE7SUFDeEIsSUFBSSxDQUFDUCxJQUFJLEdBQUcsR0FBRyxDQUFDLENBQUM7SUFDakIsSUFBSSxDQUFDdUIsWUFBWSxHQUFHLENBQUM7SUFFckI5QixPQUFPLEdBQUdBLE9BQU8sSUFBSSxDQUFDLENBQUM7O0lBRXZCO0lBQ0EsSUFBSVMsSUFBSSxHQUFHQyxNQUFNLENBQUNELElBQUksQ0FBQ1QsT0FBTyxDQUFDO0lBQy9CLEtBQUssSUFBSVcsS0FBSyxHQUFHLENBQUMsRUFBRUMsTUFBTSxHQUFHSCxJQUFJLENBQUNHLE1BQU0sRUFBRUQsS0FBSyxHQUFHQyxNQUFNLEVBQUVELEtBQUssRUFBRSxFQUFFO01BQ2pFLElBQUlFLEdBQUcsR0FBR0osSUFBSSxDQUFDRSxLQUFLLENBQUM7TUFDckIsSUFBSSxDQUFDRSxHQUFHLENBQUMsR0FBR2IsT0FBTyxDQUFDYSxHQUFHLENBQUM7SUFDMUI7SUFFQSxJQUFJLElBQUksQ0FBQ0csS0FBSyxLQUFLQyxTQUFTLEVBQUU7TUFDNUIsSUFBSSxRQUFRLEtBQUssT0FBTyxJQUFJLENBQUNELEtBQUssRUFBRTtRQUNsQyxNQUFNRSxTQUFTLENBQUMsd0JBQXdCLENBQUM7TUFDM0M7TUFDQSxJQUFJLElBQUksQ0FBQ0YsS0FBSyxHQUFHLENBQUMsRUFBRTtRQUNsQixNQUFNLElBQUlLLEtBQUssQ0FBQyx1QkFBdUIsQ0FBQztNQUMxQztNQUVBLElBQUksQ0FBQ0MsR0FBRyxHQUFHLElBQUksQ0FBQ04sS0FBSztJQUN2QjtJQUVBLElBQUksQ0FBQ2UsSUFBSSxHQUFHLEtBQUs7SUFDakIsSUFBSSxDQUFDQyxNQUFNLEdBQUcsRUFBRTtJQUVoQixJQUFJLElBQUksQ0FBQzdCLEVBQUUsS0FBSyxJQUFJLEVBQUU7TUFDcEIsSUFBSSxDQUFDOEIsS0FBSyxHQUFHckMsRUFBRSxDQUFDOEIsSUFBSTtNQUNwQixJQUFJLENBQUNNLE1BQU0sQ0FBQ0UsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDRCxLQUFLLEVBQUUsSUFBSSxDQUFDbEMsSUFBSSxFQUFFLElBQUksQ0FBQ08sS0FBSyxFQUFFLElBQUksQ0FBQ0MsSUFBSSxFQUFFVSxTQUFTLENBQUMsQ0FBQztNQUMzRSxJQUFJLENBQUNrQixLQUFLLEVBQUU7SUFDZDtFQUNGO0FBQ0YifQ==