{"version":3,"names":["info","debug","require","utils","Cell","constructor","options","setOptions","x","y","indexOf","content","String","href","Error","colSpan","rowSpan","Object","defineProperty","get","mergeTableOptions","tableOptions","cells","optionsChars","chars","tableChars","CHAR_NAMES","forEach","name","setOption","truncate","style","tableStyle","head","border","fixedWidth","colWidths","lines","computeLines","desiredWidth","strlen","paddingLeft","paddingRight","desiredHeight","length","tableWordWrap","wordWrap","textWrap","i","wrapOnWordBoundary","tableWrapOnWordBoundary","wrapLines","split","computedLines","colorizeLines","map","line","hyperlink","init","widths","slice","heights","rowHeights","width","reduce","sumPlusOne","height","hAlign","colAligns","vAlign","rowAligns","drawRight","draw","lineNum","spanningCell","drawTop","drawBottom","padLen","Math","max","padTop","ceil","drawEmpty","forceTruncation","drawLine","index","push","_topLeftChar","repeat","wrapWithStyleColors","join","offset","leftChar","spanAbove","ColSpanCell","RowSpanCell","styleProperty","colors","e","forceTruncationSymbol","left","cellLeft","leftPadding","right","rightPadding","len","pad","stylizeLine","bottom","originalCell","originalY","cellOffset","findDimension","firstDefined","args","filter","v","undefined","shift","objA","objB","nameB","targetObj","nameA","charAt","toUpperCase","substr","dimensionTable","startingIndex","span","ret","a","b","module","exports"],"sources":["cell.js"],"sourcesContent":["const { info, debug } = require('./debug');\nconst utils = require('./utils');\n\nclass Cell {\n  /**\n   * A representation of a cell within the table.\n   * Implementations must have `init` and `draw` methods,\n   * as well as `colSpan`, `rowSpan`, `desiredHeight` and `desiredWidth` properties.\n   * @param options\n   * @constructor\n   */\n  constructor(options) {\n    this.setOptions(options);\n\n    /**\n     * Each cell will have it's `x` and `y` values set by the `layout-manager` prior to\n     * `init` being called;\n     * @type {Number}\n     */\n    this.x = null;\n    this.y = null;\n  }\n\n  setOptions(options) {\n    if (['boolean', 'number', 'string'].indexOf(typeof options) !== -1) {\n      options = { content: '' + options };\n    }\n    options = options || {};\n    this.options = options;\n    let content = options.content;\n    if (['boolean', 'number', 'string'].indexOf(typeof content) !== -1) {\n      this.content = String(content);\n    } else if (!content) {\n      this.content = this.options.href || '';\n    } else {\n      throw new Error('Content needs to be a primitive, got: ' + typeof content);\n    }\n    this.colSpan = options.colSpan || 1;\n    this.rowSpan = options.rowSpan || 1;\n    if (this.options.href) {\n      Object.defineProperty(this, 'href', {\n        get() {\n          return this.options.href;\n        },\n      });\n    }\n  }\n\n  mergeTableOptions(tableOptions, cells) {\n    this.cells = cells;\n\n    let optionsChars = this.options.chars || {};\n    let tableChars = tableOptions.chars;\n    let chars = (this.chars = {});\n    CHAR_NAMES.forEach(function (name) {\n      setOption(optionsChars, tableChars, name, chars);\n    });\n\n    this.truncate = this.options.truncate || tableOptions.truncate;\n\n    let style = (this.options.style = this.options.style || {});\n    let tableStyle = tableOptions.style;\n    setOption(style, tableStyle, 'padding-left', this);\n    setOption(style, tableStyle, 'padding-right', this);\n    this.head = style.head || tableStyle.head;\n    this.border = style.border || tableStyle.border;\n\n    this.fixedWidth = tableOptions.colWidths[this.x];\n    this.lines = this.computeLines(tableOptions);\n\n    this.desiredWidth = utils.strlen(this.content) + this.paddingLeft + this.paddingRight;\n    this.desiredHeight = this.lines.length;\n  }\n\n  computeLines(tableOptions) {\n    const tableWordWrap = tableOptions.wordWrap || tableOptions.textWrap;\n    const { wordWrap = tableWordWrap } = this.options;\n    if (this.fixedWidth && wordWrap) {\n      this.fixedWidth -= this.paddingLeft + this.paddingRight;\n      if (this.colSpan) {\n        let i = 1;\n        while (i < this.colSpan) {\n          this.fixedWidth += tableOptions.colWidths[this.x + i];\n          i++;\n        }\n      }\n      const { wrapOnWordBoundary: tableWrapOnWordBoundary = true } = tableOptions;\n      const { wrapOnWordBoundary = tableWrapOnWordBoundary } = this.options;\n      return this.wrapLines(utils.wordWrap(this.fixedWidth, this.content, wrapOnWordBoundary));\n    }\n    return this.wrapLines(this.content.split('\\n'));\n  }\n\n  wrapLines(computedLines) {\n    const lines = utils.colorizeLines(computedLines);\n    if (this.href) {\n      return lines.map((line) => utils.hyperlink(this.href, line));\n    }\n    return lines;\n  }\n\n  /**\n   * Initializes the Cells data structure.\n   *\n   * @param tableOptions - A fully populated set of tableOptions.\n   * In addition to the standard default values, tableOptions must have fully populated the\n   * `colWidths` and `rowWidths` arrays. Those arrays must have lengths equal to the number\n   * of columns or rows (respectively) in this table, and each array item must be a Number.\n   *\n   */\n  init(tableOptions) {\n    let x = this.x;\n    let y = this.y;\n    this.widths = tableOptions.colWidths.slice(x, x + this.colSpan);\n    this.heights = tableOptions.rowHeights.slice(y, y + this.rowSpan);\n    this.width = this.widths.reduce(sumPlusOne, -1);\n    this.height = this.heights.reduce(sumPlusOne, -1);\n\n    this.hAlign = this.options.hAlign || tableOptions.colAligns[x];\n    this.vAlign = this.options.vAlign || tableOptions.rowAligns[y];\n\n    this.drawRight = x + this.colSpan == tableOptions.colWidths.length;\n  }\n\n  /**\n   * Draws the given line of the cell.\n   * This default implementation defers to methods `drawTop`, `drawBottom`, `drawLine` and `drawEmpty`.\n   * @param lineNum - can be `top`, `bottom` or a numerical line number.\n   * @param spanningCell - will be a number if being called from a RowSpanCell, and will represent how\n   * many rows below it's being called from. Otherwise it's undefined.\n   * @returns {String} The representation of this line.\n   */\n  draw(lineNum, spanningCell) {\n    if (lineNum == 'top') return this.drawTop(this.drawRight);\n    if (lineNum == 'bottom') return this.drawBottom(this.drawRight);\n    let content = utils.truncate(this.content, 10, this.truncate);\n    if (!lineNum) {\n      info(`${this.y}-${this.x}: ${this.rowSpan - lineNum}x${this.colSpan} Cell ${content}`);\n    } else {\n      // debug(`${lineNum}-${this.x}: 1x${this.colSpan} RowSpanCell ${content}`);\n    }\n    let padLen = Math.max(this.height - this.lines.length, 0);\n    let padTop;\n    switch (this.vAlign) {\n      case 'center':\n        padTop = Math.ceil(padLen / 2);\n        break;\n      case 'bottom':\n        padTop = padLen;\n        break;\n      default:\n        padTop = 0;\n    }\n    if (lineNum < padTop || lineNum >= padTop + this.lines.length) {\n      return this.drawEmpty(this.drawRight, spanningCell);\n    }\n    let forceTruncation = this.lines.length > this.height && lineNum + 1 >= this.height;\n    return this.drawLine(lineNum - padTop, this.drawRight, forceTruncation, spanningCell);\n  }\n\n  /**\n   * Renders the top line of the cell.\n   * @param drawRight - true if this method should render the right edge of the cell.\n   * @returns {String}\n   */\n  drawTop(drawRight) {\n    let content = [];\n    if (this.cells) {\n      //TODO: cells should always exist - some tests don't fill it in though\n      this.widths.forEach(function (width, index) {\n        content.push(this._topLeftChar(index));\n        content.push(utils.repeat(this.chars[this.y == 0 ? 'top' : 'mid'], width));\n      }, this);\n    } else {\n      content.push(this._topLeftChar(0));\n      content.push(utils.repeat(this.chars[this.y == 0 ? 'top' : 'mid'], this.width));\n    }\n    if (drawRight) {\n      content.push(this.chars[this.y == 0 ? 'topRight' : 'rightMid']);\n    }\n    return this.wrapWithStyleColors('border', content.join(''));\n  }\n\n  _topLeftChar(offset) {\n    let x = this.x + offset;\n    let leftChar;\n    if (this.y == 0) {\n      leftChar = x == 0 ? 'topLeft' : offset == 0 ? 'topMid' : 'top';\n    } else {\n      if (x == 0) {\n        leftChar = 'leftMid';\n      } else {\n        leftChar = offset == 0 ? 'midMid' : 'bottomMid';\n        if (this.cells) {\n          //TODO: cells should always exist - some tests don't fill it in though\n          let spanAbove = this.cells[this.y - 1][x] instanceof Cell.ColSpanCell;\n          if (spanAbove) {\n            leftChar = offset == 0 ? 'topMid' : 'mid';\n          }\n          if (offset == 0) {\n            let i = 1;\n            while (this.cells[this.y][x - i] instanceof Cell.ColSpanCell) {\n              i++;\n            }\n            if (this.cells[this.y][x - i] instanceof Cell.RowSpanCell) {\n              leftChar = 'leftMid';\n            }\n          }\n        }\n      }\n    }\n    return this.chars[leftChar];\n  }\n\n  wrapWithStyleColors(styleProperty, content) {\n    if (this[styleProperty] && this[styleProperty].length) {\n      try {\n        let colors = require('@colors/colors/safe');\n        for (let i = this[styleProperty].length - 1; i >= 0; i--) {\n          colors = colors[this[styleProperty][i]];\n        }\n        return colors(content);\n      } catch (e) {\n        return content;\n      }\n    } else {\n      return content;\n    }\n  }\n\n  /**\n   * Renders a line of text.\n   * @param lineNum - Which line of text to render. This is not necessarily the line within the cell.\n   * There may be top-padding above the first line of text.\n   * @param drawRight - true if this method should render the right edge of the cell.\n   * @param forceTruncationSymbol - `true` if the rendered text should end with the truncation symbol even\n   * if the text fits. This is used when the cell is vertically truncated. If `false` the text should\n   * only include the truncation symbol if the text will not fit horizontally within the cell width.\n   * @param spanningCell - a number of if being called from a RowSpanCell. (how many rows below). otherwise undefined.\n   * @returns {String}\n   */\n  drawLine(lineNum, drawRight, forceTruncationSymbol, spanningCell) {\n    let left = this.chars[this.x == 0 ? 'left' : 'middle'];\n    if (this.x && spanningCell && this.cells) {\n      let cellLeft = this.cells[this.y + spanningCell][this.x - 1];\n      while (cellLeft instanceof ColSpanCell) {\n        cellLeft = this.cells[cellLeft.y][cellLeft.x - 1];\n      }\n      if (!(cellLeft instanceof RowSpanCell)) {\n        left = this.chars['rightMid'];\n      }\n    }\n    let leftPadding = utils.repeat(' ', this.paddingLeft);\n    let right = drawRight ? this.chars['right'] : '';\n    let rightPadding = utils.repeat(' ', this.paddingRight);\n    let line = this.lines[lineNum];\n    let len = this.width - (this.paddingLeft + this.paddingRight);\n    if (forceTruncationSymbol) line += this.truncate || '…';\n    let content = utils.truncate(line, len, this.truncate);\n    content = utils.pad(content, len, ' ', this.hAlign);\n    content = leftPadding + content + rightPadding;\n    return this.stylizeLine(left, content, right);\n  }\n\n  stylizeLine(left, content, right) {\n    left = this.wrapWithStyleColors('border', left);\n    right = this.wrapWithStyleColors('border', right);\n    if (this.y === 0) {\n      content = this.wrapWithStyleColors('head', content);\n    }\n    return left + content + right;\n  }\n\n  /**\n   * Renders the bottom line of the cell.\n   * @param drawRight - true if this method should render the right edge of the cell.\n   * @returns {String}\n   */\n  drawBottom(drawRight) {\n    let left = this.chars[this.x == 0 ? 'bottomLeft' : 'bottomMid'];\n    let content = utils.repeat(this.chars.bottom, this.width);\n    let right = drawRight ? this.chars['bottomRight'] : '';\n    return this.wrapWithStyleColors('border', left + content + right);\n  }\n\n  /**\n   * Renders a blank line of text within the cell. Used for top and/or bottom padding.\n   * @param drawRight - true if this method should render the right edge of the cell.\n   * @param spanningCell - a number of if being called from a RowSpanCell. (how many rows below). otherwise undefined.\n   * @returns {String}\n   */\n  drawEmpty(drawRight, spanningCell) {\n    let left = this.chars[this.x == 0 ? 'left' : 'middle'];\n    if (this.x && spanningCell && this.cells) {\n      let cellLeft = this.cells[this.y + spanningCell][this.x - 1];\n      while (cellLeft instanceof ColSpanCell) {\n        cellLeft = this.cells[cellLeft.y][cellLeft.x - 1];\n      }\n      if (!(cellLeft instanceof RowSpanCell)) {\n        left = this.chars['rightMid'];\n      }\n    }\n    let right = drawRight ? this.chars['right'] : '';\n    let content = utils.repeat(' ', this.width);\n    return this.stylizeLine(left, content, right);\n  }\n}\n\nclass ColSpanCell {\n  /**\n   * A Cell that doesn't do anything. It just draws empty lines.\n   * Used as a placeholder in column spanning.\n   * @constructor\n   */\n  constructor() {}\n\n  draw(lineNum) {\n    if (typeof lineNum === 'number') {\n      debug(`${this.y}-${this.x}: 1x1 ColSpanCell`);\n    }\n    return '';\n  }\n\n  init() {}\n\n  mergeTableOptions() {}\n}\n\nclass RowSpanCell {\n  /**\n   * A placeholder Cell for a Cell that spans multiple rows.\n   * It delegates rendering to the original cell, but adds the appropriate offset.\n   * @param originalCell\n   * @constructor\n   */\n  constructor(originalCell) {\n    this.originalCell = originalCell;\n  }\n\n  init(tableOptions) {\n    let y = this.y;\n    let originalY = this.originalCell.y;\n    this.cellOffset = y - originalY;\n    this.offset = findDimension(tableOptions.rowHeights, originalY, this.cellOffset);\n  }\n\n  draw(lineNum) {\n    if (lineNum == 'top') {\n      return this.originalCell.draw(this.offset, this.cellOffset);\n    }\n    if (lineNum == 'bottom') {\n      return this.originalCell.draw('bottom');\n    }\n    debug(`${this.y}-${this.x}: 1x${this.colSpan} RowSpanCell for ${this.originalCell.content}`);\n    return this.originalCell.draw(this.offset + 1 + lineNum);\n  }\n\n  mergeTableOptions() {}\n}\n\nfunction firstDefined(...args) {\n  return args.filter((v) => v !== undefined && v !== null).shift();\n}\n\n// HELPER FUNCTIONS\nfunction setOption(objA, objB, nameB, targetObj) {\n  let nameA = nameB.split('-');\n  if (nameA.length > 1) {\n    nameA[1] = nameA[1].charAt(0).toUpperCase() + nameA[1].substr(1);\n    nameA = nameA.join('');\n    targetObj[nameA] = firstDefined(objA[nameA], objA[nameB], objB[nameA], objB[nameB]);\n  } else {\n    targetObj[nameB] = firstDefined(objA[nameB], objB[nameB]);\n  }\n}\n\nfunction findDimension(dimensionTable, startingIndex, span) {\n  let ret = dimensionTable[startingIndex];\n  for (let i = 1; i < span; i++) {\n    ret += 1 + dimensionTable[startingIndex + i];\n  }\n  return ret;\n}\n\nfunction sumPlusOne(a, b) {\n  return a + b + 1;\n}\n\nlet CHAR_NAMES = [\n  'top',\n  'top-mid',\n  'top-left',\n  'top-right',\n  'bottom',\n  'bottom-mid',\n  'bottom-left',\n  'bottom-right',\n  'left',\n  'left-mid',\n  'mid',\n  'mid-mid',\n  'right',\n  'right-mid',\n  'middle',\n];\n\nmodule.exports = Cell;\nmodule.exports.ColSpanCell = ColSpanCell;\nmodule.exports.RowSpanCell = RowSpanCell;\n"],"mappings":"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"}