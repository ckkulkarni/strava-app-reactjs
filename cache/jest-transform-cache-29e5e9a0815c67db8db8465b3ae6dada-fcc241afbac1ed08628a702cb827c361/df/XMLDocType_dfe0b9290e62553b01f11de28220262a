4b0df39dc1203b19e6309d56f7ccc0aa
"use strict";

// Generated by CoffeeScript 2.4.1
(function () {
  var NodeType, XMLDTDAttList, XMLDTDElement, XMLDTDEntity, XMLDTDNotation, XMLDocType, XMLNamedNodeMap, XMLNode, isObject;
  ({
    isObject
  } = require('./Utility'));
  XMLNode = require('./XMLNode');
  NodeType = require('./NodeType');
  XMLDTDAttList = require('./XMLDTDAttList');
  XMLDTDEntity = require('./XMLDTDEntity');
  XMLDTDElement = require('./XMLDTDElement');
  XMLDTDNotation = require('./XMLDTDNotation');
  XMLNamedNodeMap = require('./XMLNamedNodeMap');

  // Represents doctype declaration
  module.exports = XMLDocType = function () {
    class XMLDocType extends XMLNode {
      // Initializes a new instance of `XMLDocType`

      // `parent` the document object

      // `pubID` public identifier of the external subset
      // `sysID` system identifier of the external subset
      constructor(parent, pubID, sysID) {
        var child, i, len, ref;
        super(parent);
        this.type = NodeType.DocType;
        // set DTD name to the name of the root node
        if (parent.children) {
          ref = parent.children;
          for (i = 0, len = ref.length; i < len; i++) {
            child = ref[i];
            if (child.type === NodeType.Element) {
              this.name = child.name;
              break;
            }
          }
        }
        this.documentObject = parent;
        // arguments may also be passed as an object
        if (isObject(pubID)) {
          ({
            pubID,
            sysID
          } = pubID);
        }
        if (sysID == null) {
          [sysID, pubID] = [pubID, sysID];
        }
        if (pubID != null) {
          this.pubID = this.stringify.dtdPubID(pubID);
        }
        if (sysID != null) {
          this.sysID = this.stringify.dtdSysID(sysID);
        }
      }

      // Creates an element type declaration

      // `name` element name
      // `value` element content (defaults to #PCDATA)
      element(name, value) {
        var child;
        child = new XMLDTDElement(this, name, value);
        this.children.push(child);
        return this;
      }

      // Creates an attribute declaration

      // `elementName` the name of the element containing this attribute
      // `attributeName` attribute name
      // `attributeType` type of the attribute (defaults to CDATA)
      // `defaultValueType` default value type (either #REQUIRED, #IMPLIED, #FIXED or
      //                    #DEFAULT) (defaults to #IMPLIED)
      // `defaultValue` default value of the attribute
      //                (only used for #FIXED or #DEFAULT)
      attList(elementName, attributeName, attributeType, defaultValueType, defaultValue) {
        var child;
        child = new XMLDTDAttList(this, elementName, attributeName, attributeType, defaultValueType, defaultValue);
        this.children.push(child);
        return this;
      }

      // Creates a general entity declaration

      // `name` the name of the entity
      // `value` internal entity value or an object with external entity details
      // `value.pubID` public identifier
      // `value.sysID` system identifier
      // `value.nData` notation declaration
      entity(name, value) {
        var child;
        child = new XMLDTDEntity(this, false, name, value);
        this.children.push(child);
        return this;
      }

      // Creates a parameter entity declaration

      // `name` the name of the entity
      // `value` internal entity value or an object with external entity details
      // `value.pubID` public identifier
      // `value.sysID` system identifier
      pEntity(name, value) {
        var child;
        child = new XMLDTDEntity(this, true, name, value);
        this.children.push(child);
        return this;
      }

      // Creates a NOTATION declaration

      // `name` the name of the notation
      // `value` an object with external entity details
      // `value.pubID` public identifier
      // `value.sysID` system identifier
      notation(name, value) {
        var child;
        child = new XMLDTDNotation(this, name, value);
        this.children.push(child);
        return this;
      }

      // Converts to string

      // `options.pretty` pretty prints the result
      // `options.indent` indentation for pretty print
      // `options.offset` how many indentations to add to every line for pretty print
      // `options.newline` newline sequence for pretty print
      toString(options) {
        return this.options.writer.docType(this, this.options.writer.filterOptions(options));
      }

      // Aliases
      ele(name, value) {
        return this.element(name, value);
      }
      att(elementName, attributeName, attributeType, defaultValueType, defaultValue) {
        return this.attList(elementName, attributeName, attributeType, defaultValueType, defaultValue);
      }
      ent(name, value) {
        return this.entity(name, value);
      }
      pent(name, value) {
        return this.pEntity(name, value);
      }
      not(name, value) {
        return this.notation(name, value);
      }
      up() {
        return this.root() || this.documentObject;
      }
      isEqualNode(node) {
        if (!super.isEqualNode(node)) {
          return false;
        }
        if (node.name !== this.name) {
          return false;
        }
        if (node.publicId !== this.publicId) {
          return false;
        }
        if (node.systemId !== this.systemId) {
          return false;
        }
        return true;
      }
    }
    ;

    // DOM level 1
    Object.defineProperty(XMLDocType.prototype, 'entities', {
      get: function () {
        var child, i, len, nodes, ref;
        nodes = {};
        ref = this.children;
        for (i = 0, len = ref.length; i < len; i++) {
          child = ref[i];
          if (child.type === NodeType.EntityDeclaration && !child.pe) {
            nodes[child.name] = child;
          }
        }
        return new XMLNamedNodeMap(nodes);
      }
    });
    Object.defineProperty(XMLDocType.prototype, 'notations', {
      get: function () {
        var child, i, len, nodes, ref;
        nodes = {};
        ref = this.children;
        for (i = 0, len = ref.length; i < len; i++) {
          child = ref[i];
          if (child.type === NodeType.NotationDeclaration) {
            nodes[child.name] = child;
          }
        }
        return new XMLNamedNodeMap(nodes);
      }
    });

    // DOM level 2
    Object.defineProperty(XMLDocType.prototype, 'publicId', {
      get: function () {
        return this.pubID;
      }
    });
    Object.defineProperty(XMLDocType.prototype, 'systemId', {
      get: function () {
        return this.sysID;
      }
    });
    Object.defineProperty(XMLDocType.prototype, 'internalSubset', {
      get: function () {
        throw new Error("This DOM method is not implemented." + this.debugInfo());
      }
    });
    return XMLDocType;
  }.call(this);
}).call(void 0);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJOb2RlVHlwZSIsIlhNTERUREF0dExpc3QiLCJYTUxEVERFbGVtZW50IiwiWE1MRFRERW50aXR5IiwiWE1MRFRETm90YXRpb24iLCJYTUxEb2NUeXBlIiwiWE1MTmFtZWROb2RlTWFwIiwiWE1MTm9kZSIsImlzT2JqZWN0IiwicmVxdWlyZSIsIm1vZHVsZSIsImV4cG9ydHMiLCJjb25zdHJ1Y3RvciIsInBhcmVudCIsInB1YklEIiwic3lzSUQiLCJjaGlsZCIsImkiLCJsZW4iLCJyZWYiLCJ0eXBlIiwiRG9jVHlwZSIsImNoaWxkcmVuIiwibGVuZ3RoIiwiRWxlbWVudCIsIm5hbWUiLCJkb2N1bWVudE9iamVjdCIsInN0cmluZ2lmeSIsImR0ZFB1YklEIiwiZHRkU3lzSUQiLCJlbGVtZW50IiwidmFsdWUiLCJwdXNoIiwiYXR0TGlzdCIsImVsZW1lbnROYW1lIiwiYXR0cmlidXRlTmFtZSIsImF0dHJpYnV0ZVR5cGUiLCJkZWZhdWx0VmFsdWVUeXBlIiwiZGVmYXVsdFZhbHVlIiwiZW50aXR5IiwicEVudGl0eSIsIm5vdGF0aW9uIiwidG9TdHJpbmciLCJvcHRpb25zIiwid3JpdGVyIiwiZG9jVHlwZSIsImZpbHRlck9wdGlvbnMiLCJlbGUiLCJhdHQiLCJlbnQiLCJwZW50Iiwibm90IiwidXAiLCJyb290IiwiaXNFcXVhbE5vZGUiLCJub2RlIiwicHVibGljSWQiLCJzeXN0ZW1JZCIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwicHJvdG90eXBlIiwiZ2V0Iiwibm9kZXMiLCJFbnRpdHlEZWNsYXJhdGlvbiIsInBlIiwiTm90YXRpb25EZWNsYXJhdGlvbiIsIkVycm9yIiwiZGVidWdJbmZvIiwiY2FsbCJdLCJzb3VyY2VzIjpbIlhNTERvY1R5cGUuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAyLjQuMVxuKGZ1bmN0aW9uKCkge1xuICB2YXIgTm9kZVR5cGUsIFhNTERUREF0dExpc3QsIFhNTERUREVsZW1lbnQsIFhNTERUREVudGl0eSwgWE1MRFRETm90YXRpb24sIFhNTERvY1R5cGUsIFhNTE5hbWVkTm9kZU1hcCwgWE1MTm9kZSwgaXNPYmplY3Q7XG5cbiAgKHtpc09iamVjdH0gPSByZXF1aXJlKCcuL1V0aWxpdHknKSk7XG5cbiAgWE1MTm9kZSA9IHJlcXVpcmUoJy4vWE1MTm9kZScpO1xuXG4gIE5vZGVUeXBlID0gcmVxdWlyZSgnLi9Ob2RlVHlwZScpO1xuXG4gIFhNTERUREF0dExpc3QgPSByZXF1aXJlKCcuL1hNTERUREF0dExpc3QnKTtcblxuICBYTUxEVERFbnRpdHkgPSByZXF1aXJlKCcuL1hNTERUREVudGl0eScpO1xuXG4gIFhNTERUREVsZW1lbnQgPSByZXF1aXJlKCcuL1hNTERUREVsZW1lbnQnKTtcblxuICBYTUxEVEROb3RhdGlvbiA9IHJlcXVpcmUoJy4vWE1MRFRETm90YXRpb24nKTtcblxuICBYTUxOYW1lZE5vZGVNYXAgPSByZXF1aXJlKCcuL1hNTE5hbWVkTm9kZU1hcCcpO1xuXG4gIC8vIFJlcHJlc2VudHMgZG9jdHlwZSBkZWNsYXJhdGlvblxuICBtb2R1bGUuZXhwb3J0cyA9IFhNTERvY1R5cGUgPSAoZnVuY3Rpb24oKSB7XG4gICAgY2xhc3MgWE1MRG9jVHlwZSBleHRlbmRzIFhNTE5vZGUge1xuICAgICAgLy8gSW5pdGlhbGl6ZXMgYSBuZXcgaW5zdGFuY2Ugb2YgYFhNTERvY1R5cGVgXG5cbiAgICAgIC8vIGBwYXJlbnRgIHRoZSBkb2N1bWVudCBvYmplY3RcblxuICAgICAgLy8gYHB1YklEYCBwdWJsaWMgaWRlbnRpZmllciBvZiB0aGUgZXh0ZXJuYWwgc3Vic2V0XG4gICAgICAvLyBgc3lzSURgIHN5c3RlbSBpZGVudGlmaWVyIG9mIHRoZSBleHRlcm5hbCBzdWJzZXRcbiAgICAgIGNvbnN0cnVjdG9yKHBhcmVudCwgcHViSUQsIHN5c0lEKSB7XG4gICAgICAgIHZhciBjaGlsZCwgaSwgbGVuLCByZWY7XG4gICAgICAgIHN1cGVyKHBhcmVudCk7XG4gICAgICAgIHRoaXMudHlwZSA9IE5vZGVUeXBlLkRvY1R5cGU7XG4gICAgICAgIC8vIHNldCBEVEQgbmFtZSB0byB0aGUgbmFtZSBvZiB0aGUgcm9vdCBub2RlXG4gICAgICAgIGlmIChwYXJlbnQuY2hpbGRyZW4pIHtcbiAgICAgICAgICByZWYgPSBwYXJlbnQuY2hpbGRyZW47XG4gICAgICAgICAgZm9yIChpID0gMCwgbGVuID0gcmVmLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgICAgICBjaGlsZCA9IHJlZltpXTtcbiAgICAgICAgICAgIGlmIChjaGlsZC50eXBlID09PSBOb2RlVHlwZS5FbGVtZW50KSB7XG4gICAgICAgICAgICAgIHRoaXMubmFtZSA9IGNoaWxkLm5hbWU7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLmRvY3VtZW50T2JqZWN0ID0gcGFyZW50O1xuICAgICAgICAvLyBhcmd1bWVudHMgbWF5IGFsc28gYmUgcGFzc2VkIGFzIGFuIG9iamVjdFxuICAgICAgICBpZiAoaXNPYmplY3QocHViSUQpKSB7XG4gICAgICAgICAgKHtwdWJJRCwgc3lzSUR9ID0gcHViSUQpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzeXNJRCA9PSBudWxsKSB7XG4gICAgICAgICAgW3N5c0lELCBwdWJJRF0gPSBbcHViSUQsIHN5c0lEXTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocHViSUQgIT0gbnVsbCkge1xuICAgICAgICAgIHRoaXMucHViSUQgPSB0aGlzLnN0cmluZ2lmeS5kdGRQdWJJRChwdWJJRCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHN5c0lEICE9IG51bGwpIHtcbiAgICAgICAgICB0aGlzLnN5c0lEID0gdGhpcy5zdHJpbmdpZnkuZHRkU3lzSUQoc3lzSUQpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIENyZWF0ZXMgYW4gZWxlbWVudCB0eXBlIGRlY2xhcmF0aW9uXG5cbiAgICAgIC8vIGBuYW1lYCBlbGVtZW50IG5hbWVcbiAgICAgIC8vIGB2YWx1ZWAgZWxlbWVudCBjb250ZW50IChkZWZhdWx0cyB0byAjUENEQVRBKVxuICAgICAgZWxlbWVudChuYW1lLCB2YWx1ZSkge1xuICAgICAgICB2YXIgY2hpbGQ7XG4gICAgICAgIGNoaWxkID0gbmV3IFhNTERUREVsZW1lbnQodGhpcywgbmFtZSwgdmFsdWUpO1xuICAgICAgICB0aGlzLmNoaWxkcmVuLnB1c2goY2hpbGQpO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgIH1cblxuICAgICAgLy8gQ3JlYXRlcyBhbiBhdHRyaWJ1dGUgZGVjbGFyYXRpb25cblxuICAgICAgLy8gYGVsZW1lbnROYW1lYCB0aGUgbmFtZSBvZiB0aGUgZWxlbWVudCBjb250YWluaW5nIHRoaXMgYXR0cmlidXRlXG4gICAgICAvLyBgYXR0cmlidXRlTmFtZWAgYXR0cmlidXRlIG5hbWVcbiAgICAgIC8vIGBhdHRyaWJ1dGVUeXBlYCB0eXBlIG9mIHRoZSBhdHRyaWJ1dGUgKGRlZmF1bHRzIHRvIENEQVRBKVxuICAgICAgLy8gYGRlZmF1bHRWYWx1ZVR5cGVgIGRlZmF1bHQgdmFsdWUgdHlwZSAoZWl0aGVyICNSRVFVSVJFRCwgI0lNUExJRUQsICNGSVhFRCBvclxuICAgICAgLy8gICAgICAgICAgICAgICAgICAgICNERUZBVUxUKSAoZGVmYXVsdHMgdG8gI0lNUExJRUQpXG4gICAgICAvLyBgZGVmYXVsdFZhbHVlYCBkZWZhdWx0IHZhbHVlIG9mIHRoZSBhdHRyaWJ1dGVcbiAgICAgIC8vICAgICAgICAgICAgICAgIChvbmx5IHVzZWQgZm9yICNGSVhFRCBvciAjREVGQVVMVClcbiAgICAgIGF0dExpc3QoZWxlbWVudE5hbWUsIGF0dHJpYnV0ZU5hbWUsIGF0dHJpYnV0ZVR5cGUsIGRlZmF1bHRWYWx1ZVR5cGUsIGRlZmF1bHRWYWx1ZSkge1xuICAgICAgICB2YXIgY2hpbGQ7XG4gICAgICAgIGNoaWxkID0gbmV3IFhNTERUREF0dExpc3QodGhpcywgZWxlbWVudE5hbWUsIGF0dHJpYnV0ZU5hbWUsIGF0dHJpYnV0ZVR5cGUsIGRlZmF1bHRWYWx1ZVR5cGUsIGRlZmF1bHRWYWx1ZSk7XG4gICAgICAgIHRoaXMuY2hpbGRyZW4ucHVzaChjaGlsZCk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgfVxuXG4gICAgICAvLyBDcmVhdGVzIGEgZ2VuZXJhbCBlbnRpdHkgZGVjbGFyYXRpb25cblxuICAgICAgLy8gYG5hbWVgIHRoZSBuYW1lIG9mIHRoZSBlbnRpdHlcbiAgICAgIC8vIGB2YWx1ZWAgaW50ZXJuYWwgZW50aXR5IHZhbHVlIG9yIGFuIG9iamVjdCB3aXRoIGV4dGVybmFsIGVudGl0eSBkZXRhaWxzXG4gICAgICAvLyBgdmFsdWUucHViSURgIHB1YmxpYyBpZGVudGlmaWVyXG4gICAgICAvLyBgdmFsdWUuc3lzSURgIHN5c3RlbSBpZGVudGlmaWVyXG4gICAgICAvLyBgdmFsdWUubkRhdGFgIG5vdGF0aW9uIGRlY2xhcmF0aW9uXG4gICAgICBlbnRpdHkobmFtZSwgdmFsdWUpIHtcbiAgICAgICAgdmFyIGNoaWxkO1xuICAgICAgICBjaGlsZCA9IG5ldyBYTUxEVERFbnRpdHkodGhpcywgZmFsc2UsIG5hbWUsIHZhbHVlKTtcbiAgICAgICAgdGhpcy5jaGlsZHJlbi5wdXNoKGNoaWxkKTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICB9XG5cbiAgICAgIC8vIENyZWF0ZXMgYSBwYXJhbWV0ZXIgZW50aXR5IGRlY2xhcmF0aW9uXG5cbiAgICAgIC8vIGBuYW1lYCB0aGUgbmFtZSBvZiB0aGUgZW50aXR5XG4gICAgICAvLyBgdmFsdWVgIGludGVybmFsIGVudGl0eSB2YWx1ZSBvciBhbiBvYmplY3Qgd2l0aCBleHRlcm5hbCBlbnRpdHkgZGV0YWlsc1xuICAgICAgLy8gYHZhbHVlLnB1YklEYCBwdWJsaWMgaWRlbnRpZmllclxuICAgICAgLy8gYHZhbHVlLnN5c0lEYCBzeXN0ZW0gaWRlbnRpZmllclxuICAgICAgcEVudGl0eShuYW1lLCB2YWx1ZSkge1xuICAgICAgICB2YXIgY2hpbGQ7XG4gICAgICAgIGNoaWxkID0gbmV3IFhNTERUREVudGl0eSh0aGlzLCB0cnVlLCBuYW1lLCB2YWx1ZSk7XG4gICAgICAgIHRoaXMuY2hpbGRyZW4ucHVzaChjaGlsZCk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgfVxuXG4gICAgICAvLyBDcmVhdGVzIGEgTk9UQVRJT04gZGVjbGFyYXRpb25cblxuICAgICAgLy8gYG5hbWVgIHRoZSBuYW1lIG9mIHRoZSBub3RhdGlvblxuICAgICAgLy8gYHZhbHVlYCBhbiBvYmplY3Qgd2l0aCBleHRlcm5hbCBlbnRpdHkgZGV0YWlsc1xuICAgICAgLy8gYHZhbHVlLnB1YklEYCBwdWJsaWMgaWRlbnRpZmllclxuICAgICAgLy8gYHZhbHVlLnN5c0lEYCBzeXN0ZW0gaWRlbnRpZmllclxuICAgICAgbm90YXRpb24obmFtZSwgdmFsdWUpIHtcbiAgICAgICAgdmFyIGNoaWxkO1xuICAgICAgICBjaGlsZCA9IG5ldyBYTUxEVEROb3RhdGlvbih0aGlzLCBuYW1lLCB2YWx1ZSk7XG4gICAgICAgIHRoaXMuY2hpbGRyZW4ucHVzaChjaGlsZCk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgfVxuXG4gICAgICAvLyBDb252ZXJ0cyB0byBzdHJpbmdcblxuICAgICAgLy8gYG9wdGlvbnMucHJldHR5YCBwcmV0dHkgcHJpbnRzIHRoZSByZXN1bHRcbiAgICAgIC8vIGBvcHRpb25zLmluZGVudGAgaW5kZW50YXRpb24gZm9yIHByZXR0eSBwcmludFxuICAgICAgLy8gYG9wdGlvbnMub2Zmc2V0YCBob3cgbWFueSBpbmRlbnRhdGlvbnMgdG8gYWRkIHRvIGV2ZXJ5IGxpbmUgZm9yIHByZXR0eSBwcmludFxuICAgICAgLy8gYG9wdGlvbnMubmV3bGluZWAgbmV3bGluZSBzZXF1ZW5jZSBmb3IgcHJldHR5IHByaW50XG4gICAgICB0b1N0cmluZyhvcHRpb25zKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm9wdGlvbnMud3JpdGVyLmRvY1R5cGUodGhpcywgdGhpcy5vcHRpb25zLndyaXRlci5maWx0ZXJPcHRpb25zKG9wdGlvbnMpKTtcbiAgICAgIH1cblxuICAgICAgLy8gQWxpYXNlc1xuICAgICAgZWxlKG5hbWUsIHZhbHVlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmVsZW1lbnQobmFtZSwgdmFsdWUpO1xuICAgICAgfVxuXG4gICAgICBhdHQoZWxlbWVudE5hbWUsIGF0dHJpYnV0ZU5hbWUsIGF0dHJpYnV0ZVR5cGUsIGRlZmF1bHRWYWx1ZVR5cGUsIGRlZmF1bHRWYWx1ZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5hdHRMaXN0KGVsZW1lbnROYW1lLCBhdHRyaWJ1dGVOYW1lLCBhdHRyaWJ1dGVUeXBlLCBkZWZhdWx0VmFsdWVUeXBlLCBkZWZhdWx0VmFsdWUpO1xuICAgICAgfVxuXG4gICAgICBlbnQobmFtZSwgdmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZW50aXR5KG5hbWUsIHZhbHVlKTtcbiAgICAgIH1cblxuICAgICAgcGVudChuYW1lLCB2YWx1ZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5wRW50aXR5KG5hbWUsIHZhbHVlKTtcbiAgICAgIH1cblxuICAgICAgbm90KG5hbWUsIHZhbHVlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm5vdGF0aW9uKG5hbWUsIHZhbHVlKTtcbiAgICAgIH1cblxuICAgICAgdXAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJvb3QoKSB8fCB0aGlzLmRvY3VtZW50T2JqZWN0O1xuICAgICAgfVxuXG4gICAgICBpc0VxdWFsTm9kZShub2RlKSB7XG4gICAgICAgIGlmICghc3VwZXIuaXNFcXVhbE5vZGUobm9kZSkpIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG5vZGUubmFtZSAhPT0gdGhpcy5uYW1lKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChub2RlLnB1YmxpY0lkICE9PSB0aGlzLnB1YmxpY0lkKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChub2RlLnN5c3RlbUlkICE9PSB0aGlzLnN5c3RlbUlkKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuXG4gICAgfTtcblxuICAgIC8vIERPTSBsZXZlbCAxXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFhNTERvY1R5cGUucHJvdG90eXBlLCAnZW50aXRpZXMnLCB7XG4gICAgICBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgY2hpbGQsIGksIGxlbiwgbm9kZXMsIHJlZjtcbiAgICAgICAgbm9kZXMgPSB7fTtcbiAgICAgICAgcmVmID0gdGhpcy5jaGlsZHJlbjtcbiAgICAgICAgZm9yIChpID0gMCwgbGVuID0gcmVmLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgICAgY2hpbGQgPSByZWZbaV07XG4gICAgICAgICAgaWYgKChjaGlsZC50eXBlID09PSBOb2RlVHlwZS5FbnRpdHlEZWNsYXJhdGlvbikgJiYgIWNoaWxkLnBlKSB7XG4gICAgICAgICAgICBub2Rlc1tjaGlsZC5uYW1lXSA9IGNoaWxkO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV3IFhNTE5hbWVkTm9kZU1hcChub2Rlcyk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoWE1MRG9jVHlwZS5wcm90b3R5cGUsICdub3RhdGlvbnMnLCB7XG4gICAgICBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgY2hpbGQsIGksIGxlbiwgbm9kZXMsIHJlZjtcbiAgICAgICAgbm9kZXMgPSB7fTtcbiAgICAgICAgcmVmID0gdGhpcy5jaGlsZHJlbjtcbiAgICAgICAgZm9yIChpID0gMCwgbGVuID0gcmVmLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgICAgY2hpbGQgPSByZWZbaV07XG4gICAgICAgICAgaWYgKGNoaWxkLnR5cGUgPT09IE5vZGVUeXBlLk5vdGF0aW9uRGVjbGFyYXRpb24pIHtcbiAgICAgICAgICAgIG5vZGVzW2NoaWxkLm5hbWVdID0gY2hpbGQ7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXcgWE1MTmFtZWROb2RlTWFwKG5vZGVzKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIERPTSBsZXZlbCAyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFhNTERvY1R5cGUucHJvdG90eXBlLCAncHVibGljSWQnLCB7XG4gICAgICBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5wdWJJRDtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShYTUxEb2NUeXBlLnByb3RvdHlwZSwgJ3N5c3RlbUlkJywge1xuICAgICAgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc3lzSUQ7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoWE1MRG9jVHlwZS5wcm90b3R5cGUsICdpbnRlcm5hbFN1YnNldCcsIHtcbiAgICAgIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIlRoaXMgRE9NIG1ldGhvZCBpcyBub3QgaW1wbGVtZW50ZWQuXCIgKyB0aGlzLmRlYnVnSW5mbygpKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHJldHVybiBYTUxEb2NUeXBlO1xuXG4gIH0pLmNhbGwodGhpcyk7XG5cbn0pLmNhbGwodGhpcyk7XG4iXSwibWFwcGluZ3MiOiI7O0FBQUE7QUFDQSxDQUFDLFlBQVc7RUFDVixJQUFJQSxRQUFRLEVBQUVDLGFBQWEsRUFBRUMsYUFBYSxFQUFFQyxZQUFZLEVBQUVDLGNBQWMsRUFBRUMsVUFBVSxFQUFF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