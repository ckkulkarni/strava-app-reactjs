{"version":3,"names":["Promise","require","assert","module","exports","thenify","fn","options","createWrapper","withCallback","createCallback","resolve","reject","multiArgs","undefined","err","value","length","arguments","Array","isArray","values","i","name","replace","newFn","self","len","lastType","apply","args","lastIndex","Object","defineProperty"],"sources":["index.js"],"sourcesContent":["\nvar Promise = require('any-promise')\nvar assert = require('assert')\n\nmodule.exports = thenify\n\n/**\n * Turn async functions into promises\n *\n * @param {Function} fn\n * @return {Function}\n * @api public\n */\n\nfunction thenify(fn, options) {\n  assert(typeof fn === 'function')\n  return createWrapper(fn, options)\n}\n\n/**\n * Turn async functions into promises and backward compatible with callback\n *\n * @param {Function} fn\n * @return {Function}\n * @api public\n */\n\nthenify.withCallback = function (fn, options) {\n  assert(typeof fn === 'function')\n  options = options || {}\n  options.withCallback = true\n  return createWrapper(fn, options)\n}\n\nfunction createCallback(resolve, reject, multiArgs) {\n  // default to true\n  if (multiArgs === undefined) multiArgs = true\n  return function(err, value) {\n    if (err) return reject(err)\n    var length = arguments.length\n\n    if (length <= 2 || !multiArgs) return resolve(value)\n\n    if (Array.isArray(multiArgs)) {\n      var values = {}\n      for (var i = 1; i < length; i++) values[multiArgs[i - 1]] = arguments[i]\n      return resolve(values)\n    }\n\n    var values = new Array(length - 1)\n    for (var i = 1; i < length; ++i) values[i - 1] = arguments[i]\n    resolve(values)\n  }\n}\n\nfunction createWrapper(fn, options) {\n  options = options || {}\n  var name = fn.name;\n  name = (name || '').replace(/\\s|bound(?!$)/g, '')\n  var newFn = function () {\n    var self = this\n    var len = arguments.length\n    if (options.withCallback) {\n      var lastType = typeof arguments[len - 1]\n      if (lastType === 'function') return fn.apply(self, arguments)\n    }\n    var args = new Array(len + 1)\n    for (var i = 0; i < len; ++i) args[i] = arguments[i]\n    var lastIndex = i\n    return new Promise(function (resolve, reject) {\n      args[lastIndex] = createCallback(resolve, reject, options.multiArgs)\n      fn.apply(self, args)\n    })\n  }\n  Object.defineProperty(newFn, 'name', { value: name })\n  return newFn\n}\n"],"mappings":"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"}