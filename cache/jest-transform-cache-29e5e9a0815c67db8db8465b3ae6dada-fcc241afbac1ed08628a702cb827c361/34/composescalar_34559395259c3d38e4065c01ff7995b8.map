{"version":3,"names":["Node","require","Scalar","resolveBlockScalar","resolveFlowScalar","composeScalar","ctx","token","tagToken","onError","value","type","comment","range","options","strict","tagName","directives","source","msg","tag","findScalarTagByName","schema","findScalarTagByTest","SCALAR","scalar","res","resolve","isScalar","error","Error","message","String","format","matchWithTest","tags","collection","default","test","push","kt","knownTags","Object","assign","undefined","find","compat","ts","tagString","cs","exports"],"sources":["compose-scalar.js"],"sourcesContent":["'use strict';\n\nvar Node = require('../nodes/Node.js');\nvar Scalar = require('../nodes/Scalar.js');\nvar resolveBlockScalar = require('./resolve-block-scalar.js');\nvar resolveFlowScalar = require('./resolve-flow-scalar.js');\n\nfunction composeScalar(ctx, token, tagToken, onError) {\n    const { value, type, comment, range } = token.type === 'block-scalar'\n        ? resolveBlockScalar.resolveBlockScalar(token, ctx.options.strict, onError)\n        : resolveFlowScalar.resolveFlowScalar(token, ctx.options.strict, onError);\n    const tagName = tagToken\n        ? ctx.directives.tagName(tagToken.source, msg => onError(tagToken, 'TAG_RESOLVE_FAILED', msg))\n        : null;\n    const tag = tagToken && tagName\n        ? findScalarTagByName(ctx.schema, value, tagName, tagToken, onError)\n        : token.type === 'scalar'\n            ? findScalarTagByTest(ctx, value, token, onError)\n            : ctx.schema[Node.SCALAR];\n    let scalar;\n    try {\n        const res = tag.resolve(value, msg => onError(tagToken ?? token, 'TAG_RESOLVE_FAILED', msg), ctx.options);\n        scalar = Node.isScalar(res) ? res : new Scalar.Scalar(res);\n    }\n    catch (error) {\n        const msg = error instanceof Error ? error.message : String(error);\n        onError(tagToken ?? token, 'TAG_RESOLVE_FAILED', msg);\n        scalar = new Scalar.Scalar(value);\n    }\n    scalar.range = range;\n    scalar.source = value;\n    if (type)\n        scalar.type = type;\n    if (tagName)\n        scalar.tag = tagName;\n    if (tag.format)\n        scalar.format = tag.format;\n    if (comment)\n        scalar.comment = comment;\n    return scalar;\n}\nfunction findScalarTagByName(schema, value, tagName, tagToken, onError) {\n    if (tagName === '!')\n        return schema[Node.SCALAR]; // non-specific tag\n    const matchWithTest = [];\n    for (const tag of schema.tags) {\n        if (!tag.collection && tag.tag === tagName) {\n            if (tag.default && tag.test)\n                matchWithTest.push(tag);\n            else\n                return tag;\n        }\n    }\n    for (const tag of matchWithTest)\n        if (tag.test?.test(value))\n            return tag;\n    const kt = schema.knownTags[tagName];\n    if (kt && !kt.collection) {\n        // Ensure that the known tag is available for stringifying,\n        // but does not get used by default.\n        schema.tags.push(Object.assign({}, kt, { default: false, test: undefined }));\n        return kt;\n    }\n    onError(tagToken, 'TAG_RESOLVE_FAILED', `Unresolved tag: ${tagName}`, tagName !== 'tag:yaml.org,2002:str');\n    return schema[Node.SCALAR];\n}\nfunction findScalarTagByTest({ directives, schema }, value, token, onError) {\n    const tag = schema.tags.find(tag => tag.default && tag.test?.test(value)) || schema[Node.SCALAR];\n    if (schema.compat) {\n        const compat = schema.compat.find(tag => tag.default && tag.test?.test(value)) ??\n            schema[Node.SCALAR];\n        if (tag.tag !== compat.tag) {\n            const ts = directives.tagString(tag.tag);\n            const cs = directives.tagString(compat.tag);\n            const msg = `Value may be parsed as either ${ts} or ${cs}`;\n            onError(token, 'TAG_RESOLVE_FAILED', msg, true);\n        }\n    }\n    return tag;\n}\n\nexports.composeScalar = composeScalar;\n"],"mappings":"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"}