{"version":3,"names":["Object","defineProperty","exports","value","default","sortFields","_has","_interopRequireDefault","require","_toposort","_propertyExpr","_Reference","_isSchema","obj","__esModule","fields","excludedEdges","edges","nodes","Set","excludes","map","a","b","addNode","depPath","key","node","split","add","has","push","isRef","isSibling","path","deps","forEach","array","Array","from","reverse"],"sources":["sortFields.js"],"sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = sortFields;\n\nvar _has = _interopRequireDefault(require(\"lodash/has\"));\n\nvar _toposort = _interopRequireDefault(require(\"toposort\"));\n\nvar _propertyExpr = require(\"property-expr\");\n\nvar _Reference = _interopRequireDefault(require(\"../Reference\"));\n\nvar _isSchema = _interopRequireDefault(require(\"./isSchema\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// @ts-expect-error\nfunction sortFields(fields, excludedEdges = []) {\n  let edges = [];\n  let nodes = new Set();\n  let excludes = new Set(excludedEdges.map(([a, b]) => `${a}-${b}`));\n\n  function addNode(depPath, key) {\n    let node = (0, _propertyExpr.split)(depPath)[0];\n    nodes.add(node);\n    if (!excludes.has(`${key}-${node}`)) edges.push([key, node]);\n  }\n\n  for (const key in fields) if ((0, _has.default)(fields, key)) {\n    let value = fields[key];\n    nodes.add(key);\n    if (_Reference.default.isRef(value) && value.isSibling) addNode(value.path, key);else if ((0, _isSchema.default)(value) && 'deps' in value) value.deps.forEach(path => addNode(path, key));\n  }\n\n  return _toposort.default.array(Array.from(nodes), edges).reverse();\n}"],"mappings":"AAAA,YAAY;;AAEZA,MAAM,CAACC,cAAc,CAACC,OAAO,EAAE,YAAY,EAAE;EAC3CC,KAAK,EAAE;AACT,CAAC,CAAC;AACFD,OAAO,CAACE,OAAO,GAAGC,UAAU;AAE5B,IAAIC,IAAI,GAAGC,sBAAsB,CAACC,OAAO,CAAC,YAAY,CAAC,CAAC;AAExD,IAAIC,SAAS,GAAGF,sBAAsB,CAACC,OAAO,CAAC,UAAU,CAAC,CAAC;AAE3D,IAAIE,aAAa,GAAGF,OAAO,CAAC,eAAe,CAAC;AAE5C,IAAIG,UAAU,GAAGJ,sBAAsB,CAACC,OAAO,CAAC,cAAc,CAAC,CAAC;AAEhE,IAAII,SAAS,GAAGL,sBAAsB,CAACC,OAAO,CAAC,YAAY,CAAC,CAAC;AAE7D,SAASD,sBAAsBA,CAACM,GAAG,EAAE;EAAE,OAAOA,GAAG,IAAIA,GAAG,CAACC,UAAU,GAAGD,GAAG,GAAG;IAAET,OAAO,EAAES;EAAI,CAAC;AAAE;;AAE9F;AACA,SAASR,UAAUA,CAACU,MAAM,EAAEC,aAAa,GAAG,EAAE,EAAE;EAC9C,IAAIC,KAAK,GAAG,EAAE;EACd,IAAIC,KAAK,GAAG,IAAIC,GAAG,EAAE;EACrB,IAAIC,QAAQ,GAAG,IAAID,GAAG,CAACH,aAAa,CAACK,GAAG,CAAC,CAAC,CAACC,CAAC,EAAEC,CAAC,CAAC,KAAM,GAAED,CAAE,IAAGC,CAAE,EAAC,CAAC,CAAC;EAElE,SAASC,OAAOA,CAACC,OAAO,EAAEC,GAAG,EAAE;IAC7B,IAAIC,IAAI,GAAG,CAAC,CAAC,EAAEjB,aAAa,CAACkB,KAAK,EAAEH,OAAO,CAAC,CAAC,CAAC,CAAC;IAC/CP,KAAK,CAACW,GAAG,CAACF,IAAI,CAAC;IACf,IAAI,CAACP,QAAQ,CAACU,GAAG,CAAE,GAAEJ,GAAI,IAAGC,IAAK,EAAC,CAAC,EAAEV,KAAK,CAACc,IAAI,CAAC,CAACL,GAAG,EAAEC,IAAI,CAAC,CAAC;EAC9D;EAEA,KAAK,MAAMD,GAAG,IAAIX,MAAM,EAAE,IAAI,CAAC,CAAC,EAAET,IAAI,CAACF,OAAO,EAAEW,MAAM,EAAEW,GAAG,CAAC,EAAE;IAC5D,IAAIvB,KAAK,GAAGY,MAAM,CAACW,GAAG,CAAC;IACvBR,KAAK,CAACW,GAAG,CAACH,GAAG,CAAC;IACd,IAAIf,UAAU,CAACP,OAAO,CAAC4B,KAAK,CAAC7B,KAAK,CAAC,IAAIA,KAAK,CAAC8B,SAAS,EAAET,OAAO,CAACrB,KAAK,CAAC+B,IAAI,EAAER,GAAG,CAAC,CAAC,KAAK,IAAI,CAAC,CAAC,EAAEd,SAAS,CAACR,OAAO,EAAED,KAAK,CAAC,IAAI,MAAM,IAAIA,KAAK,EAAEA,KAAK,CAACgC,IAAI,CAACC,OAAO,CAACF,IAAI,IAAIV,OAAO,CAACU,IAAI,EAAER,GAAG,CAAC,CAAC;EAC5L;EAEA,OAAOjB,SAAS,CAACL,OAAO,CAACiC,KAAK,CAACC,KAAK,CAACC,IAAI,CAACrB,KAAK,CAAC,EAAED,KAAK,CAAC,CAACuB,OAAO,EAAE;AACpE"}