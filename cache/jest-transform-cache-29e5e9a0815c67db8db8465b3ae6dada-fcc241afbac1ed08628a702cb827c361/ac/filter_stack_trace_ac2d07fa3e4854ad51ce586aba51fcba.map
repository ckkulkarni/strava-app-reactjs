{"version":3,"names":["path_1","__importDefault","require","value_checker_1","projectRootPath","default","join","__dirname","projectChildDirs","isFileNameInCucumber","fileName","some","dir","startsWith","exports","filterStackTrace","frames","isErrorInCucumber","index","findIndex","x","isFrameInCucumber","slice","filteredFrames","filter","isFrameInNode","length","frame","valueOrDefault","getFileName","includes","sep"],"sources":["../src/filter_stack_trace.ts"],"sourcesContent":["import path from 'path'\nimport { valueOrDefault } from './value_checker'\nimport { StackFrame } from 'error-stack-parser'\n\nconst projectRootPath = path.join(__dirname, '..')\nconst projectChildDirs = ['src', 'lib', 'node_modules']\n\nexport function isFileNameInCucumber(fileName: string): boolean {\n  return projectChildDirs.some((dir) =>\n    fileName.startsWith(path.join(projectRootPath, dir))\n  )\n}\n\nexport function filterStackTrace(frames: StackFrame[]): StackFrame[] {\n  if (isErrorInCucumber(frames)) {\n    return frames\n  }\n  const index = frames.findIndex((x) => isFrameInCucumber(x))\n  if (index === -1) {\n    return frames\n  }\n  return frames.slice(0, index)\n}\n\nfunction isErrorInCucumber(frames: StackFrame[]): boolean {\n  const filteredFrames = frames.filter((x) => !isFrameInNode(x))\n  return filteredFrames.length > 0 && isFrameInCucumber(filteredFrames[0])\n}\n\nfunction isFrameInCucumber(frame: StackFrame): boolean {\n  const fileName = valueOrDefault(frame.getFileName(), '')\n  return isFileNameInCucumber(fileName)\n}\n\nfunction isFrameInNode(frame: StackFrame): boolean {\n  const fileName = valueOrDefault(frame.getFileName(), '')\n  return !fileName.includes(path.sep)\n}\n"],"mappings":";;;;;;;;;;;AAAA,MAAAA,MAAA,GAAAC,eAAA,CAAAC,OAAA;AACA,MAAAC,eAAA,GAAAD,OAAA;AAGA,MAAME,eAAe,GAAGJ,MAAA,CAAAK,OAAI,CAACC,IAAI,CAACC,SAAS,EAAE,IAAI,CAAC;AAClD,MAAMC,gBAAgB,GAAG,CAAC,KAAK,EAAE,KAAK,EAAE,cAAc,CAAC;AAEvD,SAAgBC,oBAAoBA,CAACC,QAAgB;EACnD,OAAOF,gBAAgB,CAACG,IAAI,CAAEC,GAAG,IAC/BF,QAAQ,CAACG,UAAU,CAACb,MAAA,CAAAK,OAAI,CAACC,IAAI,CAACF,eAAe,EAAEQ,GAAG,CAAC,CAAC,CACrD;AACH;AAJAE,OAAA,CAAAL,oBAAA,GAAAA,oBAAA;AAMA,SAAgBM,gBAAgBA,CAACC,MAAoB;EACnD,IAAIC,iBAAiB,CAACD,MAAM,CAAC,EAAE;IAC7B,OAAOA,MAAM;;EAEf,MAAME,KAAK,GAAGF,MAAM,CAACG,SAAS,CAAEC,CAAC,IAAKC,iBAAiB,CAACD,CAAC,CAAC,CAAC;EAC3D,IAAIF,KAAK,KAAK,CAAC,CAAC,EAAE;IAChB,OAAOF,MAAM;;EAEf,OAAOA,MAAM,CAACM,KAAK,CAAC,CAAC,EAAEJ,KAAK,CAAC;AAC/B;AATAJ,OAAA,CAAAC,gBAAA,GAAAA,gBAAA;AAWA,SAASE,iBAAiBA,CAACD,MAAoB;EAC7C,MAAMO,cAAc,GAAGP,MAAM,CAACQ,MAAM,CAAEJ,CAAC,IAAK,CAACK,aAAa,CAACL,CAAC,CAAC,CAAC;EAC9D,OAAOG,cAAc,CAACG,MAAM,GAAG,CAAC,IAAIL,iBAAiB,CAACE,cAAc,CAAC,CAAC,CAAC,CAAC;AAC1E;AAEA,SAASF,iBAAiBA,CAACM,KAAiB;EAC1C,MAAMjB,QAAQ,GAAG,IAAAP,eAAA,CAAAyB,cAAc,EAACD,KAAK,CAACE,WAAW,EAAE,EAAE,EAAE,CAAC;EACxD,OAAOpB,oBAAoB,CAACC,QAAQ,CAAC;AACvC;AAEA,SAASe,aAAaA,CAACE,KAAiB;EACtC,MAAMjB,QAAQ,GAAG,IAAAP,eAAA,CAAAyB,cAAc,EAACD,KAAK,CAACE,WAAW,EAAE,EAAE,EAAE,CAAC;EACxD,OAAO,CAACnB,QAAQ,CAACoB,QAAQ,CAAC9B,MAAA,CAAAK,OAAI,CAAC0B,GAAG,CAAC;AACrC"}