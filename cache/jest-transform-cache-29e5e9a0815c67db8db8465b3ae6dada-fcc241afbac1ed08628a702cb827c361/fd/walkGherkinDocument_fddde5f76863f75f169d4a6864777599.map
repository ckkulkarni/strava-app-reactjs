{"version":3,"names":["walkGherkinDocument","gherkinDocument","initialValue","handlers","acc","h","Object","assign","makeDefaultHandlers","feature","walkTags","tags","child","children","background","walkStepContainer","scenario","rule","ruleChild","reduce","tag","walkSteps","steps","step","walkStep","docString","dataTable","walkTableRows","rows","tableRows","tableRow","walkTableRow","cells","tableCell","stepContainer","examples","tableHeader","tableBody","exports","defaultHandlers","comment"],"sources":["../../src/walkGherkinDocument.ts"],"sourcesContent":["import * as messages from '@cucumber/messages'\nimport { GherkinDocumentHandlers } from './GherkinDocumentHandlers'\n\n/**\n * Walks a Gherkin Document, visiting each node depth first (in the order they appear in the source)\n *\n * @param gherkinDocument\n * @param initialValue the initial value of the traversal\n * @param handlers handlers for each node type, which may return a new value\n * @return result the final value\n */\nexport function walkGherkinDocument<Acc>(\n  gherkinDocument: messages.GherkinDocument,\n  initialValue: Acc,\n  handlers: Partial<GherkinDocumentHandlers<Acc>>\n): Acc {\n  let acc = initialValue\n  const h: GherkinDocumentHandlers<Acc> = { ...makeDefaultHandlers<Acc>(), ...handlers }\n  const feature = gherkinDocument.feature\n  if (!feature) return acc\n  acc = walkTags(feature.tags || [], acc)\n  acc = h.feature(feature, acc)\n\n  for (const child of feature.children) {\n    if (child.background) {\n      acc = walkStepContainer(child.background, acc)\n    } else if (child.scenario) {\n      acc = walkStepContainer(child.scenario, acc)\n    } else if (child.rule) {\n      acc = walkTags(child.rule.tags || [], acc)\n      acc = h.rule(child.rule, acc)\n      for (const ruleChild of child.rule.children) {\n        if (ruleChild.background) {\n          acc = walkStepContainer(ruleChild.background, acc)\n        } else if (ruleChild.scenario) {\n          acc = walkStepContainer(ruleChild.scenario, acc)\n        }\n      }\n    }\n  }\n  return acc\n\n  function walkTags(tags: readonly messages.Tag[], acc: Acc): Acc {\n    return tags.reduce((acc, tag) => h.tag(tag, acc), acc)\n  }\n\n  function walkSteps(steps: readonly messages.Step[], acc: Acc): Acc {\n    return steps.reduce((acc, step) => walkStep(step, acc), acc)\n  }\n\n  function walkStep(step: messages.Step, acc: Acc): Acc {\n    acc = h.step(step, acc)\n    if (step.docString) {\n      acc = h.docString(step.docString, acc)\n    }\n    if (step.dataTable) {\n      acc = h.dataTable(step.dataTable, acc)\n      acc = walkTableRows(step.dataTable.rows, acc)\n    }\n    return acc\n  }\n\n  function walkTableRows(tableRows: readonly messages.TableRow[], acc: Acc): Acc {\n    return tableRows.reduce((acc, tableRow) => walkTableRow(tableRow, acc), acc)\n  }\n\n  function walkTableRow(tableRow: messages.TableRow, acc: Acc): Acc {\n    acc = h.tableRow(tableRow, acc)\n    return tableRow.cells.reduce((acc, tableCell) => h.tableCell(tableCell, acc), acc)\n  }\n\n  function walkStepContainer(\n    stepContainer: messages.Scenario | messages.Background,\n    acc: Acc\n  ): Acc {\n    const scenario: messages.Scenario = 'tags' in stepContainer ? stepContainer : null\n    acc = walkTags(scenario?.tags || [], acc)\n    acc = scenario\n      ? h.scenario(scenario, acc)\n      : h.background(stepContainer as messages.Background, acc)\n    acc = walkSteps(stepContainer.steps, acc)\n\n    if (scenario) {\n      for (const examples of scenario.examples || []) {\n        acc = walkTags(examples.tags || [], acc)\n        acc = h.examples(examples, acc)\n        if (examples.tableHeader) {\n          acc = walkTableRow(examples.tableHeader, acc)\n          acc = walkTableRows(examples.tableBody || [], acc)\n        }\n      }\n    }\n    return acc\n  }\n}\n\nfunction makeDefaultHandlers<Acc>() {\n  const defaultHandlers: GherkinDocumentHandlers<Acc> = {\n    feature(feature, acc) {\n      return acc\n    },\n    background(background, acc) {\n      return acc\n    },\n    rule(rule, acc) {\n      return acc\n    },\n    scenario(scenario, acc) {\n      return acc\n    },\n    step(step, acc) {\n      return acc\n    },\n    examples(examples, acc) {\n      return acc\n    },\n    tag(tag, acc) {\n      return acc\n    },\n    comment(comment, acc) {\n      return acc\n    },\n    dataTable(dataTable, acc) {\n      return acc\n    },\n    tableRow(tableRow, acc) {\n      return acc\n    },\n    tableCell(tableCell, acc) {\n      return acc\n    },\n    docString(docString, acc) {\n      return acc\n    },\n  }\n  return defaultHandlers\n}\n"],"mappings":"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"}