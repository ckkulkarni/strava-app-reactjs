5891110808de88b074f4ed1cbcd18dff
"use strict";

var __createBinding = void 0 && (void 0).__createBinding || (Object.create ? function (o, m, k, k2) {
  if (k2 === undefined) k2 = k;
  var desc = Object.getOwnPropertyDescriptor(m, k);
  if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
    desc = {
      enumerable: true,
      get: function () {
        return m[k];
      }
    };
  }
  Object.defineProperty(o, k2, desc);
} : function (o, m, k, k2) {
  if (k2 === undefined) k2 = k;
  o[k2] = m[k];
});
var __setModuleDefault = void 0 && (void 0).__setModuleDefault || (Object.create ? function (o, v) {
  Object.defineProperty(o, "default", {
    enumerable: true,
    value: v
  });
} : function (o, v) {
  o["default"] = v;
});
var __importStar = void 0 && (void 0).__importStar || function (mod) {
  if (mod && mod.__esModule) return mod;
  var result = {};
  if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
  __setModuleDefault(result, mod);
  return result;
};
var __importDefault = void 0 && (void 0).__importDefault || function (mod) {
  return mod && mod.__esModule ? mod : {
    "default": mod
  };
};
Object.defineProperty(exports, "__esModule", {
  value: true
});
const helpers_1 = require("./helpers");
const attachment_manager_1 = __importDefault(require("./attachment_manager"));
const step_runner_1 = __importDefault(require("./step_runner"));
const messages = __importStar(require("@cucumber/messages"));
const messages_1 = require("@cucumber/messages");
const value_checker_1 = require("../value_checker");
class TestCaseRunner {
  constructor({
    eventBroadcaster,
    stopwatch,
    gherkinDocument,
    newId,
    pickle,
    testCase,
    retries = 0,
    skip,
    filterStackTraces,
    supportCodeLibrary,
    worldParameters
  }) {
    this.attachmentManager = new attachment_manager_1.default(({
      data,
      media
    }) => {
      if ((0, value_checker_1.doesNotHaveValue)(this.currentTestStepId)) {
        throw new Error('Cannot attach when a step/hook is not running. Ensure your step/hook waits for the attach to finish.');
      }
      const attachment = {
        attachment: {
          body: data,
          contentEncoding: media.encoding,
          mediaType: media.contentType,
          testCaseStartedId: this.currentTestCaseStartedId,
          testStepId: this.currentTestStepId
        }
      };
      this.eventBroadcaster.emit('envelope', attachment);
    });
    this.eventBroadcaster = eventBroadcaster;
    this.stopwatch = stopwatch;
    this.gherkinDocument = gherkinDocument;
    this.maxAttempts = 1 + (skip ? 0 : retries);
    this.newId = newId;
    this.pickle = pickle;
    this.testCase = testCase;
    this.skip = skip;
    this.filterStackTraces = filterStackTraces;
    this.supportCodeLibrary = supportCodeLibrary;
    this.worldParameters = worldParameters;
    this.resetTestProgressData();
  }
  resetTestProgressData() {
    this.world = new this.supportCodeLibrary.World({
      attach: this.attachmentManager.create.bind(this.attachmentManager),
      log: this.attachmentManager.log.bind(this.attachmentManager),
      parameters: this.worldParameters
    });
    this.testStepResults = [];
  }
  getBeforeStepHookDefinitions() {
    return this.supportCodeLibrary.beforeTestStepHookDefinitions.filter(hookDefinition => hookDefinition.appliesToTestCase(this.pickle));
  }
  getAfterStepHookDefinitions() {
    return this.supportCodeLibrary.afterTestStepHookDefinitions.slice(0).reverse().filter(hookDefinition => hookDefinition.appliesToTestCase(this.pickle));
  }
  getWorstStepResult() {
    if (this.testStepResults.length === 0) {
      return {
        status: this.skip ? messages.TestStepResultStatus.SKIPPED : messages.TestStepResultStatus.PASSED,
        duration: messages.TimeConversion.millisecondsToDuration(0)
      };
    }
    return (0, messages_1.getWorstTestStepResult)(this.testStepResults);
  }
  async invokeStep(step, stepDefinition, hookParameter) {
    return await step_runner_1.default.run({
      defaultTimeout: this.supportCodeLibrary.defaultTimeout,
      filterStackTraces: this.filterStackTraces,
      hookParameter,
      step,
      stepDefinition,
      world: this.world
    });
  }
  isSkippingSteps() {
    return this.getWorstStepResult().status !== messages.TestStepResultStatus.PASSED;
  }
  shouldSkipHook(isBeforeHook) {
    return this.skip || this.isSkippingSteps() && isBeforeHook;
  }
  async aroundTestStep(testStepId, runStepFn) {
    const testStepStarted = {
      testStepStarted: {
        testCaseStartedId: this.currentTestCaseStartedId,
        testStepId,
        timestamp: this.stopwatch.timestamp()
      }
    };
    this.eventBroadcaster.emit('envelope', testStepStarted);
    this.currentTestStepId = testStepId;
    const testStepResult = await runStepFn();
    this.currentTestStepId = null;
    this.testStepResults.push(testStepResult);
    const testStepFinished = {
      testStepFinished: {
        testCaseStartedId: this.currentTestCaseStartedId,
        testStepId,
        testStepResult,
        timestamp: this.stopwatch.timestamp()
      }
    };
    this.eventBroadcaster.emit('envelope', testStepFinished);
  }
  async run() {
    for (let attempt = 0; attempt < this.maxAttempts; attempt++) {
      const moreAttemptsRemaining = attempt + 1 < this.maxAttempts;
      const willBeRetried = await this.runAttempt(attempt, moreAttemptsRemaining);
      if (!willBeRetried) {
        break;
      }
      this.resetTestProgressData();
    }
    return this.getWorstStepResult().status;
  }
  async runAttempt(attempt, moreAttemptsRemaining) {
    this.currentTestCaseStartedId = this.newId();
    const testCaseStarted = {
      testCaseStarted: {
        attempt,
        testCaseId: this.testCase.id,
        id: this.currentTestCaseStartedId,
        timestamp: this.stopwatch.timestamp()
      }
    };
    this.eventBroadcaster.emit('envelope', testCaseStarted);
    // used to determine whether a hook is a Before or After
    let didWeRunStepsYet = false;
    for (const testStep of this.testCase.testSteps) {
      await this.aroundTestStep(testStep.id, async () => {
        if ((0, value_checker_1.doesHaveValue)(testStep.hookId)) {
          const hookParameter = {
            gherkinDocument: this.gherkinDocument,
            pickle: this.pickle,
            testCaseStartedId: this.currentTestCaseStartedId
          };
          if (didWeRunStepsYet) {
            hookParameter.result = this.getWorstStepResult();
            hookParameter.willBeRetried = this.getWorstStepResult().status === messages.TestStepResultStatus.FAILED && moreAttemptsRemaining;
          }
          return await this.runHook(findHookDefinition(testStep.hookId, this.supportCodeLibrary), hookParameter, !didWeRunStepsYet);
        } else {
          const pickleStep = this.pickle.steps.find(pickleStep => pickleStep.id === testStep.pickleStepId);
          const testStepResult = await this.runStep(pickleStep, testStep);
          didWeRunStepsYet = true;
          return testStepResult;
        }
      });
    }
    const willBeRetried = this.getWorstStepResult().status === messages.TestStepResultStatus.FAILED && moreAttemptsRemaining;
    const testCaseFinished = {
      testCaseFinished: {
        testCaseStartedId: this.currentTestCaseStartedId,
        timestamp: this.stopwatch.timestamp(),
        willBeRetried
      }
    };
    this.eventBroadcaster.emit('envelope', testCaseFinished);
    return willBeRetried;
  }
  async runHook(hookDefinition, hookParameter, isBeforeHook) {
    if (this.shouldSkipHook(isBeforeHook)) {
      return {
        status: messages.TestStepResultStatus.SKIPPED,
        duration: messages.TimeConversion.millisecondsToDuration(0)
      };
    }
    return await this.invokeStep(null, hookDefinition, hookParameter);
  }
  async runStepHooks(stepHooks, pickleStep, stepResult) {
    const stepHooksResult = [];
    const hookParameter = {
      gherkinDocument: this.gherkinDocument,
      pickle: this.pickle,
      pickleStep,
      testCaseStartedId: this.currentTestCaseStartedId,
      testStepId: this.currentTestStepId,
      result: stepResult
    };
    for (const stepHookDefinition of stepHooks) {
      stepHooksResult.push(await this.invokeStep(null, stepHookDefinition, hookParameter));
    }
    return stepHooksResult;
  }
  async runStep(pickleStep, testStep) {
    const stepDefinitions = testStep.stepDefinitionIds.map(stepDefinitionId => {
      return findStepDefinition(stepDefinitionId, this.supportCodeLibrary);
    });
    if (stepDefinitions.length === 0) {
      return {
        status: messages.TestStepResultStatus.UNDEFINED,
        duration: messages.TimeConversion.millisecondsToDuration(0)
      };
    } else if (stepDefinitions.length > 1) {
      return {
        message: (0, helpers_1.getAmbiguousStepException)(stepDefinitions),
        status: messages.TestStepResultStatus.AMBIGUOUS,
        duration: messages.TimeConversion.millisecondsToDuration(0)
      };
    } else if (this.isSkippingSteps()) {
      return {
        status: messages.TestStepResultStatus.SKIPPED,
        duration: messages.TimeConversion.millisecondsToDuration(0)
      };
    }
    let stepResult;
    let stepResults = await this.runStepHooks(this.getBeforeStepHookDefinitions(), pickleStep);
    if ((0, messages_1.getWorstTestStepResult)(stepResults).status !== messages.TestStepResultStatus.FAILED) {
      stepResult = await this.invokeStep(pickleStep, stepDefinitions[0]);
      stepResults.push(stepResult);
    }
    const afterStepHookResults = await this.runStepHooks(this.getAfterStepHookDefinitions(), pickleStep, stepResult);
    stepResults = stepResults.concat(afterStepHookResults);
    const finalStepResult = (0, messages_1.getWorstTestStepResult)(stepResults);
    let finalDuration = messages.TimeConversion.millisecondsToDuration(0);
    for (const result of stepResults) {
      finalDuration = messages.TimeConversion.addDurations(finalDuration, result.duration);
    }
    finalStepResult.duration = finalDuration;
    return finalStepResult;
  }
}
exports.default = TestCaseRunner;
function findHookDefinition(id, supportCodeLibrary) {
  return [...supportCodeLibrary.beforeTestCaseHookDefinitions, ...supportCodeLibrary.afterTestCaseHookDefinitions].find(definition => definition.id === id);
}
function findStepDefinition(id, supportCodeLibrary) {
  return supportCodeLibrary.stepDefinitions.find(definition => definition.id === id);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJoZWxwZXJzXzEiLCJyZXF1aXJlIiwiYXR0YWNobWVudF9tYW5hZ2VyXzEiLCJfX2ltcG9ydERlZmF1bHQiLCJzdGVwX3J1bm5lcl8xIiwibWVzc2FnZXMiLCJfX2ltcG9ydFN0YXIiLCJtZXNzYWdlc18xIiwidmFsdWVfY2hlY2tlcl8xIiwiVGVzdENhc2VSdW5uZXIiLCJjb25zdHJ1Y3RvciIsImV2ZW50QnJvYWRjYXN0ZXIiLCJzdG9wd2F0Y2giLCJnaGVya2luRG9jdW1lbnQiLCJuZXdJZCIsInBpY2tsZSIsInRlc3RDYXNlIiwicmV0cmllcyIsInNraXAiLCJmaWx0ZXJTdGFja1RyYWNlcyIsInN1cHBvcnRDb2RlTGlicmFyeSIsIndvcmxkUGFyYW1ldGVycyIsImF0dGFjaG1lbnRNYW5hZ2VyIiwiZGVmYXVsdCIsImRhdGEiLCJtZWRpYSIsImRvZXNOb3RIYXZlVmFsdWUiLCJjdXJyZW50VGVzdFN0ZXBJZCIsIkVycm9yIiwiYXR0YWNobWVudCIsImJvZHkiLCJjb250ZW50RW5jb2RpbmciLCJlbmNvZGluZyIsIm1lZGlhVHlwZSIsImNvbnRlbnRUeXBlIiwidGVzdENhc2VTdGFydGVkSWQiLCJjdXJyZW50VGVzdENhc2VTdGFydGVkSWQiLCJ0ZXN0U3RlcElkIiwiZW1pdCIsIm1heEF0dGVtcHRzIiwicmVzZXRUZXN0UHJvZ3Jlc3NEYXRhIiwid29ybGQiLCJXb3JsZCIsImF0dGFjaCIsImNyZWF0ZSIsImJpbmQiLCJsb2ciLCJwYXJhbWV0ZXJzIiwidGVzdFN0ZXBSZXN1bHRzIiwiZ2V0QmVmb3JlU3RlcEhvb2tEZWZpbml0aW9ucyIsImJlZm9yZVRlc3RTdGVwSG9va0RlZmluaXRpb25zIiwiZmlsdGVyIiwiaG9va0RlZmluaXRpb24iLCJhcHBsaWVzVG9UZXN0Q2FzZSIsImdldEFmdGVyU3RlcEhvb2tEZWZpbml0aW9ucyIsImFmdGVyVGVzdFN0ZXBIb29rRGVmaW5pdGlvbnMiLCJzbGljZSIsInJldmVyc2UiLCJnZXRXb3JzdFN0ZXBSZXN1bHQiLCJsZW5ndGgiLCJzdGF0dXMiLCJUZXN0U3RlcFJlc3VsdFN0YXR1cyIsIlNLSVBQRUQiLCJQQVNTRUQiLCJkdXJhdGlvbiIsIlRpbWVDb252ZXJzaW9uIiwibWlsbGlzZWNvbmRzVG9EdXJhdGlvbiIsImdldFdvcnN0VGVzdFN0ZXBSZXN1bHQiLCJpbnZva2VTdGVwIiwic3RlcCIsInN0ZXBEZWZpbml0aW9uIiwiaG9va1BhcmFtZXRlciIsInJ1biIsImRlZmF1bHRUaW1lb3V0IiwiaXNTa2lwcGluZ1N0ZXBzIiwic2hvdWxkU2tpcEhvb2siLCJpc0JlZm9yZUhvb2siLCJhcm91bmRUZXN0U3RlcCIsInJ1blN0ZXBGbiIsInRlc3RTdGVwU3RhcnRlZCIsInRpbWVzdGFtcCIsInRlc3RTdGVwUmVzdWx0IiwicHVzaCIsInRlc3RTdGVwRmluaXNoZWQiLCJhdHRlbXB0IiwibW9yZUF0dGVtcHRzUmVtYWluaW5nIiwid2lsbEJlUmV0cmllZCIsInJ1bkF0dGVtcHQiLCJ0ZXN0Q2FzZVN0YXJ0ZWQiLCJ0ZXN0Q2FzZUlkIiwiaWQiLCJkaWRXZVJ1blN0ZXBzWWV0IiwidGVzdFN0ZXAiLCJ0ZXN0U3RlcHMiLCJkb2VzSGF2ZVZhbHVlIiwiaG9va0lkIiwicmVzdWx0IiwiRkFJTEVEIiwicnVuSG9vayIsImZpbmRIb29rRGVmaW5pdGlvbiIsInBpY2tsZVN0ZXAiLCJzdGVwcyIsImZpbmQiLCJwaWNrbGVTdGVwSWQiLCJydW5TdGVwIiwidGVzdENhc2VGaW5pc2hlZCIsInJ1blN0ZXBIb29rcyIsInN0ZXBIb29rcyIsInN0ZXBSZXN1bHQiLCJzdGVwSG9va3NSZXN1bHQiLCJzdGVwSG9va0RlZmluaXRpb24iLCJzdGVwRGVmaW5pdGlvbnMiLCJzdGVwRGVmaW5pdGlvbklkcyIsIm1hcCIsInN0ZXBEZWZpbml0aW9uSWQiLCJmaW5kU3RlcERlZmluaXRpb24iLCJVTkRFRklORUQiLCJtZXNzYWdlIiwiZ2V0QW1iaWd1b3VzU3RlcEV4Y2VwdGlvbiIsIkFNQklHVU9VUyIsInN0ZXBSZXN1bHRzIiwiYWZ0ZXJTdGVwSG9va1Jlc3VsdHMiLCJjb25jYXQiLCJmaW5hbFN0ZXBSZXN1bHQiLCJmaW5hbER1cmF0aW9uIiwiYWRkRHVyYXRpb25zIiwiZXhwb3J0cyIsImJlZm9yZVRlc3RDYXNlSG9va0RlZmluaXRpb25zIiwiYWZ0ZXJUZXN0Q2FzZUhvb2tEZWZpbml0aW9ucyIsImRlZmluaXRpb24iXSwic291cmNlcyI6WyIuLi8uLi9zcmMvcnVudGltZS90ZXN0X2Nhc2VfcnVubmVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGdldEFtYmlndW91c1N0ZXBFeGNlcHRpb24gfSBmcm9tICcuL2hlbHBlcnMnXG5pbXBvcnQgQXR0YWNobWVudE1hbmFnZXIgZnJvbSAnLi9hdHRhY2htZW50X21hbmFnZXInXG5pbXBvcnQgU3RlcFJ1bm5lciBmcm9tICcuL3N0ZXBfcnVubmVyJ1xuaW1wb3J0ICogYXMgbWVzc2FnZXMgZnJvbSAnQGN1Y3VtYmVyL21lc3NhZ2VzJ1xuaW1wb3J0IHsgZ2V0V29yc3RUZXN0U3RlcFJlc3VsdCwgSWRHZW5lcmF0b3IgfSBmcm9tICdAY3VjdW1iZXIvbWVzc2FnZXMnXG5pbXBvcnQgeyBFdmVudEVtaXR0ZXIgfSBmcm9tICdldmVudHMnXG5pbXBvcnQge1xuICBJU3VwcG9ydENvZGVMaWJyYXJ5LFxuICBJVGVzdENhc2VIb29rUGFyYW1ldGVyLFxuICBJVGVzdFN0ZXBIb29rUGFyYW1ldGVyLFxufSBmcm9tICcuLi9zdXBwb3J0X2NvZGVfbGlicmFyeV9idWlsZGVyL3R5cGVzJ1xuaW1wb3J0IFRlc3RDYXNlSG9va0RlZmluaXRpb24gZnJvbSAnLi4vbW9kZWxzL3Rlc3RfY2FzZV9ob29rX2RlZmluaXRpb24nXG5pbXBvcnQgVGVzdFN0ZXBIb29rRGVmaW5pdGlvbiBmcm9tICcuLi9tb2RlbHMvdGVzdF9zdGVwX2hvb2tfZGVmaW5pdGlvbidcbmltcG9ydCB7IElEZWZpbml0aW9uIH0gZnJvbSAnLi4vbW9kZWxzL2RlZmluaXRpb24nXG5pbXBvcnQgeyBkb2VzSGF2ZVZhbHVlLCBkb2VzTm90SGF2ZVZhbHVlIH0gZnJvbSAnLi4vdmFsdWVfY2hlY2tlcidcbmltcG9ydCB7IElTdG9wd2F0Y2ggfSBmcm9tICcuL3N0b3B3YXRjaCdcbmltcG9ydCBTdGVwRGVmaW5pdGlvbiBmcm9tICcuLi9tb2RlbHMvc3RlcF9kZWZpbml0aW9uJ1xuXG5leHBvcnQgaW50ZXJmYWNlIElOZXdUZXN0Q2FzZVJ1bm5lck9wdGlvbnMge1xuICBldmVudEJyb2FkY2FzdGVyOiBFdmVudEVtaXR0ZXJcbiAgc3RvcHdhdGNoOiBJU3RvcHdhdGNoXG4gIGdoZXJraW5Eb2N1bWVudDogbWVzc2FnZXMuR2hlcmtpbkRvY3VtZW50XG4gIG5ld0lkOiBJZEdlbmVyYXRvci5OZXdJZFxuICBwaWNrbGU6IG1lc3NhZ2VzLlBpY2tsZVxuICB0ZXN0Q2FzZTogbWVzc2FnZXMuVGVzdENhc2VcbiAgcmV0cmllczogbnVtYmVyXG4gIHNraXA6IGJvb2xlYW5cbiAgZmlsdGVyU3RhY2tUcmFjZXM6IGJvb2xlYW5cbiAgc3VwcG9ydENvZGVMaWJyYXJ5OiBJU3VwcG9ydENvZGVMaWJyYXJ5XG4gIHdvcmxkUGFyYW1ldGVyczogYW55XG59XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFRlc3RDYXNlUnVubmVyIHtcbiAgcHJpdmF0ZSByZWFkb25seSBhdHRhY2htZW50TWFuYWdlcjogQXR0YWNobWVudE1hbmFnZXJcbiAgcHJpdmF0ZSBjdXJyZW50VGVzdENhc2VTdGFydGVkSWQ6IHN0cmluZ1xuICBwcml2YXRlIGN1cnJlbnRUZXN0U3RlcElkOiBzdHJpbmdcbiAgcHJpdmF0ZSByZWFkb25seSBldmVudEJyb2FkY2FzdGVyOiBFdmVudEVtaXR0ZXJcbiAgcHJpdmF0ZSByZWFkb25seSBzdG9wd2F0Y2g6IElTdG9wd2F0Y2hcbiAgcHJpdmF0ZSByZWFkb25seSBnaGVya2luRG9jdW1lbnQ6IG1lc3NhZ2VzLkdoZXJraW5Eb2N1bWVudFxuICBwcml2YXRlIHJlYWRvbmx5IG5ld0lkOiBJZEdlbmVyYXRvci5OZXdJZFxuICBwcml2YXRlIHJlYWRvbmx5IHBpY2tsZTogbWVzc2FnZXMuUGlja2xlXG4gIHByaXZhdGUgcmVhZG9ubHkgdGVzdENhc2U6IG1lc3NhZ2VzLlRlc3RDYXNlXG4gIHByaXZhdGUgcmVhZG9ubHkgbWF4QXR0ZW1wdHM6IG51bWJlclxuICBwcml2YXRlIHJlYWRvbmx5IHNraXA6IGJvb2xlYW5cbiAgcHJpdmF0ZSByZWFkb25seSBmaWx0ZXJTdGFja1RyYWNlczogYm9vbGVhblxuICBwcml2YXRlIHJlYWRvbmx5IHN1cHBvcnRDb2RlTGlicmFyeTogSVN1cHBvcnRDb2RlTGlicmFyeVxuICBwcml2YXRlIHRlc3RTdGVwUmVzdWx0czogbWVzc2FnZXMuVGVzdFN0ZXBSZXN1bHRbXVxuICBwcml2YXRlIHdvcmxkOiBhbnlcbiAgcHJpdmF0ZSByZWFkb25seSB3b3JsZFBhcmFtZXRlcnM6IGFueVxuXG4gIGNvbnN0cnVjdG9yKHtcbiAgICBldmVudEJyb2FkY2FzdGVyLFxuICAgIHN0b3B3YXRjaCxcbiAgICBnaGVya2luRG9jdW1lbnQsXG4gICAgbmV3SWQsXG4gICAgcGlja2xlLFxuICAgIHRlc3RDYXNlLFxuICAgIHJldHJpZXMgPSAwLFxuICAgIHNraXAsXG4gICAgZmlsdGVyU3RhY2tUcmFjZXMsXG4gICAgc3VwcG9ydENvZGVMaWJyYXJ5LFxuICAgIHdvcmxkUGFyYW1ldGVycyxcbiAgfTogSU5ld1Rlc3RDYXNlUnVubmVyT3B0aW9ucykge1xuICAgIHRoaXMuYXR0YWNobWVudE1hbmFnZXIgPSBuZXcgQXR0YWNobWVudE1hbmFnZXIoKHsgZGF0YSwgbWVkaWEgfSkgPT4ge1xuICAgICAgaWYgKGRvZXNOb3RIYXZlVmFsdWUodGhpcy5jdXJyZW50VGVzdFN0ZXBJZCkpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICdDYW5ub3QgYXR0YWNoIHdoZW4gYSBzdGVwL2hvb2sgaXMgbm90IHJ1bm5pbmcuIEVuc3VyZSB5b3VyIHN0ZXAvaG9vayB3YWl0cyBmb3IgdGhlIGF0dGFjaCB0byBmaW5pc2guJ1xuICAgICAgICApXG4gICAgICB9XG4gICAgICBjb25zdCBhdHRhY2htZW50OiBtZXNzYWdlcy5FbnZlbG9wZSA9IHtcbiAgICAgICAgYXR0YWNobWVudDoge1xuICAgICAgICAgIGJvZHk6IGRhdGEsXG4gICAgICAgICAgY29udGVudEVuY29kaW5nOiBtZWRpYS5lbmNvZGluZyxcbiAgICAgICAgICBtZWRpYVR5cGU6IG1lZGlhLmNvbnRlbnRUeXBlLFxuICAgICAgICAgIHRlc3RDYXNlU3RhcnRlZElkOiB0aGlzLmN1cnJlbnRUZXN0Q2FzZVN0YXJ0ZWRJZCxcbiAgICAgICAgICB0ZXN0U3RlcElkOiB0aGlzLmN1cnJlbnRUZXN0U3RlcElkLFxuICAgICAgICB9LFxuICAgICAgfVxuICAgICAgdGhpcy5ldmVudEJyb2FkY2FzdGVyLmVtaXQoJ2VudmVsb3BlJywgYXR0YWNobWVudClcbiAgICB9KVxuICAgIHRoaXMuZXZlbnRCcm9hZGNhc3RlciA9IGV2ZW50QnJvYWRjYXN0ZXJcbiAgICB0aGlzLnN0b3B3YXRjaCA9IHN0b3B3YXRjaFxuICAgIHRoaXMuZ2hlcmtpbkRvY3VtZW50ID0gZ2hlcmtpbkRvY3VtZW50XG4gICAgdGhpcy5tYXhBdHRlbXB0cyA9IDEgKyAoc2tpcCA/IDAgOiByZXRyaWVzKVxuICAgIHRoaXMubmV3SWQgPSBuZXdJZFxuICAgIHRoaXMucGlja2xlID0gcGlja2xlXG4gICAgdGhpcy50ZXN0Q2FzZSA9IHRlc3RDYXNlXG4gICAgdGhpcy5za2lwID0gc2tpcFxuICAgIHRoaXMuZmlsdGVyU3RhY2tUcmFjZXMgPSBmaWx0ZXJTdGFja1RyYWNlc1xuICAgIHRoaXMuc3VwcG9ydENvZGVMaWJyYXJ5ID0gc3VwcG9ydENvZGVMaWJyYXJ5XG4gICAgdGhpcy53b3JsZFBhcmFtZXRlcnMgPSB3b3JsZFBhcmFtZXRlcnNcbiAgICB0aGlzLnJlc2V0VGVzdFByb2dyZXNzRGF0YSgpXG4gIH1cblxuICByZXNldFRlc3RQcm9ncmVzc0RhdGEoKTogdm9pZCB7XG4gICAgdGhpcy53b3JsZCA9IG5ldyB0aGlzLnN1cHBvcnRDb2RlTGlicmFyeS5Xb3JsZCh7XG4gICAgICBhdHRhY2g6IHRoaXMuYXR0YWNobWVudE1hbmFnZXIuY3JlYXRlLmJpbmQodGhpcy5hdHRhY2htZW50TWFuYWdlciksXG4gICAgICBsb2c6IHRoaXMuYXR0YWNobWVudE1hbmFnZXIubG9nLmJpbmQodGhpcy5hdHRhY2htZW50TWFuYWdlciksXG4gICAgICBwYXJhbWV0ZXJzOiB0aGlzLndvcmxkUGFyYW1ldGVycyxcbiAgICB9KVxuICAgIHRoaXMudGVzdFN0ZXBSZXN1bHRzID0gW11cbiAgfVxuXG4gIGdldEJlZm9yZVN0ZXBIb29rRGVmaW5pdGlvbnMoKTogVGVzdFN0ZXBIb29rRGVmaW5pdGlvbltdIHtcbiAgICByZXR1cm4gdGhpcy5zdXBwb3J0Q29kZUxpYnJhcnkuYmVmb3JlVGVzdFN0ZXBIb29rRGVmaW5pdGlvbnMuZmlsdGVyKFxuICAgICAgKGhvb2tEZWZpbml0aW9uKSA9PiBob29rRGVmaW5pdGlvbi5hcHBsaWVzVG9UZXN0Q2FzZSh0aGlzLnBpY2tsZSlcbiAgICApXG4gIH1cblxuICBnZXRBZnRlclN0ZXBIb29rRGVmaW5pdGlvbnMoKTogVGVzdFN0ZXBIb29rRGVmaW5pdGlvbltdIHtcbiAgICByZXR1cm4gdGhpcy5zdXBwb3J0Q29kZUxpYnJhcnkuYWZ0ZXJUZXN0U3RlcEhvb2tEZWZpbml0aW9uc1xuICAgICAgLnNsaWNlKDApXG4gICAgICAucmV2ZXJzZSgpXG4gICAgICAuZmlsdGVyKChob29rRGVmaW5pdGlvbikgPT4gaG9va0RlZmluaXRpb24uYXBwbGllc1RvVGVzdENhc2UodGhpcy5waWNrbGUpKVxuICB9XG5cbiAgZ2V0V29yc3RTdGVwUmVzdWx0KCk6IG1lc3NhZ2VzLlRlc3RTdGVwUmVzdWx0IHtcbiAgICBpZiAodGhpcy50ZXN0U3RlcFJlc3VsdHMubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdGF0dXM6IHRoaXMuc2tpcFxuICAgICAgICAgID8gbWVzc2FnZXMuVGVzdFN0ZXBSZXN1bHRTdGF0dXMuU0tJUFBFRFxuICAgICAgICAgIDogbWVzc2FnZXMuVGVzdFN0ZXBSZXN1bHRTdGF0dXMuUEFTU0VELFxuICAgICAgICBkdXJhdGlvbjogbWVzc2FnZXMuVGltZUNvbnZlcnNpb24ubWlsbGlzZWNvbmRzVG9EdXJhdGlvbigwKSxcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGdldFdvcnN0VGVzdFN0ZXBSZXN1bHQodGhpcy50ZXN0U3RlcFJlc3VsdHMpXG4gIH1cblxuICBhc3luYyBpbnZva2VTdGVwKFxuICAgIHN0ZXA6IG1lc3NhZ2VzLlBpY2tsZVN0ZXAsXG4gICAgc3RlcERlZmluaXRpb246IElEZWZpbml0aW9uLFxuICAgIGhvb2tQYXJhbWV0ZXI/OiBhbnlcbiAgKTogUHJvbWlzZTxtZXNzYWdlcy5UZXN0U3RlcFJlc3VsdD4ge1xuICAgIHJldHVybiBhd2FpdCBTdGVwUnVubmVyLnJ1bih7XG4gICAgICBkZWZhdWx0VGltZW91dDogdGhpcy5zdXBwb3J0Q29kZUxpYnJhcnkuZGVmYXVsdFRpbWVvdXQsXG4gICAgICBmaWx0ZXJTdGFja1RyYWNlczogdGhpcy5maWx0ZXJTdGFja1RyYWNlcyxcbiAgICAgIGhvb2tQYXJhbWV0ZXIsXG4gICAgICBzdGVwLFxuICAgICAgc3RlcERlZmluaXRpb24sXG4gICAgICB3b3JsZDogdGhpcy53b3JsZCxcbiAgICB9KVxuICB9XG5cbiAgaXNTa2lwcGluZ1N0ZXBzKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAoXG4gICAgICB0aGlzLmdldFdvcnN0U3RlcFJlc3VsdCgpLnN0YXR1cyAhPT0gbWVzc2FnZXMuVGVzdFN0ZXBSZXN1bHRTdGF0dXMuUEFTU0VEXG4gICAgKVxuICB9XG5cbiAgc2hvdWxkU2tpcEhvb2soaXNCZWZvcmVIb29rOiBib29sZWFuKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuc2tpcCB8fCAodGhpcy5pc1NraXBwaW5nU3RlcHMoKSAmJiBpc0JlZm9yZUhvb2spXG4gIH1cblxuICBhc3luYyBhcm91bmRUZXN0U3RlcChcbiAgICB0ZXN0U3RlcElkOiBzdHJpbmcsXG4gICAgcnVuU3RlcEZuOiAoKSA9PiBQcm9taXNlPG1lc3NhZ2VzLlRlc3RTdGVwUmVzdWx0PlxuICApOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCB0ZXN0U3RlcFN0YXJ0ZWQ6IG1lc3NhZ2VzLkVudmVsb3BlID0ge1xuICAgICAgdGVzdFN0ZXBTdGFydGVkOiB7XG4gICAgICAgIHRlc3RDYXNlU3RhcnRlZElkOiB0aGlzLmN1cnJlbnRUZXN0Q2FzZVN0YXJ0ZWRJZCxcbiAgICAgICAgdGVzdFN0ZXBJZCxcbiAgICAgICAgdGltZXN0YW1wOiB0aGlzLnN0b3B3YXRjaC50aW1lc3RhbXAoKSxcbiAgICAgIH0sXG4gICAgfVxuICAgIHRoaXMuZXZlbnRCcm9hZGNhc3Rlci5lbWl0KCdlbnZlbG9wZScsIHRlc3RTdGVwU3RhcnRlZClcbiAgICB0aGlzLmN1cnJlbnRUZXN0U3RlcElkID0gdGVzdFN0ZXBJZFxuICAgIGNvbnN0IHRlc3RTdGVwUmVzdWx0ID0gYXdhaXQgcnVuU3RlcEZuKClcbiAgICB0aGlzLmN1cnJlbnRUZXN0U3RlcElkID0gbnVsbFxuICAgIHRoaXMudGVzdFN0ZXBSZXN1bHRzLnB1c2godGVzdFN0ZXBSZXN1bHQpXG4gICAgY29uc3QgdGVzdFN0ZXBGaW5pc2hlZDogbWVzc2FnZXMuRW52ZWxvcGUgPSB7XG4gICAgICB0ZXN0U3RlcEZpbmlzaGVkOiB7XG4gICAgICAgIHRlc3RDYXNlU3RhcnRlZElkOiB0aGlzLmN1cnJlbnRUZXN0Q2FzZVN0YXJ0ZWRJZCxcbiAgICAgICAgdGVzdFN0ZXBJZCxcbiAgICAgICAgdGVzdFN0ZXBSZXN1bHQsXG4gICAgICAgIHRpbWVzdGFtcDogdGhpcy5zdG9wd2F0Y2gudGltZXN0YW1wKCksXG4gICAgICB9LFxuICAgIH1cbiAgICB0aGlzLmV2ZW50QnJvYWRjYXN0ZXIuZW1pdCgnZW52ZWxvcGUnLCB0ZXN0U3RlcEZpbmlzaGVkKVxuICB9XG5cbiAgYXN5bmMgcnVuKCk6IFByb21pc2U8bWVzc2FnZXMuVGVzdFN0ZXBSZXN1bHRTdGF0dXM+IHtcbiAgICBmb3IgKGxldCBhdHRlbXB0ID0gMDsgYXR0ZW1wdCA8IHRoaXMubWF4QXR0ZW1wdHM7IGF0dGVtcHQrKykge1xuICAgICAgY29uc3QgbW9yZUF0dGVtcHRzUmVtYWluaW5nID0gYXR0ZW1wdCArIDEgPCB0aGlzLm1heEF0dGVtcHRzXG5cbiAgICAgIGNvbnN0IHdpbGxCZVJldHJpZWQgPSBhd2FpdCB0aGlzLnJ1bkF0dGVtcHQoXG4gICAgICAgIGF0dGVtcHQsXG4gICAgICAgIG1vcmVBdHRlbXB0c1JlbWFpbmluZ1xuICAgICAgKVxuXG4gICAgICBpZiAoIXdpbGxCZVJldHJpZWQpIHtcbiAgICAgICAgYnJlYWtcbiAgICAgIH1cbiAgICAgIHRoaXMucmVzZXRUZXN0UHJvZ3Jlc3NEYXRhKClcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuZ2V0V29yc3RTdGVwUmVzdWx0KCkuc3RhdHVzXG4gIH1cblxuICBhc3luYyBydW5BdHRlbXB0KFxuICAgIGF0dGVtcHQ6IG51bWJlcixcbiAgICBtb3JlQXR0ZW1wdHNSZW1haW5pbmc6IGJvb2xlYW5cbiAgKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgdGhpcy5jdXJyZW50VGVzdENhc2VTdGFydGVkSWQgPSB0aGlzLm5ld0lkKClcbiAgICBjb25zdCB0ZXN0Q2FzZVN0YXJ0ZWQ6IG1lc3NhZ2VzLkVudmVsb3BlID0ge1xuICAgICAgdGVzdENhc2VTdGFydGVkOiB7XG4gICAgICAgIGF0dGVtcHQsXG4gICAgICAgIHRlc3RDYXNlSWQ6IHRoaXMudGVzdENhc2UuaWQsXG4gICAgICAgIGlkOiB0aGlzLmN1cnJlbnRUZXN0Q2FzZVN0YXJ0ZWRJZCxcbiAgICAgICAgdGltZXN0YW1wOiB0aGlzLnN0b3B3YXRjaC50aW1lc3RhbXAoKSxcbiAgICAgIH0sXG4gICAgfVxuICAgIHRoaXMuZXZlbnRCcm9hZGNhc3Rlci5lbWl0KCdlbnZlbG9wZScsIHRlc3RDYXNlU3RhcnRlZClcbiAgICAvLyB1c2VkIHRvIGRldGVybWluZSB3aGV0aGVyIGEgaG9vayBpcyBhIEJlZm9yZSBvciBBZnRlclxuICAgIGxldCBkaWRXZVJ1blN0ZXBzWWV0ID0gZmFsc2VcbiAgICBmb3IgKGNvbnN0IHRlc3RTdGVwIG9mIHRoaXMudGVzdENhc2UudGVzdFN0ZXBzKSB7XG4gICAgICBhd2FpdCB0aGlzLmFyb3VuZFRlc3RTdGVwKHRlc3RTdGVwLmlkLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGlmIChkb2VzSGF2ZVZhbHVlKHRlc3RTdGVwLmhvb2tJZCkpIHtcbiAgICAgICAgICBjb25zdCBob29rUGFyYW1ldGVyOiBJVGVzdENhc2VIb29rUGFyYW1ldGVyID0ge1xuICAgICAgICAgICAgZ2hlcmtpbkRvY3VtZW50OiB0aGlzLmdoZXJraW5Eb2N1bWVudCxcbiAgICAgICAgICAgIHBpY2tsZTogdGhpcy5waWNrbGUsXG4gICAgICAgICAgICB0ZXN0Q2FzZVN0YXJ0ZWRJZDogdGhpcy5jdXJyZW50VGVzdENhc2VTdGFydGVkSWQsXG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChkaWRXZVJ1blN0ZXBzWWV0KSB7XG4gICAgICAgICAgICBob29rUGFyYW1ldGVyLnJlc3VsdCA9IHRoaXMuZ2V0V29yc3RTdGVwUmVzdWx0KClcbiAgICAgICAgICAgIGhvb2tQYXJhbWV0ZXIud2lsbEJlUmV0cmllZCA9XG4gICAgICAgICAgICAgIHRoaXMuZ2V0V29yc3RTdGVwUmVzdWx0KCkuc3RhdHVzID09PVxuICAgICAgICAgICAgICAgIG1lc3NhZ2VzLlRlc3RTdGVwUmVzdWx0U3RhdHVzLkZBSUxFRCAmJiBtb3JlQXR0ZW1wdHNSZW1haW5pbmdcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMucnVuSG9vayhcbiAgICAgICAgICAgIGZpbmRIb29rRGVmaW5pdGlvbih0ZXN0U3RlcC5ob29rSWQsIHRoaXMuc3VwcG9ydENvZGVMaWJyYXJ5KSxcbiAgICAgICAgICAgIGhvb2tQYXJhbWV0ZXIsXG4gICAgICAgICAgICAhZGlkV2VSdW5TdGVwc1lldFxuICAgICAgICAgIClcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb25zdCBwaWNrbGVTdGVwID0gdGhpcy5waWNrbGUuc3RlcHMuZmluZChcbiAgICAgICAgICAgIChwaWNrbGVTdGVwKSA9PiBwaWNrbGVTdGVwLmlkID09PSB0ZXN0U3RlcC5waWNrbGVTdGVwSWRcbiAgICAgICAgICApXG4gICAgICAgICAgY29uc3QgdGVzdFN0ZXBSZXN1bHQgPSBhd2FpdCB0aGlzLnJ1blN0ZXAocGlja2xlU3RlcCwgdGVzdFN0ZXApXG4gICAgICAgICAgZGlkV2VSdW5TdGVwc1lldCA9IHRydWVcbiAgICAgICAgICByZXR1cm4gdGVzdFN0ZXBSZXN1bHRcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9XG5cbiAgICBjb25zdCB3aWxsQmVSZXRyaWVkID1cbiAgICAgIHRoaXMuZ2V0V29yc3RTdGVwUmVzdWx0KCkuc3RhdHVzID09PVxuICAgICAgICBtZXNzYWdlcy5UZXN0U3RlcFJlc3VsdFN0YXR1cy5GQUlMRUQgJiYgbW9yZUF0dGVtcHRzUmVtYWluaW5nXG4gICAgY29uc3QgdGVzdENhc2VGaW5pc2hlZDogbWVzc2FnZXMuRW52ZWxvcGUgPSB7XG4gICAgICB0ZXN0Q2FzZUZpbmlzaGVkOiB7XG4gICAgICAgIHRlc3RDYXNlU3RhcnRlZElkOiB0aGlzLmN1cnJlbnRUZXN0Q2FzZVN0YXJ0ZWRJZCxcbiAgICAgICAgdGltZXN0YW1wOiB0aGlzLnN0b3B3YXRjaC50aW1lc3RhbXAoKSxcbiAgICAgICAgd2lsbEJlUmV0cmllZCxcbiAgICAgIH0sXG4gICAgfVxuICAgIHRoaXMuZXZlbnRCcm9hZGNhc3Rlci5lbWl0KCdlbnZlbG9wZScsIHRlc3RDYXNlRmluaXNoZWQpXG5cbiAgICByZXR1cm4gd2lsbEJlUmV0cmllZFxuICB9XG5cbiAgYXN5bmMgcnVuSG9vayhcbiAgICBob29rRGVmaW5pdGlvbjogVGVzdENhc2VIb29rRGVmaW5pdGlvbixcbiAgICBob29rUGFyYW1ldGVyOiBJVGVzdENhc2VIb29rUGFyYW1ldGVyLFxuICAgIGlzQmVmb3JlSG9vazogYm9vbGVhblxuICApOiBQcm9taXNlPG1lc3NhZ2VzLlRlc3RTdGVwUmVzdWx0PiB7XG4gICAgaWYgKHRoaXMuc2hvdWxkU2tpcEhvb2soaXNCZWZvcmVIb29rKSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3RhdHVzOiBtZXNzYWdlcy5UZXN0U3RlcFJlc3VsdFN0YXR1cy5TS0lQUEVELFxuICAgICAgICBkdXJhdGlvbjogbWVzc2FnZXMuVGltZUNvbnZlcnNpb24ubWlsbGlzZWNvbmRzVG9EdXJhdGlvbigwKSxcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuaW52b2tlU3RlcChudWxsLCBob29rRGVmaW5pdGlvbiwgaG9va1BhcmFtZXRlcilcbiAgfVxuXG4gIGFzeW5jIHJ1blN0ZXBIb29rcyhcbiAgICBzdGVwSG9va3M6IFRlc3RTdGVwSG9va0RlZmluaXRpb25bXSxcbiAgICBwaWNrbGVTdGVwOiBtZXNzYWdlcy5QaWNrbGVTdGVwLFxuICAgIHN0ZXBSZXN1bHQ/OiBtZXNzYWdlcy5UZXN0U3RlcFJlc3VsdFxuICApOiBQcm9taXNlPG1lc3NhZ2VzLlRlc3RTdGVwUmVzdWx0W10+IHtcbiAgICBjb25zdCBzdGVwSG9va3NSZXN1bHQgPSBbXVxuICAgIGNvbnN0IGhvb2tQYXJhbWV0ZXI6IElUZXN0U3RlcEhvb2tQYXJhbWV0ZXIgPSB7XG4gICAgICBnaGVya2luRG9jdW1lbnQ6IHRoaXMuZ2hlcmtpbkRvY3VtZW50LFxuICAgICAgcGlja2xlOiB0aGlzLnBpY2tsZSxcbiAgICAgIHBpY2tsZVN0ZXAsXG4gICAgICB0ZXN0Q2FzZVN0YXJ0ZWRJZDogdGhpcy5jdXJyZW50VGVzdENhc2VTdGFydGVkSWQsXG4gICAgICB0ZXN0U3RlcElkOiB0aGlzLmN1cnJlbnRUZXN0U3RlcElkLFxuICAgICAgcmVzdWx0OiBzdGVwUmVzdWx0LFxuICAgIH1cbiAgICBmb3IgKGNvbnN0IHN0ZXBIb29rRGVmaW5pdGlvbiBvZiBzdGVwSG9va3MpIHtcbiAgICAgIHN0ZXBIb29rc1Jlc3VsdC5wdXNoKFxuICAgICAgICBhd2FpdCB0aGlzLmludm9rZVN0ZXAobnVsbCwgc3RlcEhvb2tEZWZpbml0aW9uLCBob29rUGFyYW1ldGVyKVxuICAgICAgKVxuICAgIH1cbiAgICByZXR1cm4gc3RlcEhvb2tzUmVzdWx0XG4gIH1cblxuICBhc3luYyBydW5TdGVwKFxuICAgIHBpY2tsZVN0ZXA6IG1lc3NhZ2VzLlBpY2tsZVN0ZXAsXG4gICAgdGVzdFN0ZXA6IG1lc3NhZ2VzLlRlc3RTdGVwXG4gICk6IFByb21pc2U8bWVzc2FnZXMuVGVzdFN0ZXBSZXN1bHQ+IHtcbiAgICBjb25zdCBzdGVwRGVmaW5pdGlvbnMgPSB0ZXN0U3RlcC5zdGVwRGVmaW5pdGlvbklkcy5tYXAoXG4gICAgICAoc3RlcERlZmluaXRpb25JZCkgPT4ge1xuICAgICAgICByZXR1cm4gZmluZFN0ZXBEZWZpbml0aW9uKHN0ZXBEZWZpbml0aW9uSWQsIHRoaXMuc3VwcG9ydENvZGVMaWJyYXJ5KVxuICAgICAgfVxuICAgIClcbiAgICBpZiAoc3RlcERlZmluaXRpb25zLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3RhdHVzOiBtZXNzYWdlcy5UZXN0U3RlcFJlc3VsdFN0YXR1cy5VTkRFRklORUQsXG4gICAgICAgIGR1cmF0aW9uOiBtZXNzYWdlcy5UaW1lQ29udmVyc2lvbi5taWxsaXNlY29uZHNUb0R1cmF0aW9uKDApLFxuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoc3RlcERlZmluaXRpb25zLmxlbmd0aCA+IDEpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIG1lc3NhZ2U6IGdldEFtYmlndW91c1N0ZXBFeGNlcHRpb24oc3RlcERlZmluaXRpb25zKSxcbiAgICAgICAgc3RhdHVzOiBtZXNzYWdlcy5UZXN0U3RlcFJlc3VsdFN0YXR1cy5BTUJJR1VPVVMsXG4gICAgICAgIGR1cmF0aW9uOiBtZXNzYWdlcy5UaW1lQ29udmVyc2lvbi5taWxsaXNlY29uZHNUb0R1cmF0aW9uKDApLFxuICAgICAgfVxuICAgIH0gZWxzZSBpZiAodGhpcy5pc1NraXBwaW5nU3RlcHMoKSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3RhdHVzOiBtZXNzYWdlcy5UZXN0U3RlcFJlc3VsdFN0YXR1cy5TS0lQUEVELFxuICAgICAgICBkdXJhdGlvbjogbWVzc2FnZXMuVGltZUNvbnZlcnNpb24ubWlsbGlzZWNvbmRzVG9EdXJhdGlvbigwKSxcbiAgICAgIH1cbiAgICB9XG5cbiAgICBsZXQgc3RlcFJlc3VsdFxuICAgIGxldCBzdGVwUmVzdWx0cyA9IGF3YWl0IHRoaXMucnVuU3RlcEhvb2tzKFxuICAgICAgdGhpcy5nZXRCZWZvcmVTdGVwSG9va0RlZmluaXRpb25zKCksXG4gICAgICBwaWNrbGVTdGVwXG4gICAgKVxuICAgIGlmIChcbiAgICAgIGdldFdvcnN0VGVzdFN0ZXBSZXN1bHQoc3RlcFJlc3VsdHMpLnN0YXR1cyAhPT1cbiAgICAgIG1lc3NhZ2VzLlRlc3RTdGVwUmVzdWx0U3RhdHVzLkZBSUxFRFxuICAgICkge1xuICAgICAgc3RlcFJlc3VsdCA9IGF3YWl0IHRoaXMuaW52b2tlU3RlcChwaWNrbGVTdGVwLCBzdGVwRGVmaW5pdGlvbnNbMF0pXG4gICAgICBzdGVwUmVzdWx0cy5wdXNoKHN0ZXBSZXN1bHQpXG4gICAgfVxuICAgIGNvbnN0IGFmdGVyU3RlcEhvb2tSZXN1bHRzID0gYXdhaXQgdGhpcy5ydW5TdGVwSG9va3MoXG4gICAgICB0aGlzLmdldEFmdGVyU3RlcEhvb2tEZWZpbml0aW9ucygpLFxuICAgICAgcGlja2xlU3RlcCxcbiAgICAgIHN0ZXBSZXN1bHRcbiAgICApXG4gICAgc3RlcFJlc3VsdHMgPSBzdGVwUmVzdWx0cy5jb25jYXQoYWZ0ZXJTdGVwSG9va1Jlc3VsdHMpXG5cbiAgICBjb25zdCBmaW5hbFN0ZXBSZXN1bHQgPSBnZXRXb3JzdFRlc3RTdGVwUmVzdWx0KHN0ZXBSZXN1bHRzKVxuICAgIGxldCBmaW5hbER1cmF0aW9uID0gbWVzc2FnZXMuVGltZUNvbnZlcnNpb24ubWlsbGlzZWNvbmRzVG9EdXJhdGlvbigwKVxuICAgIGZvciAoY29uc3QgcmVzdWx0IG9mIHN0ZXBSZXN1bHRzKSB7XG4gICAgICBmaW5hbER1cmF0aW9uID0gbWVzc2FnZXMuVGltZUNvbnZlcnNpb24uYWRkRHVyYXRpb25zKFxuICAgICAgICBmaW5hbER1cmF0aW9uLFxuICAgICAgICByZXN1bHQuZHVyYXRpb25cbiAgICAgIClcbiAgICB9XG4gICAgZmluYWxTdGVwUmVzdWx0LmR1cmF0aW9uID0gZmluYWxEdXJhdGlvblxuICAgIHJldHVybiBmaW5hbFN0ZXBSZXN1bHRcbiAgfVxufVxuXG5mdW5jdGlvbiBmaW5kSG9va0RlZmluaXRpb24oXG4gIGlkOiBzdHJpbmcsXG4gIHN1cHBvcnRDb2RlTGlicmFyeTogSVN1cHBvcnRDb2RlTGlicmFyeVxuKTogVGVzdENhc2VIb29rRGVmaW5pdGlvbiB7XG4gIHJldHVybiBbXG4gICAgLi4uc3VwcG9ydENvZGVMaWJyYXJ5LmJlZm9yZVRlc3RDYXNlSG9va0RlZmluaXRpb25zLFxuICAgIC4uLnN1cHBvcnRDb2RlTGlicmFyeS5hZnRlclRlc3RDYXNlSG9va0RlZmluaXRpb25zLFxuICBdLmZpbmQoKGRlZmluaXRpb24pID0+IGRlZmluaXRpb24uaWQgPT09IGlkKVxufVxuXG5mdW5jdGlvbiBmaW5kU3RlcERlZmluaXRpb24oXG4gIGlkOiBzdHJpbmcsXG4gIHN1cHBvcnRDb2RlTGlicmFyeTogSVN1cHBvcnRDb2RlTGlicmFyeVxuKTogU3RlcERlZmluaXRpb24ge1xuICByZXR1cm4gc3VwcG9ydENvZGVMaWJyYXJ5LnN0ZXBEZWZpbml0aW9ucy5maW5kKFxuICAgIChkZWZpbml0aW9uKSA9PiBkZWZpbml0aW9uLmlkID09PSBpZFxuICApXG59XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7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