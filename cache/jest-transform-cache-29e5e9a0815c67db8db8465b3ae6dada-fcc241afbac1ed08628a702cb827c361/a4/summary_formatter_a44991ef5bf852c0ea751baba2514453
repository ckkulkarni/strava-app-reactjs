7415ed1f4512afcb3c8ea572a15da2b6
"use strict";

var __importDefault = void 0 && (void 0).__importDefault || function (mod) {
  return mod && mod.__esModule ? mod : {
    "default": mod
  };
};
Object.defineProperty(exports, "__esModule", {
  value: true
});
const helpers_1 = require("./helpers");
const _1 = __importDefault(require("./"));
const value_checker_1 = require("../value_checker");
const issue_helpers_1 = require("./helpers/issue_helpers");
const time_1 = require("../time");
class SummaryFormatter extends _1.default {
  constructor(options) {
    super(options);
    let testRunStartedTimestamp;
    options.eventBroadcaster.on('envelope', envelope => {
      if ((0, value_checker_1.doesHaveValue)(envelope.testRunStarted)) {
        testRunStartedTimestamp = envelope.testRunStarted.timestamp;
      }
      if ((0, value_checker_1.doesHaveValue)(envelope.testRunFinished)) {
        const testRunFinishedTimestamp = envelope.testRunFinished.timestamp;
        this.logSummary((0, time_1.durationBetweenTimestamps)(testRunStartedTimestamp, testRunFinishedTimestamp));
      }
    });
  }
  logSummary(testRunDuration) {
    const failures = [];
    const warnings = [];
    const testCaseAttempts = this.eventDataCollector.getTestCaseAttempts();
    testCaseAttempts.forEach(testCaseAttempt => {
      if ((0, helpers_1.isFailure)(testCaseAttempt.worstTestStepResult, testCaseAttempt.willBeRetried)) {
        failures.push(testCaseAttempt);
      } else if ((0, helpers_1.isWarning)(testCaseAttempt.worstTestStepResult, testCaseAttempt.willBeRetried)) {
        warnings.push(testCaseAttempt);
      }
    });
    if (this.eventDataCollector.undefinedParameterTypes.length > 0) {
      this.log((0, issue_helpers_1.formatUndefinedParameterTypes)(this.eventDataCollector.undefinedParameterTypes));
    }
    if (failures.length > 0) {
      this.logIssues({
        issues: failures,
        title: 'Failures'
      });
    }
    if (warnings.length > 0) {
      this.logIssues({
        issues: warnings,
        title: 'Warnings'
      });
    }
    this.log((0, helpers_1.formatSummary)({
      colorFns: this.colorFns,
      testCaseAttempts,
      testRunDuration
    }));
  }
  logIssues({
    issues,
    title
  }) {
    this.log(`${title}:\n\n`);
    issues.forEach((testCaseAttempt, index) => {
      this.log((0, helpers_1.formatIssue)({
        colorFns: this.colorFns,
        number: index + 1,
        snippetBuilder: this.snippetBuilder,
        supportCodeLibrary: this.supportCodeLibrary,
        testCaseAttempt,
        printAttachments: this.printAttachments
      }));
    });
  }
}
exports.default = SummaryFormatter;
SummaryFormatter.documentation = 'Summary output of feature and scenarios';
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJoZWxwZXJzXzEiLCJyZXF1aXJlIiwiXzEiLCJfX2ltcG9ydERlZmF1bHQiLCJ2YWx1ZV9jaGVja2VyXzEiLCJpc3N1ZV9oZWxwZXJzXzEiLCJ0aW1lXzEiLCJTdW1tYXJ5Rm9ybWF0dGVyIiwiZGVmYXVsdCIsImNvbnN0cnVjdG9yIiwib3B0aW9ucyIsInRlc3RSdW5TdGFydGVkVGltZXN0YW1wIiwiZXZlbnRCcm9hZGNhc3RlciIsIm9uIiwiZW52ZWxvcGUiLCJkb2VzSGF2ZVZhbHVlIiwidGVzdFJ1blN0YXJ0ZWQiLCJ0aW1lc3RhbXAiLCJ0ZXN0UnVuRmluaXNoZWQiLCJ0ZXN0UnVuRmluaXNoZWRUaW1lc3RhbXAiLCJsb2dTdW1tYXJ5IiwiZHVyYXRpb25CZXR3ZWVuVGltZXN0YW1wcyIsInRlc3RSdW5EdXJhdGlvbiIsImZhaWx1cmVzIiwid2FybmluZ3MiLCJ0ZXN0Q2FzZUF0dGVtcHRzIiwiZXZlbnREYXRhQ29sbGVjdG9yIiwiZ2V0VGVzdENhc2VBdHRlbXB0cyIsImZvckVhY2giLCJ0ZXN0Q2FzZUF0dGVtcHQiLCJpc0ZhaWx1cmUiLCJ3b3JzdFRlc3RTdGVwUmVzdWx0Iiwid2lsbEJlUmV0cmllZCIsInB1c2giLCJpc1dhcm5pbmciLCJ1bmRlZmluZWRQYXJhbWV0ZXJUeXBlcyIsImxlbmd0aCIsImxvZyIsImZvcm1hdFVuZGVmaW5lZFBhcmFtZXRlclR5cGVzIiwibG9nSXNzdWVzIiwiaXNzdWVzIiwidGl0bGUiLCJmb3JtYXRTdW1tYXJ5IiwiY29sb3JGbnMiLCJpbmRleCIsImZvcm1hdElzc3VlIiwibnVtYmVyIiwic25pcHBldEJ1aWxkZXIiLCJzdXBwb3J0Q29kZUxpYnJhcnkiLCJwcmludEF0dGFjaG1lbnRzIiwiZXhwb3J0cyIsImRvY3VtZW50YXRpb24iXSwic291cmNlcyI6WyIuLi8uLi9zcmMvZm9ybWF0dGVyL3N1bW1hcnlfZm9ybWF0dGVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGZvcm1hdElzc3VlLCBmb3JtYXRTdW1tYXJ5LCBpc0ZhaWx1cmUsIGlzV2FybmluZyB9IGZyb20gJy4vaGVscGVycydcbmltcG9ydCBGb3JtYXR0ZXIsIHsgSUZvcm1hdHRlck9wdGlvbnMgfSBmcm9tICcuLydcbmltcG9ydCB7IGRvZXNIYXZlVmFsdWUgfSBmcm9tICcuLi92YWx1ZV9jaGVja2VyJ1xuaW1wb3J0ICogYXMgbWVzc2FnZXMgZnJvbSAnQGN1Y3VtYmVyL21lc3NhZ2VzJ1xuaW1wb3J0IHsgSVRlc3RDYXNlQXR0ZW1wdCB9IGZyb20gJy4vaGVscGVycy9ldmVudF9kYXRhX2NvbGxlY3RvcidcbmltcG9ydCB7IGZvcm1hdFVuZGVmaW5lZFBhcmFtZXRlclR5cGVzIH0gZnJvbSAnLi9oZWxwZXJzL2lzc3VlX2hlbHBlcnMnXG5pbXBvcnQgeyBkdXJhdGlvbkJldHdlZW5UaW1lc3RhbXBzIH0gZnJvbSAnLi4vdGltZSdcblxuaW50ZXJmYWNlIElMb2dJc3N1ZXNSZXF1ZXN0IHtcbiAgaXNzdWVzOiBJVGVzdENhc2VBdHRlbXB0W11cbiAgdGl0bGU6IHN0cmluZ1xufVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTdW1tYXJ5Rm9ybWF0dGVyIGV4dGVuZHMgRm9ybWF0dGVyIHtcbiAgcHVibGljIHN0YXRpYyByZWFkb25seSBkb2N1bWVudGF0aW9uOiBzdHJpbmcgPVxuICAgICdTdW1tYXJ5IG91dHB1dCBvZiBmZWF0dXJlIGFuZCBzY2VuYXJpb3MnXG5cbiAgY29uc3RydWN0b3Iob3B0aW9uczogSUZvcm1hdHRlck9wdGlvbnMpIHtcbiAgICBzdXBlcihvcHRpb25zKVxuICAgIGxldCB0ZXN0UnVuU3RhcnRlZFRpbWVzdGFtcDogbWVzc2FnZXMuVGltZXN0YW1wXG4gICAgb3B0aW9ucy5ldmVudEJyb2FkY2FzdGVyLm9uKCdlbnZlbG9wZScsIChlbnZlbG9wZTogbWVzc2FnZXMuRW52ZWxvcGUpID0+IHtcbiAgICAgIGlmIChkb2VzSGF2ZVZhbHVlKGVudmVsb3BlLnRlc3RSdW5TdGFydGVkKSkge1xuICAgICAgICB0ZXN0UnVuU3RhcnRlZFRpbWVzdGFtcCA9IGVudmVsb3BlLnRlc3RSdW5TdGFydGVkLnRpbWVzdGFtcFxuICAgICAgfVxuICAgICAgaWYgKGRvZXNIYXZlVmFsdWUoZW52ZWxvcGUudGVzdFJ1bkZpbmlzaGVkKSkge1xuICAgICAgICBjb25zdCB0ZXN0UnVuRmluaXNoZWRUaW1lc3RhbXAgPSBlbnZlbG9wZS50ZXN0UnVuRmluaXNoZWQudGltZXN0YW1wXG4gICAgICAgIHRoaXMubG9nU3VtbWFyeShcbiAgICAgICAgICBkdXJhdGlvbkJldHdlZW5UaW1lc3RhbXBzKFxuICAgICAgICAgICAgdGVzdFJ1blN0YXJ0ZWRUaW1lc3RhbXAsXG4gICAgICAgICAgICB0ZXN0UnVuRmluaXNoZWRUaW1lc3RhbXBcbiAgICAgICAgICApXG4gICAgICAgIClcbiAgICAgIH1cbiAgICB9KVxuICB9XG5cbiAgbG9nU3VtbWFyeSh0ZXN0UnVuRHVyYXRpb246IG1lc3NhZ2VzLkR1cmF0aW9uKTogdm9pZCB7XG4gICAgY29uc3QgZmFpbHVyZXM6IElUZXN0Q2FzZUF0dGVtcHRbXSA9IFtdXG4gICAgY29uc3Qgd2FybmluZ3M6IElUZXN0Q2FzZUF0dGVtcHRbXSA9IFtdXG4gICAgY29uc3QgdGVzdENhc2VBdHRlbXB0cyA9IHRoaXMuZXZlbnREYXRhQ29sbGVjdG9yLmdldFRlc3RDYXNlQXR0ZW1wdHMoKVxuICAgIHRlc3RDYXNlQXR0ZW1wdHMuZm9yRWFjaCgodGVzdENhc2VBdHRlbXB0KSA9PiB7XG4gICAgICBpZiAoXG4gICAgICAgIGlzRmFpbHVyZShcbiAgICAgICAgICB0ZXN0Q2FzZUF0dGVtcHQud29yc3RUZXN0U3RlcFJlc3VsdCxcbiAgICAgICAgICB0ZXN0Q2FzZUF0dGVtcHQud2lsbEJlUmV0cmllZFxuICAgICAgICApXG4gICAgICApIHtcbiAgICAgICAgZmFpbHVyZXMucHVzaCh0ZXN0Q2FzZUF0dGVtcHQpXG4gICAgICB9IGVsc2UgaWYgKFxuICAgICAgICBpc1dhcm5pbmcoXG4gICAgICAgICAgdGVzdENhc2VBdHRlbXB0LndvcnN0VGVzdFN0ZXBSZXN1bHQsXG4gICAgICAgICAgdGVzdENhc2VBdHRlbXB0LndpbGxCZVJldHJpZWRcbiAgICAgICAgKVxuICAgICAgKSB7XG4gICAgICAgIHdhcm5pbmdzLnB1c2godGVzdENhc2VBdHRlbXB0KVxuICAgICAgfVxuICAgIH0pXG4gICAgaWYgKHRoaXMuZXZlbnREYXRhQ29sbGVjdG9yLnVuZGVmaW5lZFBhcmFtZXRlclR5cGVzLmxlbmd0aCA+IDApIHtcbiAgICAgIHRoaXMubG9nKFxuICAgICAgICBmb3JtYXRVbmRlZmluZWRQYXJhbWV0ZXJUeXBlcyhcbiAgICAgICAgICB0aGlzLmV2ZW50RGF0YUNvbGxlY3Rvci51bmRlZmluZWRQYXJhbWV0ZXJUeXBlc1xuICAgICAgICApXG4gICAgICApXG4gICAgfVxuICAgIGlmIChmYWlsdXJlcy5sZW5ndGggPiAwKSB7XG4gICAgICB0aGlzLmxvZ0lzc3Vlcyh7IGlzc3VlczogZmFpbHVyZXMsIHRpdGxlOiAnRmFpbHVyZXMnIH0pXG4gICAgfVxuICAgIGlmICh3YXJuaW5ncy5sZW5ndGggPiAwKSB7XG4gICAgICB0aGlzLmxvZ0lzc3Vlcyh7IGlzc3Vlczogd2FybmluZ3MsIHRpdGxlOiAnV2FybmluZ3MnIH0pXG4gICAgfVxuICAgIHRoaXMubG9nKFxuICAgICAgZm9ybWF0U3VtbWFyeSh7XG4gICAgICAgIGNvbG9yRm5zOiB0aGlzLmNvbG9yRm5zLFxuICAgICAgICB0ZXN0Q2FzZUF0dGVtcHRzLFxuICAgICAgICB0ZXN0UnVuRHVyYXRpb24sXG4gICAgICB9KVxuICAgIClcbiAgfVxuXG4gIGxvZ0lzc3Vlcyh7IGlzc3VlcywgdGl0bGUgfTogSUxvZ0lzc3Vlc1JlcXVlc3QpOiB2b2lkIHtcbiAgICB0aGlzLmxvZyhgJHt0aXRsZX06XFxuXFxuYClcbiAgICBpc3N1ZXMuZm9yRWFjaCgodGVzdENhc2VBdHRlbXB0LCBpbmRleCkgPT4ge1xuICAgICAgdGhpcy5sb2coXG4gICAgICAgIGZvcm1hdElzc3VlKHtcbiAgICAgICAgICBjb2xvckZuczogdGhpcy5jb2xvckZucyxcbiAgICAgICAgICBudW1iZXI6IGluZGV4ICsgMSxcbiAgICAgICAgICBzbmlwcGV0QnVpbGRlcjogdGhpcy5zbmlwcGV0QnVpbGRlcixcbiAgICAgICAgICBzdXBwb3J0Q29kZUxpYnJhcnk6IHRoaXMuc3VwcG9ydENvZGVMaWJyYXJ5LFxuICAgICAgICAgIHRlc3RDYXNlQXR0ZW1wdCxcbiAgICAgICAgICBwcmludEF0dGFjaG1lbnRzOiB0aGlzLnByaW50QXR0YWNobWVudHMsXG4gICAgICAgIH0pXG4gICAgICApXG4gICAgfSlcbiAgfVxufVxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0FBQUEsTUFBQUEsU0FBQSxHQUFBQyxPQUFBO0FBQ0EsTUFBQUMsRUFBQSxHQUFBQyxlQUFBLENBQUFGLE9BQUE7QUFDQSxNQUFBRyxlQUFBLEdBQUFILE9BQUE7QUFHQSxNQUFBSSxlQUFBLEdBQUFKLE9BQUE7QUFDQSxNQUFBSyxNQUFBLEdBQUFMLE9BQUE7QUFPQSxNQUFxQk0sZ0JBQWlCLFNBQVFMLEVBQUEsQ0FBQU0sT0FBUztFQUlyREMsWUFBWUMsT0FBMEI7SUFDcEMsS0FBSyxDQUFDQSxPQUFPLENBQUM7SUFDZCxJQUFJQyx1QkFBMkM7SUFDL0NELE9BQU8sQ0FBQ0UsZ0JBQWdCLENBQUNDLEVBQUUsQ0FBQyxVQUFVLEVBQUdDLFFBQTJCLElBQUk7TUFDdEUsSUFBSSxJQUFBVixlQUFBLENBQUFXLGFBQWEsRUFBQ0QsUUFBUSxDQUFDRSxjQUFjLENBQUMsRUFBRTtRQUMxQ0wsdUJBQXVCLEdBQUdHLFFBQVEsQ0FBQ0UsY0FBYyxDQUFDQyxTQUFTOztNQUU3RCxJQUFJLElBQUFiLGVBQUEsQ0FBQVcsYUFBYSxFQUFDRCxRQUFRLENBQUNJLGVBQWUsQ0FBQyxFQUFFO1FBQzNDLE1BQU1DLHdCQUF3QixHQUFHTCxRQUFRLENBQUNJLGVBQWUsQ0FBQ0QsU0FBUztRQUNuRSxJQUFJLENBQUNHLFVBQVUsQ0FDYixJQUFBZCxNQUFBLENBQUFl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