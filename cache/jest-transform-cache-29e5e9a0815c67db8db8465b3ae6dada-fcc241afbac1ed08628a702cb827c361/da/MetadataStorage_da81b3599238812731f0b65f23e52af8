7ded4c5ef6c7331fdb98431537911c51
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.MetadataStorage = void 0;
const enums_1 = require("./enums");
/**
 * Storage all library metadata.
 */
class MetadataStorage {
  constructor() {
    // -------------------------------------------------------------------------
    // Properties
    // -------------------------------------------------------------------------
    this._typeMetadatas = new Map();
    this._transformMetadatas = new Map();
    this._exposeMetadatas = new Map();
    this._excludeMetadatas = new Map();
    this._ancestorsMap = new Map();
  }
  // -------------------------------------------------------------------------
  // Adder Methods
  // -------------------------------------------------------------------------
  addTypeMetadata(metadata) {
    if (!this._typeMetadatas.has(metadata.target)) {
      this._typeMetadatas.set(metadata.target, new Map());
    }
    this._typeMetadatas.get(metadata.target).set(metadata.propertyName, metadata);
  }
  addTransformMetadata(metadata) {
    if (!this._transformMetadatas.has(metadata.target)) {
      this._transformMetadatas.set(metadata.target, new Map());
    }
    if (!this._transformMetadatas.get(metadata.target).has(metadata.propertyName)) {
      this._transformMetadatas.get(metadata.target).set(metadata.propertyName, []);
    }
    this._transformMetadatas.get(metadata.target).get(metadata.propertyName).push(metadata);
  }
  addExposeMetadata(metadata) {
    if (!this._exposeMetadatas.has(metadata.target)) {
      this._exposeMetadatas.set(metadata.target, new Map());
    }
    this._exposeMetadatas.get(metadata.target).set(metadata.propertyName, metadata);
  }
  addExcludeMetadata(metadata) {
    if (!this._excludeMetadatas.has(metadata.target)) {
      this._excludeMetadatas.set(metadata.target, new Map());
    }
    this._excludeMetadatas.get(metadata.target).set(metadata.propertyName, metadata);
  }
  // -------------------------------------------------------------------------
  // Public Methods
  // -------------------------------------------------------------------------
  findTransformMetadatas(target, propertyName, transformationType) {
    return this.findMetadatas(this._transformMetadatas, target, propertyName).filter(metadata => {
      if (!metadata.options) return true;
      if (metadata.options.toClassOnly === true && metadata.options.toPlainOnly === true) return true;
      if (metadata.options.toClassOnly === true) {
        return transformationType === enums_1.TransformationType.CLASS_TO_CLASS || transformationType === enums_1.TransformationType.PLAIN_TO_CLASS;
      }
      if (metadata.options.toPlainOnly === true) {
        return transformationType === enums_1.TransformationType.CLASS_TO_PLAIN;
      }
      return true;
    });
  }
  findExcludeMetadata(target, propertyName) {
    return this.findMetadata(this._excludeMetadatas, target, propertyName);
  }
  findExposeMetadata(target, propertyName) {
    return this.findMetadata(this._exposeMetadatas, target, propertyName);
  }
  findExposeMetadataByCustomName(target, name) {
    return this.getExposedMetadatas(target).find(metadata => {
      return metadata.options && metadata.options.name === name;
    });
  }
  findTypeMetadata(target, propertyName) {
    return this.findMetadata(this._typeMetadatas, target, propertyName);
  }
  getStrategy(target) {
    const excludeMap = this._excludeMetadatas.get(target);
    const exclude = excludeMap && excludeMap.get(undefined);
    const exposeMap = this._exposeMetadatas.get(target);
    const expose = exposeMap && exposeMap.get(undefined);
    if (exclude && expose || !exclude && !expose) return 'none';
    return exclude ? 'excludeAll' : 'exposeAll';
  }
  getExposedMetadatas(target) {
    return this.getMetadata(this._exposeMetadatas, target);
  }
  getExcludedMetadatas(target) {
    return this.getMetadata(this._excludeMetadatas, target);
  }
  getExposedProperties(target, transformationType) {
    return this.getExposedMetadatas(target).filter(metadata => {
      if (!metadata.options) return true;
      if (metadata.options.toClassOnly === true && metadata.options.toPlainOnly === true) return true;
      if (metadata.options.toClassOnly === true) {
        return transformationType === enums_1.TransformationType.CLASS_TO_CLASS || transformationType === enums_1.TransformationType.PLAIN_TO_CLASS;
      }
      if (metadata.options.toPlainOnly === true) {
        return transformationType === enums_1.TransformationType.CLASS_TO_PLAIN;
      }
      return true;
    }).map(metadata => metadata.propertyName);
  }
  getExcludedProperties(target, transformationType) {
    return this.getExcludedMetadatas(target).filter(metadata => {
      if (!metadata.options) return true;
      if (metadata.options.toClassOnly === true && metadata.options.toPlainOnly === true) return true;
      if (metadata.options.toClassOnly === true) {
        return transformationType === enums_1.TransformationType.CLASS_TO_CLASS || transformationType === enums_1.TransformationType.PLAIN_TO_CLASS;
      }
      if (metadata.options.toPlainOnly === true) {
        return transformationType === enums_1.TransformationType.CLASS_TO_PLAIN;
      }
      return true;
    }).map(metadata => metadata.propertyName);
  }
  clear() {
    this._typeMetadatas.clear();
    this._exposeMetadatas.clear();
    this._excludeMetadatas.clear();
    this._ancestorsMap.clear();
  }
  // -------------------------------------------------------------------------
  // Private Methods
  // -------------------------------------------------------------------------
  getMetadata(metadatas, target) {
    const metadataFromTargetMap = metadatas.get(target);
    let metadataFromTarget;
    if (metadataFromTargetMap) {
      metadataFromTarget = Array.from(metadataFromTargetMap.values()).filter(meta => meta.propertyName !== undefined);
    }
    const metadataFromAncestors = [];
    for (const ancestor of this.getAncestors(target)) {
      const ancestorMetadataMap = metadatas.get(ancestor);
      if (ancestorMetadataMap) {
        const metadataFromAncestor = Array.from(ancestorMetadataMap.values()).filter(meta => meta.propertyName !== undefined);
        metadataFromAncestors.push(...metadataFromAncestor);
      }
    }
    return metadataFromAncestors.concat(metadataFromTarget || []);
  }
  findMetadata(metadatas, target, propertyName) {
    const metadataFromTargetMap = metadatas.get(target);
    if (metadataFromTargetMap) {
      const metadataFromTarget = metadataFromTargetMap.get(propertyName);
      if (metadataFromTarget) {
        return metadataFromTarget;
      }
    }
    for (const ancestor of this.getAncestors(target)) {
      const ancestorMetadataMap = metadatas.get(ancestor);
      if (ancestorMetadataMap) {
        const ancestorResult = ancestorMetadataMap.get(propertyName);
        if (ancestorResult) {
          return ancestorResult;
        }
      }
    }
    return undefined;
  }
  findMetadatas(metadatas, target, propertyName) {
    const metadataFromTargetMap = metadatas.get(target);
    let metadataFromTarget;
    if (metadataFromTargetMap) {
      metadataFromTarget = metadataFromTargetMap.get(propertyName);
    }
    const metadataFromAncestorsTarget = [];
    for (const ancestor of this.getAncestors(target)) {
      const ancestorMetadataMap = metadatas.get(ancestor);
      if (ancestorMetadataMap) {
        if (ancestorMetadataMap.has(propertyName)) {
          metadataFromAncestorsTarget.push(...ancestorMetadataMap.get(propertyName));
        }
      }
    }
    return metadataFromAncestorsTarget.slice().reverse().concat((metadataFromTarget || []).slice().reverse());
  }
  getAncestors(target) {
    if (!target) return [];
    if (!this._ancestorsMap.has(target)) {
      const ancestors = [];
      for (let baseClass = Object.getPrototypeOf(target.prototype.constructor); typeof baseClass.prototype !== 'undefined'; baseClass = Object.getPrototypeOf(baseClass.prototype.constructor)) {
        ancestors.push(baseClass);
      }
      this._ancestorsMap.set(target, ancestors);
    }
    return this._ancestorsMap.get(target);
  }
}
exports.MetadataStorage = MetadataStorage;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJlbnVtc18xIiwicmVxdWlyZSIsIk1ldGFkYXRhU3RvcmFnZSIsImNvbnN0cnVjdG9yIiwiX3R5cGVNZXRhZGF0YXMiLCJNYXAiLCJfdHJhbnNmb3JtTWV0YWRhdGFzIiwiX2V4cG9zZU1ldGFkYXRhcyIsIl9leGNsdWRlTWV0YWRhdGFzIiwiX2FuY2VzdG9yc01hcCIsImFkZFR5cGVNZXRhZGF0YSIsIm1ldGFkYXRhIiwiaGFzIiwidGFyZ2V0Iiwic2V0IiwiZ2V0IiwicHJvcGVydHlOYW1lIiwiYWRkVHJhbnNmb3JtTWV0YWRhdGEiLCJwdXNoIiwiYWRkRXhwb3NlTWV0YWRhdGEiLCJhZGRFeGNsdWRlTWV0YWRhdGEiLCJmaW5kVHJhbnNmb3JtTWV0YWRhdGFzIiwidHJhbnNmb3JtYXRpb25UeXBlIiwiZmluZE1ldGFkYXRhcyIsImZpbHRlciIsIm9wdGlvbnMiLCJ0b0NsYXNzT25seSIsInRvUGxhaW5Pbmx5IiwiVHJhbnNmb3JtYXRpb25UeXBlIiwiQ0xBU1NfVE9fQ0xBU1MiLCJQTEFJTl9UT19DTEFTUyIsIkNMQVNTX1RPX1BMQUlOIiwiZmluZEV4Y2x1ZGVNZXRhZGF0YSIsImZpbmRNZXRhZGF0YSIsImZpbmRFeHBvc2VNZXRhZGF0YSIsImZpbmRFeHBvc2VNZXRhZGF0YUJ5Q3VzdG9tTmFtZSIsIm5hbWUiLCJnZXRFeHBvc2VkTWV0YWRhdGFzIiwiZmluZCIsImZpbmRUeXBlTWV0YWRhdGEiLCJnZXRTdHJhdGVneSIsImV4Y2x1ZGVNYXAiLCJleGNsdWRlIiwidW5kZWZpbmVkIiwiZXhwb3NlTWFwIiwiZXhwb3NlIiwiZ2V0TWV0YWRhdGEiLCJnZXRFeGNsdWRlZE1ldGFkYXRhcyIsImdldEV4cG9zZWRQcm9wZXJ0aWVzIiwibWFwIiwiZ2V0RXhjbHVkZWRQcm9wZXJ0aWVzIiwiY2xlYXIiLCJtZXRhZGF0YXMiLCJtZXRhZGF0YUZyb21UYXJnZXRNYXAiLCJtZXRhZGF0YUZyb21UYXJnZXQiLCJBcnJheSIsImZyb20iLCJ2YWx1ZXMiLCJtZXRhIiwibWV0YWRhdGFGcm9tQW5jZXN0b3JzIiwiYW5jZXN0b3IiLCJnZXRBbmNlc3RvcnMiLCJhbmNlc3Rvck1ldGFkYXRhTWFwIiwibWV0YWRhdGFGcm9tQW5jZXN0b3IiLCJjb25jYXQiLCJhbmNlc3RvclJlc3VsdCIsIm1ldGFkYXRhRnJvbUFuY2VzdG9yc1RhcmdldCIsInNsaWNlIiwicmV2ZXJzZSIsImFuY2VzdG9ycyIsImJhc2VDbGFzcyIsIk9iamVjdCIsImdldFByb3RvdHlwZU9mIiwicHJvdG90eXBlIiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9NZXRhZGF0YVN0b3JhZ2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgVHlwZU1ldGFkYXRhLCBFeHBvc2VNZXRhZGF0YSwgRXhjbHVkZU1ldGFkYXRhLCBUcmFuc2Zvcm1NZXRhZGF0YSB9IGZyb20gJy4vaW50ZXJmYWNlcyc7XG5pbXBvcnQgeyBUcmFuc2Zvcm1hdGlvblR5cGUgfSBmcm9tICcuL2VudW1zJztcblxuLyoqXG4gKiBTdG9yYWdlIGFsbCBsaWJyYXJ5IG1ldGFkYXRhLlxuICovXG5leHBvcnQgY2xhc3MgTWV0YWRhdGFTdG9yYWdlIHtcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvLyBQcm9wZXJ0aWVzXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuICBwcml2YXRlIF90eXBlTWV0YWRhdGFzID0gbmV3IE1hcDxGdW5jdGlvbiwgTWFwPHN0cmluZywgVHlwZU1ldGFkYXRhPj4oKTtcbiAgcHJpdmF0ZSBfdHJhbnNmb3JtTWV0YWRhdGFzID0gbmV3IE1hcDxGdW5jdGlvbiwgTWFwPHN0cmluZywgVHJhbnNmb3JtTWV0YWRhdGFbXT4+KCk7XG4gIHByaXZhdGUgX2V4cG9zZU1ldGFkYXRhcyA9IG5ldyBNYXA8RnVuY3Rpb24sIE1hcDxzdHJpbmcsIEV4cG9zZU1ldGFkYXRhPj4oKTtcbiAgcHJpdmF0ZSBfZXhjbHVkZU1ldGFkYXRhcyA9IG5ldyBNYXA8RnVuY3Rpb24sIE1hcDxzdHJpbmcsIEV4Y2x1ZGVNZXRhZGF0YT4+KCk7XG4gIHByaXZhdGUgX2FuY2VzdG9yc01hcCA9IG5ldyBNYXA8RnVuY3Rpb24sIEZ1bmN0aW9uW10+KCk7XG5cbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvLyBBZGRlciBNZXRob2RzXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuICBhZGRUeXBlTWV0YWRhdGEobWV0YWRhdGE6IFR5cGVNZXRhZGF0YSk6IHZvaWQge1xuICAgIGlmICghdGhpcy5fdHlwZU1ldGFkYXRhcy5oYXMobWV0YWRhdGEudGFyZ2V0KSkge1xuICAgICAgdGhpcy5fdHlwZU1ldGFkYXRhcy5zZXQobWV0YWRhdGEudGFyZ2V0LCBuZXcgTWFwPHN0cmluZywgVHlwZU1ldGFkYXRhPigpKTtcbiAgICB9XG4gICAgdGhpcy5fdHlwZU1ldGFkYXRhcy5nZXQobWV0YWRhdGEudGFyZ2V0KS5zZXQobWV0YWRhdGEucHJvcGVydHlOYW1lLCBtZXRhZGF0YSk7XG4gIH1cblxuICBhZGRUcmFuc2Zvcm1NZXRhZGF0YShtZXRhZGF0YTogVHJhbnNmb3JtTWV0YWRhdGEpOiB2b2lkIHtcbiAgICBpZiAoIXRoaXMuX3RyYW5zZm9ybU1ldGFkYXRhcy5oYXMobWV0YWRhdGEudGFyZ2V0KSkge1xuICAgICAgdGhpcy5fdHJhbnNmb3JtTWV0YWRhdGFzLnNldChtZXRhZGF0YS50YXJnZXQsIG5ldyBNYXA8c3RyaW5nLCBUcmFuc2Zvcm1NZXRhZGF0YVtdPigpKTtcbiAgICB9XG4gICAgaWYgKCF0aGlzLl90cmFuc2Zvcm1NZXRhZGF0YXMuZ2V0KG1ldGFkYXRhLnRhcmdldCkuaGFzKG1ldGFkYXRhLnByb3BlcnR5TmFtZSkpIHtcbiAgICAgIHRoaXMuX3RyYW5zZm9ybU1ldGFkYXRhcy5nZXQobWV0YWRhdGEudGFyZ2V0KS5zZXQobWV0YWRhdGEucHJvcGVydHlOYW1lLCBbXSk7XG4gICAgfVxuICAgIHRoaXMuX3RyYW5zZm9ybU1ldGFkYXRhcy5nZXQobWV0YWRhdGEudGFyZ2V0KS5nZXQobWV0YWRhdGEucHJvcGVydHlOYW1lKS5wdXNoKG1ldGFkYXRhKTtcbiAgfVxuXG4gIGFkZEV4cG9zZU1ldGFkYXRhKG1ldGFkYXRhOiBFeHBvc2VNZXRhZGF0YSk6IHZvaWQge1xuICAgIGlmICghdGhpcy5fZXhwb3NlTWV0YWRhdGFzLmhhcyhtZXRhZGF0YS50YXJnZXQpKSB7XG4gICAgICB0aGlzLl9leHBvc2VNZXRhZGF0YXMuc2V0KG1ldGFkYXRhLnRhcmdldCwgbmV3IE1hcDxzdHJpbmcsIEV4cG9zZU1ldGFkYXRhPigpKTtcbiAgICB9XG4gICAgdGhpcy5fZXhwb3NlTWV0YWRhdGFzLmdldChtZXRhZGF0YS50YXJnZXQpLnNldChtZXRhZGF0YS5wcm9wZXJ0eU5hbWUsIG1ldGFkYXRhKTtcbiAgfVxuXG4gIGFkZEV4Y2x1ZGVNZXRhZGF0YShtZXRhZGF0YTogRXhjbHVkZU1ldGFkYXRhKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLl9leGNsdWRlTWV0YWRhdGFzLmhhcyhtZXRhZGF0YS50YXJnZXQpKSB7XG4gICAgICB0aGlzLl9leGNsdWRlTWV0YWRhdGFzLnNldChtZXRhZGF0YS50YXJnZXQsIG5ldyBNYXA8c3RyaW5nLCBFeGNsdWRlTWV0YWRhdGE+KCkpO1xuICAgIH1cbiAgICB0aGlzLl9leGNsdWRlTWV0YWRhdGFzLmdldChtZXRhZGF0YS50YXJnZXQpLnNldChtZXRhZGF0YS5wcm9wZXJ0eU5hbWUsIG1ldGFkYXRhKTtcbiAgfVxuXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy8gUHVibGljIE1ldGhvZHNcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG4gIGZpbmRUcmFuc2Zvcm1NZXRhZGF0YXMoXG4gICAgdGFyZ2V0OiBGdW5jdGlvbixcbiAgICBwcm9wZXJ0eU5hbWU6IHN0cmluZyxcbiAgICB0cmFuc2Zvcm1hdGlvblR5cGU6IFRyYW5zZm9ybWF0aW9uVHlwZVxuICApOiBUcmFuc2Zvcm1NZXRhZGF0YVtdIHtcbiAgICByZXR1cm4gdGhpcy5maW5kTWV0YWRhdGFzKHRoaXMuX3RyYW5zZm9ybU1ldGFkYXRhcywgdGFyZ2V0LCBwcm9wZXJ0eU5hbWUpLmZpbHRlcihtZXRhZGF0YSA9PiB7XG4gICAgICBpZiAoIW1ldGFkYXRhLm9wdGlvbnMpIHJldHVybiB0cnVlO1xuICAgICAgaWYgKG1ldGFkYXRhLm9wdGlvbnMudG9DbGFzc09ubHkgPT09IHRydWUgJiYgbWV0YWRhdGEub3B0aW9ucy50b1BsYWluT25seSA9PT0gdHJ1ZSkgcmV0dXJuIHRydWU7XG5cbiAgICAgIGlmIChtZXRhZGF0YS5vcHRpb25zLnRvQ2xhc3NPbmx5ID09PSB0cnVlKSB7XG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgdHJhbnNmb3JtYXRpb25UeXBlID09PSBUcmFuc2Zvcm1hdGlvblR5cGUuQ0xBU1NfVE9fQ0xBU1MgfHxcbiAgICAgICAgICB0cmFuc2Zvcm1hdGlvblR5cGUgPT09IFRyYW5zZm9ybWF0aW9uVHlwZS5QTEFJTl9UT19DTEFTU1xuICAgICAgICApO1xuICAgICAgfVxuICAgICAgaWYgKG1ldGFkYXRhLm9wdGlvbnMudG9QbGFpbk9ubHkgPT09IHRydWUpIHtcbiAgICAgICAgcmV0dXJuIHRyYW5zZm9ybWF0aW9uVHlwZSA9PT0gVHJhbnNmb3JtYXRpb25UeXBlLkNMQVNTX1RPX1BMQUlOO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9KTtcbiAgfVxuXG4gIGZpbmRFeGNsdWRlTWV0YWRhdGEodGFyZ2V0OiBGdW5jdGlvbiwgcHJvcGVydHlOYW1lOiBzdHJpbmcpOiBFeGNsdWRlTWV0YWRhdGEge1xuICAgIHJldHVybiB0aGlzLmZpbmRNZXRhZGF0YSh0aGlzLl9leGNsdWRlTWV0YWRhdGFzLCB0YXJnZXQsIHByb3BlcnR5TmFtZSk7XG4gIH1cblxuICBmaW5kRXhwb3NlTWV0YWRhdGEodGFyZ2V0OiBGdW5jdGlvbiwgcHJvcGVydHlOYW1lOiBzdHJpbmcpOiBFeHBvc2VNZXRhZGF0YSB7XG4gICAgcmV0dXJuIHRoaXMuZmluZE1ldGFkYXRhKHRoaXMuX2V4cG9zZU1ldGFkYXRhcywgdGFyZ2V0LCBwcm9wZXJ0eU5hbWUpO1xuICB9XG5cbiAgZmluZEV4cG9zZU1ldGFkYXRhQnlDdXN0b21OYW1lKHRhcmdldDogRnVuY3Rpb24sIG5hbWU6IHN0cmluZyk6IEV4cG9zZU1ldGFkYXRhIHtcbiAgICByZXR1cm4gdGhpcy5nZXRFeHBvc2VkTWV0YWRhdGFzKHRhcmdldCkuZmluZChtZXRhZGF0YSA9PiB7XG4gICAgICByZXR1cm4gbWV0YWRhdGEub3B0aW9ucyAmJiBtZXRhZGF0YS5vcHRpb25zLm5hbWUgPT09IG5hbWU7XG4gICAgfSk7XG4gIH1cblxuICBmaW5kVHlwZU1ldGFkYXRhKHRhcmdldDogRnVuY3Rpb24sIHByb3BlcnR5TmFtZTogc3RyaW5nKTogVHlwZU1ldGFkYXRhIHtcbiAgICByZXR1cm4gdGhpcy5maW5kTWV0YWRhdGEodGhpcy5fdHlwZU1ldGFkYXRhcywgdGFyZ2V0LCBwcm9wZXJ0eU5hbWUpO1xuICB9XG5cbiAgZ2V0U3RyYXRlZ3kodGFyZ2V0OiBGdW5jdGlvbik6ICdleGNsdWRlQWxsJyB8ICdleHBvc2VBbGwnIHwgJ25vbmUnIHtcbiAgICBjb25zdCBleGNsdWRlTWFwID0gdGhpcy5fZXhjbHVkZU1ldGFkYXRhcy5nZXQodGFyZ2V0KTtcbiAgICBjb25zdCBleGNsdWRlID0gZXhjbHVkZU1hcCAmJiBleGNsdWRlTWFwLmdldCh1bmRlZmluZWQpO1xuICAgIGNvbnN0IGV4cG9zZU1hcCA9IHRoaXMuX2V4cG9zZU1ldGFkYXRhcy5nZXQodGFyZ2V0KTtcbiAgICBjb25zdCBleHBvc2UgPSBleHBvc2VNYXAgJiYgZXhwb3NlTWFwLmdldCh1bmRlZmluZWQpO1xuICAgIGlmICgoZXhjbHVkZSAmJiBleHBvc2UpIHx8ICghZXhjbHVkZSAmJiAhZXhwb3NlKSkgcmV0dXJuICdub25lJztcbiAgICByZXR1cm4gZXhjbHVkZSA/ICdleGNsdWRlQWxsJyA6ICdleHBvc2VBbGwnO1xuICB9XG5cbiAgZ2V0RXhwb3NlZE1ldGFkYXRhcyh0YXJnZXQ6IEZ1bmN0aW9uKTogRXhwb3NlTWV0YWRhdGFbXSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0TWV0YWRhdGEodGhpcy5fZXhwb3NlTWV0YWRhdGFzLCB0YXJnZXQpO1xuICB9XG5cbiAgZ2V0RXhjbHVkZWRNZXRhZGF0YXModGFyZ2V0OiBGdW5jdGlvbik6IEV4Y2x1ZGVNZXRhZGF0YVtdIHtcbiAgICByZXR1cm4gdGhpcy5nZXRNZXRhZGF0YSh0aGlzLl9leGNsdWRlTWV0YWRhdGFzLCB0YXJnZXQpO1xuICB9XG5cbiAgZ2V0RXhwb3NlZFByb3BlcnRpZXModGFyZ2V0OiBGdW5jdGlvbiwgdHJhbnNmb3JtYXRpb25UeXBlOiBUcmFuc2Zvcm1hdGlvblR5cGUpOiBzdHJpbmdbXSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0RXhwb3NlZE1ldGFkYXRhcyh0YXJnZXQpXG4gICAgICAuZmlsdGVyKG1ldGFkYXRhID0+IHtcbiAgICAgICAgaWYgKCFtZXRhZGF0YS5vcHRpb25zKSByZXR1cm4gdHJ1ZTtcbiAgICAgICAgaWYgKG1ldGFkYXRhLm9wdGlvbnMudG9DbGFzc09ubHkgPT09IHRydWUgJiYgbWV0YWRhdGEub3B0aW9ucy50b1BsYWluT25seSA9PT0gdHJ1ZSkgcmV0dXJuIHRydWU7XG5cbiAgICAgICAgaWYgKG1ldGFkYXRhLm9wdGlvbnMudG9DbGFzc09ubHkgPT09IHRydWUpIHtcbiAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgdHJhbnNmb3JtYXRpb25UeXBlID09PSBUcmFuc2Zvcm1hdGlvblR5cGUuQ0xBU1NfVE9fQ0xBU1MgfHxcbiAgICAgICAgICAgIHRyYW5zZm9ybWF0aW9uVHlwZSA9PT0gVHJhbnNmb3JtYXRpb25UeXBlLlBMQUlOX1RPX0NMQVNTXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobWV0YWRhdGEub3B0aW9ucy50b1BsYWluT25seSA9PT0gdHJ1ZSkge1xuICAgICAgICAgIHJldHVybiB0cmFuc2Zvcm1hdGlvblR5cGUgPT09IFRyYW5zZm9ybWF0aW9uVHlwZS5DTEFTU19UT19QTEFJTjtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfSlcbiAgICAgIC5tYXAobWV0YWRhdGEgPT4gbWV0YWRhdGEucHJvcGVydHlOYW1lKTtcbiAgfVxuXG4gIGdldEV4Y2x1ZGVkUHJvcGVydGllcyh0YXJnZXQ6IEZ1bmN0aW9uLCB0cmFuc2Zvcm1hdGlvblR5cGU6IFRyYW5zZm9ybWF0aW9uVHlwZSk6IHN0cmluZ1tdIHtcbiAgICByZXR1cm4gdGhpcy5nZXRFeGNsdWRlZE1ldGFkYXRhcyh0YXJnZXQpXG4gICAgICAuZmlsdGVyKG1ldGFkYXRhID0+IHtcbiAgICAgICAgaWYgKCFtZXRhZGF0YS5vcHRpb25zKSByZXR1cm4gdHJ1ZTtcbiAgICAgICAgaWYgKG1ldGFkYXRhLm9wdGlvbnMudG9DbGFzc09ubHkgPT09IHRydWUgJiYgbWV0YWRhdGEub3B0aW9ucy50b1BsYWluT25seSA9PT0gdHJ1ZSkgcmV0dXJuIHRydWU7XG5cbiAgICAgICAgaWYgKG1ldGFkYXRhLm9wdGlvbnMudG9DbGFzc09ubHkgPT09IHRydWUpIHtcbiAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgdHJhbnNmb3JtYXRpb25UeXBlID09PSBUcmFuc2Zvcm1hdGlvblR5cGUuQ0xBU1NfVE9fQ0xBU1MgfHxcbiAgICAgICAgICAgIHRyYW5zZm9ybWF0aW9uVHlwZSA9PT0gVHJhbnNmb3JtYXRpb25UeXBlLlBMQUlOX1RPX0NMQVNTXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobWV0YWRhdGEub3B0aW9ucy50b1BsYWluT25seSA9PT0gdHJ1ZSkge1xuICAgICAgICAgIHJldHVybiB0cmFuc2Zvcm1hdGlvblR5cGUgPT09IFRyYW5zZm9ybWF0aW9uVHlwZS5DTEFTU19UT19QTEFJTjtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfSlcbiAgICAgIC5tYXAobWV0YWRhdGEgPT4gbWV0YWRhdGEucHJvcGVydHlOYW1lKTtcbiAgfVxuXG4gIGNsZWFyKCk6IHZvaWQge1xuICAgIHRoaXMuX3R5cGVNZXRhZGF0YXMuY2xlYXIoKTtcbiAgICB0aGlzLl9leHBvc2VNZXRhZGF0YXMuY2xlYXIoKTtcbiAgICB0aGlzLl9leGNsdWRlTWV0YWRhdGFzLmNsZWFyKCk7XG4gICAgdGhpcy5fYW5jZXN0b3JzTWFwLmNsZWFyKCk7XG4gIH1cblxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vIFByaXZhdGUgTWV0aG9kc1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbiAgcHJpdmF0ZSBnZXRNZXRhZGF0YTxUIGV4dGVuZHMgeyB0YXJnZXQ6IEZ1bmN0aW9uOyBwcm9wZXJ0eU5hbWU6IHN0cmluZyB9PihcbiAgICBtZXRhZGF0YXM6IE1hcDxGdW5jdGlvbiwgTWFwPHN0cmluZywgVD4+LFxuICAgIHRhcmdldDogRnVuY3Rpb25cbiAgKTogVFtdIHtcbiAgICBjb25zdCBtZXRhZGF0YUZyb21UYXJnZXRNYXAgPSBtZXRhZGF0YXMuZ2V0KHRhcmdldCk7XG4gICAgbGV0IG1ldGFkYXRhRnJvbVRhcmdldDogVFtdO1xuICAgIGlmIChtZXRhZGF0YUZyb21UYXJnZXRNYXApIHtcbiAgICAgIG1ldGFkYXRhRnJvbVRhcmdldCA9IEFycmF5LmZyb20obWV0YWRhdGFGcm9tVGFyZ2V0TWFwLnZhbHVlcygpKS5maWx0ZXIobWV0YSA9PiBtZXRhLnByb3BlcnR5TmFtZSAhPT0gdW5kZWZpbmVkKTtcbiAgICB9XG4gICAgY29uc3QgbWV0YWRhdGFGcm9tQW5jZXN0b3JzOiBUW10gPSBbXTtcbiAgICBmb3IgKGNvbnN0IGFuY2VzdG9yIG9mIHRoaXMuZ2V0QW5jZXN0b3JzKHRhcmdldCkpIHtcbiAgICAgIGNvbnN0IGFuY2VzdG9yTWV0YWRhdGFNYXAgPSBtZXRhZGF0YXMuZ2V0KGFuY2VzdG9yKTtcbiAgICAgIGlmIChhbmNlc3Rvck1ldGFkYXRhTWFwKSB7XG4gICAgICAgIGNvbnN0IG1ldGFkYXRhRnJvbUFuY2VzdG9yID0gQXJyYXkuZnJvbShhbmNlc3Rvck1ldGFkYXRhTWFwLnZhbHVlcygpKS5maWx0ZXIoXG4gICAgICAgICAgbWV0YSA9PiBtZXRhLnByb3BlcnR5TmFtZSAhPT0gdW5kZWZpbmVkXG4gICAgICAgICk7XG4gICAgICAgIG1ldGFkYXRhRnJvbUFuY2VzdG9ycy5wdXNoKC4uLm1ldGFkYXRhRnJvbUFuY2VzdG9yKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG1ldGFkYXRhRnJvbUFuY2VzdG9ycy5jb25jYXQobWV0YWRhdGFGcm9tVGFyZ2V0IHx8IFtdKTtcbiAgfVxuXG4gIHByaXZhdGUgZmluZE1ldGFkYXRhPFQgZXh0ZW5kcyB7IHRhcmdldDogRnVuY3Rpb247IHByb3BlcnR5TmFtZTogc3RyaW5nIH0+KFxuICAgIG1ldGFkYXRhczogTWFwPEZ1bmN0aW9uLCBNYXA8c3RyaW5nLCBUPj4sXG4gICAgdGFyZ2V0OiBGdW5jdGlvbixcbiAgICBwcm9wZXJ0eU5hbWU6IHN0cmluZ1xuICApOiBUIHtcbiAgICBjb25zdCBtZXRhZGF0YUZyb21UYXJnZXRNYXAgPSBtZXRhZGF0YXMuZ2V0KHRhcmdldCk7XG4gICAgaWYgKG1ldGFkYXRhRnJvbVRhcmdldE1hcCkge1xuICAgICAgY29uc3QgbWV0YWRhdGFGcm9tVGFyZ2V0ID0gbWV0YWRhdGFGcm9tVGFyZ2V0TWFwLmdldChwcm9wZXJ0eU5hbWUpO1xuICAgICAgaWYgKG1ldGFkYXRhRnJvbVRhcmdldCkge1xuICAgICAgICByZXR1cm4gbWV0YWRhdGFGcm9tVGFyZ2V0O1xuICAgICAgfVxuICAgIH1cbiAgICBmb3IgKGNvbnN0IGFuY2VzdG9yIG9mIHRoaXMuZ2V0QW5jZXN0b3JzKHRhcmdldCkpIHtcbiAgICAgIGNvbnN0IGFuY2VzdG9yTWV0YWRhdGFNYXAgPSBtZXRhZGF0YXMuZ2V0KGFuY2VzdG9yKTtcbiAgICAgIGlmIChhbmNlc3Rvck1ldGFkYXRhTWFwKSB7XG4gICAgICAgIGNvbnN0IGFuY2VzdG9yUmVzdWx0ID0gYW5jZXN0b3JNZXRhZGF0YU1hcC5nZXQocHJvcGVydHlOYW1lKTtcbiAgICAgICAgaWYgKGFuY2VzdG9yUmVzdWx0KSB7XG4gICAgICAgICAgcmV0dXJuIGFuY2VzdG9yUmVzdWx0O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cblxuICBwcml2YXRlIGZpbmRNZXRhZGF0YXM8VCBleHRlbmRzIHsgdGFyZ2V0OiBGdW5jdGlvbjsgcHJvcGVydHlOYW1lOiBzdHJpbmcgfT4oXG4gICAgbWV0YWRhdGFzOiBNYXA8RnVuY3Rpb24sIE1hcDxzdHJpbmcsIFRbXT4+LFxuICAgIHRhcmdldDogRnVuY3Rpb24sXG4gICAgcHJvcGVydHlOYW1lOiBzdHJpbmdcbiAgKTogVFtdIHtcbiAgICBjb25zdCBtZXRhZGF0YUZyb21UYXJnZXRNYXAgPSBtZXRhZGF0YXMuZ2V0KHRhcmdldCk7XG4gICAgbGV0IG1ldGFkYXRhRnJvbVRhcmdldDogVFtdO1xuICAgIGlmIChtZXRhZGF0YUZyb21UYXJnZXRNYXApIHtcbiAgICAgIG1ldGFkYXRhRnJvbVRhcmdldCA9IG1ldGFkYXRhRnJvbVRhcmdldE1hcC5nZXQocHJvcGVydHlOYW1lKTtcbiAgICB9XG4gICAgY29uc3QgbWV0YWRhdGFGcm9tQW5jZXN0b3JzVGFyZ2V0OiBUW10gPSBbXTtcbiAgICBmb3IgKGNvbnN0IGFuY2VzdG9yIG9mIHRoaXMuZ2V0QW5jZXN0b3JzKHRhcmdldCkpIHtcbiAgICAgIGNvbnN0IGFuY2VzdG9yTWV0YWRhdGFNYXAgPSBtZXRhZGF0YXMuZ2V0KGFuY2VzdG9yKTtcbiAgICAgIGlmIChhbmNlc3Rvck1ldGFkYXRhTWFwKSB7XG4gICAgICAgIGlmIChhbmNlc3Rvck1ldGFkYXRhTWFwLmhhcyhwcm9wZXJ0eU5hbWUpKSB7XG4gICAgICAgICAgbWV0YWRhdGFGcm9tQW5jZXN0b3JzVGFyZ2V0LnB1c2goLi4uYW5jZXN0b3JNZXRhZGF0YU1hcC5nZXQocHJvcGVydHlOYW1lKSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG1ldGFkYXRhRnJvbUFuY2VzdG9yc1RhcmdldFxuICAgICAgLnNsaWNlKClcbiAgICAgIC5yZXZlcnNlKClcbiAgICAgIC5jb25jYXQoKG1ldGFkYXRhRnJvbVRhcmdldCB8fCBbXSkuc2xpY2UoKS5yZXZlcnNlKCkpO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRBbmNlc3RvcnModGFyZ2V0OiBGdW5jdGlvbik6IEZ1bmN0aW9uW10ge1xuICAgIGlmICghdGFyZ2V0KSByZXR1cm4gW107XG4gICAgaWYgKCF0aGlzLl9hbmNlc3RvcnNNYXAuaGFzKHRhcmdldCkpIHtcbiAgICAgIGNvbnN0IGFuY2VzdG9yczogRnVuY3Rpb25bXSA9IFtdO1xuICAgICAgZm9yIChcbiAgICAgICAgbGV0IGJhc2VDbGFzcyA9IE9iamVjdC5nZXRQcm90b3R5cGVPZih0YXJnZXQucHJvdG90eXBlLmNvbnN0cnVjdG9yKTtcbiAgICAgICAgdHlwZW9mIGJhc2VDbGFzcy5wcm90b3R5cGUgIT09ICd1bmRlZmluZWQnO1xuICAgICAgICBiYXNlQ2xhc3MgPSBPYmplY3QuZ2V0UHJvdG90eXBlT2YoYmFzZUNsYXNzLnByb3RvdHlwZS5jb25zdHJ1Y3RvcilcbiAgICAgICkge1xuICAgICAgICBhbmNlc3RvcnMucHVzaChiYXNlQ2xhc3MpO1xuICAgICAgfVxuICAgICAgdGhpcy5fYW5jZXN0b3JzTWFwLnNldCh0YXJnZXQsIGFuY2VzdG9ycyk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLl9hbmNlc3RvcnNNYXAuZ2V0KHRhcmdldCk7XG4gIH1cbn1cbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQ0EsTUFBQUEsT0FBQSxHQUFBQyxPQUFBO0FBRUE7OztBQUdBLE1BQWFDLGVBQWU7RUFBNUJDLFlBQUE7SUFDRTtJQUNBO0lBQ0E7SUFFUSxLQUFBQyxjQUFjLEdBQUcsSUFBSUMsR0FBRyxFQUF1QztJQUMvRCxLQUFBQyxtQkFBbUIsR0FBRyxJQUFJRCxHQUFHLEVBQThDO0lBQzNFLEtBQUFFLGdCQUFnQixHQUFHLElBQUlGLEdBQUcsRUFBeUM7SUFDbkUsS0FBQUcsaUJBQWlCLEdBQUcsSUFBSUgsR0FBRyxFQUEwQztJQUNyRSxLQUFBSSxhQUFhLEdBQUcsSUFBSUosR0FBRyxFQUF3QjtFQThPekQ7RUE1T0U7RUFDQTtFQUNBO0VBRUFLLGVBQWVBLENBQUNDLFFBQXNCO0lBQ3BDLElBQUksQ0FBQyxJQUFJLENBQUNQLGNBQWMsQ0FBQ1EsR0FBRyxDQUFDRCxRQUFRLENBQUNFLE1BQU0sQ0FBQyxFQUFFO01BQzdDLElBQUksQ0FBQ1QsY0FBYyxDQUFDVSxHQUFHLENBQUNILFFBQVEsQ0FBQ0UsTUFBTSxFQUFFLElBQUlSLEdBQUcsRUFBd0IsQ0FBQzs7SUFFM0UsSUFBSSxDQUFDRCxjQUFjLENBQUNXLEdBQUcsQ0FBQ0osUUFBUSxDQUFDRSxNQUFNLENBQUMsQ0FBQ0MsR0FBRyxDQUFDSCxRQUFRLENBQUNLLFlBQVksRUFBRUwsUUFBUSxDQUFDO0VBQy9FO0VBRUFNLG9CQUFvQkEsQ0FBQ04sUUFBMkI7SUFDOUMsSUFB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