{"version":3,"names":["Alias","require","Node","Scalar","defaultTagPrefix","findTagObject","value","tagName","tags","match","filter","t","tag","tagObj","find","format","Error","identify","createNode","ctx","isDocument","contents","isNode","isPair","map","schema","MAP","items","push","String","Number","Boolean","BigInt","valueOf","aliasDuplicateObjects","onAnchor","onTagObj","sourceObjects","ref","undefined","get","anchor","node","set","startsWith","slice","toJSON","Map","Symbol","iterator","Object","SEQ","exports"],"sources":["createNode.js"],"sourcesContent":["'use strict';\n\nvar Alias = require('../nodes/Alias.js');\nvar Node = require('../nodes/Node.js');\nvar Scalar = require('../nodes/Scalar.js');\n\nconst defaultTagPrefix = 'tag:yaml.org,2002:';\nfunction findTagObject(value, tagName, tags) {\n    if (tagName) {\n        const match = tags.filter(t => t.tag === tagName);\n        const tagObj = match.find(t => !t.format) ?? match[0];\n        if (!tagObj)\n            throw new Error(`Tag ${tagName} not found`);\n        return tagObj;\n    }\n    return tags.find(t => t.identify?.(value) && !t.format);\n}\nfunction createNode(value, tagName, ctx) {\n    if (Node.isDocument(value))\n        value = value.contents;\n    if (Node.isNode(value))\n        return value;\n    if (Node.isPair(value)) {\n        const map = ctx.schema[Node.MAP].createNode?.(ctx.schema, null, ctx);\n        map.items.push(value);\n        return map;\n    }\n    if (value instanceof String ||\n        value instanceof Number ||\n        value instanceof Boolean ||\n        (typeof BigInt !== 'undefined' && value instanceof BigInt) // not supported everywhere\n    ) {\n        // https://tc39.es/ecma262/#sec-serializejsonproperty\n        value = value.valueOf();\n    }\n    const { aliasDuplicateObjects, onAnchor, onTagObj, schema, sourceObjects } = ctx;\n    // Detect duplicate references to the same object & use Alias nodes for all\n    // after first. The `ref` wrapper allows for circular references to resolve.\n    let ref = undefined;\n    if (aliasDuplicateObjects && value && typeof value === 'object') {\n        ref = sourceObjects.get(value);\n        if (ref) {\n            if (!ref.anchor)\n                ref.anchor = onAnchor(value);\n            return new Alias.Alias(ref.anchor);\n        }\n        else {\n            ref = { anchor: null, node: null };\n            sourceObjects.set(value, ref);\n        }\n    }\n    if (tagName?.startsWith('!!'))\n        tagName = defaultTagPrefix + tagName.slice(2);\n    let tagObj = findTagObject(value, tagName, schema.tags);\n    if (!tagObj) {\n        if (value && typeof value.toJSON === 'function') {\n            // eslint-disable-next-line @typescript-eslint/no-unsafe-call\n            value = value.toJSON();\n        }\n        if (!value || typeof value !== 'object') {\n            const node = new Scalar.Scalar(value);\n            if (ref)\n                ref.node = node;\n            return node;\n        }\n        tagObj =\n            value instanceof Map\n                ? schema[Node.MAP]\n                : Symbol.iterator in Object(value)\n                    ? schema[Node.SEQ]\n                    : schema[Node.MAP];\n    }\n    if (onTagObj) {\n        onTagObj(tagObj);\n        delete ctx.onTagObj;\n    }\n    const node = tagObj?.createNode\n        ? tagObj.createNode(ctx.schema, value, ctx)\n        : new Scalar.Scalar(value);\n    if (tagName)\n        node.tag = tagName;\n    if (ref)\n        ref.node = node;\n    return node;\n}\n\nexports.createNode = createNode;\n"],"mappings":"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"}