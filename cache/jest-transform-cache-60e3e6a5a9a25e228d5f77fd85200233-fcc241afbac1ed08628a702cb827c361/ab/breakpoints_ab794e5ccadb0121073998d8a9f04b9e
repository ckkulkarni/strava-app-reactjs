7e07f15eb33da7ea2317dc4d0e8ee200
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.computeBreakpointsBase = computeBreakpointsBase;
exports.createEmptyBreakpointObject = createEmptyBreakpointObject;
exports.default = void 0;
exports.handleBreakpoints = handleBreakpoints;
exports.mergeBreakpointsInOrder = mergeBreakpointsInOrder;
exports.removeUnusedBreakpoints = removeUnusedBreakpoints;
exports.resolveBreakpointValues = resolveBreakpointValues;
exports.values = void 0;
var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));
var _propTypes = _interopRequireDefault(require("prop-types"));
var _utils = require("@mui/utils");
var _merge = _interopRequireDefault(require("./merge"));
// The breakpoint **start** at this value.
// For instance with the first breakpoint xs: [xs, sm[.
const values = {
  xs: 0,
  // phone
  sm: 600,
  // tablet
  md: 900,
  // small laptop
  lg: 1200,
  // desktop
  xl: 1536 // large screen
};

exports.values = values;
const defaultBreakpoints = {
  // Sorted ASC by size. That's important.
  // It can't be configured as it's used statically for propTypes.
  keys: ['xs', 'sm', 'md', 'lg', 'xl'],
  up: key => `@media (min-width:${values[key]}px)`
};
function handleBreakpoints(props, propValue, styleFromPropValue) {
  const theme = props.theme || {};
  if (Array.isArray(propValue)) {
    const themeBreakpoints = theme.breakpoints || defaultBreakpoints;
    return propValue.reduce((acc, item, index) => {
      acc[themeBreakpoints.up(themeBreakpoints.keys[index])] = styleFromPropValue(propValue[index]);
      return acc;
    }, {});
  }
  if (typeof propValue === 'object') {
    const themeBreakpoints = theme.breakpoints || defaultBreakpoints;
    return Object.keys(propValue).reduce((acc, breakpoint) => {
      // key is breakpoint
      if (Object.keys(themeBreakpoints.values || values).indexOf(breakpoint) !== -1) {
        const mediaKey = themeBreakpoints.up(breakpoint);
        acc[mediaKey] = styleFromPropValue(propValue[breakpoint], breakpoint);
      } else {
        const cssKey = breakpoint;
        acc[cssKey] = propValue[cssKey];
      }
      return acc;
    }, {});
  }
  const output = styleFromPropValue(propValue);
  return output;
}
function breakpoints(styleFunction) {
  // false positive
  // eslint-disable-next-line react/function-component-definition
  const newStyleFunction = props => {
    const theme = props.theme || {};
    const base = styleFunction(props);
    const themeBreakpoints = theme.breakpoints || defaultBreakpoints;
    const extended = themeBreakpoints.keys.reduce((acc, key) => {
      if (props[key]) {
        acc = acc || {};
        acc[themeBreakpoints.up(key)] = styleFunction((0, _extends2.default)({
          theme
        }, props[key]));
      }
      return acc;
    }, null);
    return (0, _merge.default)(base, extended);
  };
  newStyleFunction.propTypes = process.env.NODE_ENV !== 'production' ? (0, _extends2.default)({}, styleFunction.propTypes, {
    xs: _propTypes.default.object,
    sm: _propTypes.default.object,
    md: _propTypes.default.object,
    lg: _propTypes.default.object,
    xl: _propTypes.default.object
  }) : {};
  newStyleFunction.filterProps = ['xs', 'sm', 'md', 'lg', 'xl', ...styleFunction.filterProps];
  return newStyleFunction;
}
function createEmptyBreakpointObject(breakpointsInput = {}) {
  var _breakpointsInput$key;
  const breakpointsInOrder = (_breakpointsInput$key = breakpointsInput.keys) == null ? void 0 : _breakpointsInput$key.reduce((acc, key) => {
    const breakpointStyleKey = breakpointsInput.up(key);
    acc[breakpointStyleKey] = {};
    return acc;
  }, {});
  return breakpointsInOrder || {};
}
function removeUnusedBreakpoints(breakpointKeys, style) {
  return breakpointKeys.reduce((acc, key) => {
    const breakpointOutput = acc[key];
    const isBreakpointUnused = !breakpointOutput || Object.keys(breakpointOutput).length === 0;
    if (isBreakpointUnused) {
      delete acc[key];
    }
    return acc;
  }, style);
}
function mergeBreakpointsInOrder(breakpointsInput, ...styles) {
  const emptyBreakpoints = createEmptyBreakpointObject(breakpointsInput);
  const mergedOutput = [emptyBreakpoints, ...styles].reduce((prev, next) => (0, _utils.deepmerge)(prev, next), {});
  return removeUnusedBreakpoints(Object.keys(emptyBreakpoints), mergedOutput);
}

// compute base for responsive values; e.g.,
// [1,2,3] => {xs: true, sm: true, md: true}
// {xs: 1, sm: 2, md: 3} => {xs: true, sm: true, md: true}
function computeBreakpointsBase(breakpointValues, themeBreakpoints) {
  // fixed value
  if (typeof breakpointValues !== 'object') {
    return {};
  }
  const base = {};
  const breakpointsKeys = Object.keys(themeBreakpoints);
  if (Array.isArray(breakpointValues)) {
    breakpointsKeys.forEach((breakpoint, i) => {
      if (i < breakpointValues.length) {
        base[breakpoint] = true;
      }
    });
  } else {
    breakpointsKeys.forEach(breakpoint => {
      if (breakpointValues[breakpoint] != null) {
        base[breakpoint] = true;
      }
    });
  }
  return base;
}
function resolveBreakpointValues({
  values: breakpointValues,
  breakpoints: themeBreakpoints,
  base: customBase
}) {
  const base = customBase || computeBreakpointsBase(breakpointValues, themeBreakpoints);
  const keys = Object.keys(base);
  if (keys.length === 0) {
    return breakpointValues;
  }
  let previous;
  return keys.reduce((acc, breakpoint, i) => {
    if (Array.isArray(breakpointValues)) {
      acc[breakpoint] = breakpointValues[i] != null ? breakpointValues[i] : breakpointValues[previous];
      previous = i;
    } else if (typeof breakpointValues === 'object') {
      acc[breakpoint] = breakpointValues[breakpoint] != null ? breakpointValues[breakpoint] : breakpointValues[previous];
      previous = breakpoint;
    } else {
      acc[breakpoint] = breakpointValues;
    }
    return acc;
  }, {});
}
var _default = breakpoints;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsInZhbHVlIiwiY29tcHV0ZUJyZWFrcG9pbnRzQmFzZSIsImNyZWF0ZUVtcHR5QnJlYWtwb2ludE9iamVjdCIsImRlZmF1bHQiLCJoYW5kbGVCcmVha3BvaW50cyIsIm1lcmdlQnJlYWtwb2ludHNJbk9yZGVyIiwicmVtb3ZlVW51c2VkQnJlYWtwb2ludHMiLCJyZXNvbHZlQnJlYWtwb2ludFZhbHVlcyIsInZhbHVlcyIsIl9leHRlbmRzMiIsIl9wcm9wVHlwZXMiLCJfdXRpbHMiLCJfbWVyZ2UiLCJ4cyIsInNtIiwibWQiLCJsZyIsInhsIiwiZGVmYXVsdEJyZWFrcG9pbnRzIiwia2V5cyIsInVwIiwia2V5IiwicHJvcHMiLCJwcm9wVmFsdWUiLCJzdHlsZUZyb21Qcm9wVmFsdWUiLCJ0aGVtZSIsIkFycmF5IiwiaXNBcnJheSIsInRoZW1lQnJlYWtwb2ludHMiLCJicmVha3BvaW50cyIsInJlZHVjZSIsImFjYyIsIml0ZW0iLCJpbmRleCIsImJyZWFrcG9pbnQiLCJpbmRleE9mIiwibWVkaWFLZXkiLCJjc3NLZXkiLCJvdXRwdXQiLCJzdHlsZUZ1bmN0aW9uIiwibmV3U3R5bGVGdW5jdGlvbiIsImJhc2UiLCJleHRlbmRlZCIsInByb3BUeXBlcyIsInByb2Nlc3MiLCJlbnYiLCJOT0RFX0VOViIsIm9iamVjdCIsImZpbHRlclByb3BzIiwiYnJlYWtwb2ludHNJbnB1dCIsIl9icmVha3BvaW50c0lucHV0JGtleSIsImJyZWFrcG9pbnRzSW5PcmRlciIsImJyZWFrcG9pbnRTdHlsZUtleSIsImJyZWFrcG9pbnRLZXlzIiwic3R5bGUiLCJicmVha3BvaW50T3V0cHV0IiwiaXNCcmVha3BvaW50VW51c2VkIiwibGVuZ3RoIiwic3R5bGVzIiwiZW1wdHlCcmVha3BvaW50cyIsIm1lcmdlZE91dHB1dCIsInByZXYiLCJuZXh0IiwiZGVlcG1lcmdlIiwiYnJlYWtwb2ludFZhbHVlcyIsImJyZWFrcG9pbnRzS2V5cyIsImZvckVhY2giLCJpIiwiY3VzdG9tQmFzZSIsInByZXZpb3VzIiwiX2RlZmF1bHQiXSwic291cmNlcyI6WyJicmVha3BvaW50cy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxudmFyIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQgPSByZXF1aXJlKFwiQGJhYmVsL3J1bnRpbWUvaGVscGVycy9pbnRlcm9wUmVxdWlyZURlZmF1bHRcIik7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHtcbiAgdmFsdWU6IHRydWVcbn0pO1xuZXhwb3J0cy5jb21wdXRlQnJlYWtwb2ludHNCYXNlID0gY29tcHV0ZUJyZWFrcG9pbnRzQmFzZTtcbmV4cG9ydHMuY3JlYXRlRW1wdHlCcmVha3BvaW50T2JqZWN0ID0gY3JlYXRlRW1wdHlCcmVha3BvaW50T2JqZWN0O1xuZXhwb3J0cy5kZWZhdWx0ID0gdm9pZCAwO1xuZXhwb3J0cy5oYW5kbGVCcmVha3BvaW50cyA9IGhhbmRsZUJyZWFrcG9pbnRzO1xuZXhwb3J0cy5tZXJnZUJyZWFrcG9pbnRzSW5PcmRlciA9IG1lcmdlQnJlYWtwb2ludHNJbk9yZGVyO1xuZXhwb3J0cy5yZW1vdmVVbnVzZWRCcmVha3BvaW50cyA9IHJlbW92ZVVudXNlZEJyZWFrcG9pbnRzO1xuZXhwb3J0cy5yZXNvbHZlQnJlYWtwb2ludFZhbHVlcyA9IHJlc29sdmVCcmVha3BvaW50VmFsdWVzO1xuZXhwb3J0cy52YWx1ZXMgPSB2b2lkIDA7XG52YXIgX2V4dGVuZHMyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKFwiQGJhYmVsL3J1bnRpbWUvaGVscGVycy9leHRlbmRzXCIpKTtcbnZhciBfcHJvcFR5cGVzID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKFwicHJvcC10eXBlc1wiKSk7XG52YXIgX3V0aWxzID0gcmVxdWlyZShcIkBtdWkvdXRpbHNcIik7XG52YXIgX21lcmdlID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKFwiLi9tZXJnZVwiKSk7XG4vLyBUaGUgYnJlYWtwb2ludCAqKnN0YXJ0KiogYXQgdGhpcyB2YWx1ZS5cbi8vIEZvciBpbnN0YW5jZSB3aXRoIHRoZSBmaXJzdCBicmVha3BvaW50IHhzOiBbeHMsIHNtWy5cbmNvbnN0IHZhbHVlcyA9IHtcbiAgeHM6IDAsXG4gIC8vIHBob25lXG4gIHNtOiA2MDAsXG4gIC8vIHRhYmxldFxuICBtZDogOTAwLFxuICAvLyBzbWFsbCBsYXB0b3BcbiAgbGc6IDEyMDAsXG4gIC8vIGRlc2t0b3BcbiAgeGw6IDE1MzYgLy8gbGFyZ2Ugc2NyZWVuXG59O1xuZXhwb3J0cy52YWx1ZXMgPSB2YWx1ZXM7XG5jb25zdCBkZWZhdWx0QnJlYWtwb2ludHMgPSB7XG4gIC8vIFNvcnRlZCBBU0MgYnkgc2l6ZS4gVGhhdCdzIGltcG9ydGFudC5cbiAgLy8gSXQgY2FuJ3QgYmUgY29uZmlndXJlZCBhcyBpdCdzIHVzZWQgc3RhdGljYWxseSBmb3IgcHJvcFR5cGVzLlxuICBrZXlzOiBbJ3hzJywgJ3NtJywgJ21kJywgJ2xnJywgJ3hsJ10sXG4gIHVwOiBrZXkgPT4gYEBtZWRpYSAobWluLXdpZHRoOiR7dmFsdWVzW2tleV19cHgpYFxufTtcbmZ1bmN0aW9uIGhhbmRsZUJyZWFrcG9pbnRzKHByb3BzLCBwcm9wVmFsdWUsIHN0eWxlRnJvbVByb3BWYWx1ZSkge1xuICBjb25zdCB0aGVtZSA9IHByb3BzLnRoZW1lIHx8IHt9O1xuICBpZiAoQXJyYXkuaXNBcnJheShwcm9wVmFsdWUpKSB7XG4gICAgY29uc3QgdGhlbWVCcmVha3BvaW50cyA9IHRoZW1lLmJyZWFrcG9pbnRzIHx8IGRlZmF1bHRCcmVha3BvaW50cztcbiAgICByZXR1cm4gcHJvcFZhbHVlLnJlZHVjZSgoYWNjLCBpdGVtLCBpbmRleCkgPT4ge1xuICAgICAgYWNjW3RoZW1lQnJlYWtwb2ludHMudXAodGhlbWVCcmVha3BvaW50cy5rZXlzW2luZGV4XSldID0gc3R5bGVGcm9tUHJvcFZhbHVlKHByb3BWYWx1ZVtpbmRleF0pO1xuICAgICAgcmV0dXJuIGFjYztcbiAgICB9LCB7fSk7XG4gIH1cbiAgaWYgKHR5cGVvZiBwcm9wVmFsdWUgPT09ICdvYmplY3QnKSB7XG4gICAgY29uc3QgdGhlbWVCcmVha3BvaW50cyA9IHRoZW1lLmJyZWFrcG9pbnRzIHx8IGRlZmF1bHRCcmVha3BvaW50cztcbiAgICByZXR1cm4gT2JqZWN0LmtleXMocHJvcFZhbHVlKS5yZWR1Y2UoKGFjYywgYnJlYWtwb2ludCkgPT4ge1xuICAgICAgLy8ga2V5IGlzIGJyZWFrcG9pbnRcbiAgICAgIGlmIChPYmplY3Qua2V5cyh0aGVtZUJyZWFrcG9pbnRzLnZhbHVlcyB8fCB2YWx1ZXMpLmluZGV4T2YoYnJlYWtwb2ludCkgIT09IC0xKSB7XG4gICAgICAgIGNvbnN0IG1lZGlhS2V5ID0gdGhlbWVCcmVha3BvaW50cy51cChicmVha3BvaW50KTtcbiAgICAgICAgYWNjW21lZGlhS2V5XSA9IHN0eWxlRnJvbVByb3BWYWx1ZShwcm9wVmFsdWVbYnJlYWtwb2ludF0sIGJyZWFrcG9pbnQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc3QgY3NzS2V5ID0gYnJlYWtwb2ludDtcbiAgICAgICAgYWNjW2Nzc0tleV0gPSBwcm9wVmFsdWVbY3NzS2V5XTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBhY2M7XG4gICAgfSwge30pO1xuICB9XG4gIGNvbnN0IG91dHB1dCA9IHN0eWxlRnJvbVByb3BWYWx1ZShwcm9wVmFsdWUpO1xuICByZXR1cm4gb3V0cHV0O1xufVxuZnVuY3Rpb24gYnJlYWtwb2ludHMoc3R5bGVGdW5jdGlvbikge1xuICAvLyBmYWxzZSBwb3NpdGl2ZVxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcmVhY3QvZnVuY3Rpb24tY29tcG9uZW50LWRlZmluaXRpb25cbiAgY29uc3QgbmV3U3R5bGVGdW5jdGlvbiA9IHByb3BzID0+IHtcbiAgICBjb25zdCB0aGVtZSA9IHByb3BzLnRoZW1lIHx8IHt9O1xuICAgIGNvbnN0IGJhc2UgPSBzdHlsZUZ1bmN0aW9uKHByb3BzKTtcbiAgICBjb25zdCB0aGVtZUJyZWFrcG9pbnRzID0gdGhlbWUuYnJlYWtwb2ludHMgfHwgZGVmYXVsdEJyZWFrcG9pbnRzO1xuICAgIGNvbnN0IGV4dGVuZGVkID0gdGhlbWVCcmVha3BvaW50cy5rZXlzLnJlZHVjZSgoYWNjLCBrZXkpID0+IHtcbiAgICAgIGlmIChwcm9wc1trZXldKSB7XG4gICAgICAgIGFjYyA9IGFjYyB8fCB7fTtcbiAgICAgICAgYWNjW3RoZW1lQnJlYWtwb2ludHMudXAoa2V5KV0gPSBzdHlsZUZ1bmN0aW9uKCgwLCBfZXh0ZW5kczIuZGVmYXVsdCkoe1xuICAgICAgICAgIHRoZW1lXG4gICAgICAgIH0sIHByb3BzW2tleV0pKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBhY2M7XG4gICAgfSwgbnVsbCk7XG4gICAgcmV0dXJuICgwLCBfbWVyZ2UuZGVmYXVsdCkoYmFzZSwgZXh0ZW5kZWQpO1xuICB9O1xuICBuZXdTdHlsZUZ1bmN0aW9uLnByb3BUeXBlcyA9IHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicgPyAoMCwgX2V4dGVuZHMyLmRlZmF1bHQpKHt9LCBzdHlsZUZ1bmN0aW9uLnByb3BUeXBlcywge1xuICAgIHhzOiBfcHJvcFR5cGVzLmRlZmF1bHQub2JqZWN0LFxuICAgIHNtOiBfcHJvcFR5cGVzLmRlZmF1bHQub2JqZWN0LFxuICAgIG1kOiBfcHJvcFR5cGVzLmRlZmF1bHQub2JqZWN0LFxuICAgIGxnOiBfcHJvcFR5cGVzLmRlZmF1bHQub2JqZWN0LFxuICAgIHhsOiBfcHJvcFR5cGVzLmRlZmF1bHQub2JqZWN0XG4gIH0pIDoge307XG4gIG5ld1N0eWxlRnVuY3Rpb24uZmlsdGVyUHJvcHMgPSBbJ3hzJywgJ3NtJywgJ21kJywgJ2xnJywgJ3hsJywgLi4uc3R5bGVGdW5jdGlvbi5maWx0ZXJQcm9wc107XG4gIHJldHVybiBuZXdTdHlsZUZ1bmN0aW9uO1xufVxuZnVuY3Rpb24gY3JlYXRlRW1wdHlCcmVha3BvaW50T2JqZWN0KGJyZWFrcG9pbnRzSW5wdXQgPSB7fSkge1xuICB2YXIgX2JyZWFrcG9pbnRzSW5wdXQka2V5O1xuICBjb25zdCBicmVha3BvaW50c0luT3JkZXIgPSAoX2JyZWFrcG9pbnRzSW5wdXQka2V5ID0gYnJlYWtwb2ludHNJbnB1dC5rZXlzKSA9PSBudWxsID8gdm9pZCAwIDogX2JyZWFrcG9pbnRzSW5wdXQka2V5LnJlZHVjZSgoYWNjLCBrZXkpID0+IHtcbiAgICBjb25zdCBicmVha3BvaW50U3R5bGVLZXkgPSBicmVha3BvaW50c0lucHV0LnVwKGtleSk7XG4gICAgYWNjW2JyZWFrcG9pbnRTdHlsZUtleV0gPSB7fTtcbiAgICByZXR1cm4gYWNjO1xuICB9LCB7fSk7XG4gIHJldHVybiBicmVha3BvaW50c0luT3JkZXIgfHwge307XG59XG5mdW5jdGlvbiByZW1vdmVVbnVzZWRCcmVha3BvaW50cyhicmVha3BvaW50S2V5cywgc3R5bGUpIHtcbiAgcmV0dXJuIGJyZWFrcG9pbnRLZXlzLnJlZHVjZSgoYWNjLCBrZXkpID0+IHtcbiAgICBjb25zdCBicmVha3BvaW50T3V0cHV0ID0gYWNjW2tleV07XG4gICAgY29uc3QgaXNCcmVha3BvaW50VW51c2VkID0gIWJyZWFrcG9pbnRPdXRwdXQgfHwgT2JqZWN0LmtleXMoYnJlYWtwb2ludE91dHB1dCkubGVuZ3RoID09PSAwO1xuICAgIGlmIChpc0JyZWFrcG9pbnRVbnVzZWQpIHtcbiAgICAgIGRlbGV0ZSBhY2Nba2V5XTtcbiAgICB9XG4gICAgcmV0dXJuIGFjYztcbiAgfSwgc3R5bGUpO1xufVxuZnVuY3Rpb24gbWVyZ2VCcmVha3BvaW50c0luT3JkZXIoYnJlYWtwb2ludHNJbnB1dCwgLi4uc3R5bGVzKSB7XG4gIGNvbnN0IGVtcHR5QnJlYWtwb2ludHMgPSBjcmVhdGVFbXB0eUJyZWFrcG9pbnRPYmplY3QoYnJlYWtwb2ludHNJbnB1dCk7XG4gIGNvbnN0IG1lcmdlZE91dHB1dCA9IFtlbXB0eUJyZWFrcG9pbnRzLCAuLi5zdHlsZXNdLnJlZHVjZSgocHJldiwgbmV4dCkgPT4gKDAsIF91dGlscy5kZWVwbWVyZ2UpKHByZXYsIG5leHQpLCB7fSk7XG4gIHJldHVybiByZW1vdmVVbnVzZWRCcmVha3BvaW50cyhPYmplY3Qua2V5cyhlbXB0eUJyZWFrcG9pbnRzKSwgbWVyZ2VkT3V0cHV0KTtcbn1cblxuLy8gY29tcHV0ZSBiYXNlIGZvciByZXNwb25zaXZlIHZhbHVlczsgZS5nLixcbi8vIFsxLDIsM10gPT4ge3hzOiB0cnVlLCBzbTogdHJ1ZSwgbWQ6IHRydWV9XG4vLyB7eHM6IDEsIHNtOiAyLCBtZDogM30gPT4ge3hzOiB0cnVlLCBzbTogdHJ1ZSwgbWQ6IHRydWV9XG5mdW5jdGlvbiBjb21wdXRlQnJlYWtwb2ludHNCYXNlKGJyZWFrcG9pbnRWYWx1ZXMsIHRoZW1lQnJlYWtwb2ludHMpIHtcbiAgLy8gZml4ZWQgdmFsdWVcbiAgaWYgKHR5cGVvZiBicmVha3BvaW50VmFsdWVzICE9PSAnb2JqZWN0Jykge1xuICAgIHJldHVybiB7fTtcbiAgfVxuICBjb25zdCBiYXNlID0ge307XG4gIGNvbnN0IGJyZWFrcG9pbnRzS2V5cyA9IE9iamVjdC5rZXlzKHRoZW1lQnJlYWtwb2ludHMpO1xuICBpZiAoQXJyYXkuaXNBcnJheShicmVha3BvaW50VmFsdWVzKSkge1xuICAgIGJyZWFrcG9pbnRzS2V5cy5mb3JFYWNoKChicmVha3BvaW50LCBpKSA9PiB7XG4gICAgICBpZiAoaSA8IGJyZWFrcG9pbnRWYWx1ZXMubGVuZ3RoKSB7XG4gICAgICAgIGJhc2VbYnJlYWtwb2ludF0gPSB0cnVlO1xuICAgICAgfVxuICAgIH0pO1xuICB9IGVsc2Uge1xuICAgIGJyZWFrcG9pbnRzS2V5cy5mb3JFYWNoKGJyZWFrcG9pbnQgPT4ge1xuICAgICAgaWYgKGJyZWFrcG9pbnRWYWx1ZXNbYnJlYWtwb2ludF0gIT0gbnVsbCkge1xuICAgICAgICBiYXNlW2JyZWFrcG9pbnRdID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuICByZXR1cm4gYmFzZTtcbn1cbmZ1bmN0aW9uIHJlc29sdmVCcmVha3BvaW50VmFsdWVzKHtcbiAgdmFsdWVzOiBicmVha3BvaW50VmFsdWVzLFxuICBicmVha3BvaW50czogdGhlbWVCcmVha3BvaW50cyxcbiAgYmFzZTogY3VzdG9tQmFzZVxufSkge1xuICBjb25zdCBiYXNlID0gY3VzdG9tQmFzZSB8fCBjb21wdXRlQnJlYWtwb2ludHNCYXNlKGJyZWFrcG9pbnRWYWx1ZXMsIHRoZW1lQnJlYWtwb2ludHMpO1xuICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXMoYmFzZSk7XG4gIGlmIChrZXlzLmxlbmd0aCA9PT0gMCkge1xuICAgIHJldHVybiBicmVha3BvaW50VmFsdWVzO1xuICB9XG4gIGxldCBwcmV2aW91cztcbiAgcmV0dXJuIGtleXMucmVkdWNlKChhY2MsIGJyZWFrcG9pbnQsIGkpID0+IHtcbiAgICBpZiAoQXJyYXkuaXNBcnJheShicmVha3BvaW50VmFsdWVzKSkge1xuICAgICAgYWNjW2JyZWFrcG9pbnRdID0gYnJlYWtwb2ludFZhbHVlc1tpXSAhPSBudWxsID8gYnJlYWtwb2ludFZhbHVlc1tpXSA6IGJyZWFrcG9pbnRWYWx1ZXNbcHJldmlvdXNdO1xuICAgICAgcHJldmlvdXMgPSBpO1xuICAgIH0gZWxzZSBpZiAodHlwZW9mIGJyZWFrcG9pbnRWYWx1ZXMgPT09ICdvYmplY3QnKSB7XG4gICAgICBhY2NbYnJlYWtwb2ludF0gPSBicmVha3BvaW50VmFsdWVzW2JyZWFrcG9pbnRdICE9IG51bGwgPyBicmVha3BvaW50VmFsdWVzW2JyZWFrcG9pbnRdIDogYnJlYWtwb2ludFZhbHVlc1twcmV2aW91c107XG4gICAgICBwcmV2aW91cyA9IGJyZWFrcG9pbnQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIGFjY1ticmVha3BvaW50XSA9IGJyZWFrcG9pbnRWYWx1ZXM7XG4gICAgfVxuICAgIHJldHVybiBhY2M7XG4gIH0sIHt9KTtcbn1cbnZhciBfZGVmYXVsdCA9IGJyZWFrcG9pbnRzO1xuZXhwb3J0cy5kZWZhdWx0ID0gX2RlZmF1bHQ7Il0sIm1hcHBpbmdzIjoiQUFBQSxZQUFZOztBQUVaLElBQUlBLHNCQUFzQixHQUFHQyxPQUFPLENBQUMsOENBQThDLENBQUM7QUFDcEZDLE1BQU0sQ0FBQ0MsY0FBYyxDQUFDQyxPQUFPLEVBQUUsWUFBWSxFQUFFO0VBQzNDQyxLQUFLLEVBQUU7QUFDVCxDQUFDLENBQUM7QUFDRkQsT0FBTyxDQUFDRSxzQkFBc0IsR0FBR0Esc0JBQXNCO0FBQ3ZERixPQUFPLENBQUNHLDJCQUEyQixHQUFHQSwyQkFBMkI7QUFDakVILE9BQU8sQ0FBQ0ksT0FBTyxHQUFHLEtBQUssQ0FBQztBQUN4QkosT0FBTyxDQUFDSyxpQkFBaUIsR0FBR0EsaUJBQWlCO0FBQzdDTCxPQUFPLENBQUNNLHVCQUF1QixHQUFHQSx1QkFBdUI7QUFDekROLE9BQU8sQ0FBQ08sdUJBQXVCLEdBQUdBLHVCQUF1QjtBQUN6RFAsT0FBTyxDQUFDUSx1QkFBdUIsR0FBR0EsdUJBQXVCO0FBQ3pEUixPQUFPLENBQUNTLE1BQU0sR0FBRyxLQUFLLENBQUM7QUFDdkIsSUFBSUMsU0FBUyxHQUFHZCxzQkFBc0IsQ0FBQ0MsT0FBTyxDQUFDLGdDQUFnQyxDQUFDLENBQUM7QUFDakYsSUFBSWMsVUFBVSxHQUFHZixzQkFBc0IsQ0FBQ0MsT0FBTyxDQUFDLFlBQVksQ0FBQyxDQUFDO0FBQzlELElBQUllLE1BQU0sR0FBR2YsT0FBTyxDQUFDLFlBQVksQ0FBQztBQUNsQyxJQUFJZ0IsTUFBTSxHQUFHakIsc0JBQXNCLENBQUNDLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQztBQUN2RDtBQUNBO0FBQ0EsTUFBTVksTUFBTSxHQUFHO0VBQ2JLLEVBQUUsRUFBRSxDQUFDO0VBQ0w7RUFDQUMsRUFBRSxFQUFFLEdBQUc7RUFDUDtFQUNBQyxFQUFFLEVBQUUsR0FBRztFQUNQO0VBQ0FDLEVBQUUsRUFBRSxJQUFJO0VB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