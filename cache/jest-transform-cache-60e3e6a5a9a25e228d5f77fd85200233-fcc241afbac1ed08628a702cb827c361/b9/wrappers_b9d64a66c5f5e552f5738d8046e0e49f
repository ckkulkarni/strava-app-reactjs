20cd46a1e18ae23780b10b47e95e3d63
"use strict";

/**
 * Wrappers for common types.
 * @type {Object.<string,IWrapper>}
 * @const
 */
var wrappers = exports;
var Message = require("./message");

/**
 * From object converter part of an {@link IWrapper}.
 * @typedef WrapperFromObjectConverter
 * @type {function}
 * @param {Object.<string,*>} object Plain object
 * @returns {Message<{}>} Message instance
 * @this Type
 */

/**
 * To object converter part of an {@link IWrapper}.
 * @typedef WrapperToObjectConverter
 * @type {function}
 * @param {Message<{}>} message Message instance
 * @param {IConversionOptions} [options] Conversion options
 * @returns {Object.<string,*>} Plain object
 * @this Type
 */

/**
 * Common type wrapper part of {@link wrappers}.
 * @interface IWrapper
 * @property {WrapperFromObjectConverter} [fromObject] From object converter
 * @property {WrapperToObjectConverter} [toObject] To object converter
 */

// Custom wrapper for Any
wrappers[".google.protobuf.Any"] = {
  fromObject: function (object) {
    // unwrap value type if mapped
    if (object && object["@type"]) {
      // Only use fully qualified type name after the last '/'
      var name = object["@type"].substring(object["@type"].lastIndexOf("/") + 1);
      var type = this.lookup(name);
      /* istanbul ignore else */
      if (type) {
        // type_url does not accept leading "."
        var type_url = object["@type"].charAt(0) === "." ? object["@type"].substr(1) : object["@type"];
        // type_url prefix is optional, but path seperator is required
        if (type_url.indexOf("/") === -1) {
          type_url = "/" + type_url;
        }
        return this.create({
          type_url: type_url,
          value: type.encode(type.fromObject(object)).finish()
        });
      }
    }
    return this.fromObject(object);
  },
  toObject: function (message, options) {
    // Default prefix
    var googleApi = "type.googleapis.com/";
    var prefix = "";
    var name = "";

    // decode value if requested and unmapped
    if (options && options.json && message.type_url && message.value) {
      // Only use fully qualified type name after the last '/'
      name = message.type_url.substring(message.type_url.lastIndexOf("/") + 1);
      // Separate the prefix used
      prefix = message.type_url.substring(0, message.type_url.lastIndexOf("/") + 1);
      var type = this.lookup(name);
      /* istanbul ignore else */
      if (type) message = type.decode(message.value);
    }

    // wrap value if unmapped
    if (!(message instanceof this.ctor) && message instanceof Message) {
      var object = message.$type.toObject(message, options);
      var messageName = message.$type.fullName[0] === "." ? message.$type.fullName.substr(1) : message.$type.fullName;
      // Default to type.googleapis.com prefix if no prefix is used
      if (prefix === "") {
        prefix = googleApi;
      }
      name = prefix + messageName;
      object["@type"] = name;
      return object;
    }
    return this.toObject(message, options);
  }
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJ3cmFwcGVycyIsImV4cG9ydHMiLCJNZXNzYWdlIiwicmVxdWlyZSIsImZyb21PYmplY3QiLCJvYmplY3QiLCJuYW1lIiwic3Vic3RyaW5nIiwibGFzdEluZGV4T2YiLCJ0eXBlIiwibG9va3VwIiwidHlwZV91cmwiLCJjaGFyQXQiLCJzdWJzdHIiLCJpbmRleE9mIiwiY3JlYXRlIiwidmFsdWUiLCJlbmNvZGUiLCJmaW5pc2giLCJ0b09iamVjdCIsIm1lc3NhZ2UiLCJvcHRpb25zIiwiZ29vZ2xlQXBpIiwicHJlZml4IiwianNvbiIsImRlY29kZSIsImN0b3IiLCIkdHlwZSIsIm1lc3NhZ2VOYW1lIiwiZnVsbE5hbWUiXSwic291cmNlcyI6WyJ3cmFwcGVycy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxuLyoqXG4gKiBXcmFwcGVycyBmb3IgY29tbW9uIHR5cGVzLlxuICogQHR5cGUge09iamVjdC48c3RyaW5nLElXcmFwcGVyPn1cbiAqIEBjb25zdFxuICovXG52YXIgd3JhcHBlcnMgPSBleHBvcnRzO1xuXG52YXIgTWVzc2FnZSA9IHJlcXVpcmUoXCIuL21lc3NhZ2VcIik7XG5cbi8qKlxuICogRnJvbSBvYmplY3QgY29udmVydGVyIHBhcnQgb2YgYW4ge0BsaW5rIElXcmFwcGVyfS5cbiAqIEB0eXBlZGVmIFdyYXBwZXJGcm9tT2JqZWN0Q29udmVydGVyXG4gKiBAdHlwZSB7ZnVuY3Rpb259XG4gKiBAcGFyYW0ge09iamVjdC48c3RyaW5nLCo+fSBvYmplY3QgUGxhaW4gb2JqZWN0XG4gKiBAcmV0dXJucyB7TWVzc2FnZTx7fT59IE1lc3NhZ2UgaW5zdGFuY2VcbiAqIEB0aGlzIFR5cGVcbiAqL1xuXG4vKipcbiAqIFRvIG9iamVjdCBjb252ZXJ0ZXIgcGFydCBvZiBhbiB7QGxpbmsgSVdyYXBwZXJ9LlxuICogQHR5cGVkZWYgV3JhcHBlclRvT2JqZWN0Q29udmVydGVyXG4gKiBAdHlwZSB7ZnVuY3Rpb259XG4gKiBAcGFyYW0ge01lc3NhZ2U8e30+fSBtZXNzYWdlIE1lc3NhZ2UgaW5zdGFuY2VcbiAqIEBwYXJhbSB7SUNvbnZlcnNpb25PcHRpb25zfSBbb3B0aW9uc10gQ29udmVyc2lvbiBvcHRpb25zXG4gKiBAcmV0dXJucyB7T2JqZWN0LjxzdHJpbmcsKj59IFBsYWluIG9iamVjdFxuICogQHRoaXMgVHlwZVxuICovXG5cbi8qKlxuICogQ29tbW9uIHR5cGUgd3JhcHBlciBwYXJ0IG9mIHtAbGluayB3cmFwcGVyc30uXG4gKiBAaW50ZXJmYWNlIElXcmFwcGVyXG4gKiBAcHJvcGVydHkge1dyYXBwZXJGcm9tT2JqZWN0Q29udmVydGVyfSBbZnJvbU9iamVjdF0gRnJvbSBvYmplY3QgY29udmVydGVyXG4gKiBAcHJvcGVydHkge1dyYXBwZXJUb09iamVjdENvbnZlcnRlcn0gW3RvT2JqZWN0XSBUbyBvYmplY3QgY29udmVydGVyXG4gKi9cblxuLy8gQ3VzdG9tIHdyYXBwZXIgZm9yIEFueVxud3JhcHBlcnNbXCIuZ29vZ2xlLnByb3RvYnVmLkFueVwiXSA9IHtcblxuICAgIGZyb21PYmplY3Q6IGZ1bmN0aW9uKG9iamVjdCkge1xuXG4gICAgICAgIC8vIHVud3JhcCB2YWx1ZSB0eXBlIGlmIG1hcHBlZFxuICAgICAgICBpZiAob2JqZWN0ICYmIG9iamVjdFtcIkB0eXBlXCJdKSB7XG4gICAgICAgICAgICAgLy8gT25seSB1c2UgZnVsbHkgcXVhbGlmaWVkIHR5cGUgbmFtZSBhZnRlciB0aGUgbGFzdCAnLydcbiAgICAgICAgICAgIHZhciBuYW1lID0gb2JqZWN0W1wiQHR5cGVcIl0uc3Vic3RyaW5nKG9iamVjdFtcIkB0eXBlXCJdLmxhc3RJbmRleE9mKFwiL1wiKSArIDEpO1xuICAgICAgICAgICAgdmFyIHR5cGUgPSB0aGlzLmxvb2t1cChuYW1lKTtcbiAgICAgICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBlbHNlICovXG4gICAgICAgICAgICBpZiAodHlwZSkge1xuICAgICAgICAgICAgICAgIC8vIHR5cGVfdXJsIGRvZXMgbm90IGFjY2VwdCBsZWFkaW5nIFwiLlwiXG4gICAgICAgICAgICAgICAgdmFyIHR5cGVfdXJsID0gb2JqZWN0W1wiQHR5cGVcIl0uY2hhckF0KDApID09PSBcIi5cIiA/XG4gICAgICAgICAgICAgICAgICAgIG9iamVjdFtcIkB0eXBlXCJdLnN1YnN0cigxKSA6IG9iamVjdFtcIkB0eXBlXCJdO1xuICAgICAgICAgICAgICAgIC8vIHR5cGVfdXJsIHByZWZpeCBpcyBvcHRpb25hbCwgYnV0IHBhdGggc2VwZXJhdG9yIGlzIHJlcXVpcmVkXG4gICAgICAgICAgICAgICAgaWYgKHR5cGVfdXJsLmluZGV4T2YoXCIvXCIpID09PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICB0eXBlX3VybCA9IFwiL1wiICsgdHlwZV91cmw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZSh7XG4gICAgICAgICAgICAgICAgICAgIHR5cGVfdXJsOiB0eXBlX3VybCxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHR5cGUuZW5jb2RlKHR5cGUuZnJvbU9iamVjdChvYmplY3QpKS5maW5pc2goKVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuZnJvbU9iamVjdChvYmplY3QpO1xuICAgIH0sXG5cbiAgICB0b09iamVjdDogZnVuY3Rpb24obWVzc2FnZSwgb3B0aW9ucykge1xuXG4gICAgICAgIC8vIERlZmF1bHQgcHJlZml4XG4gICAgICAgIHZhciBnb29nbGVBcGkgPSBcInR5cGUuZ29vZ2xlYXBpcy5jb20vXCI7XG4gICAgICAgIHZhciBwcmVmaXggPSBcIlwiO1xuICAgICAgICB2YXIgbmFtZSA9IFwiXCI7XG5cbiAgICAgICAgLy8gZGVjb2RlIHZhbHVlIGlmIHJlcXVlc3RlZCBhbmQgdW5tYXBwZWRcbiAgICAgICAgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5qc29uICYmIG1lc3NhZ2UudHlwZV91cmwgJiYgbWVzc2FnZS52YWx1ZSkge1xuICAgICAgICAgICAgLy8gT25seSB1c2UgZnVsbHkgcXVhbGlmaWVkIHR5cGUgbmFtZSBhZnRlciB0aGUgbGFzdCAnLydcbiAgICAgICAgICAgIG5hbWUgPSBtZXNzYWdlLnR5cGVfdXJsLnN1YnN0cmluZyhtZXNzYWdlLnR5cGVfdXJsLmxhc3RJbmRleE9mKFwiL1wiKSArIDEpO1xuICAgICAgICAgICAgLy8gU2VwYXJhdGUgdGhlIHByZWZpeCB1c2VkXG4gICAgICAgICAgICBwcmVmaXggPSBtZXNzYWdlLnR5cGVfdXJsLnN1YnN0cmluZygwLCBtZXNzYWdlLnR5cGVfdXJsLmxhc3RJbmRleE9mKFwiL1wiKSArIDEpO1xuICAgICAgICAgICAgdmFyIHR5cGUgPSB0aGlzLmxvb2t1cChuYW1lKTtcbiAgICAgICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBlbHNlICovXG4gICAgICAgICAgICBpZiAodHlwZSlcbiAgICAgICAgICAgICAgICBtZXNzYWdlID0gdHlwZS5kZWNvZGUobWVzc2FnZS52YWx1ZSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyB3cmFwIHZhbHVlIGlmIHVubWFwcGVkXG4gICAgICAgIGlmICghKG1lc3NhZ2UgaW5zdGFuY2VvZiB0aGlzLmN0b3IpICYmIG1lc3NhZ2UgaW5zdGFuY2VvZiBNZXNzYWdlKSB7XG4gICAgICAgICAgICB2YXIgb2JqZWN0ID0gbWVzc2FnZS4kdHlwZS50b09iamVjdChtZXNzYWdlLCBvcHRpb25zKTtcbiAgICAgICAgICAgIHZhciBtZXNzYWdlTmFtZSA9IG1lc3NhZ2UuJHR5cGUuZnVsbE5hbWVbMF0gPT09IFwiLlwiID9cbiAgICAgICAgICAgICAgICBtZXNzYWdlLiR0eXBlLmZ1bGxOYW1lLnN1YnN0cigxKSA6IG1lc3NhZ2UuJHR5cGUuZnVsbE5hbWU7XG4gICAgICAgICAgICAvLyBEZWZhdWx0IHRvIHR5cGUuZ29vZ2xlYXBpcy5jb20gcHJlZml4IGlmIG5vIHByZWZpeCBpcyB1c2VkXG4gICAgICAgICAgICBpZiAocHJlZml4ID09PSBcIlwiKSB7XG4gICAgICAgICAgICAgICAgcHJlZml4ID0gZ29vZ2xlQXBpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbmFtZSA9IHByZWZpeCArIG1lc3NhZ2VOYW1lO1xuICAgICAgICAgICAgb2JqZWN0W1wiQHR5cGVcIl0gPSBuYW1lO1xuICAgICAgICAgICAgcmV0dXJuIG9iamVjdDtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzLnRvT2JqZWN0KG1lc3NhZ2UsIG9wdGlvbnMpO1xuICAgIH1cbn07XG4iXSwibWFwcGluZ3MiOiJBQUFBLFlBQVk7O0FBRVo7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUlBLFFBQVEsR0FBR0MsT0FBTztBQUV0QixJQUFJQyxPQUFPLEdBQUdDLE9BQU8sQ0FBQyxXQUFXLENBQUM7O0FBRWxDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBSCxRQUFRLENBQUMsc0JBQXNCLENBQUMsR0FBRztFQUUvQkksVUFBVSxFQUFFLFNBQUFBLENBQVNDLE1BQU0sRUFBRTtJQUV6QjtJQUNBLElBQUlBLE1BQU0sSUFBSUEsTUFBTSxDQUFDLE9BQU8sQ0FBQyxFQUFFO01BQzFCO01BQ0QsSUFBSUMsSUFBSSxHQUFHRCxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUNFLFNBQVMsQ0FBQ0YsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDRyxXQUFXLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO01BQzFFLElBQUlDLElBQUksR0FBRyxJQUFJLENBQUNDLE1BQU0sQ0FBQ0osSUFBSSxDQUFDO01BQzVCO01BQ0EsSUFBSUcsSUFBSSxFQUFFO1FBQ047UUFDQSxJQUFJRSxRQUFRLEdBQUdOLE1BQU0sQ0FBQyxPQUFPLENB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