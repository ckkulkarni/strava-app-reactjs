46648ca75187b957954e6441c3a87052
"use strict";

module.exports = Field;

// extends ReflectionObject
var ReflectionObject = require("./object");
((Field.prototype = Object.create(ReflectionObject.prototype)).constructor = Field).className = "Field";
var Enum = require("./enum"),
  types = require("./types"),
  util = require("./util");
var Type; // cyclic

var ruleRe = /^required|optional|repeated$/;

/**
 * Constructs a new message field instance. Note that {@link MapField|map fields} have their own class.
 * @name Field
 * @classdesc Reflected message field.
 * @extends FieldBase
 * @constructor
 * @param {string} name Unique name within its namespace
 * @param {number} id Unique id within its namespace
 * @param {string} type Value type
 * @param {string|Object.<string,*>} [rule="optional"] Field rule
 * @param {string|Object.<string,*>} [extend] Extended type if different from parent
 * @param {Object.<string,*>} [options] Declared options
 */

/**
 * Constructs a field from a field descriptor.
 * @param {string} name Field name
 * @param {IField} json Field descriptor
 * @returns {Field} Created field
 * @throws {TypeError} If arguments are invalid
 */
Field.fromJSON = function fromJSON(name, json) {
  return new Field(name, json.id, json.type, json.rule, json.extend, json.options, json.comment);
};

/**
 * Not an actual constructor. Use {@link Field} instead.
 * @classdesc Base class of all reflected message fields. This is not an actual class but here for the sake of having consistent type definitions.
 * @exports FieldBase
 * @extends ReflectionObject
 * @constructor
 * @param {string} name Unique name within its namespace
 * @param {number} id Unique id within its namespace
 * @param {string} type Value type
 * @param {string|Object.<string,*>} [rule="optional"] Field rule
 * @param {string|Object.<string,*>} [extend] Extended type if different from parent
 * @param {Object.<string,*>} [options] Declared options
 * @param {string} [comment] Comment associated with this field
 */
function Field(name, id, type, rule, extend, options, comment) {
  if (util.isObject(rule)) {
    comment = extend;
    options = rule;
    rule = extend = undefined;
  } else if (util.isObject(extend)) {
    comment = options;
    options = extend;
    extend = undefined;
  }
  ReflectionObject.call(this, name, options);
  if (!util.isInteger(id) || id < 0) throw TypeError("id must be a non-negative integer");
  if (!util.isString(type)) throw TypeError("type must be a string");
  if (rule !== undefined && !ruleRe.test(rule = rule.toString().toLowerCase())) throw TypeError("rule must be a string rule");
  if (extend !== undefined && !util.isString(extend)) throw TypeError("extend must be a string");
  if (rule === "proto3_optional") {
    rule = "optional";
  }
  /**
   * Field rule, if any.
   * @type {string|undefined}
   */
  this.rule = rule && rule !== "optional" ? rule : undefined; // toJSON

  /**
   * Field type.
   * @type {string}
   */
  this.type = type; // toJSON

  /**
   * Unique field id.
   * @type {number}
   */
  this.id = id; // toJSON, marker

  /**
   * Extended type if different from parent.
   * @type {string|undefined}
   */
  this.extend = extend || undefined; // toJSON

  /**
   * Whether this field is required.
   * @type {boolean}
   */
  this.required = rule === "required";

  /**
   * Whether this field is optional.
   * @type {boolean}
   */
  this.optional = !this.required;

  /**
   * Whether this field is repeated.
   * @type {boolean}
   */
  this.repeated = rule === "repeated";

  /**
   * Whether this field is a map or not.
   * @type {boolean}
   */
  this.map = false;

  /**
   * Message this field belongs to.
   * @type {Type|null}
   */
  this.message = null;

  /**
   * OneOf this field belongs to, if any,
   * @type {OneOf|null}
   */
  this.partOf = null;

  /**
   * The field type's default value.
   * @type {*}
   */
  this.typeDefault = null;

  /**
   * The field's default value on prototypes.
   * @type {*}
   */
  this.defaultValue = null;

  /**
   * Whether this field's value should be treated as a long.
   * @type {boolean}
   */
  this.long = util.Long ? types.long[type] !== undefined : /* istanbul ignore next */false;

  /**
   * Whether this field's value is a buffer.
   * @type {boolean}
   */
  this.bytes = type === "bytes";

  /**
   * Resolved type if not a basic type.
   * @type {Type|Enum|null}
   */
  this.resolvedType = null;

  /**
   * Sister-field within the extended type if a declaring extension field.
   * @type {Field|null}
   */
  this.extensionField = null;

  /**
   * Sister-field within the declaring namespace if an extended field.
   * @type {Field|null}
   */
  this.declaringField = null;

  /**
   * Internally remembers whether this field is packed.
   * @type {boolean|null}
   * @private
   */
  this._packed = null;

  /**
   * Comment for this field.
   * @type {string|null}
   */
  this.comment = comment;
}

/**
 * Determines whether this field is packed. Only relevant when repeated and working with proto2.
 * @name Field#packed
 * @type {boolean}
 * @readonly
 */
Object.defineProperty(Field.prototype, "packed", {
  get: function () {
    // defaults to packed=true if not explicity set to false
    if (this._packed === null) this._packed = this.getOption("packed") !== false;
    return this._packed;
  }
});

/**
 * @override
 */
Field.prototype.setOption = function setOption(name, value, ifNotSet) {
  if (name === "packed")
    // clear cached before setting
    this._packed = null;
  return ReflectionObject.prototype.setOption.call(this, name, value, ifNotSet);
};

/**
 * Field descriptor.
 * @interface IField
 * @property {string} [rule="optional"] Field rule
 * @property {string} type Field type
 * @property {number} id Field id
 * @property {Object.<string,*>} [options] Field options
 */

/**
 * Extension field descriptor.
 * @interface IExtensionField
 * @extends IField
 * @property {string} extend Extended type
 */

/**
 * Converts this field to a field descriptor.
 * @param {IToJSONOptions} [toJSONOptions] JSON conversion options
 * @returns {IField} Field descriptor
 */
Field.prototype.toJSON = function toJSON(toJSONOptions) {
  var keepComments = toJSONOptions ? Boolean(toJSONOptions.keepComments) : false;
  return util.toObject(["rule", this.rule !== "optional" && this.rule || undefined, "type", this.type, "id", this.id, "extend", this.extend, "options", this.options, "comment", keepComments ? this.comment : undefined]);
};

/**
 * Resolves this field's type references.
 * @returns {Field} `this`
 * @throws {Error} If any reference cannot be resolved
 */
Field.prototype.resolve = function resolve() {
  if (this.resolved) return this;
  if ((this.typeDefault = types.defaults[this.type]) === undefined) {
    // if not a basic type, resolve it
    this.resolvedType = (this.declaringField ? this.declaringField.parent : this.parent).lookupTypeOrEnum(this.type);
    if (this.resolvedType instanceof Type) this.typeDefault = null;else
      // instanceof Enum
      this.typeDefault = this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]; // first defined
  }

  // use explicitly set default value if present
  if (this.options && this.options["default"] != null) {
    this.typeDefault = this.options["default"];
    if (this.resolvedType instanceof Enum && typeof this.typeDefault === "string") this.typeDefault = this.resolvedType.values[this.typeDefault];
  }

  // remove unnecessary options
  if (this.options) {
    if (this.options.packed === true || this.options.packed !== undefined && this.resolvedType && !(this.resolvedType instanceof Enum)) delete this.options.packed;
    if (!Object.keys(this.options).length) this.options = undefined;
  }

  // convert to internal data type if necesssary
  if (this.long) {
    this.typeDefault = util.Long.fromNumber(this.typeDefault, this.type.charAt(0) === "u");

    /* istanbul ignore else */
    if (Object.freeze) Object.freeze(this.typeDefault); // long instances are meant to be immutable anyway (i.e. use small int cache that even requires it)
  } else if (this.bytes && typeof this.typeDefault === "string") {
    var buf;
    if (util.base64.test(this.typeDefault)) util.base64.decode(this.typeDefault, buf = util.newBuffer(util.base64.length(this.typeDefault)), 0);else util.utf8.write(this.typeDefault, buf = util.newBuffer(util.utf8.length(this.typeDefault)), 0);
    this.typeDefault = buf;
  }

  // take special care of maps and repeated fields
  if (this.map) this.defaultValue = util.emptyObject;else if (this.repeated) this.defaultValue = util.emptyArray;else this.defaultValue = this.typeDefault;

  // ensure proper value on prototype
  if (this.parent instanceof Type) this.parent.ctor.prototype[this.name] = this.defaultValue;
  return ReflectionObject.prototype.resolve.call(this);
};

/**
 * Decorator function as returned by {@link Field.d} and {@link MapField.d} (TypeScript).
 * @typedef FieldDecorator
 * @type {function}
 * @param {Object} prototype Target prototype
 * @param {string} fieldName Field name
 * @returns {undefined}
 */

/**
 * Field decorator (TypeScript).
 * @name Field.d
 * @function
 * @param {number} fieldId Field id
 * @param {"double"|"float"|"int32"|"uint32"|"sint32"|"fixed32"|"sfixed32"|"int64"|"uint64"|"sint64"|"fixed64"|"sfixed64"|"string"|"bool"|"bytes"|Object} fieldType Field type
 * @param {"optional"|"required"|"repeated"} [fieldRule="optional"] Field rule
 * @param {T} [defaultValue] Default value
 * @returns {FieldDecorator} Decorator function
 * @template T extends number | number[] | Long | Long[] | string | string[] | boolean | boolean[] | Uint8Array | Uint8Array[] | Buffer | Buffer[]
 */
Field.d = function decorateField(fieldId, fieldType, fieldRule, defaultValue) {
  // submessage: decorate the submessage and use its name as the type
  if (typeof fieldType === "function") fieldType = util.decorateType(fieldType).name;

  // enum reference: create a reflected copy of the enum and keep reuseing it
  else if (fieldType && typeof fieldType === "object") fieldType = util.decorateEnum(fieldType).name;
  return function fieldDecorator(prototype, fieldName) {
    util.decorateType(prototype.constructor).add(new Field(fieldName, fieldId, fieldType, fieldRule, {
      "default": defaultValue
    }));
  };
};

/**
 * Field decorator (TypeScript).
 * @name Field.d
 * @function
 * @param {number} fieldId Field id
 * @param {Constructor<T>|string} fieldType Field type
 * @param {"optional"|"required"|"repeated"} [fieldRule="optional"] Field rule
 * @returns {FieldDecorator} Decorator function
 * @template T extends Message<T>
 * @variation 2
 */
// like Field.d but without a default value

// Sets up cyclic dependencies (called in index-light)
Field._configure = function configure(Type_) {
  Type = Type_;
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJtb2R1bGUiLCJleHBvcnRzIiwiRmllbGQiLCJSZWZsZWN0aW9uT2JqZWN0IiwicmVxdWlyZSIsInByb3RvdHlwZSIsIk9iamVjdCIsImNyZWF0ZSIsImNvbnN0cnVjdG9yIiwiY2xhc3NOYW1lIiwiRW51bSIsInR5cGVzIiwidXRpbCIsIlR5cGUiLCJydWxlUmUiLCJmcm9tSlNPTiIsIm5hbWUiLCJqc29uIiwiaWQiLCJ0eXBlIiwicnVsZSIsImV4dGVuZCIsIm9wdGlvbnMiLCJjb21tZW50IiwiaXNPYmplY3QiLCJ1bmRlZmluZWQiLCJjYWxsIiwiaXNJbnRlZ2VyIiwiVHlwZUVycm9yIiwiaXNTdHJpbmciLCJ0ZXN0IiwidG9TdHJpbmciLCJ0b0xvd2VyQ2FzZSIsInJlcXVpcmVkIiwib3B0aW9uYWwiLCJyZXBlYXRlZCIsIm1hcCIsIm1lc3NhZ2UiLCJwYXJ0T2YiLCJ0eXBlRGVmYXVsdCIsImRlZmF1bHRWYWx1ZSIsImxvbmciLCJMb25nIiwiYnl0ZXMiLCJyZXNvbHZlZFR5cGUiLCJleHRlbnNpb25GaWVsZCIsImRlY2xhcmluZ0ZpZWxkIiwiX3BhY2tlZCIsImRlZmluZVByb3BlcnR5IiwiZ2V0IiwiZ2V0T3B0aW9uIiwic2V0T3B0aW9uIiwidmFsdWUiLCJpZk5vdFNldCIsInRvSlNPTiIsInRvSlNPTk9wdGlvbnMiLCJrZWVwQ29tbWVudHMiLCJCb29sZWFuIiwidG9PYmplY3QiLCJyZXNvbHZlIiwicmVzb2x2ZWQiLCJkZWZhdWx0cyIsInBhcmVudCIsImxvb2t1cFR5cGVPckVudW0iLCJ2YWx1ZXMiLCJrZXlzIiwicGFja2VkIiwibGVuZ3RoIiwiZnJvbU51bWJlciIsImNoYXJBdCIsImZyZWV6ZSIsImJ1ZiIsImJhc2U2NCIsImRlY29kZSIsIm5ld0J1ZmZlciIsInV0ZjgiLCJ3cml0ZSIsImVtcHR5T2JqZWN0IiwiZW1wdHlBcnJheSIsImN0b3IiLCJkIiwiZGVjb3JhdGVGaWVsZCIsImZpZWxkSWQiLCJmaWVsZFR5cGUiLCJmaWVsZFJ1bGUiLCJkZWNvcmF0ZVR5cGUiLCJkZWNvcmF0ZUVudW0iLCJmaWVsZERlY29yYXRvciIsImZpZWxkTmFtZSIsImFkZCIsIl9jb25maWd1cmUiLCJjb25maWd1cmUiLCJUeXBlXyJdLCJzb3VyY2VzIjpbImZpZWxkLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xubW9kdWxlLmV4cG9ydHMgPSBGaWVsZDtcblxuLy8gZXh0ZW5kcyBSZWZsZWN0aW9uT2JqZWN0XG52YXIgUmVmbGVjdGlvbk9iamVjdCA9IHJlcXVpcmUoXCIuL29iamVjdFwiKTtcbigoRmllbGQucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShSZWZsZWN0aW9uT2JqZWN0LnByb3RvdHlwZSkpLmNvbnN0cnVjdG9yID0gRmllbGQpLmNsYXNzTmFtZSA9IFwiRmllbGRcIjtcblxudmFyIEVudW0gID0gcmVxdWlyZShcIi4vZW51bVwiKSxcbiAgICB0eXBlcyA9IHJlcXVpcmUoXCIuL3R5cGVzXCIpLFxuICAgIHV0aWwgID0gcmVxdWlyZShcIi4vdXRpbFwiKTtcblxudmFyIFR5cGU7IC8vIGN5Y2xpY1xuXG52YXIgcnVsZVJlID0gL15yZXF1aXJlZHxvcHRpb25hbHxyZXBlYXRlZCQvO1xuXG4vKipcbiAqIENvbnN0cnVjdHMgYSBuZXcgbWVzc2FnZSBmaWVsZCBpbnN0YW5jZS4gTm90ZSB0aGF0IHtAbGluayBNYXBGaWVsZHxtYXAgZmllbGRzfSBoYXZlIHRoZWlyIG93biBjbGFzcy5cbiAqIEBuYW1lIEZpZWxkXG4gKiBAY2xhc3NkZXNjIFJlZmxlY3RlZCBtZXNzYWdlIGZpZWxkLlxuICogQGV4dGVuZHMgRmllbGRCYXNlXG4gKiBAY29uc3RydWN0b3JcbiAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIFVuaXF1ZSBuYW1lIHdpdGhpbiBpdHMgbmFtZXNwYWNlXG4gKiBAcGFyYW0ge251bWJlcn0gaWQgVW5pcXVlIGlkIHdpdGhpbiBpdHMgbmFtZXNwYWNlXG4gKiBAcGFyYW0ge3N0cmluZ30gdHlwZSBWYWx1ZSB0eXBlXG4gKiBAcGFyYW0ge3N0cmluZ3xPYmplY3QuPHN0cmluZywqPn0gW3J1bGU9XCJvcHRpb25hbFwiXSBGaWVsZCBydWxlXG4gKiBAcGFyYW0ge3N0cmluZ3xPYmplY3QuPHN0cmluZywqPn0gW2V4dGVuZF0gRXh0ZW5kZWQgdHlwZSBpZiBkaWZmZXJlbnQgZnJvbSBwYXJlbnRcbiAqIEBwYXJhbSB7T2JqZWN0LjxzdHJpbmcsKj59IFtvcHRpb25zXSBEZWNsYXJlZCBvcHRpb25zXG4gKi9cblxuLyoqXG4gKiBDb25zdHJ1Y3RzIGEgZmllbGQgZnJvbSBhIGZpZWxkIGRlc2NyaXB0b3IuXG4gKiBAcGFyYW0ge3N0cmluZ30gbmFtZSBGaWVsZCBuYW1lXG4gKiBAcGFyYW0ge0lGaWVsZH0ganNvbiBGaWVsZCBkZXNjcmlwdG9yXG4gKiBAcmV0dXJucyB7RmllbGR9IENyZWF0ZWQgZmllbGRcbiAqIEB0aHJvd3Mge1R5cGVFcnJvcn0gSWYgYXJndW1lbnRzIGFyZSBpbnZhbGlkXG4gKi9cbkZpZWxkLmZyb21KU09OID0gZnVuY3Rpb24gZnJvbUpTT04obmFtZSwganNvbikge1xuICAgIHJldHVybiBuZXcgRmllbGQobmFtZSwganNvbi5pZCwganNvbi50eXBlLCBqc29uLnJ1bGUsIGpzb24uZXh0ZW5kLCBqc29uLm9wdGlvbnMsIGpzb24uY29tbWVudCk7XG59O1xuXG4vKipcbiAqIE5vdCBhbiBhY3R1YWwgY29uc3RydWN0b3IuIFVzZSB7QGxpbmsgRmllbGR9IGluc3RlYWQuXG4gKiBAY2xhc3NkZXNjIEJhc2UgY2xhc3Mgb2YgYWxsIHJlZmxlY3RlZCBtZXNzYWdlIGZpZWxkcy4gVGhpcyBpcyBub3QgYW4gYWN0dWFsIGNsYXNzIGJ1dCBoZXJlIGZvciB0aGUgc2FrZSBvZiBoYXZpbmcgY29uc2lzdGVudCB0eXBlIGRlZmluaXRpb25zLlxuICogQGV4cG9ydHMgRmllbGRCYXNlXG4gKiBAZXh0ZW5kcyBSZWZsZWN0aW9uT2JqZWN0XG4gKiBAY29uc3RydWN0b3JcbiAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIFVuaXF1ZSBuYW1lIHdpdGhpbiBpdHMgbmFtZXNwYWNlXG4gKiBAcGFyYW0ge251bWJlcn0gaWQgVW5pcXVlIGlkIHdpdGhpbiBpdHMgbmFtZXNwYWNlXG4gKiBAcGFyYW0ge3N0cmluZ30gdHlwZSBWYWx1ZSB0eXBlXG4gKiBAcGFyYW0ge3N0cmluZ3xPYmplY3QuPHN0cmluZywqPn0gW3J1bGU9XCJvcHRpb25hbFwiXSBGaWVsZCBydWxlXG4gKiBAcGFyYW0ge3N0cmluZ3xPYmplY3QuPHN0cmluZywqPn0gW2V4dGVuZF0gRXh0ZW5kZWQgdHlwZSBpZiBkaWZmZXJlbnQgZnJvbSBwYXJlbnRcbiAqIEBwYXJhbSB7T2JqZWN0LjxzdHJpbmcsKj59IFtvcHRpb25zXSBEZWNsYXJlZCBvcHRpb25zXG4gKiBAcGFyYW0ge3N0cmluZ30gW2NvbW1lbnRdIENvbW1lbnQgYXNzb2NpYXRlZCB3aXRoIHRoaXMgZmllbGRcbiAqL1xuZnVuY3Rpb24gRmllbGQobmFtZSwgaWQsIHR5cGUsIHJ1bGUsIGV4dGVuZCwgb3B0aW9ucywgY29tbWVudCkge1xuXG4gICAgaWYgKHV0aWwuaXNPYmplY3QocnVsZSkpIHtcbiAgICAgICAgY29tbWVudCA9IGV4dGVuZDtcbiAgICAgICAgb3B0aW9ucyA9IHJ1bGU7XG4gICAgICAgIHJ1bGUgPSBleHRlbmQgPSB1bmRlZmluZWQ7XG4gICAgfSBlbHNlIGlmICh1dGlsLmlzT2JqZWN0KGV4dGVuZCkpIHtcbiAgICAgICAgY29tbWVudCA9IG9wdGlvbnM7XG4gICAgICAgIG9wdGlvbnMgPSBleHRlbmQ7XG4gICAgICAgIGV4dGVuZCA9IHVuZGVmaW5lZDtcbiAgICB9XG5cbiAgICBSZWZsZWN0aW9uT2JqZWN0LmNhbGwodGhpcywgbmFtZSwgb3B0aW9ucyk7XG5cbiAgICBpZiAoIXV0aWwuaXNJbnRlZ2VyKGlkKSB8fCBpZCA8IDApXG4gICAgICAgIHRocm93IFR5cGVFcnJvcihcImlkIG11c3QgYmUgYSBub24tbmVnYXRpdmUgaW50ZWdlclwiKTtcblxuICAgIGlmICghdXRpbC5pc1N0cmluZyh0eXBlKSlcbiAgICAgICAgdGhyb3cgVHlwZUVycm9yKFwidHlwZSBtdXN0IGJlIGEgc3RyaW5nXCIpO1xuXG4gICAgaWYgKHJ1bGUgIT09IHVuZGVmaW5lZCAmJiAhcnVsZVJlLnRlc3QocnVsZSA9IHJ1bGUudG9TdHJpbmcoKS50b0xvd2VyQ2FzZSgpKSlcbiAgICAgICAgdGhyb3cgVHlwZUVycm9yKFwicnVsZSBtdXN0IGJlIGEgc3RyaW5nIHJ1bGVcIik7XG5cbiAgICBpZiAoZXh0ZW5kICE9PSB1bmRlZmluZWQgJiYgIXV0aWwuaXNTdHJpbmcoZXh0ZW5kKSlcbiAgICAgICAgdGhyb3cgVHlwZUVycm9yKFwiZXh0ZW5kIG11c3QgYmUgYSBzdHJpbmdcIik7XG5cbiAgICBpZiAocnVsZSA9PT0gXCJwcm90bzNfb3B0aW9uYWxcIikge1xuICAgICAgICBydWxlID0gXCJvcHRpb25hbFwiO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBGaWVsZCBydWxlLCBpZiBhbnkuXG4gICAgICogQHR5cGUge3N0cmluZ3x1bmRlZmluZWR9XG4gICAgICovXG4gICAgdGhpcy5ydWxlID0gcnVsZSAmJiBydWxlICE9PSBcIm9wdGlvbmFsXCIgPyBydWxlIDogdW5kZWZpbmVkOyAvLyB0b0pTT05cblxuICAgIC8qKlxuICAgICAqIEZpZWxkIHR5cGUuXG4gICAgICogQHR5cGUge3N0cmluZ31cbiAgICAgKi9cbiAgICB0aGlzLnR5cGUgPSB0eXBlOyAvLyB0b0pTT05cblxuICAgIC8qKlxuICAgICAqIFVuaXF1ZSBmaWVsZCBpZC5cbiAgICAgKiBAdHlwZSB7bnVtYmVyfVxuICAgICAqL1xuICAgIHRoaXMuaWQgPSBpZDsgLy8gdG9KU09OLCBtYXJrZXJcblxuICAgIC8qKlxuICAgICAqIEV4dGVuZGVkIHR5cGUgaWYgZGlmZmVyZW50IGZyb20gcGFyZW50LlxuICAgICAqIEB0eXBlIHtzdHJpbmd8dW5kZWZpbmVkfVxuICAgICAqL1xuICAgIHRoaXMuZXh0ZW5kID0gZXh0ZW5kIHx8IHVuZGVmaW5lZDsgLy8gdG9KU09OXG5cbiAgICAvKipcbiAgICAgKiBXaGV0aGVyIHRoaXMgZmllbGQgaXMgcmVxdWlyZWQuXG4gICAgICogQHR5cGUge2Jvb2xlYW59XG4gICAgICovXG4gICAgdGhpcy5yZXF1aXJlZCA9IHJ1bGUgPT09IFwicmVxdWlyZWRcIjtcblxuICAgIC8qKlxuICAgICAqIFdoZXRoZXIgdGhpcyBmaWVsZCBpcyBvcHRpb25hbC5cbiAgICAgKiBAdHlwZSB7Ym9vbGVhbn1cbiAgICAgKi9cbiAgICB0aGlzLm9wdGlvbmFsID0gIXRoaXMucmVxdWlyZWQ7XG5cbiAgICAvKipcbiAgICAgKiBXaGV0aGVyIHRoaXMgZmllbGQgaXMgcmVwZWF0ZWQuXG4gICAgICogQHR5cGUge2Jvb2xlYW59XG4gICAgICovXG4gICAgdGhpcy5yZXBlYXRlZCA9IHJ1bGUgPT09IFwicmVwZWF0ZWRcIjtcblxuICAgIC8qKlxuICAgICAqIFdoZXRoZXIgdGhpcyBmaWVsZCBpcyBhIG1hcCBvciBub3QuXG4gICAgICogQHR5cGUge2Jvb2xlYW59XG4gICAgICovXG4gICAgdGhpcy5tYXAgPSBmYWxzZTtcblxuICAgIC8qKlxuICAgICAqIE1lc3NhZ2UgdGhpcyBmaWVsZCBiZWxvbmdzIHRvLlxuICAgICAqIEB0eXBlIHtUeXBlfG51bGx9XG4gICAgICovXG4gICAgdGhpcy5tZXNzYWdlID0gbnVsbDtcblxuICAgIC8qKlxuICAgICAqIE9uZU9mIHRoaXMgZmllbGQgYmVsb25ncyB0bywgaWYgYW55LFxuICAgICAqIEB0eXBlIHtPbmVPZnxudWxsfVxuICAgICAqL1xuICAgIHRoaXMucGFydE9mID0gbnVsbDtcblxuICAgIC8qKlxuICAgICAqIFRoZSBmaWVsZCB0eXBlJ3MgZGVmYXVsdCB2YWx1ZS5cbiAgICAgKiBAdHlwZSB7Kn1cbiAgICAgKi9cbiAgICB0aGlzLnR5cGVEZWZhdWx0ID0gbnVsbDtcblxuICAgIC8qKlxuICAgICAqIFRoZSBmaWVsZCdzIGRlZmF1bHQgdmFsdWUgb24gcHJvdG90eXBlcy5cbiAgICAgKiBAdHlwZSB7Kn1cbiAgICAgKi9cbiAgICB0aGlzLmRlZmF1bHRWYWx1ZSA9IG51bGw7XG5cbiAgICAvKipcbiAgICAgKiBXaGV0aGVyIHRoaXMgZmllbGQncyB2YWx1ZSBzaG91bGQgYmUgdHJlYXRlZCBhcyBhIGxvbmcuXG4gICAgICogQHR5cGUge2Jvb2xlYW59XG4gICAgICovXG4gICAgdGhpcy5sb25nID0gdXRpbC5Mb25nID8gdHlwZXMubG9uZ1t0eXBlXSAhPT0gdW5kZWZpbmVkIDogLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi8gZmFsc2U7XG5cbiAgICAvKipcbiAgICAgKiBXaGV0aGVyIHRoaXMgZmllbGQncyB2YWx1ZSBpcyBhIGJ1ZmZlci5cbiAgICAgKiBAdHlwZSB7Ym9vbGVhbn1cbiAgICAgKi9cbiAgICB0aGlzLmJ5dGVzID0gdHlwZSA9PT0gXCJieXRlc1wiO1xuXG4gICAgLyoqXG4gICAgICogUmVzb2x2ZWQgdHlwZSBpZiBub3QgYSBiYXNpYyB0eXBlLlxuICAgICAqIEB0eXBlIHtUeXBlfEVudW18bnVsbH1cbiAgICAgKi9cbiAgICB0aGlzLnJlc29sdmVkVHlwZSA9IG51bGw7XG5cbiAgICAvKipcbiAgICAgKiBTaXN0ZXItZmllbGQgd2l0aGluIHRoZSBleHRlbmRlZCB0eXBlIGlmIGEgZGVjbGFyaW5nIGV4dGVuc2lvbiBmaWVsZC5cbiAgICAgKiBAdHlwZSB7RmllbGR8bnVsbH1cbiAgICAgKi9cbiAgICB0aGlzLmV4dGVuc2lvbkZpZWxkID0gbnVsbDtcblxuICAgIC8qKlxuICAgICAqIFNpc3Rlci1maWVsZCB3aXRoaW4gdGhlIGRlY2xhcmluZyBuYW1lc3BhY2UgaWYgYW4gZXh0ZW5kZWQgZmllbGQuXG4gICAgICogQHR5cGUge0ZpZWxkfG51bGx9XG4gICAgICovXG4gICAgdGhpcy5kZWNsYXJpbmdGaWVsZCA9IG51bGw7XG5cbiAgICAvKipcbiAgICAgKiBJbnRlcm5hbGx5IHJlbWVtYmVycyB3aGV0aGVyIHRoaXMgZmllbGQgaXMgcGFja2VkLlxuICAgICAqIEB0eXBlIHtib29sZWFufG51bGx9XG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICB0aGlzLl9wYWNrZWQgPSBudWxsO1xuXG4gICAgLyoqXG4gICAgICogQ29tbWVudCBmb3IgdGhpcyBmaWVsZC5cbiAgICAgKiBAdHlwZSB7c3RyaW5nfG51bGx9XG4gICAgICovXG4gICAgdGhpcy5jb21tZW50ID0gY29tbWVudDtcbn1cblxuLyoqXG4gKiBEZXRlcm1pbmVzIHdoZXRoZXIgdGhpcyBmaWVsZCBpcyBwYWNrZWQuIE9ubHkgcmVsZXZhbnQgd2hlbiByZXBlYXRlZCBhbmQgd29ya2luZyB3aXRoIHByb3RvMi5cbiAqIEBuYW1lIEZpZWxkI3BhY2tlZFxuICogQHR5cGUge2Jvb2xlYW59XG4gKiBAcmVhZG9ubHlcbiAqL1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KEZpZWxkLnByb3RvdHlwZSwgXCJwYWNrZWRcIiwge1xuICAgIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICAgIC8vIGRlZmF1bHRzIHRvIHBhY2tlZD10cnVlIGlmIG5vdCBleHBsaWNpdHkgc2V0IHRvIGZhbHNlXG4gICAgICAgIGlmICh0aGlzLl9wYWNrZWQgPT09IG51bGwpXG4gICAgICAgICAgICB0aGlzLl9wYWNrZWQgPSB0aGlzLmdldE9wdGlvbihcInBhY2tlZFwiKSAhPT0gZmFsc2U7XG4gICAgICAgIHJldHVybiB0aGlzLl9wYWNrZWQ7XG4gICAgfVxufSk7XG5cbi8qKlxuICogQG92ZXJyaWRlXG4gKi9cbkZpZWxkLnByb3RvdHlwZS5zZXRPcHRpb24gPSBmdW5jdGlvbiBzZXRPcHRpb24obmFtZSwgdmFsdWUsIGlmTm90U2V0KSB7XG4gICAgaWYgKG5hbWUgPT09IFwicGFja2VkXCIpIC8vIGNsZWFyIGNhY2hlZCBiZWZvcmUgc2V0dGluZ1xuICAgICAgICB0aGlzLl9wYWNrZWQgPSBudWxsO1xuICAgIHJldHVybiBSZWZsZWN0aW9uT2JqZWN0LnByb3RvdHlwZS5zZXRPcHRpb24uY2FsbCh0aGlzLCBuYW1lLCB2YWx1ZSwgaWZOb3RTZXQpO1xufTtcblxuLyoqXG4gKiBGaWVsZCBkZXNjcmlwdG9yLlxuICogQGludGVyZmFjZSBJRmllbGRcbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBbcnVsZT1cIm9wdGlvbmFsXCJdIEZpZWxkIHJ1bGVcbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSB0eXBlIEZpZWxkIHR5cGVcbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBpZCBGaWVsZCBpZFxuICogQHByb3BlcnR5IHtPYmplY3QuPHN0cmluZywqPn0gW29wdGlvbnNdIEZpZWxkIG9wdGlvbnNcbiAqL1xuXG4vKipcbiAqIEV4dGVuc2lvbiBmaWVsZCBkZXNjcmlwdG9yLlxuICogQGludGVyZmFjZSBJRXh0ZW5zaW9uRmllbGRcbiAqIEBleHRlbmRzIElGaWVsZFxuICogQHByb3BlcnR5IHtzdHJpbmd9IGV4dGVuZCBFeHRlbmRlZCB0eXBlXG4gKi9cblxuLyoqXG4gKiBDb252ZXJ0cyB0aGlzIGZpZWxkIHRvIGEgZmllbGQgZGVzY3JpcHRvci5cbiAqIEBwYXJhbSB7SVRvSlNPTk9wdGlvbnN9IFt0b0pTT05PcHRpb25zXSBKU09OIGNvbnZlcnNpb24gb3B0aW9uc1xuICogQHJldHVybnMge0lGaWVsZH0gRmllbGQgZGVzY3JpcHRvclxuICovXG5GaWVsZC5wcm90b3R5cGUudG9KU09OID0gZnVuY3Rpb24gdG9KU09OKHRvSlNPTk9wdGlvbnMpIHtcbiAgICB2YXIga2VlcENvbW1lbnRzID0gdG9KU09OT3B0aW9ucyA/IEJvb2xlYW4odG9KU09OT3B0aW9ucy5rZWVwQ29tbWVudHMpIDogZmFsc2U7XG4gICAgcmV0dXJuIHV0aWwudG9PYmplY3QoW1xuICAgICAgICBcInJ1bGVcIiAgICAsIHRoaXMucnVsZSAhPT0gXCJvcHRpb25hbFwiICYmIHRoaXMucnVsZSB8fCB1bmRlZmluZWQsXG4gICAgICAgIFwidHlwZVwiICAgICwgdGhpcy50eXBlLFxuICAgICAgICBcImlkXCIgICAgICAsIHRoaXMuaWQsXG4gICAgICAgIFwiZXh0ZW5kXCIgICwgdGhpcy5leHRlbmQsXG4gICAgICAgIFwib3B0aW9uc1wiICwgdGhpcy5vcHRpb25zLFxuICAgICAgICBcImNvbW1lbnRcIiAsIGtlZXBDb21tZW50cyA/IHRoaXMuY29tbWVudCA6IHVuZGVmaW5lZFxuICAgIF0pO1xufTtcblxuLyoqXG4gKiBSZXNvbHZlcyB0aGlzIGZpZWxkJ3MgdHlwZSByZWZlcmVuY2VzLlxuICogQHJldHVybnMge0ZpZWxkfSBgdGhpc2BcbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiBhbnkgcmVmZXJlbmNlIGNhbm5vdCBiZSByZXNvbHZlZFxuICovXG5GaWVsZC5wcm90b3R5cGUucmVzb2x2ZSA9IGZ1bmN0aW9uIHJlc29sdmUoKSB7XG5cbiAgICBpZiAodGhpcy5yZXNvbHZlZClcbiAgICAgICAgcmV0dXJuIHRoaXM7XG5cbiAgICBpZiAoKHRoaXMudHlwZURlZmF1bHQgPSB0eXBlcy5kZWZhdWx0c1t0aGlzLnR5cGVdKSA9PT0gdW5kZWZpbmVkKSB7IC8vIGlmIG5vdCBhIGJhc2ljIHR5cGUsIHJlc29sdmUgaXRcbiAgICAgICAgdGhpcy5yZXNvbHZlZFR5cGUgPSAodGhpcy5kZWNsYXJpbmdGaWVsZCA/IHRoaXMuZGVjbGFyaW5nRmllbGQucGFyZW50IDogdGhpcy5wYXJlbnQpLmxvb2t1cFR5cGVPckVudW0odGhpcy50eXBlKTtcbiAgICAgICAgaWYgKHRoaXMucmVzb2x2ZWRUeXBlIGluc3RhbmNlb2YgVHlwZSlcbiAgICAgICAgICAgIHRoaXMudHlwZURlZmF1bHQgPSBudWxsO1xuICAgICAgICBlbHNlIC8vIGluc3RhbmNlb2YgRW51bVxuICAgICAgICAgICAgdGhpcy50eXBlRGVmYXVsdCA9IHRoaXMucmVzb2x2ZWRUeXBlLnZhbHVlc1tPYmplY3Qua2V5cyh0aGlzLnJlc29sdmVkVHlwZS52YWx1ZXMpWzBdXTsgLy8gZmlyc3QgZGVmaW5lZFxuICAgIH1cblxuICAgIC8vIHVzZSBleHBsaWNpdGx5IHNldCBkZWZhdWx0IHZhbHVlIGlmIHByZXNlbnRcbiAgICBpZiAodGhpcy5vcHRpb25zICYmIHRoaXMub3B0aW9uc1tcImRlZmF1bHRcIl0gIT0gbnVsbCkge1xuICAgICAgICB0aGlzLnR5cGVEZWZhdWx0ID0gdGhpcy5vcHRpb25zW1wiZGVmYXVsdFwiXTtcbiAgICAgICAgaWYgKHRoaXMucmVzb2x2ZWRUeXBlIGluc3RhbmNlb2YgRW51bSAmJiB0eXBlb2YgdGhpcy50eXBlRGVmYXVsdCA9PT0gXCJzdHJpbmdcIilcbiAgICAgICAgICAgIHRoaXMudHlwZURlZmF1bHQgPSB0aGlzLnJlc29sdmVkVHlwZS52YWx1ZXNbdGhpcy50eXBlRGVmYXVsdF07XG4gICAgfVxuXG4gICAgLy8gcmVtb3ZlIHVubmVjZXNzYXJ5IG9wdGlvbnNcbiAgICBpZiAodGhpcy5vcHRpb25zKSB7XG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMucGFja2VkID09PSB0cnVlIHx8IHRoaXMub3B0aW9ucy5wYWNrZWQgIT09IHVuZGVmaW5lZCAmJiB0aGlzLnJlc29sdmVkVHlwZSAmJiAhKHRoaXMucmVzb2x2ZWRUeXBlIGluc3RhbmNlb2YgRW51bSkpXG4gICAgICAgICAgICBkZWxldGUgdGhpcy5vcHRpb25zLnBhY2tlZDtcbiAgICAgICAgaWYgKCFPYmplY3Qua2V5cyh0aGlzLm9wdGlvbnMpLmxlbmd0aClcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucyA9IHVuZGVmaW5lZDtcbiAgICB9XG5cbiAgICAvLyBjb252ZXJ0IHRvIGludGVybmFsIGRhdGEgdHlwZSBpZiBuZWNlc3NzYXJ5XG4gICAgaWYgKHRoaXMubG9uZykge1xuICAgICAgICB0aGlzLnR5cGVEZWZhdWx0ID0gdXRpbC5Mb25nLmZyb21OdW1iZXIodGhpcy50eXBlRGVmYXVsdCwgdGhpcy50eXBlLmNoYXJBdCgwKSA9PT0gXCJ1XCIpO1xuXG4gICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBlbHNlICovXG4gICAgICAgIGlmIChPYmplY3QuZnJlZXplKVxuICAgICAgICAgICAgT2JqZWN0LmZyZWV6ZSh0aGlzLnR5cGVEZWZhdWx0KTsgLy8gbG9uZyBpbnN0YW5jZXMgYXJlIG1lYW50IHRvIGJlIGltbXV0YWJsZSBhbnl3YXkgKGkuZS4gdXNlIHNtYWxsIGludCBjYWNoZSB0aGF0IGV2ZW4gcmVxdWlyZXMgaXQpXG5cbiAgICB9IGVsc2UgaWYgKHRoaXMuYnl0ZXMgJiYgdHlwZW9mIHRoaXMudHlwZURlZmF1bHQgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgdmFyIGJ1ZjtcbiAgICAgICAgaWYgKHV0aWwuYmFzZTY0LnRlc3QodGhpcy50eXBlRGVmYXVsdCkpXG4gICAgICAgICAgICB1dGlsLmJhc2U2NC5kZWNvZGUodGhpcy50eXBlRGVmYXVsdCwgYnVmID0gdXRpbC5uZXdCdWZmZXIodXRpbC5iYXNlNjQubGVuZ3RoKHRoaXMudHlwZURlZmF1bHQpKSwgMCk7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHV0aWwudXRmOC53cml0ZSh0aGlzLnR5cGVEZWZhdWx0LCBidWYgPSB1dGlsLm5ld0J1ZmZlcih1dGlsLnV0ZjgubGVuZ3RoKHRoaXMudHlwZURlZmF1bHQpKSwgMCk7XG4gICAgICAgIHRoaXMudHlwZURlZmF1bHQgPSBidWY7XG4gICAgfVxuXG4gICAgLy8gdGFrZSBzcGVjaWFsIGNhcmUgb2YgbWFwcyBhbmQgcmVwZWF0ZWQgZmllbGRzXG4gICAgaWYgKHRoaXMubWFwKVxuICAgICAgICB0aGlzLmRlZmF1bHRWYWx1ZSA9IHV0aWwuZW1wdHlPYmplY3Q7XG4gICAgZWxzZSBpZiAodGhpcy5yZXBlYXRlZClcbiAgICAgICAgdGhpcy5kZWZhdWx0VmFsdWUgPSB1dGlsLmVtcHR5QXJyYXk7XG4gICAgZWxzZVxuICAgICAgICB0aGlzLmRlZmF1bHRWYWx1ZSA9IHRoaXMudHlwZURlZmF1bHQ7XG5cbiAgICAvLyBlbnN1cmUgcHJvcGVyIHZhbHVlIG9uIHByb3RvdHlwZVxuICAgIGlmICh0aGlzLnBhcmVudCBpbnN0YW5jZW9mIFR5cGUpXG4gICAgICAgIHRoaXMucGFyZW50LmN0b3IucHJvdG90eXBlW3RoaXMubmFtZV0gPSB0aGlzLmRlZmF1bHRWYWx1ZTtcblxuICAgIHJldHVybiBSZWZsZWN0aW9uT2JqZWN0LnByb3RvdHlwZS5yZXNvbHZlLmNhbGwodGhpcyk7XG59O1xuXG4vKipcbiAqIERlY29yYXRvciBmdW5jdGlvbiBhcyByZXR1cm5lZCBieSB7QGxpbmsgRmllbGQuZH0gYW5kIHtAbGluayBNYXBGaWVsZC5kfSAoVHlwZVNjcmlwdCkuXG4gKiBAdHlwZWRlZiBGaWVsZERlY29yYXRvclxuICogQHR5cGUge2Z1bmN0aW9ufVxuICogQHBhcmFtIHtPYmplY3R9IHByb3RvdHlwZSBUYXJnZXQgcHJvdG90eXBlXG4gKiBAcGFyYW0ge3N0cmluZ30gZmllbGROYW1lIEZpZWxkIG5hbWVcbiAqIEByZXR1cm5zIHt1bmRlZmluZWR9XG4gKi9cblxuLyoqXG4gKiBGaWVsZCBkZWNvcmF0b3IgKFR5cGVTY3JpcHQpLlxuICogQG5hbWUgRmllbGQuZFxuICogQGZ1bmN0aW9uXG4gKiBAcGFyYW0ge251bWJlcn0gZmllbGRJZCBGaWVsZCBpZFxuICogQHBhcmFtIHtcImRvdWJsZVwifFwiZmxvYXRcInxcImludDMyXCJ8XCJ1aW50MzJcInxcInNpbnQzMlwifFwiZml4ZWQzMlwifFwic2ZpeGVkMzJcInxcImludDY0XCJ8XCJ1aW50NjRcInxcInNpbnQ2NFwifFwiZml4ZWQ2NFwifFwic2ZpeGVkNjRcInxcInN0cmluZ1wifFwiYm9vbFwifFwiYnl0ZXNcInxPYmplY3R9IGZpZWxkVHlwZSBGaWVsZCB0eXBlXG4gKiBAcGFyYW0ge1wib3B0aW9uYWxcInxcInJlcXVpcmVkXCJ8XCJyZXBlYXRlZFwifSBbZmllbGRSdWxlPVwib3B0aW9uYWxcIl0gRmllbGQgcnVsZVxuICogQHBhcmFtIHtUfSBbZGVmYXVsdFZhbHVlXSBEZWZhdWx0IHZhbHVlXG4gKiBAcmV0dXJucyB7RmllbGREZWNvcmF0b3J9IERlY29yYXRvciBmdW5jdGlvblxuICogQHRlbXBsYXRlIFQgZXh0ZW5kcyBudW1iZXIgfCBudW1iZXJbXSB8IExvbmcgfCBMb25nW10gfCBzdHJpbmcgfCBzdHJpbmdbXSB8IGJvb2xlYW4gfCBib29sZWFuW10gfCBVaW50OEFycmF5IHwgVWludDhBcnJheVtdIHwgQnVmZmVyIHwgQnVmZmVyW11cbiAqL1xuRmllbGQuZCA9IGZ1bmN0aW9uIGRlY29yYXRlRmllbGQoZmllbGRJZCwgZmllbGRUeXBlLCBmaWVsZFJ1bGUsIGRlZmF1bHRWYWx1ZSkge1xuXG4gICAgLy8gc3VibWVzc2FnZTogZGVjb3JhdGUgdGhlIHN1Ym1lc3NhZ2UgYW5kIHVzZSBpdHMgbmFtZSBhcyB0aGUgdHlwZVxuICAgIGlmICh0eXBlb2YgZmllbGRUeXBlID09PSBcImZ1bmN0aW9uXCIpXG4gICAgICAgIGZpZWxkVHlwZSA9IHV0aWwuZGVjb3JhdGVUeXBlKGZpZWxkVHlwZSkubmFtZTtcblxuICAgIC8vIGVudW0gcmVmZXJlbmNlOiBjcmVhdGUgYSByZWZsZWN0ZWQgY29weSBvZiB0aGUgZW51bSBhbmQga2VlcCByZXVzZWluZyBpdFxuICAgIGVsc2UgaWYgKGZpZWxkVHlwZSAmJiB0eXBlb2YgZmllbGRUeXBlID09PSBcIm9iamVjdFwiKVxuICAgICAgICBmaWVsZFR5cGUgPSB1dGlsLmRlY29yYXRlRW51bShmaWVsZFR5cGUpLm5hbWU7XG5cbiAgICByZXR1cm4gZnVuY3Rpb24gZmllbGREZWNvcmF0b3IocHJvdG90eXBlLCBmaWVsZE5hbWUpIHtcbiAgICAgICAgdXRpbC5kZWNvcmF0ZVR5cGUocHJvdG90eXBlLmNvbnN0cnVjdG9yKVxuICAgICAgICAgICAgLmFkZChuZXcgRmllbGQoZmllbGROYW1lLCBmaWVsZElkLCBmaWVsZFR5cGUsIGZpZWxkUnVsZSwgeyBcImRlZmF1bHRcIjogZGVmYXVsdFZhbHVlIH0pKTtcbiAgICB9O1xufTtcblxuLyoqXG4gKiBGaWVsZCBkZWNvcmF0b3IgKFR5cGVTY3JpcHQpLlxuICogQG5hbWUgRmllbGQuZFxuICogQGZ1bmN0aW9uXG4gKiBAcGFyYW0ge251bWJlcn0gZmllbGRJZCBGaWVsZCBpZFxuICogQHBhcmFtIHtDb25zdHJ1Y3RvcjxUPnxzdHJpbmd9IGZpZWxkVHlwZSBGaWVsZCB0eXBlXG4gKiBAcGFyYW0ge1wib3B0aW9uYWxcInxcInJlcXVpcmVkXCJ8XCJyZXBlYXRlZFwifSBbZmllbGRSdWxlPVwib3B0aW9uYWxcIl0gRmllbGQgcnVsZVxuICogQHJldHVybnMge0ZpZWxkRGVjb3JhdG9yfSBEZWNvcmF0b3IgZnVuY3Rpb25cbiAqIEB0ZW1wbGF0ZSBUIGV4dGVuZHMgTWVzc2FnZTxUPlxuICogQHZhcmlhdGlvbiAyXG4gKi9cbi8vIGxpa2UgRmllbGQuZCBidXQgd2l0aG91dCBhIGRlZmF1bHQgdmFsdWVcblxuLy8gU2V0cyB1cCBjeWNsaWMgZGVwZW5kZW5jaWVzIChjYWxsZWQgaW4gaW5kZXgtbGlnaHQpXG5GaWVsZC5fY29uZmlndXJlID0gZnVuY3Rpb24gY29uZmlndXJlKFR5cGVfKSB7XG4gICAgVHlwZSA9IFR5cGVfO1xufTtcbiJdLCJtYXBwaW5ncyI6IkFBQUEsWUFBWTs7QUFDWkEsTUFBTSxDQUFDQyxPQUFPLEdBQUdDLEtBQUs7O0FBRXRCO0FBQ0EsSUFBSUMsZ0JBQWdCLEdBQUdDLE9BQU8sQ0FBQyxVQUFVLENBQUM7QUFDMUMsQ0FBQyxDQUFDRixLQUFLLENBQUNHLFNBQVMsR0FBR0MsTUFBTSxDQUFDQyxNQUFNLENBQUNKLGdCQUFnQixDQUFDRSxTQUFTLENBQUMsRUFBRUcsV0FBVyxHQUFHTixLQUFLLEVBQUVPLFNBQVMsR0FBRyxPQUFPO0FBRXZHLElBQUlDLElBQUksR0FBSU4sT0FBTyxDQUFDLFFBQVEsQ0FBQztFQUN6Qk8sS0FBSyxHQUFHUCxPQUFPLENBQUMsU0FBUyxDQUFDO0VBQzFCUSxJQUFJLEdBQUlSLE9BQU8sQ0FBQyxRQUFRLENBQUM7QUFFN0IsSUFBSVMsSUFBSSxDQUFDLENBQUM7O0FBRVYsSUFBSUMsTUFBTSxHQUFHLDhCQUE4Qjs7QUFFM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7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