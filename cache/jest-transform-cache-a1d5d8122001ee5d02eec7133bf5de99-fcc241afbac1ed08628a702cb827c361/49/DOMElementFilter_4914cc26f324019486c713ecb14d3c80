f285affe65d454fb7a18bf8170dc763f
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = createDOMElementFilter;
exports.test = void 0;
/**
 * Source: https://github.com/facebook/jest/blob/e7bb6a1e26ffab90611b2593912df15b69315611/packages/pretty-format/src/plugins/DOMElement.ts
 */
/* eslint-disable -- trying to stay as close to the original as possible */
/* istanbul ignore file */

function escapeHTML(str) {
  return str.replace(/</g, '&lt;').replace(/>/g, '&gt;');
}
// Return empty string if keys is empty.
const printProps = (keys, props, config, indentation, depth, refs, printer) => {
  const indentationNext = indentation + config.indent;
  const colors = config.colors;
  return keys.map(key => {
    const value = props[key];
    let printed = printer(value, config, indentationNext, depth, refs);
    if (typeof value !== 'string') {
      if (printed.indexOf('\n') !== -1) {
        printed = config.spacingOuter + indentationNext + printed + config.spacingOuter + indentation;
      }
      printed = '{' + printed + '}';
    }
    return config.spacingInner + indentation + colors.prop.open + key + colors.prop.close + '=' + colors.value.open + printed + colors.value.close;
  }).join('');
};

// https://developer.mozilla.org/en-US/docs/Web/API/Node/nodeType#node_type_constants
const NodeTypeTextNode = 3;

// Return empty string if children is empty.
const printChildren = (children, config, indentation, depth, refs, printer) => children.map(child => {
  const printedChild = typeof child === 'string' ? printText(child, config) : printer(child, config, indentation, depth, refs);
  if (printedChild === '' && typeof child === 'object' && child !== null && child.nodeType !== NodeTypeTextNode) {
    // A plugin serialized this Node to '' meaning we should ignore it.
    return '';
  }
  return config.spacingOuter + indentation + printedChild;
}).join('');
const printText = (text, config) => {
  const contentColor = config.colors.content;
  return contentColor.open + escapeHTML(text) + contentColor.close;
};
const printComment = (comment, config) => {
  const commentColor = config.colors.comment;
  return commentColor.open + '<!--' + escapeHTML(comment) + '-->' + commentColor.close;
};

// Separate the functions to format props, children, and element,
// so a plugin could override a particular function, if needed.
// Too bad, so sad: the traditional (but unnecessary) space
// in a self-closing tagColor requires a second test of printedProps.
const printElement = (type, printedProps, printedChildren, config, indentation) => {
  const tagColor = config.colors.tag;
  return tagColor.open + '<' + type + (printedProps && tagColor.close + printedProps + config.spacingOuter + indentation + tagColor.open) + (printedChildren ? '>' + tagColor.close + printedChildren + config.spacingOuter + indentation + tagColor.open + '</' + type : (printedProps && !config.min ? '' : ' ') + '/') + '>' + tagColor.close;
};
const printElementAsLeaf = (type, config) => {
  const tagColor = config.colors.tag;
  return tagColor.open + '<' + type + tagColor.close + ' â€¦' + tagColor.open + ' />' + tagColor.close;
};
const ELEMENT_NODE = 1;
const TEXT_NODE = 3;
const COMMENT_NODE = 8;
const FRAGMENT_NODE = 11;
const ELEMENT_REGEXP = /^((HTML|SVG)\w*)?Element$/;
const testNode = val => {
  const constructorName = val.constructor.name;
  const {
    nodeType,
    tagName
  } = val;
  const isCustomElement = typeof tagName === 'string' && tagName.includes('-') || typeof val.hasAttribute === 'function' && val.hasAttribute('is');
  return nodeType === ELEMENT_NODE && (ELEMENT_REGEXP.test(constructorName) || isCustomElement) || nodeType === TEXT_NODE && constructorName === 'Text' || nodeType === COMMENT_NODE && constructorName === 'Comment' || nodeType === FRAGMENT_NODE && constructorName === 'DocumentFragment';
};
const test = val => {
  var _val$constructor;
  return (val == null ? void 0 : (_val$constructor = val.constructor) == null ? void 0 : _val$constructor.name) && testNode(val);
};
exports.test = test;
function nodeIsText(node) {
  return node.nodeType === TEXT_NODE;
}
function nodeIsComment(node) {
  return node.nodeType === COMMENT_NODE;
}
function nodeIsFragment(node) {
  return node.nodeType === FRAGMENT_NODE;
}
function createDOMElementFilter(filterNode) {
  return {
    test: val => {
      var _val$constructor2;
      return (val == null ? void 0 : (_val$constructor2 = val.constructor) == null ? void 0 : _val$constructor2.name) && testNode(val);
    },
    serialize: (node, config, indentation, depth, refs, printer) => {
      if (nodeIsText(node)) {
        return printText(node.data, config);
      }
      if (nodeIsComment(node)) {
        return printComment(node.data, config);
      }
      const type = nodeIsFragment(node) ? `DocumentFragment` : node.tagName.toLowerCase();
      if (++depth > config.maxDepth) {
        return printElementAsLeaf(type, config);
      }
      return printElement(type, printProps(nodeIsFragment(node) ? [] : Array.from(node.attributes).map(attr => attr.name).sort(), nodeIsFragment(node) ? {} : Array.from(node.attributes).reduce((props, attribute) => {
        props[attribute.name] = attribute.value;
        return props;
      }, {}), config, indentation + config.indent, depth, refs, printer), printChildren(Array.prototype.slice.call(node.childNodes || node.children).filter(filterNode), config, indentation + config.indent, depth, refs, printer), config, indentation);
    }
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsImRlZmF1bHQiLCJjcmVhdGVET01FbGVtZW50RmlsdGVyIiwidGVzdCIsImVzY2FwZUhUTUwiLCJzdHIiLCJyZXBsYWNlIiwicHJpbnRQcm9wcyIsImtleXMiLCJwcm9wcyIsImNvbmZpZyIsImluZGVudGF0aW9uIiwiZGVwdGgiLCJyZWZzIiwicHJpbnRlciIsImluZGVudGF0aW9uTmV4dCIsImluZGVudCIsImNvbG9ycyIsIm1hcCIsImtleSIsInByaW50ZWQiLCJpbmRleE9mIiwic3BhY2luZ091dGVyIiwic3BhY2luZ0lubmVyIiwicHJvcCIsIm9wZW4iLCJjbG9zZSIsImpvaW4iLCJOb2RlVHlwZVRleHROb2RlIiwicHJpbnRDaGlsZHJlbiIsImNoaWxkcmVuIiwiY2hpbGQiLCJwcmludGVkQ2hpbGQiLCJwcmludFRleHQiLCJub2RlVHlwZSIsInRleHQiLCJjb250ZW50Q29sb3IiLCJjb250ZW50IiwicHJpbnRDb21tZW50IiwiY29tbWVudCIsImNvbW1lbnRDb2xvciIsInByaW50RWxlbWVudCIsInR5cGUiLCJwcmludGVkUHJvcHMiLCJwcmludGVkQ2hpbGRyZW4iLCJ0YWdDb2xvciIsInRhZyIsIm1pbiIsInByaW50RWxlbWVudEFzTGVhZiIsIkVMRU1FTlRfTk9ERSIsIlRFWFRfTk9ERSIsIkNPTU1FTlRfTk9ERSIsIkZSQUdNRU5UX05PREUiLCJFTEVNRU5UX1JFR0VYUCIsInRlc3ROb2RlIiwidmFsIiwiY29uc3RydWN0b3JOYW1lIiwiY29uc3RydWN0b3IiLCJuYW1lIiwidGFnTmFtZSIsImlzQ3VzdG9tRWxlbWVudCIsImluY2x1ZGVzIiwiaGFzQXR0cmlidXRlIiwiX3ZhbCRjb25zdHJ1Y3RvciIsIm5vZGVJc1RleHQiLCJub2RlIiwibm9kZUlzQ29tbWVudCIsIm5vZGVJc0ZyYWdtZW50IiwiZmlsdGVyTm9kZSIsIl92YWwkY29uc3RydWN0b3IyIiwic2VyaWFsaXplIiwiZGF0YSIsInRvTG93ZXJDYXNlIiwibWF4RGVwdGgiLCJBcnJheSIsImZyb20iLCJhdHRyaWJ1dGVzIiwiYXR0ciIsInNvcnQiLCJyZWR1Y2UiLCJhdHRyaWJ1dGUiLCJwcm90b3R5cGUiLCJzbGljZSIsImNhbGwiLCJjaGlsZE5vZGVzIiwiZmlsdGVyIl0sInNvdXJjZXMiOlsiRE9NRWxlbWVudEZpbHRlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7XG4gIHZhbHVlOiB0cnVlXG59KTtcbmV4cG9ydHMuZGVmYXVsdCA9IGNyZWF0ZURPTUVsZW1lbnRGaWx0ZXI7XG5leHBvcnRzLnRlc3QgPSB2b2lkIDA7XG4vKipcbiAqIFNvdXJjZTogaHR0cHM6Ly9naXRodWIuY29tL2ZhY2Vib29rL2plc3QvYmxvYi9lN2JiNmExZTI2ZmZhYjkwNjExYjI1OTM5MTJkZjE1YjY5MzE1NjExL3BhY2thZ2VzL3ByZXR0eS1mb3JtYXQvc3JjL3BsdWdpbnMvRE9NRWxlbWVudC50c1xuICovXG4vKiBlc2xpbnQtZGlzYWJsZSAtLSB0cnlpbmcgdG8gc3RheSBhcyBjbG9zZSB0byB0aGUgb3JpZ2luYWwgYXMgcG9zc2libGUgKi9cbi8qIGlzdGFuYnVsIGlnbm9yZSBmaWxlICovXG5cbmZ1bmN0aW9uIGVzY2FwZUhUTUwoc3RyKSB7XG4gIHJldHVybiBzdHIucmVwbGFjZSgvPC9nLCAnJmx0OycpLnJlcGxhY2UoLz4vZywgJyZndDsnKTtcbn1cbi8vIFJldHVybiBlbXB0eSBzdHJpbmcgaWYga2V5cyBpcyBlbXB0eS5cbmNvbnN0IHByaW50UHJvcHMgPSAoa2V5cywgcHJvcHMsIGNvbmZpZywgaW5kZW50YXRpb24sIGRlcHRoLCByZWZzLCBwcmludGVyKSA9PiB7XG4gIGNvbnN0IGluZGVudGF0aW9uTmV4dCA9IGluZGVudGF0aW9uICsgY29uZmlnLmluZGVudDtcbiAgY29uc3QgY29sb3JzID0gY29uZmlnLmNvbG9ycztcbiAgcmV0dXJuIGtleXMubWFwKGtleSA9PiB7XG4gICAgY29uc3QgdmFsdWUgPSBwcm9wc1trZXldO1xuICAgIGxldCBwcmludGVkID0gcHJpbnRlcih2YWx1ZSwgY29uZmlnLCBpbmRlbnRhdGlvbk5leHQsIGRlcHRoLCByZWZzKTtcbiAgICBpZiAodHlwZW9mIHZhbHVlICE9PSAnc3RyaW5nJykge1xuICAgICAgaWYgKHByaW50ZWQuaW5kZXhPZignXFxuJykgIT09IC0xKSB7XG4gICAgICAgIHByaW50ZWQgPSBjb25maWcuc3BhY2luZ091dGVyICsgaW5kZW50YXRpb25OZXh0ICsgcHJpbnRlZCArIGNvbmZpZy5zcGFjaW5nT3V0ZXIgKyBpbmRlbnRhdGlvbjtcbiAgICAgIH1cbiAgICAgIHByaW50ZWQgPSAneycgKyBwcmludGVkICsgJ30nO1xuICAgIH1cbiAgICByZXR1cm4gY29uZmlnLnNwYWNpbmdJbm5lciArIGluZGVudGF0aW9uICsgY29sb3JzLnByb3Aub3BlbiArIGtleSArIGNvbG9ycy5wcm9wLmNsb3NlICsgJz0nICsgY29sb3JzLnZhbHVlLm9wZW4gKyBwcmludGVkICsgY29sb3JzLnZhbHVlLmNsb3NlO1xuICB9KS5qb2luKCcnKTtcbn07XG5cbi8vIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9Ob2RlL25vZGVUeXBlI25vZGVfdHlwZV9jb25zdGFudHNcbmNvbnN0IE5vZGVUeXBlVGV4dE5vZGUgPSAzO1xuXG4vLyBSZXR1cm4gZW1wdHkgc3RyaW5nIGlmIGNoaWxkcmVuIGlzIGVtcHR5LlxuY29uc3QgcHJpbnRDaGlsZHJlbiA9IChjaGlsZHJlbiwgY29uZmlnLCBpbmRlbnRhdGlvbiwgZGVwdGgsIHJlZnMsIHByaW50ZXIpID0+IGNoaWxkcmVuLm1hcChjaGlsZCA9PiB7XG4gIGNvbnN0IHByaW50ZWRDaGlsZCA9IHR5cGVvZiBjaGlsZCA9PT0gJ3N0cmluZycgPyBwcmludFRleHQoY2hpbGQsIGNvbmZpZykgOiBwcmludGVyKGNoaWxkLCBjb25maWcsIGluZGVudGF0aW9uLCBkZXB0aCwgcmVmcyk7XG4gIGlmIChwcmludGVkQ2hpbGQgPT09ICcnICYmIHR5cGVvZiBjaGlsZCA9PT0gJ29iamVjdCcgJiYgY2hpbGQgIT09IG51bGwgJiYgY2hpbGQubm9kZVR5cGUgIT09IE5vZGVUeXBlVGV4dE5vZGUpIHtcbiAgICAvLyBBIHBsdWdpbiBzZXJpYWxpemVkIHRoaXMgTm9kZSB0byAnJyBtZWFuaW5nIHdlIHNob3VsZCBpZ25vcmUgaXQuXG4gICAgcmV0dXJuICcnO1xuICB9XG4gIHJldHVybiBjb25maWcuc3BhY2luZ091dGVyICsgaW5kZW50YXRpb24gKyBwcmludGVkQ2hpbGQ7XG59KS5qb2luKCcnKTtcbmNvbnN0IHByaW50VGV4dCA9ICh0ZXh0LCBjb25maWcpID0+IHtcbiAgY29uc3QgY29udGVudENvbG9yID0gY29uZmlnLmNvbG9ycy5jb250ZW50O1xuICByZXR1cm4gY29udGVudENvbG9yLm9wZW4gKyBlc2NhcGVIVE1MKHRleHQpICsgY29udGVudENvbG9yLmNsb3NlO1xufTtcbmNvbnN0IHByaW50Q29tbWVudCA9IChjb21tZW50LCBjb25maWcpID0+IHtcbiAgY29uc3QgY29tbWVudENvbG9yID0gY29uZmlnLmNvbG9ycy5jb21tZW50O1xuICByZXR1cm4gY29tbWVudENvbG9yLm9wZW4gKyAnPCEtLScgKyBlc2NhcGVIVE1MKGNvbW1lbnQpICsgJy0tPicgKyBjb21tZW50Q29sb3IuY2xvc2U7XG59O1xuXG4vLyBTZXBhcmF0ZSB0aGUgZnVuY3Rpb25zIHRvIGZvcm1hdCBwcm9wcywgY2hpbGRyZW4sIGFuZCBlbGVtZW50LFxuLy8gc28gYSBwbHVnaW4gY291bGQgb3ZlcnJpZGUgYSBwYXJ0aWN1bGFyIGZ1bmN0aW9uLCBpZiBuZWVkZWQuXG4vLyBUb28gYmFkLCBzbyBzYWQ6IHRoZSB0cmFkaXRpb25hbCAoYnV0IHVubmVjZXNzYXJ5KSBzcGFjZVxuLy8gaW4gYSBzZWxmLWNsb3NpbmcgdGFnQ29sb3IgcmVxdWlyZXMgYSBzZWNvbmQgdGVzdCBvZiBwcmludGVkUHJvcHMuXG5jb25zdCBwcmludEVsZW1lbnQgPSAodHlwZSwgcHJpbnRlZFByb3BzLCBwcmludGVkQ2hpbGRyZW4sIGNvbmZpZywgaW5kZW50YXRpb24pID0+IHtcbiAgY29uc3QgdGFnQ29sb3IgPSBjb25maWcuY29sb3JzLnRhZztcbiAgcmV0dXJuIHRhZ0NvbG9yLm9wZW4gKyAnPCcgKyB0eXBlICsgKHByaW50ZWRQcm9wcyAmJiB0YWdDb2xvci5jbG9zZSArIHByaW50ZWRQcm9wcyArIGNvbmZpZy5zcGFjaW5nT3V0ZXIgKyBpbmRlbnRhdGlvbiArIHRhZ0NvbG9yLm9wZW4pICsgKHByaW50ZWRDaGlsZHJlbiA/ICc+JyArIHRhZ0NvbG9yLmNsb3NlICsgcHJpbnRlZENoaWxkcmVuICsgY29uZmlnLnNwYWNpbmdPdXRlciArIGluZGVudGF0aW9uICsgdGFnQ29sb3Iub3BlbiArICc8LycgKyB0eXBlIDogKHByaW50ZWRQcm9wcyAmJiAhY29uZmlnLm1pbiA/ICcnIDogJyAnKSArICcvJykgKyAnPicgKyB0YWdDb2xvci5jbG9zZTtcbn07XG5jb25zdCBwcmludEVsZW1lbnRBc0xlYWYgPSAodHlwZSwgY29uZmlnKSA9PiB7XG4gIGNvbnN0IHRhZ0NvbG9yID0gY29uZmlnLmNvbG9ycy50YWc7XG4gIHJldHVybiB0YWdDb2xvci5vcGVuICsgJzwnICsgdHlwZSArIHRhZ0NvbG9yLmNsb3NlICsgJyDigKYnICsgdGFnQ29sb3Iub3BlbiArICcgLz4nICsgdGFnQ29sb3IuY2xvc2U7XG59O1xuY29uc3QgRUxFTUVOVF9OT0RFID0gMTtcbmNvbnN0IFRFWFRfTk9ERSA9IDM7XG5jb25zdCBDT01NRU5UX05PREUgPSA4O1xuY29uc3QgRlJBR01FTlRfTk9ERSA9IDExO1xuY29uc3QgRUxFTUVOVF9SRUdFWFAgPSAvXigoSFRNTHxTVkcpXFx3Kik/RWxlbWVudCQvO1xuY29uc3QgdGVzdE5vZGUgPSB2YWwgPT4ge1xuICBjb25zdCBjb25zdHJ1Y3Rvck5hbWUgPSB2YWwuY29uc3RydWN0b3IubmFtZTtcbiAgY29uc3Qge1xuICAgIG5vZGVUeXBlLFxuICAgIHRhZ05hbWVcbiAgfSA9IHZhbDtcbiAgY29uc3QgaXNDdXN0b21FbGVtZW50ID0gdHlwZW9mIHRhZ05hbWUgPT09ICdzdHJpbmcnICYmIHRhZ05hbWUuaW5jbHVkZXMoJy0nKSB8fCB0eXBlb2YgdmFsLmhhc0F0dHJpYnV0ZSA9PT0gJ2Z1bmN0aW9uJyAmJiB2YWwuaGFzQXR0cmlidXRlKCdpcycpO1xuICByZXR1cm4gbm9kZVR5cGUgPT09IEVMRU1FTlRfTk9ERSAmJiAoRUxFTUVOVF9SRUdFWFAudGVzdChjb25zdHJ1Y3Rvck5hbWUpIHx8IGlzQ3VzdG9tRWxlbWVudCkgfHwgbm9kZVR5cGUgPT09IFRFWFRfTk9ERSAmJiBjb25zdHJ1Y3Rvck5hbWUgPT09ICdUZXh0JyB8fCBub2RlVHlwZSA9PT0gQ09NTUVOVF9OT0RFICYmIGNvbnN0cnVjdG9yTmFtZSA9PT0gJ0NvbW1lbnQnIHx8IG5vZGVUeXBlID09PSBGUkFHTUVOVF9OT0RFICYmIGNvbnN0cnVjdG9yTmFtZSA9PT0gJ0RvY3VtZW50RnJhZ21lbnQnO1xufTtcbmNvbnN0IHRlc3QgPSB2YWwgPT4ge1xuICB2YXIgX3ZhbCRjb25zdHJ1Y3RvcjtcbiAgcmV0dXJuICh2YWwgPT0gbnVsbCA/IHZvaWQgMCA6IChfdmFsJGNvbnN0cnVjdG9yID0gdmFsLmNvbnN0cnVjdG9yKSA9PSBudWxsID8gdm9pZCAwIDogX3ZhbCRjb25zdHJ1Y3Rvci5uYW1lKSAmJiB0ZXN0Tm9kZSh2YWwpO1xufTtcbmV4cG9ydHMudGVzdCA9IHRlc3Q7XG5mdW5jdGlvbiBub2RlSXNUZXh0KG5vZGUpIHtcbiAgcmV0dXJuIG5vZGUubm9kZVR5cGUgPT09IFRFWFRfTk9ERTtcbn1cbmZ1bmN0aW9uIG5vZGVJc0NvbW1lbnQobm9kZSkge1xuICByZXR1cm4gbm9kZS5ub2RlVHlwZSA9PT0gQ09NTUVOVF9OT0RFO1xufVxuZnVuY3Rpb24gbm9kZUlzRnJhZ21lbnQobm9kZSkge1xuICByZXR1cm4gbm9kZS5ub2RlVHlwZSA9PT0gRlJBR01FTlRfTk9ERTtcbn1cbmZ1bmN0aW9uIGNyZWF0ZURPTUVsZW1lbnRGaWx0ZXIoZmlsdGVyTm9kZSkge1xuICByZXR1cm4ge1xuICAgIHRlc3Q6IHZhbCA9PiB7XG4gICAgICB2YXIgX3ZhbCRjb25zdHJ1Y3RvcjI7XG4gICAgICByZXR1cm4gKHZhbCA9PSBudWxsID8gdm9pZCAwIDogKF92YWwkY29uc3RydWN0b3IyID0gdmFsLmNvbnN0cnVjdG9yKSA9PSBudWxsID8gdm9pZCAwIDogX3ZhbCRjb25zdHJ1Y3RvcjIubmFtZSkgJiYgdGVzdE5vZGUodmFsKTtcbiAgICB9LFxuICAgIHNlcmlhbGl6ZTogKG5vZGUsIGNvbmZpZywgaW5kZW50YXRpb24sIGRlcHRoLCByZWZzLCBwcmludGVyKSA9PiB7XG4gICAgICBpZiAobm9kZUlzVGV4dChub2RlKSkge1xuICAgICAgICByZXR1cm4gcHJpbnRUZXh0KG5vZGUuZGF0YSwgY29uZmlnKTtcbiAgICAgIH1cbiAgICAgIGlmIChub2RlSXNDb21tZW50KG5vZGUpKSB7XG4gICAgICAgIHJldHVybiBwcmludENvbW1lbnQobm9kZS5kYXRhLCBjb25maWcpO1xuICAgICAgfVxuICAgICAgY29uc3QgdHlwZSA9IG5vZGVJc0ZyYWdtZW50KG5vZGUpID8gYERvY3VtZW50RnJhZ21lbnRgIDogbm9kZS50YWdOYW1lLnRvTG93ZXJDYXNlKCk7XG4gICAgICBpZiAoKytkZXB0aCA+IGNvbmZpZy5tYXhEZXB0aCkge1xuICAgICAgICByZXR1cm4gcHJpbnRFbGVtZW50QXNMZWFmKHR5cGUsIGNvbmZpZyk7XG4gICAgICB9XG4gICAgICByZXR1cm4gcHJpbnRFbGVtZW50KHR5cGUsIHByaW50UHJvcHMobm9kZUlzRnJhZ21lbnQobm9kZSkgPyBbXSA6IEFycmF5LmZyb20obm9kZS5hdHRyaWJ1dGVzKS5tYXAoYXR0ciA9PiBhdHRyLm5hbWUpLnNvcnQoKSwgbm9kZUlzRnJhZ21lbnQobm9kZSkgPyB7fSA6IEFycmF5LmZyb20obm9kZS5hdHRyaWJ1dGVzKS5yZWR1Y2UoKHByb3BzLCBhdHRyaWJ1dGUpID0+IHtcbiAgICAgICAgcHJvcHNbYXR0cmlidXRlLm5hbWVdID0gYXR0cmlidXRlLnZhbHVlO1xuICAgICAgICByZXR1cm4gcHJvcHM7XG4gICAgICB9LCB7fSksIGNvbmZpZywgaW5kZW50YXRpb24gKyBjb25maWcuaW5kZW50LCBkZXB0aCwgcmVmcywgcHJpbnRlciksIHByaW50Q2hpbGRyZW4oQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwobm9kZS5jaGlsZE5vZGVzIHx8IG5vZGUuY2hpbGRyZW4pLmZpbHRlcihmaWx0ZXJOb2RlKSwgY29uZmlnLCBpbmRlbnRhdGlvbiArIGNvbmZpZy5pbmRlbnQsIGRlcHRoLCByZWZzLCBwcmludGVyKSwgY29uZmlnLCBpbmRlbnRhdGlvbik7XG4gICAgfVxuICB9O1xufSJdLCJtYXBwaW5ncyI6IkFBQUEsWUFBWTs7QUFFWkEsTUFBTSxDQUFDQyxjQUFjLENBQUNDLE9BQU8sRUFBRSxZQUFZLEVBQUU7RUFDM0NDLEtBQUssRUFBRTtBQUNULENBQUMsQ0FBQztBQUNGRCxPQUFPLENBQUNFLE9BQU8sR0FBR0Msc0JBQXNCO0FBQ3hDSCxPQUFPLENBQUNJLElBQUksR0FBRyxLQUFLLENBQUM7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxTQUFTQyxVQUFVQSxDQUFDQyxHQUFHLEVBQUU7RUFDdkIsT0FBT0EsR0FBRyxDQUFDQyxPQUFPLENBQUMsSUFBSSxFQUFFLE1BQU0sQ0FBQyxDQUFDQSxPQUFPLENBQUMsSUFBSSxFQUFFLE1BQU0sQ0FBQztBQUN4RDtBQUNBO0FBQ0EsTUFBTUMsVUFBVSxHQUFHQSxDQUFDQyxJQUFJLEVBQUVDLEtBQUssRUFBRUMsTUFBTSxFQUFFQyxXQUFXLEVBQUVDLEtBQUssRUFBRUMsSUFBSSxFQUFFQyxPQUFPLEtBQUs7RUFDN0UsTUFBTUMsZUFBZSxHQUFHSixXQUFXLEdBQUdELE1BQU0sQ0FBQ00sTUFBTTtFQUNuRCxNQUFNQyxNQUFNLEdBQUdQLE1BQU0sQ0FBQ08sTUFBTTtFQUM1QixPQUFPVCxJQUFJLENBQUNVLEdBQUcsQ0FBQ0MsR0FBRyxJQUFJO0lBQ3JCLE1BQU1uQixLQUFLLEdBQUdTLEtBQUssQ0FBQ1UsR0FBRyxDQUFDO0lBQ3hCLElBQUlDLE9BQU8sR0FBR04sT0FBTyxDQUFDZCxLQUFLLEVBQUVVLE1BQU0sRUFBRUssZUFBZSxFQUFFSCxLQUFLLEVBQUVDLElBQUksQ0FBQztJQUNsRSxJQUFJLE9BQU9iLEtBQUssS0FBSyxRQUFRLEVBQUU7TUFDN0IsSUFBSW9CLE9BQU8sQ0FBQ0MsT0FBTyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFO1FBQ2hDRCxPQUFPLEdBQUdWLE1BQU0sQ0FBQ1ksWUFBWSxHQUFHUCxlQUFlLEdBQUdLLE9BQU8sR0FBR1YsTUFBTSxDQUFDWSxZQUFZLEdBQUdYLFdBQVc7TUFDL0Y7TUFDQVMsT0FBTyxHQUFHLEdBQUcsR0FBR0EsT0FBTyxHQUFHLEdBQUc7SUFDL0I7SUFDQSxPQUFPVixNQUFNLENBQUNhLFlBQVksR0FBR1osV0FBVyxHQUFHTSxNQUFNLENBQUNPLElBQUksQ0FBQ0MsSUFBSSxHQUFHTixHQUFHLEdBQUdGLE1BQU0sQ0FBQ08sSUFBSSxDQUFDRSxLQUFLLEdBQUcsR0FBRyxHQUFHVCxNQUFNLENBQUNqQixLQUFLLENBQUN5QixJQUFJLEdBQUdMLE9BQU8sR0FBR0gsTUFBTSxDQUFDakIsS0FBSyxDQUFDMEIsS0FBSztFQUNoSixDQUFDLENBQUMsQ0FBQ0MsSUFBSSxDQUFDLEVBQUUsQ0FBQztBQUNiLENBQUM7O0FBRUQ7QUFDQSxNQUFNQyxnQkFBZ0IsR0FBRyxDQUFDOztBQUUxQjtBQUNBLE1BQU1DLGFBQWEsR0FBR0EsQ0FBQ0MsUUFBUSxFQUFFcEIsTUFBTSxFQUFFQyxXQUFXLEVBQUVDLEtBQUssRUFBRUMsSUFBSSxFQUFFQyxPQUFPLEtBQUtnQixRQUFRLENBQUNaLEdBQUcsQ0FBQ2EsS0FBSyxJQUFJO0VBQ25HLE1BQU1DLFlBQVksR0FBRyxPQUFPRCxLQUFLLEtBQUssUUFBUSxHQUFHRSxTQUFTLENBQUNGLEtBQUssRUFBRXJCLE1BQU0sQ0FBQyxHQUFHSSxPQUFPLENBQUNpQixLQUFLLEVBQUVyQixNQUFNLEVBQUVDLFdBQVcsRUFBRUMsS0FBSyxFQUFFQyxJQUFJLENBQUM7RUFDNUgsSUFBSW1CLFlBQVksS0FBSyxFQUFFLElBQUksT0FBT0QsS0FBSyxLQUFLLFFBQVEsSUFBSUEsS0FBSyxLQUFLLElBQUksSUFBSUEsS0FBSyxDQUFDRyxRQUFRLEtBQUtOLGdCQUFnQixFQUFFO0lBQzdHO0lBQ0EsT0FBTyxFQUFFO0VBQ1g7RUFDQSxPQUFPbEIsTUFBTSxDQUFDWSxZQUFZLEdBQUdYLFdBQVcsR0FBR3FCLFlBQVk7QUFDekQsQ0FBQyxDQUFDLENBQUNMLElBQUksQ0FBQyxFQUFFLENBQUM7QUFDWCxNQUFNTSxTQUFTLEdBQUdBLENBQUNFLElBQUksRUFBRXpCLE1BQU0sS0FBSztFQUNsQyxNQUFNMEIsWUFBWSxHQUFHMUIsTUFBTSxDQUFDTyxNQUFNLENBQUNvQixPQUFPO0VBQzFDLE9BQU9ELFlBQVksQ0FBQ1gsSUFBSSxHQUFHckIsVUFBVSxDQUFDK0IsSUFBSSxDQUFDLEdBQUdDLFlBQVksQ0FBQ1YsS0FBSztBQUNsRSxDQUFDO0FBQ0QsTUFBTVksWUFBWSxHQUFHQSxDQUFDQyxPQUFPLEVBQUU3QixNQUFNLEtBQUs7RUFDeEMsTUFBTThCLFlBQVksR0FBRzlCLE1BQU0sQ0FBQ08sTUFBTSxDQUFDc0IsT0FBTztFQUMxQyxPQUFPQyxZQUFZLENBQUNmLElBQUksR0FBRyxNQUFNLEdBQUdyQixVQUFVLENBQUNtQyxPQUFPLENBQUMsR0FBRyxLQUFLLEdBQUdDLFlBQVksQ0FBQ2QsS0FBSztBQUN0RixDQUFDOztBQUVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTWUsWUFBWSxHQUFHQSxDQUFDQyxJQUFJLEVBQUVDLFlBQVksRUFBRUMsZUFBZSxFQUFFbEMsTUFBTSxFQUFFQyxXQUFXLEtBQUs7RUFDakYsTUFBTWtDLFFBQVEsR0FBR25DLE1BQU0sQ0FBQ08sTUFBTSxDQUFDNkIsR0FBRztFQUNsQyxPQUFPRCxRQUFRLENBQUNwQixJQUFJLEdBQUcsR0FBRyxHQUFHaUIsSUFBSSxJQUFJQyxZQUFZLElBQUlFLFFBQVEsQ0FBQ25CLEtBQUssR0FBR2lCLFlBQVksR0FBR2pDLE1BQU0sQ0FBQ1ksWUFBWSxHQUFHWCxXQUFXLEdBQUdrQyxRQUFRLENBQUNwQixJQUFJLENBQUMsSUFBSW1CLGVBQWUsR0FBRyxHQUFHLEdBQUdDLFFBQVEsQ0FBQ25CLEtBQUssR0FBR2tCLGVBQWUsR0FBR2xDLE1BQU0sQ0FBQ1ksWUFBWSxHQUFHWCxXQUFXLEdBQUdrQyxRQUFRLENBQUNwQixJQUFJLEdBQUcsSUFBSSxHQUFHaUIsSUFBSSxHQUFHLENBQUNDLFlBQVksSUFBSSxDQUFDakMsTUFBTSxDQUFDcUMsR0FBRyxHQUFHLEVBQUUsR0FBRyxHQUFHLElBQUksR0FBRyxDQUFDLEdBQUcsR0FBRyxHQUFHRixRQUFRLENBQUNuQixLQUFLO0FBQ2hWLENBQUM7QUFDRCxNQUFNc0Isa0JBQWtCLEdBQUdBLENBQUNOLElBQUksRUFBRWhDLE1BQU0sS0FBSztFQUMzQyxNQUFNbUMsUUFBUSxHQUFHbkMsTUFBTSxDQUFDTyxNQUFNLENBQUM2QixHQUFHO0VBQ2xDLE9BQU9ELFFBQVEsQ0FBQ3BCLElBQUksR0FBRyxHQUFHLEdBQUdpQixJQUFJLEdBQUdHLFFBQVEsQ0FBQ25CLEtBQUssR0FBRyxJQUFJLEdBQUdtQixRQUFRLENBQUNwQixJQUFJLEdBQUcsS0FBSyxHQUFHb0IsUUFBUSxDQUFDbkIsS0FBSztBQUNwRyxDQUFDO0FBQ0QsTUFBTXVCLFlBQVksR0FBRyxDQUFDO0FBQ3RCLE1BQU1DLFNBQVMsR0FBRyxDQUFDO0FBQ25CLE1BQU1DLFlBQVksR0FBRyxDQUFDO0FBQ3RCLE1BQU1DLGFBQWEsR0FBRyxFQUFFO0FBQ3hCLE1BQU1DLGNBQWMsR0FBRywyQkFBMkI7QUFDbEQsTUFBTUMsUUFBUSxHQUFHQyxHQUFHLElBQUk7RUFDdEIsTUFBTUMsZUFBZSxHQUFHRCxHQUFHLENBQUNFLFdBQVcsQ0FBQ0MsSUFBSTtFQUM1QyxNQUFNO0lBQ0p4QixRQUFRO0lBQ1J5QjtFQUNGLENBQUMsR0FBR0osR0FBRztFQUNQLE1BQU1LLGVBQWUsR0FBRyxPQUFPRCxPQUFPLEtBQUssUUFBUSxJQUFJQSxPQUFPLENBQUNFLFFBQVEsQ0FBQyxHQUFHLENBQUMsSUFBSSxPQUFPTixHQUFHLENBQUNPLFlBQVksS0FBSyxVQUFVLElBQUlQLEdBQUcsQ0FBQ08sWUFBWSxDQUFDLElBQUksQ0FBQztFQUNoSixPQUFPNUIsUUFBUSxLQUFLZSxZQUFZLEtBQUtJLGNBQWMsQ0FBQ2xELElBQUksQ0FBQ3FELGVBQWUsQ0FBQyxJQUFJSSxlQUFlLENBQUMsSUFBSTFCLFFBQVEsS0FBS2dCLFNBQVMsSUFBSU0sZUFBZSxLQUFLLE1BQU0sSUFBSXRCLFFBQVEsS0FBS2lCLFlBQVksSUFBSUssZUFBZSxLQUFLLFNBQVMsSUFBSXRCLFFBQVEsS0FBS2tCLGFBQWEsSUFBSUksZUFBZSxLQUFLLGtCQUFrQjtBQUM3UixDQUFDO0FBQ0QsTUFBTXJELElBQUksR0FBR29ELEdBQUcsSUFBSTtFQUNsQixJQUFJUSxnQkFBZ0I7RUFDcEIsT0FBTyxDQUFDUixHQUFHLElBQUksSUFBSSxHQUFHLEtBQUssQ0FBQyxHQUFHLENBQUNRLGdCQUFnQixHQUFHUixHQUFHLENBQUNFLFdBQVcsS0FBSyxJQUFJLEdBQUcsS0FBSyxDQUFDLEdBQUdNLGdCQUFnQixDQUFDTCxJQUFJLEtBQUtKLFFBQVEsQ0FBQ0MsR0FBRyxDQUFDO0FBQ2hJLENBQUM7QUFDRHhELE9BQU8sQ0FBQ0ksSUFBSSxHQUFHQSxJQUFJO0FBQ25CLFNBQVM2RCxVQUFVQSxDQUFDQyxJQUFJLEVBQUU7RUFDeEIsT0FBT0EsSUFBSSxDQUFDL0IsUUFBUSxLQUFLZ0IsU0FBUztBQUNwQztBQUNBLFNBQVNnQixhQUFhQSxDQUFDRCxJQUFJLEVBQUU7RUFDM0IsT0FBT0EsSUFBSSxDQUFDL0IsUUFBUSxLQUFLaUIsWUFBWTtBQUN2QztBQUNBLFNBQVNnQixjQUFjQSxDQUFDRixJQUFJLEVBQUU7RUFDNUIsT0FBT0EsSUFBSSxDQUFDL0IsUUFBUSxLQUFLa0IsYUFBYTtBQUN4QztBQUNBLFNBQVNsRCxzQkFBc0JBLENBQUNrRSxVQUFVLEVBQUU7RUFDMUMsT0FBTztJQUNMakUsSUFBSSxFQUFFb0QsR0FBRyxJQUFJO01BQ1gsSUFBSWMsaUJBQWlCO01BQ3JCLE9BQU8sQ0FBQ2QsR0FBRyxJQUFJLElBQUksR0FBRyxLQUFLLENBQUMsR0FBRyxDQUFDYyxpQkFBaUIsR0FBR2QsR0FBRyxDQUFDRSxXQUFXLEtBQUssSUFBSSxHQUFHLEtBQUssQ0FBQyxHQUFHWSxpQkFBaUIsQ0FBQ1gsSUFBSSxLQUFLSixRQUFRLENBQUNDLEdBQUcsQ0FBQztJQUNsSSxDQUFDO0lBQ0RlLFNBQVMsRUFBRUEsQ0FBQ0wsSUFBSSxFQUFFdkQsTUFBTSxFQUFFQyxXQUFXLEVBQUVDLEtBQUssRUFBRUMsSUFBSSxFQUFFQyxPQUFPLEtBQUs7TUFDOUQsSUFBSWtELFVBQVUsQ0FBQ0MsSUFBSSxDQUFDLEVBQUU7UUFDcEIsT0FBT2hDLFNBQVMsQ0FBQ2dDLElBQUksQ0FBQ00sSUFBSSxFQUFFN0QsTUFBTSxDQUFDO01BQ3JDO01BQ0EsSUFBSXdELGFBQWEsQ0FBQ0QsSUFBSSxDQUFDLEVBQUU7UUFDdkIsT0FBTzNCLFlBQVksQ0FBQzJCLElBQUksQ0FBQ00sSUFBSSxFQUFFN0QsTUFBTSxDQUFDO01BQ3hDO01BQ0EsTUFBTWdDLElBQUksR0FBR3lCLGNBQWMsQ0FBQ0YsSUFBSSxDQUFDLEdBQUksa0JBQWlCLEdBQUdBLElBQUksQ0FBQ04sT0FBTyxDQUFDYSxXQUFXLEVBQUU7TUFDbkYsSUFBSSxFQUFFNUQsS0FBSyxHQUFHRixNQUFNLENBQUMrRCxRQUFRLEVBQUU7UUFDN0IsT0FBT3pCLGtCQUFrQixDQUFDTixJQUFJLEVBQUVoQyxNQUFNLENBQUM7TUFDekM7TUFDQSxPQUFPK0IsWUFBWSxDQUFDQyxJQUFJLEVBQUVuQyxVQUFVLENBQUM0RCxjQUFjLENBQUNGLElBQUksQ0FBQyxHQUFHLEVBQUUsR0FBR1MsS0FBSyxDQUFDQyxJQUFJLENBQUNWLElBQUksQ0FBQ1csVUFBVSxDQUFDLENBQUMxRCxHQUFHLENBQUMyRCxJQUFJLElBQUlBLElBQUksQ0FBQ25CLElBQUksQ0FBQyxDQUFDb0IsSUFBSSxFQUFFLEVBQUVYLGNBQWMsQ0FBQ0YsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUdTLEtBQUssQ0FBQ0MsSUFBSSxDQUFDVixJQUFJLENBQUNXLFVBQVUsQ0FBQyxDQUFDRyxNQUFNLENBQUMsQ0FBQ3RFLEtBQUssRUFBRXVFLFNBQVMsS0FBSztRQUMvTXZFLEtBQUssQ0FBQ3VFLFNBQVMsQ0FBQ3RCLElBQUksQ0FBQyxHQUFHc0IsU0FBUyxDQUFDaEYsS0FBSztRQUN2QyxPQUFPUyxLQUFLO01BQ2QsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUVDLE1BQU0sRUFBRUMsV0FBVyxHQUFHRCxNQUFNLENBQUNNLE1BQU0sRUFBRUosS0FBSyxFQUFFQyxJQUFJLEVBQUVDLE9BQU8sQ0FBQyxFQUFFZSxhQUFhLENBQUM2QyxLQUFLLENBQUNPLFNBQVMsQ0FBQ0MsS0FBSyxDQUFDQyxJQUFJLENBQUNsQixJQUFJLENBQUNtQixVQUFVLElBQUluQixJQUFJLENBQUNuQyxRQUFRLENBQUMsQ0FBQ3VELE1BQU0sQ0FBQ2pCLFVBQVUsQ0FBQyxFQUFFMUQsTUFBTSxFQUFFQyxXQUFXLEdBQUdELE1BQU0sQ0FBQ00sTUFBTSxFQUFFSixLQUFLLEVBQUVDLElBQUksRUFBRUMsT0FBTyxDQUFDLEVBQUVKLE1BQU0sRUFBRUMsV0FBVyxDQUFDO0lBQ3JQO0VBQ0YsQ0FBQztBQUNIIn0=