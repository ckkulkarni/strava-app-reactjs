10635cf867a7d36847de70125b2a72fd
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _stream = _interopRequireDefault(require("stream"));
var _utils = _interopRequireDefault(require("../utils.js"));
var _throttle = _interopRequireDefault(require("./throttle.js"));
var _speedometer2 = _interopRequireDefault(require("./speedometer.js"));
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
const kInternals = Symbol('internals');
class AxiosTransformStream extends _stream.default.Transform {
  constructor(options) {
    options = _utils.default.toFlatObject(options, {
      maxRate: 0,
      chunkSize: 64 * 1024,
      minChunkSize: 100,
      timeWindow: 500,
      ticksRate: 2,
      samplesCount: 15
    }, null, (prop, source) => {
      return !_utils.default.isUndefined(source[prop]);
    });
    super({
      readableHighWaterMark: options.chunkSize
    });
    const self = this;
    const internals = this[kInternals] = {
      length: options.length,
      timeWindow: options.timeWindow,
      ticksRate: options.ticksRate,
      chunkSize: options.chunkSize,
      maxRate: options.maxRate,
      minChunkSize: options.minChunkSize,
      bytesSeen: 0,
      isCaptured: false,
      notifiedBytesLoaded: 0,
      ts: Date.now(),
      bytes: 0,
      onReadCallback: null
    };
    const _speedometer = (0, _speedometer2.default)(internals.ticksRate * options.samplesCount, internals.timeWindow);
    this.on('newListener', event => {
      if (event === 'progress') {
        if (!internals.isCaptured) {
          internals.isCaptured = true;
        }
      }
    });
    let bytesNotified = 0;
    internals.updateProgress = (0, _throttle.default)(function throttledHandler() {
      const totalBytes = internals.length;
      const bytesTransferred = internals.bytesSeen;
      const progressBytes = bytesTransferred - bytesNotified;
      if (!progressBytes || self.destroyed) return;
      const rate = _speedometer(progressBytes);
      bytesNotified = bytesTransferred;
      process.nextTick(() => {
        self.emit('progress', {
          'loaded': bytesTransferred,
          'total': totalBytes,
          'progress': totalBytes ? bytesTransferred / totalBytes : undefined,
          'bytes': progressBytes,
          'rate': rate ? rate : undefined,
          'estimated': rate && totalBytes && bytesTransferred <= totalBytes ? (totalBytes - bytesTransferred) / rate : undefined
        });
      });
    }, internals.ticksRate);
    const onFinish = () => {
      internals.updateProgress(true);
    };
    this.once('end', onFinish);
    this.once('error', onFinish);
  }
  _read(size) {
    const internals = this[kInternals];
    if (internals.onReadCallback) {
      internals.onReadCallback();
    }
    return super._read(size);
  }
  _transform(chunk, encoding, callback) {
    const self = this;
    const internals = this[kInternals];
    const maxRate = internals.maxRate;
    const readableHighWaterMark = this.readableHighWaterMark;
    const timeWindow = internals.timeWindow;
    const divider = 1000 / timeWindow;
    const bytesThreshold = maxRate / divider;
    const minChunkSize = internals.minChunkSize !== false ? Math.max(internals.minChunkSize, bytesThreshold * 0.01) : 0;
    function pushChunk(_chunk, _callback) {
      const bytes = Buffer.byteLength(_chunk);
      internals.bytesSeen += bytes;
      internals.bytes += bytes;
      if (internals.isCaptured) {
        internals.updateProgress();
      }
      if (self.push(_chunk)) {
        process.nextTick(_callback);
      } else {
        internals.onReadCallback = () => {
          internals.onReadCallback = null;
          process.nextTick(_callback);
        };
      }
    }
    const transformChunk = (_chunk, _callback) => {
      const chunkSize = Buffer.byteLength(_chunk);
      let chunkRemainder = null;
      let maxChunkSize = readableHighWaterMark;
      let bytesLeft;
      let passed = 0;
      if (maxRate) {
        const now = Date.now();
        if (!internals.ts || (passed = now - internals.ts) >= timeWindow) {
          internals.ts = now;
          bytesLeft = bytesThreshold - internals.bytes;
          internals.bytes = bytesLeft < 0 ? -bytesLeft : 0;
          passed = 0;
        }
        bytesLeft = bytesThreshold - internals.bytes;
      }
      if (maxRate) {
        if (bytesLeft <= 0) {
          // next time window
          return setTimeout(() => {
            _callback(null, _chunk);
          }, timeWindow - passed);
        }
        if (bytesLeft < maxChunkSize) {
          maxChunkSize = bytesLeft;
        }
      }
      if (maxChunkSize && chunkSize > maxChunkSize && chunkSize - maxChunkSize > minChunkSize) {
        chunkRemainder = _chunk.subarray(maxChunkSize);
        _chunk = _chunk.subarray(0, maxChunkSize);
      }
      pushChunk(_chunk, chunkRemainder ? () => {
        process.nextTick(_callback, null, chunkRemainder);
      } : _callback);
    };
    transformChunk(chunk, function transformNextChunk(err, _chunk) {
      if (err) {
        return callback(err);
      }
      if (_chunk) {
        transformChunk(_chunk, transformNextChunk);
      } else {
        callback(null);
      }
    });
  }
  setLength(length) {
    this[kInternals].length = +length;
    return this;
  }
}
var _default = AxiosTransformStream;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsImRlZmF1bHQiLCJfc3RyZWFtIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsInJlcXVpcmUiLCJfdXRpbHMiLCJfdGhyb3R0bGUiLCJfc3BlZWRvbWV0ZXIyIiwib2JqIiwiX19lc01vZHVsZSIsImtJbnRlcm5hbHMiLCJTeW1ib2wiLCJBeGlvc1RyYW5zZm9ybVN0cmVhbSIsInN0cmVhbSIsIlRyYW5zZm9ybSIsImNvbnN0cnVjdG9yIiwib3B0aW9ucyIsInV0aWxzIiwidG9GbGF0T2JqZWN0IiwibWF4UmF0ZSIsImNodW5rU2l6ZSIsIm1pbkNodW5rU2l6ZSIsInRpbWVXaW5kb3ciLCJ0aWNrc1JhdGUiLCJzYW1wbGVzQ291bnQiLCJwcm9wIiwic291cmNlIiwiaXNVbmRlZmluZWQiLCJyZWFkYWJsZUhpZ2hXYXRlck1hcmsiLCJzZWxmIiwiaW50ZXJuYWxzIiwibGVuZ3RoIiwiYnl0ZXNTZWVuIiwiaXNDYXB0dXJlZCIsIm5vdGlmaWVkQnl0ZXNMb2FkZWQiLCJ0cyIsIkRhdGUiLCJub3ciLCJieXRlcyIsIm9uUmVhZENhbGxiYWNrIiwiX3NwZWVkb21ldGVyIiwic3BlZWRvbWV0ZXIiLCJvbiIsImV2ZW50IiwiYnl0ZXNOb3RpZmllZCIsInVwZGF0ZVByb2dyZXNzIiwidGhyb3R0bGUiLCJ0aHJvdHRsZWRIYW5kbGVyIiwidG90YWxCeXRlcyIsImJ5dGVzVHJhbnNmZXJyZWQiLCJwcm9ncmVzc0J5dGVzIiwiZGVzdHJveWVkIiwicmF0ZSIsInByb2Nlc3MiLCJuZXh0VGljayIsImVtaXQiLCJ1bmRlZmluZWQiLCJvbkZpbmlzaCIsIm9uY2UiLCJfcmVhZCIsInNpemUiLCJfdHJhbnNmb3JtIiwiY2h1bmsiLCJlbmNvZGluZyIsImNhbGxiYWNrIiwiZGl2aWRlciIsImJ5dGVzVGhyZXNob2xkIiwiTWF0aCIsIm1heCIsInB1c2hDaHVuayIsIl9jaHVuayIsIl9jYWxsYmFjayIsIkJ1ZmZlciIsImJ5dGVMZW5ndGgiLCJwdXNoIiwidHJhbnNmb3JtQ2h1bmsiLCJjaHVua1JlbWFpbmRlciIsIm1heENodW5rU2l6ZSIsImJ5dGVzTGVmdCIsInBhc3NlZCIsInNldFRpbWVvdXQiLCJzdWJhcnJheSIsInRyYW5zZm9ybU5leHRDaHVuayIsImVyciIsInNldExlbmd0aCIsIl9kZWZhdWx0Il0sInNvdXJjZXMiOlsiQXhpb3NUcmFuc2Zvcm1TdHJlYW0uanMiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5pbXBvcnQgc3RyZWFtIGZyb20gJ3N0cmVhbSc7XG5pbXBvcnQgdXRpbHMgZnJvbSAnLi4vdXRpbHMuanMnO1xuaW1wb3J0IHRocm90dGxlIGZyb20gJy4vdGhyb3R0bGUuanMnO1xuaW1wb3J0IHNwZWVkb21ldGVyIGZyb20gJy4vc3BlZWRvbWV0ZXIuanMnO1xuXG5jb25zdCBrSW50ZXJuYWxzID0gU3ltYm9sKCdpbnRlcm5hbHMnKTtcblxuY2xhc3MgQXhpb3NUcmFuc2Zvcm1TdHJlYW0gZXh0ZW5kcyBzdHJlYW0uVHJhbnNmb3Jte1xuICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7XG4gICAgb3B0aW9ucyA9IHV0aWxzLnRvRmxhdE9iamVjdChvcHRpb25zLCB7XG4gICAgICBtYXhSYXRlOiAwLFxuICAgICAgY2h1bmtTaXplOiA2NCAqIDEwMjQsXG4gICAgICBtaW5DaHVua1NpemU6IDEwMCxcbiAgICAgIHRpbWVXaW5kb3c6IDUwMCxcbiAgICAgIHRpY2tzUmF0ZTogMixcbiAgICAgIHNhbXBsZXNDb3VudDogMTVcbiAgICB9LCBudWxsLCAocHJvcCwgc291cmNlKSA9PiB7XG4gICAgICByZXR1cm4gIXV0aWxzLmlzVW5kZWZpbmVkKHNvdXJjZVtwcm9wXSk7XG4gICAgfSk7XG5cbiAgICBzdXBlcih7XG4gICAgICByZWFkYWJsZUhpZ2hXYXRlck1hcms6IG9wdGlvbnMuY2h1bmtTaXplXG4gICAgfSk7XG5cbiAgICBjb25zdCBzZWxmID0gdGhpcztcblxuICAgIGNvbnN0IGludGVybmFscyA9IHRoaXNba0ludGVybmFsc10gPSB7XG4gICAgICBsZW5ndGg6IG9wdGlvbnMubGVuZ3RoLFxuICAgICAgdGltZVdpbmRvdzogb3B0aW9ucy50aW1lV2luZG93LFxuICAgICAgdGlja3NSYXRlOiBvcHRpb25zLnRpY2tzUmF0ZSxcbiAgICAgIGNodW5rU2l6ZTogb3B0aW9ucy5jaHVua1NpemUsXG4gICAgICBtYXhSYXRlOiBvcHRpb25zLm1heFJhdGUsXG4gICAgICBtaW5DaHVua1NpemU6IG9wdGlvbnMubWluQ2h1bmtTaXplLFxuICAgICAgYnl0ZXNTZWVuOiAwLFxuICAgICAgaXNDYXB0dXJlZDogZmFsc2UsXG4gICAgICBub3RpZmllZEJ5dGVzTG9hZGVkOiAwLFxuICAgICAgdHM6IERhdGUubm93KCksXG4gICAgICBieXRlczogMCxcbiAgICAgIG9uUmVhZENhbGxiYWNrOiBudWxsXG4gICAgfTtcblxuICAgIGNvbnN0IF9zcGVlZG9tZXRlciA9IHNwZWVkb21ldGVyKGludGVybmFscy50aWNrc1JhdGUgKiBvcHRpb25zLnNhbXBsZXNDb3VudCwgaW50ZXJuYWxzLnRpbWVXaW5kb3cpO1xuXG4gICAgdGhpcy5vbignbmV3TGlzdGVuZXInLCBldmVudCA9PiB7XG4gICAgICBpZiAoZXZlbnQgPT09ICdwcm9ncmVzcycpIHtcbiAgICAgICAgaWYgKCFpbnRlcm5hbHMuaXNDYXB0dXJlZCkge1xuICAgICAgICAgIGludGVybmFscy5pc0NhcHR1cmVkID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgbGV0IGJ5dGVzTm90aWZpZWQgPSAwO1xuXG4gICAgaW50ZXJuYWxzLnVwZGF0ZVByb2dyZXNzID0gdGhyb3R0bGUoZnVuY3Rpb24gdGhyb3R0bGVkSGFuZGxlcigpIHtcbiAgICAgIGNvbnN0IHRvdGFsQnl0ZXMgPSBpbnRlcm5hbHMubGVuZ3RoO1xuICAgICAgY29uc3QgYnl0ZXNUcmFuc2ZlcnJlZCA9IGludGVybmFscy5ieXRlc1NlZW47XG4gICAgICBjb25zdCBwcm9ncmVzc0J5dGVzID0gYnl0ZXNUcmFuc2ZlcnJlZCAtIGJ5dGVzTm90aWZpZWQ7XG4gICAgICBpZiAoIXByb2dyZXNzQnl0ZXMgfHwgc2VsZi5kZXN0cm95ZWQpIHJldHVybjtcblxuICAgICAgY29uc3QgcmF0ZSA9IF9zcGVlZG9tZXRlcihwcm9ncmVzc0J5dGVzKTtcblxuICAgICAgYnl0ZXNOb3RpZmllZCA9IGJ5dGVzVHJhbnNmZXJyZWQ7XG5cbiAgICAgIHByb2Nlc3MubmV4dFRpY2soKCkgPT4ge1xuICAgICAgICBzZWxmLmVtaXQoJ3Byb2dyZXNzJywge1xuICAgICAgICAgICdsb2FkZWQnOiBieXRlc1RyYW5zZmVycmVkLFxuICAgICAgICAgICd0b3RhbCc6IHRvdGFsQnl0ZXMsXG4gICAgICAgICAgJ3Byb2dyZXNzJzogdG90YWxCeXRlcyA/IChieXRlc1RyYW5zZmVycmVkIC8gdG90YWxCeXRlcykgOiB1bmRlZmluZWQsXG4gICAgICAgICAgJ2J5dGVzJzogcHJvZ3Jlc3NCeXRlcyxcbiAgICAgICAgICAncmF0ZSc6IHJhdGUgPyByYXRlIDogdW5kZWZpbmVkLFxuICAgICAgICAgICdlc3RpbWF0ZWQnOiByYXRlICYmIHRvdGFsQnl0ZXMgJiYgYnl0ZXNUcmFuc2ZlcnJlZCA8PSB0b3RhbEJ5dGVzID9cbiAgICAgICAgICAgICh0b3RhbEJ5dGVzIC0gYnl0ZXNUcmFuc2ZlcnJlZCkgLyByYXRlIDogdW5kZWZpbmVkXG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSwgaW50ZXJuYWxzLnRpY2tzUmF0ZSk7XG5cbiAgICBjb25zdCBvbkZpbmlzaCA9ICgpID0+IHtcbiAgICAgIGludGVybmFscy51cGRhdGVQcm9ncmVzcyh0cnVlKTtcbiAgICB9O1xuXG4gICAgdGhpcy5vbmNlKCdlbmQnLCBvbkZpbmlzaCk7XG4gICAgdGhpcy5vbmNlKCdlcnJvcicsIG9uRmluaXNoKTtcbiAgfVxuXG4gIF9yZWFkKHNpemUpIHtcbiAgICBjb25zdCBpbnRlcm5hbHMgPSB0aGlzW2tJbnRlcm5hbHNdO1xuXG4gICAgaWYgKGludGVybmFscy5vblJlYWRDYWxsYmFjaykge1xuICAgICAgaW50ZXJuYWxzLm9uUmVhZENhbGxiYWNrKCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHN1cGVyLl9yZWFkKHNpemUpO1xuICB9XG5cbiAgX3RyYW5zZm9ybShjaHVuaywgZW5jb2RpbmcsIGNhbGxiYWNrKSB7XG4gICAgY29uc3Qgc2VsZiA9IHRoaXM7XG4gICAgY29uc3QgaW50ZXJuYWxzID0gdGhpc1trSW50ZXJuYWxzXTtcbiAgICBjb25zdCBtYXhSYXRlID0gaW50ZXJuYWxzLm1heFJhdGU7XG5cbiAgICBjb25zdCByZWFkYWJsZUhpZ2hXYXRlck1hcmsgPSB0aGlzLnJlYWRhYmxlSGlnaFdhdGVyTWFyaztcblxuICAgIGNvbnN0IHRpbWVXaW5kb3cgPSBpbnRlcm5hbHMudGltZVdpbmRvdztcblxuICAgIGNvbnN0IGRpdmlkZXIgPSAxMDAwIC8gdGltZVdpbmRvdztcbiAgICBjb25zdCBieXRlc1RocmVzaG9sZCA9IChtYXhSYXRlIC8gZGl2aWRlcik7XG4gICAgY29uc3QgbWluQ2h1bmtTaXplID0gaW50ZXJuYWxzLm1pbkNodW5rU2l6ZSAhPT0gZmFsc2UgPyBNYXRoLm1heChpbnRlcm5hbHMubWluQ2h1bmtTaXplLCBieXRlc1RocmVzaG9sZCAqIDAuMDEpIDogMDtcblxuICAgIGZ1bmN0aW9uIHB1c2hDaHVuayhfY2h1bmssIF9jYWxsYmFjaykge1xuICAgICAgY29uc3QgYnl0ZXMgPSBCdWZmZXIuYnl0ZUxlbmd0aChfY2h1bmspO1xuICAgICAgaW50ZXJuYWxzLmJ5dGVzU2VlbiArPSBieXRlcztcbiAgICAgIGludGVybmFscy5ieXRlcyArPSBieXRlcztcblxuICAgICAgaWYgKGludGVybmFscy5pc0NhcHR1cmVkKSB7XG4gICAgICAgIGludGVybmFscy51cGRhdGVQcm9ncmVzcygpO1xuICAgICAgfVxuXG4gICAgICBpZiAoc2VsZi5wdXNoKF9jaHVuaykpIHtcbiAgICAgICAgcHJvY2Vzcy5uZXh0VGljayhfY2FsbGJhY2spO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaW50ZXJuYWxzLm9uUmVhZENhbGxiYWNrID0gKCkgPT4ge1xuICAgICAgICAgIGludGVybmFscy5vblJlYWRDYWxsYmFjayA9IG51bGw7XG4gICAgICAgICAgcHJvY2Vzcy5uZXh0VGljayhfY2FsbGJhY2spO1xuICAgICAgICB9O1xuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IHRyYW5zZm9ybUNodW5rID0gKF9jaHVuaywgX2NhbGxiYWNrKSA9PiB7XG4gICAgICBjb25zdCBjaHVua1NpemUgPSBCdWZmZXIuYnl0ZUxlbmd0aChfY2h1bmspO1xuICAgICAgbGV0IGNodW5rUmVtYWluZGVyID0gbnVsbDtcbiAgICAgIGxldCBtYXhDaHVua1NpemUgPSByZWFkYWJsZUhpZ2hXYXRlck1hcms7XG4gICAgICBsZXQgYnl0ZXNMZWZ0O1xuICAgICAgbGV0IHBhc3NlZCA9IDA7XG5cbiAgICAgIGlmIChtYXhSYXRlKSB7XG4gICAgICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCk7XG5cbiAgICAgICAgaWYgKCFpbnRlcm5hbHMudHMgfHwgKHBhc3NlZCA9IChub3cgLSBpbnRlcm5hbHMudHMpKSA+PSB0aW1lV2luZG93KSB7XG4gICAgICAgICAgaW50ZXJuYWxzLnRzID0gbm93O1xuICAgICAgICAgIGJ5dGVzTGVmdCA9IGJ5dGVzVGhyZXNob2xkIC0gaW50ZXJuYWxzLmJ5dGVzO1xuICAgICAgICAgIGludGVybmFscy5ieXRlcyA9IGJ5dGVzTGVmdCA8IDAgPyAtYnl0ZXNMZWZ0IDogMDtcbiAgICAgICAgICBwYXNzZWQgPSAwO1xuICAgICAgICB9XG5cbiAgICAgICAgYnl0ZXNMZWZ0ID0gYnl0ZXNUaHJlc2hvbGQgLSBpbnRlcm5hbHMuYnl0ZXM7XG4gICAgICB9XG5cbiAgICAgIGlmIChtYXhSYXRlKSB7XG4gICAgICAgIGlmIChieXRlc0xlZnQgPD0gMCkge1xuICAgICAgICAgIC8vIG5leHQgdGltZSB3aW5kb3dcbiAgICAgICAgICByZXR1cm4gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICBfY2FsbGJhY2sobnVsbCwgX2NodW5rKTtcbiAgICAgICAgICB9LCB0aW1lV2luZG93IC0gcGFzc2VkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChieXRlc0xlZnQgPCBtYXhDaHVua1NpemUpIHtcbiAgICAgICAgICBtYXhDaHVua1NpemUgPSBieXRlc0xlZnQ7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKG1heENodW5rU2l6ZSAmJiBjaHVua1NpemUgPiBtYXhDaHVua1NpemUgJiYgKGNodW5rU2l6ZSAtIG1heENodW5rU2l6ZSkgPiBtaW5DaHVua1NpemUpIHtcbiAgICAgICAgY2h1bmtSZW1haW5kZXIgPSBfY2h1bmsuc3ViYXJyYXkobWF4Q2h1bmtTaXplKTtcbiAgICAgICAgX2NodW5rID0gX2NodW5rLnN1YmFycmF5KDAsIG1heENodW5rU2l6ZSk7XG4gICAgICB9XG5cbiAgICAgIHB1c2hDaHVuayhfY2h1bmssIGNodW5rUmVtYWluZGVyID8gKCkgPT4ge1xuICAgICAgICBwcm9jZXNzLm5leHRUaWNrKF9jYWxsYmFjaywgbnVsbCwgY2h1bmtSZW1haW5kZXIpO1xuICAgICAgfSA6IF9jYWxsYmFjayk7XG4gICAgfTtcblxuICAgIHRyYW5zZm9ybUNodW5rKGNodW5rLCBmdW5jdGlvbiB0cmFuc2Zvcm1OZXh0Q2h1bmsoZXJyLCBfY2h1bmspIHtcbiAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgcmV0dXJuIGNhbGxiYWNrKGVycik7XG4gICAgICB9XG5cbiAgICAgIGlmIChfY2h1bmspIHtcbiAgICAgICAgdHJhbnNmb3JtQ2h1bmsoX2NodW5rLCB0cmFuc2Zvcm1OZXh0Q2h1bmspO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY2FsbGJhY2sobnVsbCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBzZXRMZW5ndGgobGVuZ3RoKSB7XG4gICAgdGhpc1trSW50ZXJuYWxzXS5sZW5ndGggPSArbGVuZ3RoO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IEF4aW9zVHJhbnNmb3JtU3RyZWFtO1xuIl0sIm1hcHBpbmdzIjoiQUFBQSxZQUFZOztBQUFDQSxNQUFBLENBQUFDLGNBQUEsQ0FBQUMsT0FBQTtFQUFBQyxLQUFBO0FBQUE7QUFBQUQsT0FBQSxDQUFBRSxPQUFBO0FBRWIsSUFBQUMsT0FBQSxHQUFBQyxzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUMsTUFBQSxHQUFBRixzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUUsU0FBQSxHQUFBSCxzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUcsYUFBQSxHQUFBSixzQkFBQSxDQUFBQyxPQUFBO0FBQTJDLFNBQUFELHVCQUFBSyxHQUFBLFdBQUFBLEdBQUEsSUFBQUEsR0FBQSxDQUFBQyxVQUFBLEdBQUFELEdBQUEsS0FBQVAsT0FBQSxFQUFBTyxHQUFBO0FBRTNDLE1BQU1FLFVBQVUsR0FBR0MsTUFBTSxDQUFDLFdBQVcsQ0FBQztBQUV0QyxNQUFNQyxvQkFBb0IsU0FBU0MsZUFBTSxDQUFDQyxTQUFTO0VBQ2pEQyxXQUFXQSxDQUFDQyxPQUFPLEVBQUU7SUFDbkJBLE9BQU8sR0FBR0MsY0FBSyxDQUFDQyxZQUFZLENBQUNGLE9BQU8sRUFBRTtNQUNwQ0csT0FBTyxFQUFFLENBQUM7TUFDVkMsU0FBUyxFQUFFLEVBQUUsR0FBRyxJQUFJO01BQ3BCQyxZQUFZLEVBQUUsR0FBRztNQUNqQkMsVUFBVSxFQUFFLEdBQUc7TUFDZkMsU0FBUyxFQUFFLENBQUM7TUFDWkMsWUFBWSxFQUFFO0lBQ2hCLENBQUMsRUFBRSxJQUFJLEVBQUUsQ0FBQ0MsSUFBSSxFQUFFQyxNQUFNLEtBQUs7TUFDekIsT0FBTyxDQUFDVCxjQUFLLENBQUNVLFdBQVcsQ0FBQ0QsTUFBTSxDQUFDRCxJQUFJLENBQUMsQ0FBQztJQUN6QyxDQUFDLENBQUM7SUFFRixLQUFLLENBQUM7TUFD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