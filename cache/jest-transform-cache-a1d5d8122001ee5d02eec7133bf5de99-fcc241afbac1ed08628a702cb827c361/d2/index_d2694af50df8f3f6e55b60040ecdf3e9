a2251f91cb8cc8c0d96e4d9cabcf71f7
"use strict";

module.exports = realpath;
realpath.realpath = realpath;
realpath.sync = realpathSync;
realpath.realpathSync = realpathSync;
realpath.monkeypatch = monkeypatch;
realpath.unmonkeypatch = unmonkeypatch;
var fs = require('fs');
var origRealpath = fs.realpath;
var origRealpathSync = fs.realpathSync;
var version = process.version;
var ok = /^v[0-5]\./.test(version);
var old = require('./old.js');
function newError(er) {
  return er && er.syscall === 'realpath' && (er.code === 'ELOOP' || er.code === 'ENOMEM' || er.code === 'ENAMETOOLONG');
}
function realpath(p, cache, cb) {
  if (ok) {
    return origRealpath(p, cache, cb);
  }
  if (typeof cache === 'function') {
    cb = cache;
    cache = null;
  }
  origRealpath(p, cache, function (er, result) {
    if (newError(er)) {
      old.realpath(p, cache, cb);
    } else {
      cb(er, result);
    }
  });
}
function realpathSync(p, cache) {
  if (ok) {
    return origRealpathSync(p, cache);
  }
  try {
    return origRealpathSync(p, cache);
  } catch (er) {
    if (newError(er)) {
      return old.realpathSync(p, cache);
    } else {
      throw er;
    }
  }
}
function monkeypatch() {
  fs.realpath = realpath;
  fs.realpathSync = realpathSync;
}
function unmonkeypatch() {
  fs.realpath = origRealpath;
  fs.realpathSync = origRealpathSync;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJtb2R1bGUiLCJleHBvcnRzIiwicmVhbHBhdGgiLCJzeW5jIiwicmVhbHBhdGhTeW5jIiwibW9ua2V5cGF0Y2giLCJ1bm1vbmtleXBhdGNoIiwiZnMiLCJyZXF1aXJlIiwib3JpZ1JlYWxwYXRoIiwib3JpZ1JlYWxwYXRoU3luYyIsInZlcnNpb24iLCJwcm9jZXNzIiwib2siLCJ0ZXN0Iiwib2xkIiwibmV3RXJyb3IiLCJlciIsInN5c2NhbGwiLCJjb2RlIiwicCIsImNhY2hlIiwiY2IiLCJyZXN1bHQiXSwic291cmNlcyI6WyJpbmRleC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJtb2R1bGUuZXhwb3J0cyA9IHJlYWxwYXRoXG5yZWFscGF0aC5yZWFscGF0aCA9IHJlYWxwYXRoXG5yZWFscGF0aC5zeW5jID0gcmVhbHBhdGhTeW5jXG5yZWFscGF0aC5yZWFscGF0aFN5bmMgPSByZWFscGF0aFN5bmNcbnJlYWxwYXRoLm1vbmtleXBhdGNoID0gbW9ua2V5cGF0Y2hcbnJlYWxwYXRoLnVubW9ua2V5cGF0Y2ggPSB1bm1vbmtleXBhdGNoXG5cbnZhciBmcyA9IHJlcXVpcmUoJ2ZzJylcbnZhciBvcmlnUmVhbHBhdGggPSBmcy5yZWFscGF0aFxudmFyIG9yaWdSZWFscGF0aFN5bmMgPSBmcy5yZWFscGF0aFN5bmNcblxudmFyIHZlcnNpb24gPSBwcm9jZXNzLnZlcnNpb25cbnZhciBvayA9IC9edlswLTVdXFwuLy50ZXN0KHZlcnNpb24pXG52YXIgb2xkID0gcmVxdWlyZSgnLi9vbGQuanMnKVxuXG5mdW5jdGlvbiBuZXdFcnJvciAoZXIpIHtcbiAgcmV0dXJuIGVyICYmIGVyLnN5c2NhbGwgPT09ICdyZWFscGF0aCcgJiYgKFxuICAgIGVyLmNvZGUgPT09ICdFTE9PUCcgfHxcbiAgICBlci5jb2RlID09PSAnRU5PTUVNJyB8fFxuICAgIGVyLmNvZGUgPT09ICdFTkFNRVRPT0xPTkcnXG4gIClcbn1cblxuZnVuY3Rpb24gcmVhbHBhdGggKHAsIGNhY2hlLCBjYikge1xuICBpZiAob2spIHtcbiAgICByZXR1cm4gb3JpZ1JlYWxwYXRoKHAsIGNhY2hlLCBjYilcbiAgfVxuXG4gIGlmICh0eXBlb2YgY2FjaGUgPT09ICdmdW5jdGlvbicpIHtcbiAgICBjYiA9IGNhY2hlXG4gICAgY2FjaGUgPSBudWxsXG4gIH1cbiAgb3JpZ1JlYWxwYXRoKHAsIGNhY2hlLCBmdW5jdGlvbiAoZXIsIHJlc3VsdCkge1xuICAgIGlmIChuZXdFcnJvcihlcikpIHtcbiAgICAgIG9sZC5yZWFscGF0aChwLCBjYWNoZSwgY2IpXG4gICAgfSBlbHNlIHtcbiAgICAgIGNiKGVyLCByZXN1bHQpXG4gICAgfVxuICB9KVxufVxuXG5mdW5jdGlvbiByZWFscGF0aFN5bmMgKHAsIGNhY2hlKSB7XG4gIGlmIChvaykge1xuICAgIHJldHVybiBvcmlnUmVhbHBhdGhTeW5jKHAsIGNhY2hlKVxuICB9XG5cbiAgdHJ5IHtcbiAgICByZXR1cm4gb3JpZ1JlYWxwYXRoU3luYyhwLCBjYWNoZSlcbiAgfSBjYXRjaCAoZXIpIHtcbiAgICBpZiAobmV3RXJyb3IoZXIpKSB7XG4gICAgICByZXR1cm4gb2xkLnJlYWxwYXRoU3luYyhwLCBjYWNoZSlcbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgZXJcbiAgICB9XG4gIH1cbn1cblxuZnVuY3Rpb24gbW9ua2V5cGF0Y2ggKCkge1xuICBmcy5yZWFscGF0aCA9IHJlYWxwYXRoXG4gIGZzLnJlYWxwYXRoU3luYyA9IHJlYWxwYXRoU3luY1xufVxuXG5mdW5jdGlvbiB1bm1vbmtleXBhdGNoICgpIHtcbiAgZnMucmVhbHBhdGggPSBvcmlnUmVhbHBhdGhcbiAgZnMucmVhbHBhdGhTeW5jID0gb3JpZ1JlYWxwYXRoU3luY1xufVxuIl0sIm1hcHBpbmdzIjoiOztBQUFBQSxNQUFNLENBQUNDLE9BQU8sR0FBR0MsUUFBUTtBQUN6QkEsUUFBUSxDQUFDQSxRQUFRLEdBQUdBLFFBQVE7QUFDNUJBLFFBQVEsQ0FBQ0MsSUFBSSxHQUFHQyxZQUFZO0FBQzVCRixRQUFRLENB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