3472bb69eba1595adfbcc7af19962fbe
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = useCurrentColorScheme;
exports.getColorScheme = getColorScheme;
exports.getSystemMode = getSystemMode;
var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));
var React = _interopRequireWildcard(require("react"));
var _getInitColorSchemeScript = require("./getInitColorSchemeScript");
function _getRequireWildcardCache(nodeInterop) {
  if (typeof WeakMap !== "function") return null;
  var cacheBabelInterop = new WeakMap();
  var cacheNodeInterop = new WeakMap();
  return (_getRequireWildcardCache = function (nodeInterop) {
    return nodeInterop ? cacheNodeInterop : cacheBabelInterop;
  })(nodeInterop);
}
function _interopRequireWildcard(obj, nodeInterop) {
  if (!nodeInterop && obj && obj.__esModule) {
    return obj;
  }
  if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
    return {
      default: obj
    };
  }
  var cache = _getRequireWildcardCache(nodeInterop);
  if (cache && cache.has(obj)) {
    return cache.get(obj);
  }
  var newObj = {};
  var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;
  for (var key in obj) {
    if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) {
      var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;
      if (desc && (desc.get || desc.set)) {
        Object.defineProperty(newObj, key, desc);
      } else {
        newObj[key] = obj[key];
      }
    }
  }
  newObj.default = obj;
  if (cache) {
    cache.set(obj, newObj);
  }
  return newObj;
}
function getSystemMode(mode) {
  if (typeof window !== 'undefined' && mode === 'system') {
    const mql = window.matchMedia('(prefers-color-scheme: dark)');
    if (mql.matches) {
      return 'dark';
    }
    return 'light';
  }
  return undefined;
}
function processState(state, callback) {
  if (state.mode === 'light' || state.mode === 'system' && state.systemMode === 'light') {
    return callback('light');
  }
  if (state.mode === 'dark' || state.mode === 'system' && state.systemMode === 'dark') {
    return callback('dark');
  }
  return undefined;
}
function getColorScheme(state) {
  return processState(state, mode => {
    if (mode === 'light') {
      return state.lightColorScheme;
    }
    if (mode === 'dark') {
      return state.darkColorScheme;
    }
    return undefined;
  });
}
function initializeValue(key, defaultValue) {
  if (typeof window === 'undefined') {
    return undefined;
  }
  let value;
  try {
    value = localStorage.getItem(key) || undefined;
    if (!value) {
      // the first time that user enters the site.
      localStorage.setItem(key, defaultValue);
    }
  } catch (e) {
    // Unsupported
  }
  return value || defaultValue;
}
function useCurrentColorScheme(options) {
  const {
    defaultMode = 'light',
    defaultLightColorScheme,
    defaultDarkColorScheme,
    supportedColorSchemes = [],
    modeStorageKey = _getInitColorSchemeScript.DEFAULT_MODE_STORAGE_KEY,
    colorSchemeStorageKey = _getInitColorSchemeScript.DEFAULT_COLOR_SCHEME_STORAGE_KEY,
    storageWindow = typeof window === 'undefined' ? undefined : window
  } = options;
  const joinedColorSchemes = supportedColorSchemes.join(',');
  const [state, setState] = React.useState(() => {
    const initialMode = initializeValue(modeStorageKey, defaultMode);
    const lightColorScheme = initializeValue(`${colorSchemeStorageKey}-light`, defaultLightColorScheme);
    const darkColorScheme = initializeValue(`${colorSchemeStorageKey}-dark`, defaultDarkColorScheme);
    return {
      mode: initialMode,
      systemMode: getSystemMode(initialMode),
      lightColorScheme,
      darkColorScheme
    };
  });
  const colorScheme = getColorScheme(state);
  const setMode = React.useCallback(mode => {
    setState(currentState => {
      if (mode === currentState.mode) {
        // do nothing if mode does not change
        return currentState;
      }
      const newMode = !mode ? defaultMode : mode;
      try {
        localStorage.setItem(modeStorageKey, newMode);
      } catch (e) {
        // Unsupported
      }
      return (0, _extends2.default)({}, currentState, {
        mode: newMode,
        systemMode: getSystemMode(newMode)
      });
    });
  }, [modeStorageKey, defaultMode]);
  const setColorScheme = React.useCallback(value => {
    if (!value) {
      setState(currentState => {
        try {
          localStorage.setItem(`${colorSchemeStorageKey}-light`, defaultLightColorScheme);
          localStorage.setItem(`${colorSchemeStorageKey}-dark`, defaultDarkColorScheme);
        } catch (e) {
          // Unsupported
        }
        return (0, _extends2.default)({}, currentState, {
          lightColorScheme: defaultLightColorScheme,
          darkColorScheme: defaultDarkColorScheme
        });
      });
    } else if (typeof value === 'string') {
      if (value && !joinedColorSchemes.includes(value)) {
        console.error(`\`${value}\` does not exist in \`theme.colorSchemes\`.`);
      } else {
        setState(currentState => {
          const newState = (0, _extends2.default)({}, currentState);
          processState(currentState, mode => {
            try {
              localStorage.setItem(`${colorSchemeStorageKey}-${mode}`, value);
            } catch (e) {
              // Unsupported
            }
            if (mode === 'light') {
              newState.lightColorScheme = value;
            }
            if (mode === 'dark') {
              newState.darkColorScheme = value;
            }
          });
          return newState;
        });
      }
    } else {
      setState(currentState => {
        const newState = (0, _extends2.default)({}, currentState);
        const newLightColorScheme = value.light === null ? defaultLightColorScheme : value.light;
        const newDarkColorScheme = value.dark === null ? defaultDarkColorScheme : value.dark;
        if (newLightColorScheme) {
          if (!joinedColorSchemes.includes(newLightColorScheme)) {
            console.error(`\`${newLightColorScheme}\` does not exist in \`theme.colorSchemes\`.`);
          } else {
            newState.lightColorScheme = newLightColorScheme;
            try {
              localStorage.setItem(`${colorSchemeStorageKey}-light`, newLightColorScheme);
            } catch (error) {
              // Unsupported
            }
          }
        }
        if (newDarkColorScheme) {
          if (!joinedColorSchemes.includes(newDarkColorScheme)) {
            console.error(`\`${newDarkColorScheme}\` does not exist in \`theme.colorSchemes\`.`);
          } else {
            newState.darkColorScheme = newDarkColorScheme;
            try {
              localStorage.setItem(`${colorSchemeStorageKey}-dark`, newDarkColorScheme);
            } catch (error) {
              // Unsupported
            }
          }
        }
        return newState;
      });
    }
  }, [joinedColorSchemes, colorSchemeStorageKey, defaultLightColorScheme, defaultDarkColorScheme]);
  const handleMediaQuery = React.useCallback(e => {
    if (state.mode === 'system') {
      setState(currentState => (0, _extends2.default)({}, currentState, {
        systemMode: e != null && e.matches ? 'dark' : 'light'
      }));
    }
  }, [state.mode]);

  // Ref hack to avoid adding handleMediaQuery as a dep
  const mediaListener = React.useRef(handleMediaQuery);
  mediaListener.current = handleMediaQuery;
  React.useEffect(() => {
    const handler = (...args) => mediaListener.current(...args);

    // Always listen to System preference
    const media = window.matchMedia('(prefers-color-scheme: dark)');

    // Intentionally use deprecated listener methods to support iOS & old browsers
    media.addListener(handler);
    handler(media);
    return () => media.removeListener(handler);
  }, []);

  // Handle when localStorage has changed
  React.useEffect(() => {
    const handleStorage = event => {
      const value = event.newValue;
      if (typeof event.key === 'string' && event.key.startsWith(colorSchemeStorageKey) && (!value || joinedColorSchemes.match(value))) {
        // If the key is deleted, value will be null then reset color scheme to the default one.
        if (event.key.endsWith('light')) {
          setColorScheme({
            light: value
          });
        }
        if (event.key.endsWith('dark')) {
          setColorScheme({
            dark: value
          });
        }
      }
      if (event.key === modeStorageKey && (!value || ['light', 'dark', 'system'].includes(value))) {
        setMode(value || defaultMode);
      }
    };
    if (storageWindow) {
      // For syncing color-scheme changes between iframes
      storageWindow.addEventListener('storage', handleStorage);
      return () => storageWindow.removeEventListener('storage', handleStorage);
    }
    return undefined;
  }, [setColorScheme, setMode, modeStorageKey, colorSchemeStorageKey, joinedColorSchemes, defaultMode, storageWindow]);
  return (0, _extends2.default)({}, state, {
    colorScheme,
    setMode,
    setColorScheme
  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsInZhbHVlIiwiZGVmYXVsdCIsInVzZUN1cnJlbnRDb2xvclNjaGVtZSIsImdldENvbG9yU2NoZW1lIiwiZ2V0U3lzdGVtTW9kZSIsIl9leHRlbmRzMiIsIlJlYWN0IiwiX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQiLCJfZ2V0SW5pdENvbG9yU2NoZW1lU2NyaXB0IiwiX2dldFJlcXVpcmVXaWxkY2FyZENhY2hlIiwibm9kZUludGVyb3AiLCJXZWFrTWFwIiwiY2FjaGVCYWJlbEludGVyb3AiLCJjYWNoZU5vZGVJbnRlcm9wIiwib2JqIiwiX19lc01vZHVsZSIsImNhY2hlIiwiaGFzIiwiZ2V0IiwibmV3T2JqIiwiaGFzUHJvcGVydHlEZXNjcmlwdG9yIiwiZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yIiwia2V5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJjYWxsIiwiZGVzYyIsInNldCIsIm1vZGUiLCJ3aW5kb3ciLCJtcWwiLCJtYXRjaE1lZGlhIiwibWF0Y2hlcyIsInVuZGVmaW5lZCIsInByb2Nlc3NTdGF0ZSIsInN0YXRlIiwiY2FsbGJhY2siLCJzeXN0ZW1Nb2RlIiwibGlnaHRDb2xvclNjaGVtZSIsImRhcmtDb2xvclNjaGVtZSIsImluaXRpYWxpemVWYWx1ZSIsImRlZmF1bHRWYWx1ZSIsImxvY2FsU3RvcmFnZSIsImdldEl0ZW0iLCJzZXRJdGVtIiwiZSIsIm9wdGlvbnMiLCJkZWZhdWx0TW9kZSIsImRlZmF1bHRMaWdodENvbG9yU2NoZW1lIiwiZGVmYXVsdERhcmtDb2xvclNjaGVtZSIsInN1cHBvcnRlZENvbG9yU2NoZW1lcyIsIm1vZGVTdG9yYWdlS2V5IiwiREVGQVVMVF9NT0RFX1NUT1JBR0VfS0VZIiwiY29sb3JTY2hlbWVTdG9yYWdlS2V5IiwiREVGQVVMVF9DT0xPUl9TQ0hFTUVfU1RPUkFHRV9LRVkiLCJzdG9yYWdlV2luZG93Iiwiam9pbmVkQ29sb3JTY2hlbWVzIiwiam9pbiIsInNldFN0YXRlIiwidXNlU3RhdGUiLCJpbml0aWFsTW9kZSIsImNvbG9yU2NoZW1lIiwic2V0TW9kZSIsInVzZUNhbGxiYWNrIiwiY3VycmVudFN0YXRlIiwibmV3TW9kZSIsInNldENvbG9yU2NoZW1lIiwiaW5jbHVkZXMiLCJjb25zb2xlIiwiZXJyb3IiLCJuZXdTdGF0ZSIsIm5ld0xpZ2h0Q29sb3JTY2hlbWUiLCJsaWdodCIsIm5ld0RhcmtDb2xvclNjaGVtZSIsImRhcmsiLCJoYW5kbGVNZWRpYVF1ZXJ5IiwibWVkaWFMaXN0ZW5lciIsInVzZVJlZiIsImN1cnJlbnQiLCJ1c2VFZmZlY3QiLCJoYW5kbGVyIiwiYXJncyIsIm1lZGlhIiwiYWRkTGlzdGVuZXIiLCJyZW1vdmVMaXN0ZW5lciIsImhhbmRsZVN0b3JhZ2UiLCJldmVudCIsIm5ld1ZhbHVlIiwic3RhcnRzV2l0aCIsIm1hdGNoIiwiZW5kc1dpdGgiLCJhZGRFdmVudExpc3RlbmVyIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciJdLCJzb3VyY2VzIjpbInVzZUN1cnJlbnRDb2xvclNjaGVtZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxudmFyIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQgPSByZXF1aXJlKFwiQGJhYmVsL3J1bnRpbWUvaGVscGVycy9pbnRlcm9wUmVxdWlyZURlZmF1bHRcIik7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHtcbiAgdmFsdWU6IHRydWVcbn0pO1xuZXhwb3J0cy5kZWZhdWx0ID0gdXNlQ3VycmVudENvbG9yU2NoZW1lO1xuZXhwb3J0cy5nZXRDb2xvclNjaGVtZSA9IGdldENvbG9yU2NoZW1lO1xuZXhwb3J0cy5nZXRTeXN0ZW1Nb2RlID0gZ2V0U3lzdGVtTW9kZTtcbnZhciBfZXh0ZW5kczIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoXCJAYmFiZWwvcnVudGltZS9oZWxwZXJzL2V4dGVuZHNcIikpO1xudmFyIFJlYWN0ID0gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQocmVxdWlyZShcInJlYWN0XCIpKTtcbnZhciBfZ2V0SW5pdENvbG9yU2NoZW1lU2NyaXB0ID0gcmVxdWlyZShcIi4vZ2V0SW5pdENvbG9yU2NoZW1lU2NyaXB0XCIpO1xuZnVuY3Rpb24gX2dldFJlcXVpcmVXaWxkY2FyZENhY2hlKG5vZGVJbnRlcm9wKSB7IGlmICh0eXBlb2YgV2Vha01hcCAhPT0gXCJmdW5jdGlvblwiKSByZXR1cm4gbnVsbDsgdmFyIGNhY2hlQmFiZWxJbnRlcm9wID0gbmV3IFdlYWtNYXAoKTsgdmFyIGNhY2hlTm9kZUludGVyb3AgPSBuZXcgV2Vha01hcCgpOyByZXR1cm4gKF9nZXRSZXF1aXJlV2lsZGNhcmRDYWNoZSA9IGZ1bmN0aW9uIChub2RlSW50ZXJvcCkgeyByZXR1cm4gbm9kZUludGVyb3AgPyBjYWNoZU5vZGVJbnRlcm9wIDogY2FjaGVCYWJlbEludGVyb3A7IH0pKG5vZGVJbnRlcm9wKTsgfVxuZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQob2JqLCBub2RlSW50ZXJvcCkgeyBpZiAoIW5vZGVJbnRlcm9wICYmIG9iaiAmJiBvYmouX19lc01vZHVsZSkgeyByZXR1cm4gb2JqOyB9IGlmIChvYmogPT09IG51bGwgfHwgdHlwZW9mIG9iaiAhPT0gXCJvYmplY3RcIiAmJiB0eXBlb2Ygb2JqICE9PSBcImZ1bmN0aW9uXCIpIHsgcmV0dXJuIHsgZGVmYXVsdDogb2JqIH07IH0gdmFyIGNhY2hlID0gX2dldFJlcXVpcmVXaWxkY2FyZENhY2hlKG5vZGVJbnRlcm9wKTsgaWYgKGNhY2hlICYmIGNhY2hlLmhhcyhvYmopKSB7IHJldHVybiBjYWNoZS5nZXQob2JqKTsgfSB2YXIgbmV3T2JqID0ge307IHZhciBoYXNQcm9wZXJ0eURlc2NyaXB0b3IgPSBPYmplY3QuZGVmaW5lUHJvcGVydHkgJiYgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcjsgZm9yICh2YXIga2V5IGluIG9iaikgeyBpZiAoa2V5ICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBrZXkpKSB7IHZhciBkZXNjID0gaGFzUHJvcGVydHlEZXNjcmlwdG9yID8gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmosIGtleSkgOiBudWxsOyBpZiAoZGVzYyAmJiAoZGVzYy5nZXQgfHwgZGVzYy5zZXQpKSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShuZXdPYmosIGtleSwgZGVzYyk7IH0gZWxzZSB7IG5ld09ialtrZXldID0gb2JqW2tleV07IH0gfSB9IG5ld09iai5kZWZhdWx0ID0gb2JqOyBpZiAoY2FjaGUpIHsgY2FjaGUuc2V0KG9iaiwgbmV3T2JqKTsgfSByZXR1cm4gbmV3T2JqOyB9XG5mdW5jdGlvbiBnZXRTeXN0ZW1Nb2RlKG1vZGUpIHtcbiAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnICYmIG1vZGUgPT09ICdzeXN0ZW0nKSB7XG4gICAgY29uc3QgbXFsID0gd2luZG93Lm1hdGNoTWVkaWEoJyhwcmVmZXJzLWNvbG9yLXNjaGVtZTogZGFyayknKTtcbiAgICBpZiAobXFsLm1hdGNoZXMpIHtcbiAgICAgIHJldHVybiAnZGFyayc7XG4gICAgfVxuICAgIHJldHVybiAnbGlnaHQnO1xuICB9XG4gIHJldHVybiB1bmRlZmluZWQ7XG59XG5mdW5jdGlvbiBwcm9jZXNzU3RhdGUoc3RhdGUsIGNhbGxiYWNrKSB7XG4gIGlmIChzdGF0ZS5tb2RlID09PSAnbGlnaHQnIHx8IHN0YXRlLm1vZGUgPT09ICdzeXN0ZW0nICYmIHN0YXRlLnN5c3RlbU1vZGUgPT09ICdsaWdodCcpIHtcbiAgICByZXR1cm4gY2FsbGJhY2soJ2xpZ2h0Jyk7XG4gIH1cbiAgaWYgKHN0YXRlLm1vZGUgPT09ICdkYXJrJyB8fCBzdGF0ZS5tb2RlID09PSAnc3lzdGVtJyAmJiBzdGF0ZS5zeXN0ZW1Nb2RlID09PSAnZGFyaycpIHtcbiAgICByZXR1cm4gY2FsbGJhY2soJ2RhcmsnKTtcbiAgfVxuICByZXR1cm4gdW5kZWZpbmVkO1xufVxuZnVuY3Rpb24gZ2V0Q29sb3JTY2hlbWUoc3RhdGUpIHtcbiAgcmV0dXJuIHByb2Nlc3NTdGF0ZShzdGF0ZSwgbW9kZSA9PiB7XG4gICAgaWYgKG1vZGUgPT09ICdsaWdodCcpIHtcbiAgICAgIHJldHVybiBzdGF0ZS5saWdodENvbG9yU2NoZW1lO1xuICAgIH1cbiAgICBpZiAobW9kZSA9PT0gJ2RhcmsnKSB7XG4gICAgICByZXR1cm4gc3RhdGUuZGFya0NvbG9yU2NoZW1lO1xuICAgIH1cbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9KTtcbn1cbmZ1bmN0aW9uIGluaXRpYWxpemVWYWx1ZShrZXksIGRlZmF1bHRWYWx1ZSkge1xuICBpZiAodHlwZW9mIHdpbmRvdyA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9XG4gIGxldCB2YWx1ZTtcbiAgdHJ5IHtcbiAgICB2YWx1ZSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKGtleSkgfHwgdW5kZWZpbmVkO1xuICAgIGlmICghdmFsdWUpIHtcbiAgICAgIC8vIHRoZSBmaXJzdCB0aW1lIHRoYXQgdXNlciBlbnRlcnMgdGhlIHNpdGUuXG4gICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShrZXksIGRlZmF1bHRWYWx1ZSk7XG4gICAgfVxuICB9IGNhdGNoIChlKSB7XG4gICAgLy8gVW5zdXBwb3J0ZWRcbiAgfVxuICByZXR1cm4gdmFsdWUgfHwgZGVmYXVsdFZhbHVlO1xufVxuZnVuY3Rpb24gdXNlQ3VycmVudENvbG9yU2NoZW1lKG9wdGlvbnMpIHtcbiAgY29uc3Qge1xuICAgIGRlZmF1bHRNb2RlID0gJ2xpZ2h0JyxcbiAgICBkZWZhdWx0TGlnaHRDb2xvclNjaGVtZSxcbiAgICBkZWZhdWx0RGFya0NvbG9yU2NoZW1lLFxuICAgIHN1cHBvcnRlZENvbG9yU2NoZW1lcyA9IFtdLFxuICAgIG1vZGVTdG9yYWdlS2V5ID0gX2dldEluaXRDb2xvclNjaGVtZVNjcmlwdC5ERUZBVUxUX01PREVfU1RPUkFHRV9LRVksXG4gICAgY29sb3JTY2hlbWVTdG9yYWdlS2V5ID0gX2dldEluaXRDb2xvclNjaGVtZVNjcmlwdC5ERUZBVUxUX0NPTE9SX1NDSEVNRV9TVE9SQUdFX0tFWSxcbiAgICBzdG9yYWdlV2luZG93ID0gdHlwZW9mIHdpbmRvdyA9PT0gJ3VuZGVmaW5lZCcgPyB1bmRlZmluZWQgOiB3aW5kb3dcbiAgfSA9IG9wdGlvbnM7XG4gIGNvbnN0IGpvaW5lZENvbG9yU2NoZW1lcyA9IHN1cHBvcnRlZENvbG9yU2NoZW1lcy5qb2luKCcsJyk7XG4gIGNvbnN0IFtzdGF0ZSwgc2V0U3RhdGVdID0gUmVhY3QudXNlU3RhdGUoKCkgPT4ge1xuICAgIGNvbnN0IGluaXRpYWxNb2RlID0gaW5pdGlhbGl6ZVZhbHVlKG1vZGVTdG9yYWdlS2V5LCBkZWZhdWx0TW9kZSk7XG4gICAgY29uc3QgbGlnaHRDb2xvclNjaGVtZSA9IGluaXRpYWxpemVWYWx1ZShgJHtjb2xvclNjaGVtZVN0b3JhZ2VLZXl9LWxpZ2h0YCwgZGVmYXVsdExpZ2h0Q29sb3JTY2hlbWUpO1xuICAgIGNvbnN0IGRhcmtDb2xvclNjaGVtZSA9IGluaXRpYWxpemVWYWx1ZShgJHtjb2xvclNjaGVtZVN0b3JhZ2VLZXl9LWRhcmtgLCBkZWZhdWx0RGFya0NvbG9yU2NoZW1lKTtcbiAgICByZXR1cm4ge1xuICAgICAgbW9kZTogaW5pdGlhbE1vZGUsXG4gICAgICBzeXN0ZW1Nb2RlOiBnZXRTeXN0ZW1Nb2RlKGluaXRpYWxNb2RlKSxcbiAgICAgIGxpZ2h0Q29sb3JTY2hlbWUsXG4gICAgICBkYXJrQ29sb3JTY2hlbWVcbiAgICB9O1xuICB9KTtcbiAgY29uc3QgY29sb3JTY2hlbWUgPSBnZXRDb2xvclNjaGVtZShzdGF0ZSk7XG4gIGNvbnN0IHNldE1vZGUgPSBSZWFjdC51c2VDYWxsYmFjayhtb2RlID0+IHtcbiAgICBzZXRTdGF0ZShjdXJyZW50U3RhdGUgPT4ge1xuICAgICAgaWYgKG1vZGUgPT09IGN1cnJlbnRTdGF0ZS5tb2RlKSB7XG4gICAgICAgIC8vIGRvIG5vdGhpbmcgaWYgbW9kZSBkb2VzIG5vdCBjaGFuZ2VcbiAgICAgICAgcmV0dXJuIGN1cnJlbnRTdGF0ZTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IG5ld01vZGUgPSAhbW9kZSA/IGRlZmF1bHRNb2RlIDogbW9kZTtcbiAgICAgIHRyeSB7XG4gICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKG1vZGVTdG9yYWdlS2V5LCBuZXdNb2RlKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgLy8gVW5zdXBwb3J0ZWRcbiAgICAgIH1cbiAgICAgIHJldHVybiAoMCwgX2V4dGVuZHMyLmRlZmF1bHQpKHt9LCBjdXJyZW50U3RhdGUsIHtcbiAgICAgICAgbW9kZTogbmV3TW9kZSxcbiAgICAgICAgc3lzdGVtTW9kZTogZ2V0U3lzdGVtTW9kZShuZXdNb2RlKVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH0sIFttb2RlU3RvcmFnZUtleSwgZGVmYXVsdE1vZGVdKTtcbiAgY29uc3Qgc2V0Q29sb3JTY2hlbWUgPSBSZWFjdC51c2VDYWxsYmFjayh2YWx1ZSA9PiB7XG4gICAgaWYgKCF2YWx1ZSkge1xuICAgICAgc2V0U3RhdGUoY3VycmVudFN0YXRlID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShgJHtjb2xvclNjaGVtZVN0b3JhZ2VLZXl9LWxpZ2h0YCwgZGVmYXVsdExpZ2h0Q29sb3JTY2hlbWUpO1xuICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGAke2NvbG9yU2NoZW1lU3RvcmFnZUtleX0tZGFya2AsIGRlZmF1bHREYXJrQ29sb3JTY2hlbWUpO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgLy8gVW5zdXBwb3J0ZWRcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gKDAsIF9leHRlbmRzMi5kZWZhdWx0KSh7fSwgY3VycmVudFN0YXRlLCB7XG4gICAgICAgICAgbGlnaHRDb2xvclNjaGVtZTogZGVmYXVsdExpZ2h0Q29sb3JTY2hlbWUsXG4gICAgICAgICAgZGFya0NvbG9yU2NoZW1lOiBkZWZhdWx0RGFya0NvbG9yU2NoZW1lXG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICBpZiAodmFsdWUgJiYgIWpvaW5lZENvbG9yU2NoZW1lcy5pbmNsdWRlcyh2YWx1ZSkpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihgXFxgJHt2YWx1ZX1cXGAgZG9lcyBub3QgZXhpc3QgaW4gXFxgdGhlbWUuY29sb3JTY2hlbWVzXFxgLmApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgc2V0U3RhdGUoY3VycmVudFN0YXRlID0+IHtcbiAgICAgICAgICBjb25zdCBuZXdTdGF0ZSA9ICgwLCBfZXh0ZW5kczIuZGVmYXVsdCkoe30sIGN1cnJlbnRTdGF0ZSk7XG4gICAgICAgICAgcHJvY2Vzc1N0YXRlKGN1cnJlbnRTdGF0ZSwgbW9kZSA9PiB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShgJHtjb2xvclNjaGVtZVN0b3JhZ2VLZXl9LSR7bW9kZX1gLCB2YWx1ZSk7XG4gICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgIC8vIFVuc3VwcG9ydGVkXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAobW9kZSA9PT0gJ2xpZ2h0Jykge1xuICAgICAgICAgICAgICBuZXdTdGF0ZS5saWdodENvbG9yU2NoZW1lID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAobW9kZSA9PT0gJ2RhcmsnKSB7XG4gICAgICAgICAgICAgIG5ld1N0YXRlLmRhcmtDb2xvclNjaGVtZSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICAgIHJldHVybiBuZXdTdGF0ZTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHNldFN0YXRlKGN1cnJlbnRTdGF0ZSA9PiB7XG4gICAgICAgIGNvbnN0IG5ld1N0YXRlID0gKDAsIF9leHRlbmRzMi5kZWZhdWx0KSh7fSwgY3VycmVudFN0YXRlKTtcbiAgICAgICAgY29uc3QgbmV3TGlnaHRDb2xvclNjaGVtZSA9IHZhbHVlLmxpZ2h0ID09PSBudWxsID8gZGVmYXVsdExpZ2h0Q29sb3JTY2hlbWUgOiB2YWx1ZS5saWdodDtcbiAgICAgICAgY29uc3QgbmV3RGFya0NvbG9yU2NoZW1lID0gdmFsdWUuZGFyayA9PT0gbnVsbCA/IGRlZmF1bHREYXJrQ29sb3JTY2hlbWUgOiB2YWx1ZS5kYXJrO1xuICAgICAgICBpZiAobmV3TGlnaHRDb2xvclNjaGVtZSkge1xuICAgICAgICAgIGlmICgham9pbmVkQ29sb3JTY2hlbWVzLmluY2x1ZGVzKG5ld0xpZ2h0Q29sb3JTY2hlbWUpKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGBcXGAke25ld0xpZ2h0Q29sb3JTY2hlbWV9XFxgIGRvZXMgbm90IGV4aXN0IGluIFxcYHRoZW1lLmNvbG9yU2NoZW1lc1xcYC5gKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbmV3U3RhdGUubGlnaHRDb2xvclNjaGVtZSA9IG5ld0xpZ2h0Q29sb3JTY2hlbWU7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShgJHtjb2xvclNjaGVtZVN0b3JhZ2VLZXl9LWxpZ2h0YCwgbmV3TGlnaHRDb2xvclNjaGVtZSk7XG4gICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAvLyBVbnN1cHBvcnRlZFxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAobmV3RGFya0NvbG9yU2NoZW1lKSB7XG4gICAgICAgICAgaWYgKCFqb2luZWRDb2xvclNjaGVtZXMuaW5jbHVkZXMobmV3RGFya0NvbG9yU2NoZW1lKSkge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihgXFxgJHtuZXdEYXJrQ29sb3JTY2hlbWV9XFxgIGRvZXMgbm90IGV4aXN0IGluIFxcYHRoZW1lLmNvbG9yU2NoZW1lc1xcYC5gKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbmV3U3RhdGUuZGFya0NvbG9yU2NoZW1lID0gbmV3RGFya0NvbG9yU2NoZW1lO1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oYCR7Y29sb3JTY2hlbWVTdG9yYWdlS2V5fS1kYXJrYCwgbmV3RGFya0NvbG9yU2NoZW1lKTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgIC8vIFVuc3VwcG9ydGVkXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXdTdGF0ZTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfSwgW2pvaW5lZENvbG9yU2NoZW1lcywgY29sb3JTY2hlbWVTdG9yYWdlS2V5LCBkZWZhdWx0TGlnaHRDb2xvclNjaGVtZSwgZGVmYXVsdERhcmtDb2xvclNjaGVtZV0pO1xuICBjb25zdCBoYW5kbGVNZWRpYVF1ZXJ5ID0gUmVhY3QudXNlQ2FsbGJhY2soZSA9PiB7XG4gICAgaWYgKHN0YXRlLm1vZGUgPT09ICdzeXN0ZW0nKSB7XG4gICAgICBzZXRTdGF0ZShjdXJyZW50U3RhdGUgPT4gKDAsIF9leHRlbmRzMi5kZWZhdWx0KSh7fSwgY3VycmVudFN0YXRlLCB7XG4gICAgICAgIHN5c3RlbU1vZGU6IGUgIT0gbnVsbCAmJiBlLm1hdGNoZXMgPyAnZGFyaycgOiAnbGlnaHQnXG4gICAgICB9KSk7XG4gICAgfVxuICB9LCBbc3RhdGUubW9kZV0pO1xuXG4gIC8vIFJlZiBoYWNrIHRvIGF2b2lkIGFkZGluZyBoYW5kbGVNZWRpYVF1ZXJ5IGFzIGEgZGVwXG4gIGNvbnN0IG1lZGlhTGlzdGVuZXIgPSBSZWFjdC51c2VSZWYoaGFuZGxlTWVkaWFRdWVyeSk7XG4gIG1lZGlhTGlzdGVuZXIuY3VycmVudCA9IGhhbmRsZU1lZGlhUXVlcnk7XG4gIFJlYWN0LnVzZUVmZmVjdCgoKSA9PiB7XG4gICAgY29uc3QgaGFuZGxlciA9ICguLi5hcmdzKSA9PiBtZWRpYUxpc3RlbmVyLmN1cnJlbnQoLi4uYXJncyk7XG5cbiAgICAvLyBBbHdheXMgbGlzdGVuIHRvIFN5c3RlbSBwcmVmZXJlbmNlXG4gICAgY29uc3QgbWVkaWEgPSB3aW5kb3cubWF0Y2hNZWRpYSgnKHByZWZlcnMtY29sb3Itc2NoZW1lOiBkYXJrKScpO1xuXG4gICAgLy8gSW50ZW50aW9uYWxseSB1c2UgZGVwcmVjYXRlZCBsaXN0ZW5lciBtZXRob2RzIHRvIHN1cHBvcnQgaU9TICYgb2xkIGJyb3dzZXJzXG4gICAgbWVkaWEuYWRkTGlzdGVuZXIoaGFuZGxlcik7XG4gICAgaGFuZGxlcihtZWRpYSk7XG4gICAgcmV0dXJuICgpID0+IG1lZGlhLnJlbW92ZUxpc3RlbmVyKGhhbmRsZXIpO1xuICB9LCBbXSk7XG5cbiAgLy8gSGFuZGxlIHdoZW4gbG9jYWxTdG9yYWdlIGhhcyBjaGFuZ2VkXG4gIFJlYWN0LnVzZUVmZmVjdCgoKSA9PiB7XG4gICAgY29uc3QgaGFuZGxlU3RvcmFnZSA9IGV2ZW50ID0+IHtcbiAgICAgIGNvbnN0IHZhbHVlID0gZXZlbnQubmV3VmFsdWU7XG4gICAgICBpZiAodHlwZW9mIGV2ZW50LmtleSA9PT0gJ3N0cmluZycgJiYgZXZlbnQua2V5LnN0YXJ0c1dpdGgoY29sb3JTY2hlbWVTdG9yYWdlS2V5KSAmJiAoIXZhbHVlIHx8IGpvaW5lZENvbG9yU2NoZW1lcy5tYXRjaCh2YWx1ZSkpKSB7XG4gICAgICAgIC8vIElmIHRoZSBrZXkgaXMgZGVsZXRlZCwgdmFsdWUgd2lsbCBiZSBudWxsIHRoZW4gcmVzZXQgY29sb3Igc2NoZW1lIHRvIHRoZSBkZWZhdWx0IG9uZS5cbiAgICAgICAgaWYgKGV2ZW50LmtleS5lbmRzV2l0aCgnbGlnaHQnKSkge1xuICAgICAgICAgIHNldENvbG9yU2NoZW1lKHtcbiAgICAgICAgICAgIGxpZ2h0OiB2YWx1ZVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmIChldmVudC5rZXkuZW5kc1dpdGgoJ2RhcmsnKSkge1xuICAgICAgICAgIHNldENvbG9yU2NoZW1lKHtcbiAgICAgICAgICAgIGRhcms6IHZhbHVlXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChldmVudC5rZXkgPT09IG1vZGVTdG9yYWdlS2V5ICYmICghdmFsdWUgfHwgWydsaWdodCcsICdkYXJrJywgJ3N5c3RlbSddLmluY2x1ZGVzKHZhbHVlKSkpIHtcbiAgICAgICAgc2V0TW9kZSh2YWx1ZSB8fCBkZWZhdWx0TW9kZSk7XG4gICAgICB9XG4gICAgfTtcbiAgICBpZiAoc3RvcmFnZVdpbmRvdykge1xuICAgICAgLy8gRm9yIHN5bmNpbmcgY29sb3Itc2NoZW1lIGNoYW5nZXMgYmV0d2VlbiBpZnJhbWVzXG4gICAgICBzdG9yYWdlV2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3N0b3JhZ2UnLCBoYW5kbGVTdG9yYWdlKTtcbiAgICAgIHJldHVybiAoKSA9PiBzdG9yYWdlV2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3N0b3JhZ2UnLCBoYW5kbGVTdG9yYWdlKTtcbiAgICB9XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfSwgW3NldENvbG9yU2NoZW1lLCBzZXRNb2RlLCBtb2RlU3RvcmFnZUtleSwgY29sb3JTY2hlbWVTdG9yYWdlS2V5LCBqb2luZWRDb2xvclNjaGVtZXMsIGRlZmF1bHRNb2RlLCBzdG9yYWdlV2luZG93XSk7XG4gIHJldHVybiAoMCwgX2V4dGVuZHMyLmRlZmF1bHQpKHt9LCBzdGF0ZSwge1xuICAgIGNvbG9yU2NoZW1lLFxuICAgIHNldE1vZGUsXG4g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